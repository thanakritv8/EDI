if(typeof Web=="undefined")Web={DataView:{}};Web.SmartTag=function(){this.initialize()};Web.SmartTag.prototype={isVisible:function(){return this._visible==true},initialize:function(){this._visible=false},_hideMenu:function(){var a=this._tag;if(a&&a.menu){$(a.menu).menu("destroy").remove();$(a.markerSelector).removeClass(a.markerClassName);this.unmark();a.menu=null;a.items=null}},_createTag:function(){var f="1px",c="absolute",h=this,d=function(){},b=function(a){Web.SmartTag._instance.hide(a)},g=(new Date).getTime()*1e4+6.21355968e17,a=function(){h.open();return false},e={left:$('<div class="web-smart-tag left"></div>').appendTo(document.body).css({position:c,width:f}).hide().hover(d,b).click(a),top:$('<div class="web-smart-tag top"></div>').appendTo(document.body).css({position:c,height:f}).hide().hover(d,b).click(a),right:$('<div class="web-smart-tag right"></div>').appendTo(document.body).css({position:c,width:f}).hide().hover(d,b).click(a),bottom:$('<div class="web-smart-tag bottom"></div>').appendTo(document.body).css({position:c,height:f}).hide().hover(d,b).click(a),arrow:$('<div class="web-smart-tag arrow"><span class="button"></span></div>').appendTo(document.body).css({position:c}).hide().hover(d,b).click(a),className:null,uniqueClassName:"st-"+g,markerClassName:"m-"+g};e.selector="."+e.uniqueClassName;e.markerSelector="."+e.markerClassName;$(document).click(function(){h._hideMenu()});return e},exec:function(){var a=this._tag;if(!a._callback)return;var c=$(a.selector),b=a._callback(c);if(b){this._hideMenu();b[0].select()}},open:function(s){var m="left bottom",h="left top";if(s&&!$(s.currentTarget).is(".smart-tag"))return;var e=this,b=e._tag;if(!b._callback)return;var g=$(b.selector),k=b._callback(g);if(k){var t=g.is(b.markerSelector);b.menu&&e._hideMenu();if(!t){g.addClass(b.markerClassName);b.items=k;var c=$(b.selector),a=b.menu=e._buildMenu(k,$([]),0);a.menu({select:function(h,g){for(var f=$(g.item).data("path"),d=b.items,a=null,c=0;c<f.length;c++){a=d[f[c]];if(a.children)d=a.children}if(!a.select)return false;e._hideMenu();a.select()}}).position({my:h,at:m,of:c});var q=c.outerWidth();q>a.outerWidth()&&a.outerWidth(q);var d=c.offset(),n=$(window).scrollLeft(),l=$(window).width(),o=a.outerWidth();if(d.left+o>n+l){a.position({my:h,at:String.format("left-{0} bottom",o-(n+l-d.left)),of:c,collision:"none"});d=a.offset()}var i=a.outerHeight(),p=$(window).scrollTop(),f=p+$(window).height();if(d.top+i>f){var r=c.offset(),j=r.top-p,u=f-r.top+c.outerHeight();if(j>u){a.outerHeight(i>j?j:i);a.position({my:m,at:h,of:b.selector})}else a.outerHeight(f-d.top);a.css("overflow","auto")}a.find("a:first").focus()}}},_buildMenu:function(d,b,c){var e=this,a=$(String.format('<ul class="web-smart-tag menu level{0}">',c));b.length==0&&a.appendTo(document.body);$(d).each(function(g){var c=this;if(!c.text&&c.select)return;var f=b.add(g),d=$("<li></li>").appendTo(a).data("path",f);if(c.text)$('<a href="javascript:"><span class="outer"><span class="inner"></span></span></a>').appendTo(d).find("span.inner").text(c.text);else $('<div class="divider"></div>').appendTo(d);c.checked&&d.addClass("selected");c.icon&&d.addClass(c.icon);c.children&&e._buildMenu(c.children,f).appendTo(d)});return a},show:function(u,c,k,r){var o="right{0} top",i="none",e="left top",g=this;if(g._paused==true)return;var a=g._tag;if(!a)a=g._tag=g._createTag();a._callback=null;if(c){var f=a.className==c,h=a.className&&!f;h&&a.left.removeClass(a.className);!f&&a.left.addClass(c);h&&a.top.removeClass(a.className);!f&&a.top.addClass(c);h&&a.right.removeClass(a.className);!f&&a.right.addClass(c);h&&a.bottom.removeClass(a.className);!f&&a.bottom.addClass(c);h&&a.arrow.removeClass(a.className);!f&&a.arrow.addClass(c);a.className=c}g._visible=true;var b=$(u).addClass(a.uniqueClassName).addClass("smart-tag"),d=b.outerWidth(),m=b.outerHeight()-1,j=-1,n=0;if(b.is(".ui-resizable"))n=3;d-=n;j-=n;if(k){a.containerSelector="#"+k.attr("id");var t=k.offset(),s=k.outerWidth(),p=t.left+s-1-16,q=b.offset();if(q.left+d-1>p){var l=p-q.left;if(l<20){g.hide();return}else{j=l-d;d=l}}a.width=d}a.left.height(m).show().position({my:e,at:e,of:b,collision:i});a.top.width(d).show().position({my:e,at:e,of:b,collision:i});a.right.height(m).show().position({my:e,at:String.format(o,j),of:b,collision:i});a.bottom.width(d).show().position({my:e,at:"left bottom-1",of:b,collision:i});a.arrow.height(m).show().position({my:"right top",at:String.format(o,j),of:b,collision:i});a._callback=r},is:function(a){if(!this._visible)return false;var b=this._tag;return b.left[0]==a||b.top[0]==a||b.right[0]==a||b.bottom[0]==a||b.arrow[0]==a},hide:function(d){var c=this;if(c._paused==true)return;var b=null;if(d){b=d.relatedTarget;if(!b)b=d.toElement}var a=c._tag;if(b&&a){var e=$(b);if(c.is(b)||e.is(a.selector))return}c._visible=false;if(a){c.mark();a.left.hide();a.top.hide();a.right.hide();a.bottom.hide();a.arrow.hide();$(a.selector).removeClass(a.uniqueClassName).removeClass("smart-tag")}},pause:function(){this.hide();this._hideMenu();this._paused=true},resume:function(){this._paused=false},mark:function(){var k="right{0} top",f="none",d="left top",h=this,a=h._tag;if(!a)return;var c=$(a.markerSelector);if(c.length==0)return;var b=h._marker;if(!b)b=h._marker=h._createMarker();if(!b.visible){b.visible=true;b.className=a.className;b.containerSelector=a.containerSelector;b._callback=a._callback;var e=c.outerWidth(),i=c.outerHeight()-1,g=-1,j=0;if(c.is(".ui-resizable"))j=3;e-=j;g-=j;if(a.width<e){g=a.width-e;e=a.width}b.left.addClass(a.className).height(i).show().position({my:d,at:d,of:c,collision:f});b.top.addClass(a.className).width(e).show().position({my:d,at:d,of:c,collision:f});b.right.addClass(a.className).height(i).show().position({my:d,at:String.format(k,g),of:c,collision:f});b.bottom.addClass(a.className).width(e).show().position({my:d,at:"left bottom-1",of:c,collision:f});b.arrow.addClass(a.className).height(i).show().position({my:"right top",at:String.format(k,g),of:c,collision:f})}},_createMarker:function(){var e="1px",b="absolute",f=this,a=this._marker,g=this._tag,d=function(){f.unmark();f.show($(g.markerSelector),a.className,$(a.containerSelector),a._callback)},c=function(){};if(!a)a={left:$('<div class="web-smart-tag left marker"></div>').appendTo(document.body).css({position:b,width:e}).hide().hover(d,c),top:$('<div class="web-smart-tag top marker"></div>').appendTo(document.body).css({position:b,height:e}).hide().hover(d,c),right:$('<div class="web-smart-tag right marker"></div>').appendTo(document.body).css({position:b,width:e}).hide().hover(d,c),bottom:$('<div class="web-smart-tag bottom marker"></div>').appendTo(document.body).css({position:b,height:e}).hide().hover(d,c),arrow:$('<div class="web-smart-tag arrow marker"><span class="button"></span></div>').appendTo(document.body).css({position:b}).hide().hover(d,c)};return a},unmark:function(){var a=this._marker;if(a&&a.visible){a.visible=false;a.left.hide().removeClass(a.className);a.top.hide().removeClass(a.className);a.right.hide().removeClass(a.className);a.bottom.hide().removeClass(a.className);a.arrow.hide().removeClass(a.className)}}};Web.SmartTag._instance=new Web.SmartTag;jQuery.fn.smartTag=function(c,b){var d=arguments,a=Web.SmartTag._instance;if(d.length==2)this.hover(function(){var d=true;if(b.test)d=b.test();d&&a.show(this,c,b.container,b.items)},function(b){a.hide(b)}).click(function(c){var d=$(c.target);if(d.is(".node-button,:input"))return true;b.select&&b.select();if(d.is(".button,.status"))a.exec(c);else a.open(c);return false});else switch(c){case"pause":a.pause();break;case"resume":a.resume();a.hide();break;case"hide":a.hide();a._hideMenu();break;case"destroy":this.off("mouseenter mouseleave click");break;default:throw Error(String.format('Method "{0}" is not supported',c));}return this};Web.DataView.Extensions={};$(document).mousedown(function(h){var c=null,e=".resizable-data-view",f=false,d=$(h.target);if(d.parent().length==0)return;var b=d.closest(e);if(b.length==0)b=d.closest(".DataViewContainer").parent().children(e);if(b.length==0&&d.closest(".HoverMenu,.web-smart-tag").length>0)return;if(b.length>0){var a=b.attr("id");a=a?a.match(/^(.+?)_[a-z]+$/i):c;a=a?a[1]:c;var g=a?$find(a):c;if(g){Web.DataView.Extensions.active(g.extension(),true);f=true}}!f&&Web.DataView.Extensions.active(c,false)}).keydown(function(b){var a=Web.DataView.Extensions.activeTarget(b);a&&a.keydown(b)}).keyup(function(b){var a=Web.DataView.Extensions.activeTarget(b);a&&a.keyup(b)}).keypress(function(b){var a=Web.DataView.Extensions.activeTarget(b);a&&a.keydown(b)});Web.DataView.Extensions.activeTarget=function(b){var a=Web.DataView.Extensions.active();return a&&$(b.target).closest("input,select,textarea,.HoverMenu,.web-smart-tag,.Group,.horizontal-scroll-bar-wrap,.vertical-scroll-bar-wrap").length==0?a:null};Web.DataView.Extensions.active=function(a,d){var c=null;if(arguments.length==0){var e=Web.DataView._activeExtensionId;if(!e)return c;var f=$find(e);return f?f.extension():c}if(a==0)return;if(d==c)return Web.DataView._activeExtensionId==a.dataView().get_id();else{if(d&&this.active(a))return;var b=this.active();if(d){b&&b.deactivate();Web.DataView._activeExtensionId=a.dataView().get_id();a.activate()}else{Web.DataView._activeExtensionId=c;b&&b.deactivate();a&&a.deactivate()}}};if(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>7)Web.DataView.Extensions.DataSheet=function(a){return new Web.DataView.DataSheet(a)};Web.DataView.DataSheet=function(a){this.dataView(a)};Web.DataView.DataSheet.prototype={initialize:function(){var a=this,b=a._dataView;a._rowHeight=15;for(var c=0;c<b._fields.length;c++)if(b._fields[c].OnDemand)a._rowHeight=75;a._headerHeight=15;a._createContainer();a._frozenFieldName=b.readContext("dataSheetFrozenField")},options:function(){return{actionBar:true,description:true}},_createContainer:function(){var a=this,b=a._dataView,c=a._id=b.get_id()+"_DataSheet";a._selector="#"+c;var e=b._element;a.$that().remove();var d=$("<div>").attr("id",c).addClass("container data-sheet resizable-data-view").appendTo(e);a.showRowNumber()&&d.addClass("show-row-numbers")},_reset:function(){var d="destroy",c=null,a=this;a._refreshSpeed=c;$().smartTag("hide");for(var f=a._cellMap,g=a._gapMap,e=a._headerMap,h=a._rowMap,b=0;b<f.length;b++){delete f[b];if(g)delete g[b];if(e)delete e[b];if(h)delete h[b]}a._$horizontalScrollbar.slider(d);a._$verticalScrollbar.slider(d);a.$that().find(".header-cell,.data-cell,span.showing").smartTag(d);a._$dataRows.unbind();a._viewId=c;a._dataView._lastExtension=c;a._cursor=c;a.rowRange(c)},rowRange:function(c,b){var a=this;if(c=="current"){if(!b)return a._currentRowRange;a._lastRowRange=a._currentRowRange;a._currentRowRange=b}else if(c=="last"){if(!b)return a._lastRowRange;a._lastRowRange=b}else{a._lastRowRange=null;a._currentRowRange=null}},rowHeight:function(){return this._rowHeight},headerHeight:function(){return this._headerHeight},charWidth:function(b){if(b==0)b=15;var d=Web.DataView.DataSheet,a=d._charWidth;if(a==null){var e="abcdefghijklmnopqrstuvwzyz0123456789",c=$('<div class="data-row"><div class="data-cell"><div class="data-item"></div></div></div>').appendTo(this.$that()),f=c.find(".data-item").text(e).width();d._charWidth=a=Math.ceil(f/e.length);c.remove()}return b?a*b:a},$that:function(a){var b=this._selector;if(a){if(a.charAt(0)!="_")a=" "+a;b+=a}return $(b)},dataView:function(a){if(a==null)return this._dataView;else this._dataView=a},show:function(){var a=this,j=a._dataView,g=j.get_viewId();if(a._viewId!=g||a.pageSize()!=a._lastPageSize){a._viewId=g;a._allocateCells()}else a.$that().show();a._$sliderPageInfo.hide();if(a.lookup()){var f=a.$that(),b=f.parents(".ModalPlaceholder").find(".HeaderText table:first");b.width("100%");var d=a.$that(".header-row .header-cell:last"),k=d.position(),l=d.outerWidth(),e=k.left+l,i=f.outerWidth(),c=$(window).width()/5*4;if(e>c)e=c;var h=c-i;if(h>0){b.parent().outerWidth(b.outerWidth()+h);a.autoSize(false)}a.cursor(true)}a.autoSize(false)},hide:function(){this.$that().hide()},activate:function(){this.cursor(true)},deactivate:function(){this.cursor(false)},keydown:function(c,u){var y="value",r=":visible",q="option",B="CtrlHome",x="ShiftTab",w="Enter",A="ShiftEnter",z="PageDown",d=true,a=this;if(a._skipKeyDown){a._skipKeyDown=false;return}var k=false;if(a.busy())k=d;else{var o=a._$horizontalScrollbar,n=a.cursor(),l=a.totalRowCount(),e=a.topRowIndex(),j=a.pageSize(),E=a.dataView()._fields,p=E.length-1,h=n.col,b=n.row,f=null;switch(c.keyCode){case 40:f="Down";break;case 38:f="Up";break;case 39:f="Right";break;case 37:f="Left";break;case 34:f=z;break;case 33:f="PageUp";break;case 13:f=c.shiftKey?A:w;break;case 9:f=c.shiftKey?x:"Tab";break;case 36:f=c.ctrlKey?B:"Home";break;case 35:f=c.ctrlKey?"CtrlEnd":"End"}if(f&&!u&&navigator.userAgent.match(/webkit/)){var D=a._lastKey==f;a._lastKey=f;var C=(new Date).getTime(),v=a._refreshSpeed;v=v?v*1.5:100;if(D&&C-a._lastKeyTime<v){f=null;k=d}else a._lastKeyTime=C}switch(f){case"Down":case w:if(f==w&&c.ctrlKey)a.rowCommand(n.row-e,"Select");else if(n.row<l-1){b++;a.cursor(d,b,h);if(e+j-1<b)a.scrollTopRow(b-j+1);else b<e&&a.scrollTopRow(b)}k=d;break;case"Up":case A:if(b>0){b--;a.cursor(d,b,h);if(b<e)a.scrollTopRow(b);else b>e+j-1&&a.scrollTopRow(b-j+1)}k=d;break;case"Right":case"Tab":if(n.col<p||u){h++;if(h>p)h=p;a.cursor(d,b,h);var i=a.cell(0,h),s=a._$verticalScrollbar.offset(),t=o.slider(q),g=i.is(r)?t.value:-1;while(d){var m=i.offset();if(!i.is(r)||m.left+i.outerWidth()>=s.left){if(g==t.max)break;g++;o.slider(q,y,g);a.hScroll(g)}else break}}else if(f=="Tab"&&b<l-1){a.cursor(d,b,0);c.keyCode=37;a.keydown(c,d);c.keyCode=40;a.keydown(c)}!c.ctrlKey&&(b<e||b>e+j-1)&&a.makeCursorVisible();k=d;break;case"Left":case x:if(n.col>0||u){h--;if(h<0)h=0;a.cursor(d,b,h);i=a.cell(0,h);s=a._$verticalScrollbar.offset();t=o.slider(q);g=t.value;while(d){m=i.offset();if(i.is(r)&&m.left+i.outerWidth()<s.left)break;g--;if(g<0)break;o.slider(q,y,g);a.hScroll(g)}if(!i.is(r)||m.left+i.outerWidth()>=s.left){g=t.max;while(d){m=i.offset();if(i.is(r)&&m.left+i.outerWidth()<s.left)break;g--;if(g<0)break;o.slider(q,y,g);a.hScroll(g)}}}else if(f==x&&b>0){a.cursor(d,b,p);c.keyCode=39;a.keydown(c,d);c.keyCode=38;a.keydown(c)}!c.ctrlKey&&(b<e||b>e+j-1)&&a.makeCursorVisible();k=d;break;case z:b+=j;if(b>l-1)b=l-1;a.cursor(d,b,h);e+=j;if(e+j>l)e=l-j;if(e<0)e=0;a.scrollTopRow(e);k=d;break;case"PageUp":b-=j;if(b<0)b=0;a.cursor(d,b,h);e-=j;if(e<0)e=0;a.scrollTopRow(e);k=d;break;case"Home":case B:if(c.ctrlKey)b=0;a.cursor(d,b,0);c.keyCode=37;a.keydown(c,d);c.ctrlKey&&a.makeCursorVisible();break;case"End":case"CtrlEnd":if(c.ctrlKey)b=l-1;a.cursor(d,b,p);c.keyCode=39;a.keydown(c,d);c.ctrlKey&&a.makeCursorVisible()}}if(k&&c.preventDefault){c.preventDefault();c.stopPropagation();a._skipKeyDown=navigator.userAgent.match(/Firefox/)&&!u}},makeCursorVisible:function(){var b=this,e=b.cursor(),a=b.topRowIndex(),c=b.pageSize(),g=e.row,i=b.totalRowCount();if(g<a||g>a+c-1){a=g-Math.floor(c/2);if(a+c>=i)a=i-c;if(a<0)a=0;b.scrollTopRow(a)}var f=b.cell(e.row-a,e.col);if(f.length>0){var j=f.offset(),k=b._$verticalScrollbar.offset();if(j.left+f.outerWidth()>=k.left){var h=b._$horizontalScrollbar,d=h.slider("option");if(d.value++<d.max-1){h.slider("option","value",d.value);b.hScroll(d.value)}}}},keypress:function(){},keyup:function(b){var e=this,a=b.which,j=false,h=a==189||a==109||a==187||a==107||a==173||a==61;if(h&&b.altKey&&b.shiftKey){var f=e.topRowIndex(),d=e.cursor(),i=e.cell(d.row-f,d.col),c=i.find(".node-button"),g=c.is(".collapsed");if(c.length>0&&!c.is(".terminal")&&(!g&&(a==189||a==109||a==173)||g&&(a==187||a==107||a==61))){$().smartTag("hide");e.execute("node-button",d.row-f,d.col,"click",c[0]);b.preventDefault();b.stopPropagation()}}},field:function(a){return this._dataView.findField(a)},fieldUnderAlias:function(a){return this._dataView.findFieldUnderAlias(this.field(a))},hierarchyField:function(){return this._hierarchyField},visibleDataRows:function(p){var c=null,b=this,t=b._dataView,e=c,h=c,q=c,d=p;if(d==c)d=b.pageIndex();var s=t._cachedPages,o=b.pageCount();o==1&&b.pageOffset(0);for(var g=b.pageOffset(),k=g>0&&d<o-1,u=b.hierarchyField()!=c,l=d==o-1&&d>0,a=0;a<s.length;a++){var f=s[a];if(f.index==d)e=f;else if(k&&f.index==d+1)h=f;else if((l||u)&&f.index==d-1)q=f;if(e&&(k&&h||l&&q))break}if(!e||k&&!h||l&&!q)return c;p!=c&&t.set_pageIndex(p);var j=[],r=e.index*b.pageSize()+g,m=r-1;for(a=g;a<e.rows.length;a++){Array.add(j,e.rows[a]);m++}b._bottomInvisibleRow=c;if(h){var n=h.rows,i=n.length;if(i>g)i=g;for(a=0;a<i;a++){Array.add(j,n[a]);m++}b._bottomInvisibleRow=n[i]}b.rowRange("current",{first:r,last:m,rows:j});return j},wait:function(b){var a=this._$pagerRefresh;if(a)if(b||b==null)a.addClass("wait");else a.removeClass("wait")},busy:function(){return this._dataView._isBusy},row:function(b){var a=this._rowMap;if(!a)a=this._rowMap=[];var c=a[b];if(!c){var d=this.$that(String.format("_R{0}",b));c=a[b]=d}return c},cell:function(d,c){var b=this._cellMap;if(!b)b=this._cellMap=[];var a=b[d],e=a?a[c]:null;if(!e){if(!a)a=b[d]=[];e=a[c]=this.$that(String.format("_R{0}_C{1}",d,c))}return e},gap:function(b){var a=this._gapMap;if(!a)a=this._gapMap=[];var d=a[b];if(!d){var c=this.$that(String.format("_RG{0}",b));d=a[b]={gap:c,status:c.find(".status"),number:c.find(".number")}}return d},header:function(b){var a=this._headerMap;if(!a)a=this._headerMap=[];var c=a[b];if(!c){var d=this.$that(String.format("_H{0}",b));c=a[b]=d}return c},refresh:function(i){var s="selected",k=false,j=true,a=this,e=a._dataView,n=e._fields;if(!i){i=a.visibleDataRows();if(i==null){e.goToPage(e.get_pageIndex(),j);return}}var h=a.rowRange("last"),d=a.rowRange("current"),l=[],u=a.pageSize(),A=a.showRowNumber(),K=a.multiSelect(),L=a.topRowIndex(),p=a.hierarchyField(),M=a.keyField(),f=new Sys.StringBuilder;e._disableObjectRef=j;var C=a.systemFilter(),I=Web.DataViewResources.Form,G=e._hasKey(),z=!a._refreshSpeed;if(z)a._refreshSpeed=(new Date).getTime();if(h&&d)if(h.first==d.first&&h.last==d.last)for(var b=0;b<u;b++)l.push(b);else{var g=d.first<h.first?d.last:d.first,w=g==d.last?-1:1;while(w>0&&g<=d.last||w<0&&g>=d.first){if(h.first<=g&&g<=h.last){var F=g-d.first,r=g-h.first;if(0<=r&&r<u){for(var c=0;c<n.length;c++){var D=a.cell(F,c),N=a.cell(r,c);D.empty();var E=N[0].childNodes;E.length>0&&D[0].appendChild(E[0])}l.push(F)}}g+=w}}for(b=0;b<i.length;b++){var o=i[b];if(l.length==0||!Array.contains(l,b))for(c=0;c<n.length;c++){var x=n[c];x=e._allFields[x.Index];f.append('<div class="data-item">');var q=k;if(c==0){K&&f.appendFormat('<input type="checkbox" class="checkbox"/>');if(G)q=j;if(p){var y=o[p.Index];if(y){var P=y.split("/"),m=i[b+1];if(!m)m=a._bottomInvisibleRow;var J=m?m[p.Index]:null,t=C&&Array.contains(C,o[M.Index]);f.appendFormat('<span style="margin-left:{0}px;" class="button node-button{1}{2}" title="{3}"></span>',(P.length-1)*16,(!J||y.length>=J.length)&&!t?" terminal":"",t?" collapsed":"",t?I.Maximize:I.Minimize)}}}q&&f.append('<span class="button">');e._renderItem(f,x,o,k,null,k);q&&f.append("</span>");f.append("</div>");var O=a.cell(b,c);O[0].innerHTML=f.toString();f.clear()}var H=a.row(b).removeClass("empty");if(G)if(e.rowIsSelected(o))H.addClass(s);else H.removeClass(s);A&&a.gap(b).number.text(L+b+1)}e._disableObjectRef=k;for(b=i.length;b<u;b++){for(c=0;c<n.length;c++)a.cell(b,c).empty();a.row(b).removeClass(s).addClass("empty");A&&a.gap(b).number.text("")}a._syncVScrollBar();a.wait(k);if(z)a._refreshSpeed=(new Date).getTime()-a._refreshSpeed;var v=a.cursor(),B=a.totalRowCount();if(v&&v.row>=B)a.cursor(j,B-1,v.col);else a.cursor(j)},reset:function(a){a&&this.pageOffset(0);this.rowRange(null)},fixedColumns:function(){for(var b=this._frozenFieldName,c=this._dataView._fields,a=0;a<c.length;a++){var d=c[a];if(d.Name==b||!b&&d.tagged("data-sheet-freeze"))return a+1}return 0},freeze:function(b){var a=this,d=a._dataView;if(b==null){var c=a.fixedColumns();return c==0?null:d._fields[c-1].Name}if(b=="")b=null;d.writeContext("dataSheetFrozenField",b);a._frozenFieldName=b;a._reset();a.show();a.refresh()},_freeze:function(){var a=this.fixedColumns();this.$that().find("div.data-row").each(function(){$(String.format("div.data-cell:lt({0})",a),this).addClass("fixed")})},_allocateCells:function(){var y="margin-top",u="left middle",t="right-8 middle",s="_VSB .scroll-bar",P='<div class="ui-slider-handle-parent"></div>',O='<div class="ui-handle-helper"></div>',N=".ui-slider-handle",r="absolute",i="pause",f="resume",c=true,M=".header-cell",E="</div>",d=null,m="dataSheetColumnWidth",b=this,a=b;b._createContainer();var g=b._dataView,A=g._fields,R=g._allFields,bb=g._rows,ab=g.get_pageCount(),q=g.get_pageSize();b._lastPageSize=q;for(var o=b.totalRowCount(),L=b.headerHeight(),T=b.rowHeight(),Z=0,e=0;e<R.length;e++){var l=R[e];if(l.tagged("hierarchy-organization"))b._hierarchyField=l}var j=g.readContext(m),J=j==d;if(J)j=[];var X=0,k=b._id,h=new Sys.StringBuilder,v=3;if(b.showRowNumber())v+=o.toString().length;v=b.charWidth(v);h.appendFormat('<div id="{0}_H" class="header-row"><div id="{0}_HG" class="header-gap" style="position:relative;height:{1}px;width:{2}px"><span></span></div>',k,L,v);for(e=0;e<A.length;e++){l=A[e];l=g._allFields[l.AliasIndex];if(J){var C=b.charWidth(l.Columns);j[e]=C}else C=j[e];X+=C;h.appendFormat('<div id="{0}_H{1}" class="header-cell c{1}" style="position:relative;width:{2}px;height:{3}px"></div>',k,e,C,L)}h.append(E);for(var n=0;n<q;n++){var z="";if(n==0)z+=" first";if(n==q-1)z+=" last";if(n%2!=0)z+=" alternating";h.appendFormat('<div id="{0}_R{1}" class="data-row{3}"><div id="{0}_RG{1}" class="data-gap" style="position:relative;height:{2}px;width:{4}px"><div class="gap-item"><span class="status">&nbsp;</span><span class="number"></span></div></div>',k,n,T,z,v);for(e=0;e<A.length;e++){l=A[e];l=g._allFields[l.AliasIndex];h.appendFormat('<div id="{0}_R{1}_C{2}" class="data-cell c{2}" style="position:relative;width:{3}px;height:{4}px"><!--r{1}, c{2}--></div>',k,n,e,j[e],T)}h.append(E)}h.append(E);h.appendFormat('<div id="{0}_HSB" class="horizontal-scroll-bar-wrap"><div class="scroll-bar"></div></div>',k);h.appendFormat('<div id="{0}_Pager" class="pager"><span class="showing"></span><span title="Refresh" class="refresh"></span></div>',k);h.appendFormat('<div id="{0}_VSB" class="vertical-scroll-bar-wrap"><div class="scroll-bar"></div></div>',k);var p=b.$that(),K=p.outerWidth();p.show().html(h.toString());var G=a.sort();$(M,p).each(function(c){var b=a._dataView._fields[c];b=a._dataView._allFields[b.AliasIndex];c==0&&a.multiSelect()&&$('<input type="checkbox" class="checkbox"/>').appendTo(this);if(b.AllowSorting){var e=$('<span class="button"></span>').appendTo(this).text(b.HeaderText).attr("title",String.format(Web.DataViewResources.HeaderFilter.SortBy,b.HeaderText)),d=$('<span class="status"></span>').appendTo(e);G&&G.fieldName==b.Name&&d.addClass(G.order!="desc"?"sort-asc":"sort-desc")}else $(this).text(b.HeaderText)});h.clear();var S=b.$that("div.header-row"),H=0,B;b._$headerCells=$(S).find("div.header-cell,div.header-gap").each(function(b){var d=$(this);H+=d.outerWidth();if(b==0)B=d.outerHeight();b>0&&d.resizable({handles:"e",maxWidth:K-50,alsoResize:String.format("#{0} div.data-cell.c{1}",k,b-1),resize:function(e,d){j[b-1]=d.size.width;g.writeContext(m,j);a.cursor(c)},start:function(){},stop:function(){a.autoSize(c);$().smartTag(f)}}).find(".ui-resizable-handle").mousedown(function(){$().smartTag(i)}).mouseup(function(){$().smartTag(f)}).dblclick(function(l){var d="cursor",h=$(l.target),i=h.css(d);h.css(d,"default");var e=0;a.$that(String.format("div.data-cell.c{0} div.data-item",b-1)).each(function(){var a="position",b=$(this),d=b.css(a);b.css(a,r);var c=b.outerWidth();b.css(a,d);if(c>e)e=c});if(e<K-20){j[b-1]=e;$(String.format("#{0} div.header-cell.c{1}, #{0} div.data-cell.c{1}",k,b-1)).width(e);a.autoSize(c);$().smartTag(f);g.writeContext(m,j);a.cursor(c)}h.css(d,i)})});S.height(B);var Q=b._$dataRows=b.$that("div.data-row").each(function(){var a=this;H=0;var b=$("div.data-cell,div.data-gap",a).each(function(b){var a=$(this);H+=a.outerWidth();if(b==0)B=a.outerHeight()});$(a).height(B);b.css("top",0)}).click(function(d){var b=$(d.target),f=parseInt($(this).attr("id").match(/_R(\d+)$/)[1]),e=a.cellIndex(b),c="row";action="click";if(b.is(".node-button"))c="node-button";a.execute(c,f,e,action,d.target)});b._$dataGaps=b.$that("div.data-gap");var F=navigator.userAgent.match(/Firefox/)==c,V=F?"wheel":"mousewheel";Q.bind(V,function(e){var h=e.originalEvent?e.originalEvent.wheelDelta/120:d;if(h==d)h=e.originalEvent.deltaY!=d?e.originalEvent.deltaY:d;if(h!=d&&a.pageCount()>1){$().smartTag(i);if(!a.busy()){var l=Math.ceil(Math.abs(h)),g=e.originalEvent.wheelDeltaX;if(g==d)g=e.originalEvent.deltaX!=d?e.originalEvent.deltaX:d;if(g!=d&&g!=0){if(!F)g*=-1;e.keyCode=g>0?37:39;e.ctrlKey=c;a.keydown(e)}else{if(F)h*=-1;var b=a.topRowIndex(),k=a.pageSize();if(h<0){b=b+l;var j=a.totalRowCount();if(b+k>j)b=j-k;if(b<0)b=0;a.scrollTopRow(b)}else{b=b-l;if(b<0)b=0;a.scrollTopRow(b)}}}e.preventDefault();e.stopPropagation();$().smartTag(f)}});b.$that(M).each(function(b){$(this).smartTag("header-cell",{container:p,items:function(){return a._contextMenuOfColumn(b)}})});Q.each(function(b){$(this).find(".data-cell.c0").smartTag("data-cell",{container:p,items:function(){return a._contextMenuOfDataRow(b)},test:function(){var c=a.absoluteRowIndex(b);return c<a.totalRowCount()},select:function(){var d=a.absoluteRowIndex(b);o=a.totalRowCount();if(d>=o)d=o-1;a.cursor(c,d,0)}})});b._$pageShowing=b.$that("div.pager span.showing").smartTag("pager-menu",{container:p,items:function(){var b=[];$(Web.DataViewResources.Pager.PageSizes).each(function(){var c=this;b.push({text:String.format("{0} {1}",Web.DataViewResources.Pager.ItemsPerPage,this),checked:this==g.get_pageSize(),select:function(){a.pageSize(c)}})});return b}});b._freeze();var w=b._$horizontalScrollbar=b.$that("_HSB .scroll-bar");w.slider({orientation:"horizontal",min:0,max:0,value:0,animate:100,slide:function(c,b){a.hScroll(b.value)},start:function(){$().smartTag(i)},stop:function(){$().smartTag(f);w.width("100%")}});var W=w.find(N).mousedown(function(){w.width(U.width())}),U=W.append(O).wrap(P).parent(),cb=b.$that("div.data-row.last"),D=b._$sliderPageInfo=$("<div>").addClass("data-sheet pager-info-popup").css({position:r}).hide().appendTo(document.body);a._pageInfoTimeout=-1;a.pageInfoSlideTimeout=d;var I=b._$verticalScrollbar=b.$that(s).slider({orientation:"vertical",min:0,max:o<=q?0:o-q,animate:100,value:g.get_pageIndex()*q+a.pageOffset(),slide:function(f,e){a._skipSyncVScrollBar=c;var b=a.scrollTopRow(e.value,c);if(!a._pageInfoSlideTimeout)a._pageInfoSlideTimeout=setTimeout(function(){D.show().position({my:t,at:u,of:x});a._pageInfoSlideTimeout=d},50);a._pageInfoTimeout!=-1&&clearTimeout(a._pageInfoTimeout);a._updatePageInfo(b)},change:function(){D.show().position({my:t,at:u,of:$(this).find("a.ui-slider-handle")})},start:function(){if(a.busy())return false;$().smartTag(i)},stop:function(){$().smartTag(f);a._pageInfoTimeout=setTimeout(function(){D.hide()},1e3);if(a.resetVScrollBar){a.$that(s).height("100%").css({"margin-top":0});a._$vSliderHandleParent.css(y,+x.height()/2);a.resetVScrollBar=false}}}),x=b._$vSliderHandle=I.find(N).mousedown(function(){if(I.slider("option","max")>0){a.resetVScrollBar=c;a.$that(s).height(a._$vSliderHandleParent.height()).css({"margin-top":+x.height()/2});a._$vSliderHandleParent.css(y,0)}}),Y=b._$vSliderHandleParent=x.append(O).wrap(P).parent();b._$pagerRefresh=b.$that("_Pager .refresh").click(function(){if(!a.busy())if(g._hasSearchAction)g.search();else g.sync();return false});b.autoSize();(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>=9)&&$(window).resize(function(){a.autoSize(c)})},cellIndex:function(d){var b=".data-cell",c=$(d).parent(b,b).andSelf().attr("id"),a=c?c.match(/_C(\d+)$/):null;a=a==null?-1:parseInt(a[1]);return a},hScroll:function(d){var a=this,b=a.fixedColumns(),c=b==0?"":String.format(":gt({0})",b-1);a.$that("div.data-cell").show();a.$that("div.header-cell").show();a.$that(String.format("div.header-row div.header-cell:lt({0}){1}",d+b,c)).hide();this._$dataRows.each(function(){$(this).find(String.format("div.data-cell:lt({0}){1}",d+b,c)).hide()});$().smartTag("hide");a.cursor(true)},keyField:function(){var b=this._dataView,a=b._keyFields;return a.length>0?a[0]:null},topRowIndex:function(){return this.pageIndex()*this.pageSize()+this.pageOffset()},absoluteRowIndex:function(a){return a+this.topRowIndex()},execute:function(n,c,b,l){var a=this;if(a.busy())return;var e=a._dataView;if(n=="node-button"){var j=a.keyField(),i=a.rowRange("current").rows,k=i[c][j.Index];if(l=="click"){a.systemFilter(k);e._clearCache(false);e._requiresRowCount=true;e.goToPage(a.pageIndex())}}else{var f=a.totalRowCount(),d=a.absoluteRowIndex(c);if(d>=f)d=f-1;if(b>=0){a.cursor(true,d,b);a.makeCursorVisible()}else{var m=a.cursor();b=m.col;var h=a.cell(c,b);if(!h.is(":visible")||h.offset().left>a._$verticalScrollbar.offset().left){var g=$(a._$dataRows[c]).find(".data-cell:visible");if(g.length>0)b=a.cellIndex(g[0])}a.cursor(true,d,b);a.rowCommand(c,"Select")}}},rowCommand:function(b,f,c){var d=this._dataView,a=this.rowRange("current").rows;if(b>=a.length)b=a.length-1;var e=a[b];d.rowCommand(e,"Select",c);$().smartTag("hide")},systemFilter:function(b){var a=this._nodeFilter;if(b==null||b==true)return a;else if(b==false)this._nodeFilter=null;else{if(!a)a=this._nodeFilter=["collapse-nodes"];var c=Array.indexOf(a,b);if(c==-1)Array.add(a,b);else Array.remove(a,b)}},pageIndex:function(){var a=this._dataView;return a.get_pageIndex()},pageCount:function(){var a=this._dataView;return a.get_pageCount()},pageOffset:function(b){var a=this,c=a._dataView;if(b==null)return a._pageOffset!=null?a._pageOffset:0;else a._pageOffset=b},scrollTopRow:function(k,b){var d=this;if(b==null)b=false;var a=d,j=d._dataView,m=d.totalRowCount(),h=j.get_pageSize(),f=b?m-h-k:k,g=Math.floor(f/h),n=f-g*h;a._goToPageTimeout!=-1&&clearTimeout(a._goToPageTimeout);a.pageOffset(n);var c=a.visibleDataRows(g),e=function(){if(c)a.refresh(c);else j.goToPage(g,false)},l=100,i=d._refreshSpeed;if(i==null||i<75||b==false)if(b&&!c)a._goToPageTimeout=window.setTimeout(e,500);else e();else{if(b&&!c)l=500;a._goToPageTimeout=window.setTimeout(e,l)}return f},autoSize:function(B){var q="right top",k="option",j=":visible",a=this,u=a;u._refreshSpeed=null;if(B==true){a._autoSizeTimeout&&clearTimeout(a._autoSizeTimeout);a._autoSizeTimeout=setTimeout(function(){u.autoSize();this._autoSizeTimeout=null},50);return}var z=$(window).scrollTop(),b=a.$that();if(!b.is(j))return;var s=a._dataView,g=s._fields,m=$(".container.resizable-data-view:visible");m.hide();b.outerWidth($(s._element).width());m.show();var d=a._$horizontalScrollbar,y=d.find(".ui-slider-handle"),x=d.find(".ui-slider-handle-parent"),n=1+a.$that("_VSB").outerWidth();a.$that("_HSB").outerWidth(b.outerWidth()-n);var h=-1,f=-1,i=b.width()-n-b.find("div.header-cell.c0").position().left;b.find("div.data-row.first div.data-cell.fixed").each(function(){var a=$(this).width();i-=a;l+=a});var o=a.fixedColumns(),l=0,r=function(c){var a=$(c),b=a.is(j);!b&&a.show();var d=a.outerWidth();!b&&a.hide();return d},w=b.find("div.data-row.first div.data-cell").each(function(a){if(a>=o){var b=r(this),c=l+b;if(c>=i){h=a;return false}l+=b}}),v=0;$(w.get().reverse()).each(function(b){var a=r(this),c=v+a;if(c>=i){f=g.length-b-o;return false}v+=a});var c=h!=-1?g.length-h:0;if(c<f)c=f;a._rightMostFirstInvisibleColumn=f;d.slider(k,"max",c);d.slider(k,"value")>c&&d.slider(k,"value",c);var p=d.width(),e=p;if(c>0)e=(g.length-c)/g.length*e;else{a.$that("div.data-cell").show();a.$that("div.header-cell").show()}y.css({width:e,"margin-left":-e/2});x.width(p-e);var A=a.$that(".header-row"),t=a.$that("div.data-row.last");a.$that("_VSB").css({position:"absolute"}).height(t.position().top+t.outerHeight()).position({my:q,at:q,of:A,collision:"none"});a._updatePageInfo();$(window).scrollTop(z)},_syncVScrollBar:function(){var j="margin-top",g="option",a=this;if(a._skipSyncVScrollBar){a._skipSyncVScrollBar=false;return}var m=a._dataView,d=a._$verticalScrollbar,e=a.totalRowCount(),f=m.get_pageSize(),h=e<=f?0:e-f,l=d.slider(g),k=a.topRowIndex(),b=e>f?e-f-k:0;if(b<0)b=0;if(l.max!=h){d.slider(g,"max",h);if(b>h)b=h-1;d.slider(g,"value",b);a._$sliderPageInfo.hide()}else if(l.value!=b){d.slider(g,"value",b);a._$sliderPageInfo.hide()}a._updatePageInfo(k);var i=d.height(),c=0;if(e>f)c=i*(f/e);if(c<10)c=10;a.$that("_VSB .scroll-bar").height("100%");if(d.slider(g,"max")==0){a._$vSliderHandleParent.height("100%").css(j,0);a._$vSliderHandle.css({height:i,"margin-bottom":0})}else{a._$vSliderHandleParent.height(i-c).css(j,c/2);a._$vSliderHandle.css({height:c,"margin-bottom":-c/2})}},_updatePageInfo:function(b){var f="right middle",c=this,g=c._dataView,a=c.totalRowCount(),d=g.get_pageSize();if(d>a)d=a;if(b==null)b=g.get_pageIndex()*d+c.pageOffset();var e=b+d;if(e>=a){e=a;b=a-d}b++;c._$sliderPageInfo[0].innerHTML=String.format("{0} - {1}",b,e);var h=Web.DataViewResources;c._$pageShowing[0].innerHTML=a>0?String.format(h.Pager.ShowingItems,b,e,a):h.Data.NoRecords;c._$pagerRefresh.css({position:"absolute"}).position({my:f,at:f,of:c.$that("_Pager"),collision:"none"})},lookup:function(){return this.dataView().get_lookupField()},_contextMenuOfDataRow:function(c){var a="Select",b=this;return[{text:a,select:function(){if(b.lookup())b.rowCommand(c,a);else b.rowCommand(c,a,"editForm1")}}]},sort:function(c){var d=null,b=this,e=b._dataView;if(c==d){c=e.get_sortExpression();var a=c?c.match(/^(\w+?)(\s+(asc|desc))?$/):d;return{fieldName:a?a[1]:d,order:a?a[3]:d}}else{if(b.busy())return;b.pageOffset(0);e.sort(c);b._$headerCells.find(".status").removeClass("sort-asc sort-desc");a=b.sort();if(a.fieldName){var f=b.fieldUnderAlias(a.fieldName);f&&b.header(f.Index).find(".status").addClass(a.order!="desc"?"sort-asc":"sort-desc")}}},showRowNumber:function(){return this._dataView.get_showRowNumber()==true},multiSelect:function(){return this._dataView.get_showMultipleSelection()},totalRowCount:function(){var a=this._dataView;return a._totalRowCount},pageSize:function(b){if(this.busy())return;var a=this._dataView;if(b==null)return a.get_pageSize();else{this._reset();a._clearCache();a.set_pageSize(b)}},_contextMenuOfColumn:function(o){var b=[],d=this,k=d._dataView,n=k._fields,f=n[o],i=k._allFields[f.AliasIndex],m=Web.DataViewResources,a=m.HeaderFilter,j=m.Grid;if(i.AllowSorting){var h=a.GenericSortAscending,g=a.GenericSortDescending;switch(i.FilterType){case"Text":h=a.StringSortAscending;g=a.StringSortDescending;break;case"Date":h=a.DateSortAscending;g=a.DateSortDescending}var e=this.sort(),c=i.Name;b.push({select:function(){d.sort(c)}});b.push({text:h,icon:"sort-asc",checked:e.fieldName==c&&e.order!="desc",select:function(){d.sort(c+" asc")}});b.push({text:g,icon:"sort-desc",checked:e.fieldName==c&&e.order=="desc",select:function(){d.sort(c+" desc")}})}var l=this.freeze()==f.Name;b.push({text:l?j.Unfreeze:j.Freeze,select:function(){d.freeze(l?"":f.Name)}});return b.length>0?b:[{text:"Header Item 1",select:function(){alert("header 1")}},{text:"Header item number 2",select2:function(){alert("header 2")},children:[{text:"Header Sub Item 1",select:function(){alert("header sub item 1")}},{text:"Header Sub Item 2",select:function(){alert("header sub item 2")}},{text:"Header Sub Item 3",select:function(){alert("header sub item 3")}},{text:"Header Sub Item 4",select:function(){alert("header sub item 4")}},{text:"Header Sub Item 5",select:function(){alert("header sub item 5")}}]},{text:"item #3",select:function(){alert("header 3")}}]},cursor:function(k,o,n){var h="none",g="left top",f="cursor",e="3px",d="absolute",b=this,r=b._dataView;if(!Web.DataView.Extensions.active(b))k=false;var i=b.$that(),a=b._cursor;if(!a)a=b._cursor={left:$('<div class="cursor left"></div>').appendTo(i).css({position:d,width:e}).hide(),top:$('<div class="cursor top"></div>').appendTo(i).css({position:d,height:e}).hide(),right:$('<div class="cursor right"></div>').appendTo(i).css({position:d,width:e}).hide(),bottom:$('<div class="cursor bottom"></div>').appendTo(i).css({position:d,height:e}).hide(),row:0,col:0};if(k==null)return a;b._$dataGaps.removeClass(f);b._$headerCells.removeClass(f);if(k){if(o!=null)a.row=o;if(n!=null)a.col=n;var q=b.pageSize(),p=b.topRowIndex(),j=a.row-p;if(j<0||j>=q)b.cursor(false);else{var c=b.cell(j,a.col),l=c.outerHeight()-3,m=c.outerWidth()+3;a.left.height(l).show().position({my:g,at:"left-2 top+1",of:c,collision:h});a.top.width(m).show().position({my:g,at:"left-2 top-2",of:c,collision:h});a.right.height(l).show().position({my:g,at:"right-2 top+1",of:c,collision:h});a.bottom.width(m).show().position({my:g,at:"left-2 bottom-2",of:c,collision:h});b.gap(j).gap.addClass(f);b.header(a.col).addClass(f)}}else{a.left.hide();a.top.hide();a.right.hide();a.bottom.hide()}}}