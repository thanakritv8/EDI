Type.registerNamespace("Web");Web.DataViewMode={View:"View",Lookup:"Lookup"};Web.DynamicExpressionScope={Field:0,ViewRowStyle:1,CategoryVisibility:2,DataFieldVisibility:3,DefaultValues:4,ReadOnly:5,Rule:6};Web.AutoHideMode={Nothing:0,Self:1,Container:2};Web.DynamicExpressionType={RegularExpression:0,ClientScript:1,ServerExpression:2,CSharp:3,VisualBasic:4,Any:4};Web.DataViewAggregates=["None","Sum","Count","Avg","Max","Min"];Web.FieldSearchMode={Default:0,Required:1,Suggested:2,Allowed:3,Forbidden:4};Web.PageState={};Web.PageState._init=function(){if(!this._state){var a=$get("__COTSTATE");if(a!=null&&!String.isNullOrEmpty(a.value))this._state=Sys.Serialization.JavaScriptSerializer.deserialize(a.value);else this._state={}}};Web.PageState._save=function(){var a=$get("__COTSTATE");if(a!=null)a.value=Sys.Serialization.JavaScriptSerializer.serialize(this._state)};Web.PageState.read=function(a){this._init();return this._state[a]};Web.PageState.write=function(b,a){this._init();this._state[b]=a;this._save()};Sys.StringBuilder.prototype.appendFormat=function(){this.append(String._toFormattedString(false,arguments))};String.isNullOrEmpty=function(a){return a==null||a.length==0};String.isBlank=function(a){return a==null||typeof a=="string"&&a.match(Web.DataView._blankRegex)!=null};String._wordTrimRegex=/(\S{16})\S+/g;String._tagRegex=/<\/?\w.*?>/g;String.trimLongWords=function(a,f){if(a==null)return a;var e=this._wordTrimRegex;if(f!=null)e=new RegExp(String.format("(\\S{{{0}}})\\S+",f),"g");var h=a.replace(e,"$1...");if(a.match(String._tagRegex)){var d=new Sys.StringBuilder,g=String._tagRegex,b=g.exec(a),c=0;while(b){tag=b[0];b.index>0&&d.append(a.substring(c,b.index).replace(e,"$1..."));c=b.index+tag.length;d.append(tag);b=g.exec(a)}c<a.length&&d.append(a.substring(c));h=d.toString()}return h};String.htmlEncode=function(a){return typeof a=="string"&&a.match(Web.DataView._htmlTest)?a:Web.DataView.htmlEncode(a)};String.isJavaScriptNull=function(a){return a=="%js%null"||a=="null"};String.jsNull="%js%null";Web.DataView=function(c){var b=null,a=this;Web.DataView.initializeBase(a,[c]);a._controller=b;a._viewId=b;a._servicePath=b;a._baseUrl=b;a._pageIndex=-1;a._pageSize=Web.DataViewResources.Pager.PageSizes[0];a._sortExpression=b;a._filter=[];a._externalFilter=[];a._categories=b;a._fields=b;a._allFields=b;a._rows=b;a._totalRowCount=0;a._firstPageButtonIndex=0;a._pageCount=0;a._views=[];a._actionGroups=[];a._selectedKey=[];a._selectedKeyFilter=[];a._lastCommandName=b;a._lastViewId=b;a._lookupField=b;a._filterFields=b;a._filterSource=b;a._mode=Web.DataViewMode.View;a._lookupPostBackExpression=b;a._domFilterSource=b;a._selectedKeyList=[];a._pageSizes=Web.DataViewResources.Pager.PageSizes};Web.DataView.htmlEncode=function(a){if(a!=null&&typeof a!="string")a=a.toString();return a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a};Web.DataView.htmlAttributeEncode=function(a){return a!=null&&typeof a=="string"?a.replace(/\x27/g,"&#39;").replace(/\x22/g,"&quot;"):a};Web.DataView.isIE6=this._ie6=Sys.Browser.agent==Sys.Browser.InternetExplorer&&Sys.Browser.version<7;Web.DataView.prototype={get_controller:function(){return this._controller},set_controller:function(a){this._controller=a},get_useCase:function(){return this._useCase},set_useCase:function(a){this._useCase=a},get_viewId:function(){var a=this;if(!a._viewId&&a._views.length>0)a._viewId=a._views[0].Id;var b=a._viewId;if(!b)b="";return b},set_viewId:function(a){this._viewId=a},get_newViewId:function(){return this._newViewId},set_newViewId:function(a){this._newViewId=a},get_servicePath:function(){return this._servicePath},set_servicePath:function(a){this._servicePath=this.resolveClientUrl(a);if(!Web.DataView._servicePath)Web.DataView._servicePath=a},get_baseUrl:function(){return this._baseUrl},set_baseUrl:function(a){if(a=="~")a="/";this._baseUrl=a;if(!Web.DataView._baseUrl)Web.DataView._baseUrl=a},get_siteUrl:function(){var b=this.get_servicePath(),a=b.match(/(^.+?\/)\w+\/\w+\.asmx/);return a?a[1]:""},resolveClientUrl:function(a){return a?a.replace(/~\x2f/g,this.get_baseUrl()):null},get_hideExternalFilterFields:function(){return this._hideExternalFilterFields!=false},set_hideExternalFilterFields:function(a){this._hideExternalFilterFields=a},get_backOnCancel:function(){return this._backOnCancel==true},set_backOnCancel:function(a){this._backOnCancel=a},get_confirmContext:function(){return this._confirmContext},set_confirmContext:function(a){this._confirmContext=a},get_startCommandName:function(){return this._startCommandName},set_startCommandName:function(a){this._startCommandName=a},get_startCommandArgument:function(){return this._startCommandArgument},set_startCommandArgument:function(a){this._startCommandArgument=a},get_exitModalStateCommands:function(){return this._exitModalStateCommands},set_exitModalStateCommands:function(a){this._exitModalStateCommands=a},get_showActionBar:function(){var a=this.extension();if(a){var b=a.options();return b.actionBar==true}return this._showActionBar!=false},set_showActionBar:function(a){this._showActionBar=a},get_showActionButtons:function(){var a=this._showActionButtons;if(a==null){a="TopAndBottom";this._showActionButtons=a}return a},set_showActionButtons:function(a){this._showActionButtons=a},get_showSearchBar:function(){return this._showSearchBar==true&&!(__tf!=4)},set_showSearchBar:function(a){this._showSearchBar=a},get_searchOnStart:function(){return this._searchOnStart==true},set_searchOnStart:function(a){this._searchOnStart=a;a&&this.set_searchBarIsVisible(true)},get_searchBarIsVisible:function(){return this._searchBarIsVisible==true},set_searchBarIsVisible:function(a){this._searchBarIsVisible=a},get_showModalForms:function(){return $appfactory.mobile?true:this._showModalForms==true},set_showModalForms:function(a){this._showModalForms=a},get_showDescription:function(){var a=this.extension();if(a){var b=a.options();return b.description==true}return this._showDescription!=false},set_showDescription:function(a){this._showDescription=a},get_showFirstLetters:function(){return this._showFirstLetters==true},set_showFirstLetters:function(a){this._showFirstLetters=a},get_autoSelectFirstRow:function(){return this._autoSelectFirstRow==true},set_autoSelectFirstRow:function(a){this._autoSelectFirstRow=a},get_autoHighlightFirstRow:function(){return this._autoHighlightFirstRow==true},set_autoHighlightFirstRow:function(a){this._autoHighlightFirstRow=a},get_refreshInterval:function(){return this._refreshInterval},set_refreshInterval:function(a){this._refreshInterval=!(__tf!=4)?a:0},get_showViewSelector:function(){return this._showViewSelector!=false},set_showViewSelector:function(a){this._showViewSelector=a},get_showPager:function(){var a=this._showPager;if(a==null||a==true){a="Bottom";this._showPager=a}else if(a==false)a="None";return a},set_showPager:function(a){this._showPager=a},get_showPageSize:function(){return this._showPageSize!=false},set_showPageSize:function(a){this._showPageSize=a},get_selectionMode:function(){return this._selectionMode},set_selectionMode:function(a){this._selectionMode=a},multiSelect:function(){return this._selectionMode=="Multiple"},get_cookie:function(){return this._cookie},set_cookie:function(a){this._cookie=a},get_pagerButtonCount:function(c){var b=this;if(!b._pagerButtonCount||c){var a=Web.DataViewResources.Pager.PageButtonCount;if(b.get_pageCount()>a){a=a-3;if(a<5)a=5}b._pagerButtonCount=a}return b._pagerButtonCount},get_pageIndex:function(){return this._pageIndex},set_pageIndex:function(b){var a=this;a._pageIndex=b;if(b>=0){var c=a.get_pagerButtonCount();if(b>=a._firstPageButtonIndex+c)a._firstPageButtonIndex=b;else if(b<a._firstPageButtonIndex){a._firstPageButtonIndex-=c;if(b<a._firstPageButtonIndex)a._firstPageButtonIndex=b}if(a._firstPageButtonIndex<0)a._firstPageButtonIndex=0;if(a.get_pageCount()-a._firstPageButtonIndex<c)a._firstPageButtonIndex=a.get_pageCount()-c;if(a._firstPageButtonIndex<0)a._firstPageButtonIndex=0}if(b==-2)a._pageOffset=0},get_pageOffset:function(){return!this.get_isDataSheet()?0:this._pageOffset==null?0:this._pageOffset},set_pageOffset:function(a){this._pageOffset=a},get_categoryTabIndex:function(){return this._categoryTabIndex},set_categoryTabIndex:function(b){var a=this;if(b!=a._categoryTabIndex){a._categoryTabIndex=b;a._updateTabbedCategoryVisibility();if(b!=-1){if(a._modalPopup){a._resizeContainerBounds();a._modalPopup.show()}_body_performResize();if(a.get_isEditing()){a._focusedFieldName=null;a._focus()}}}},get_enabled:function(){return this._enabled==null?true:this._enabled},set_enabled:function(a){this._enabled=a},get_showInSummary:function(){return this._showInSummary},set_showInSummary:function(a){this._showInSummary=a},get_summaryFieldCount:function(){return this._summaryFieldCount},set_summaryFieldCount:function(a){this._summaryFieldCount=a},get_showLEVs:function(){return this._showLEVs},set_showLEVs:function(a){this._showLEVs=a},get_tag:function(){return this._tag},set_tag:function(a){this._tag=a},get_pageSize:function(){return this._pageSize},set_pageSize:function(b){var a=this;a._pageSize=b;a._pageOffset=0;delete a._viewColumnSettings;if(Array.indexOf(a._pageSizes,b)==-1){a._pageSizes=Array.clone(a._pageSizes);Array.insert(a._pageSizes,0,b)}a._fields!=null&&a.refreshData()},get_sortExpression:function(){return this._sortExpression},set_sortExpression:function(b){var c=" asc",a=this;if(!b||b.length==0)a._sortExpression=null;else{var d=b.match(/^(\w+)\s*((asc|desc)|$)/i);if(d&&d[2].length==0)if(String.isNullOrEmpty(a._sortExpression)||a._sortExpression.match(/^(\w+)\s*/)[1]!=d[1])a._sortExpression=b+c;else if(a._sortExpression.endsWith(c))a._sortExpression=b+" desc";else a._sortExpression=b+c;else a._sortExpression=b}},get_filterSource:function(){return this._filterSource},set_filterSource:function(a){this._filterSource=a},get_filterFields:function(){return this._filterFields},set_filterFields:function(a){this._filterFields=a},get_visibleWhen:function(){return this._visibleWhen},set_visibleWhen:function(a){this._visibleWhen=a},get_showQuickFind:function(){return this._showQuickFind!=false},get_quickFindText:function(){return String.isNullOrEmpty(this._quickFindText)?Web.DataViewResources.Grid.QuickFindText:this._quickFindText},set_quickFindText:function(a){this._quickFindText=a},get_quickFindElement:function(){return $get(this.get_id()+"_QuickFind")},set_showQuickFind:function(a){this._showQuickFind=a},get_showRowNumber:function(){return this._showRowNumber==true},set_showRowNumber:function(a){this._showRowNumber=a},get_filter:function(){var e="disableStartFilter",a=this;if(a.get_lookupField()==null&&(a.get_pageIndex()==-1&&!a._allFields||a._externalFilter.length>0&&a._filter.length==0)){if(a.get_domFilterSource()){a._externalFilter=[];for(var f=a.get_filterFields().split(Web.DataView._simpleListRegex),h=a.get_domFilterSource().value.split(Web.DataView._simpleListRegex),c=0;c<f.length;c++)Array.add(a._externalFilter,{Name:f[c],Value:h[c]})}else{var d=Web.DataView._commandLine.match(/\?([\s\S]+)/);if(d&&(a.get_filterSource()!="None"&&a.get_filterSource()==null)&&!a.get_useCase()){a._externalFilter=[];var g=/(\w+)=([\S\s]*?)(&|$)/g,b=g.exec(d[1]);while(b){b[1]!="ReturnUrl"&&Array.add(a._externalFilter,{Name:b[1],Value:b[2].length==0?String.jsNull:decodeURIComponent(b[2])});b=g.exec(d[1])}}}a.applyExternalFilter(a.get_isModal())}else a.get_filterSource()=="Context"&&a._externalFilter.length>0&&a.applyExternalFilter(true);if(a._startupFilter){if(a.readContext(e)!=true){Array.addRange(a._filter,a._startupFilter);a.writeContext(e,true)}a._startupFilter=null}return a._filter},set_filter:function(a){this._filter=a},get_startupFilter:function(){return this._startupFilter},set_startupFilter:function(a){this._startupFilter=a},get_externalFilter:function(){return this._externalFilter},set_externalFilter:function(a){this._externalFilter=a?a:[]},get_ditto:function(){return this._ditto},set_ditto:function(a){this._ditto=a},get_modalAnchor:function(){return this._modalAnchor},set_modalAnchor:function(a){this._modalAnchor=a},get_description:function(){return this._description},set_description:function(a){this._description=a},get_isModal:function(){return this._modalPopup!=null||this._isModal},get_categories:function(){return this._categories},get_fields:function(){return this._fields},get_rows:function(){return this._rows},get_selectedRow:function(){var a=this,b=a.extension();return b?a._selectedRow:a._rows?a._rows[a._selectedRowIndex!=null?a._selectedRowIndex:0]:[]},get_pageCount:function(){return this._pageCount},get_aggregates:function(){return this._aggregates},get_views:function(){return this._views},actionGroups:function(b){var j=[],i=this._actionGroups,d,e,f,a,g,c,h;if(typeof b=="string")b=[b];for(f=0;f<b.length;f++){h=b[f];for(d=0;d<i.length;d++){a=i[d];c=null;if(a.Scope==h||a.Id==h)for(e=0;e<a.Actions.length;e++){g=a.Actions[e];if(this._isActionAvailable(g)){!c&&j.push(c={Scope:a.Scope,HeaderText:a.HeaderText,Flat:a.Flat,Id:a.Id,Actions:[]});c.Actions.push(g)}}}}return j},actions:function(b){var a=this.actionGroups(b);return a.length?a[0].Actions:null},get_actionGroups:function(h,g){var a=this;for(var f=[],b=0;b<a._actionGroups.length;b++)if(a._actionGroups[b].Scope==h){var d=a._actionGroups[b],c=g?d:null;if(!g)for(var e=0;e<d.Actions.length;e++)if(a._isActionAvailable(d.Actions[e])){c=a._actionGroups[b];break}c&&Array.add(f,c)}return f},get_actions:function(d,e){for(var b=[],a=0;a<this._actionGroups.length;a++)if(this._actionGroups[a].Scope==d){var c=this._actionGroups[a];if(e)Array.addRange(b,c.Actions);else return c.Actions}return b},get_action:function(f){for(var d=f.split(/\//),b=0;b<this._actionGroups.length;b++){var a=this._actionGroups[b];if(a.Id==d[0])for(var c=0;c<a.Actions.length;c++){var e=a.Actions[c];if(e.Id==d[1])return e}}return null},get_selectedKey:function(){return this._selectedKey},set_selectedKey:function(a){this._selectedKey=a},get_selectedKeyFilter:function(){return this._selectedKeyFilter},set_selectedKeyFilter:function(a){this._selectedKeyFilter=a},_get_selectedValueElement:function(){return $get(String.format("{0}_{1}_SelectedValue",this.get_id(),this.get_controller()))},get_selectedValue:function(){var a=this.readContext("SelectedValue");if(a)return a;var b=this._get_selectedValueElement();return b?b.value:""},set_selectedValue:function(a){if(this._hasSearchAction)return;this.writeContext("SelectedValue",a.toString());var b=this._get_selectedValueElement();if(b)b.value=a!=null?a:""},get_keyRef:function(){var c=this.get_selectedKey();if(!c)return null;for(var b="",a=0;a<this._keyFields.length;a++){if(a>0)b+="&";b=String.format("{0}{1}={2}",b,this._keyFields[a].Name,c[a])}return b},get_showIcons:function(){return this._icons!=null&&this._lookupField==null||this.get_showRowNumber()},get_showMultipleSelection:function(){return this.multiSelect()&&this._hasKey()},get_sysColCount:function(){var a=0;if(this.get_showIcons())a++;if(this.get_showMultipleSelection())a++;if(this.get_isDataSheet())a++;return a},_createRowKey:function(c){for(var e=this._rows[c],a="",b=0;b<this._keyFields.length;b++){var d=this._keyFields[b];if(a.length>0)a+=",";a+=e[d.Index].toString()}return a},toggleSelectedRow:function(b){var i="MultiSelectedRow",h="Selected",a=this;for(var l=b!=null?b:0,m=b!=null?b:a._rows.length-1,n=$get(a.get_id()+"_ToggleButton"),f=l;f<=m;f++){var j=a._createRowKey(f),g=Array.indexOf(a._selectedKeyList,j);g!=-1&&Array.removeAt(a._selectedKeyList,g);var e=b==null?n.checked:g==-1;e&&Array.add(a._selectedKeyList,j);var d=$get(a.get_id()+"_CheckBox"+f);if(d){d.checked=e;if(e)$(d).addClass(h);else $(d).removeClass(h);var c=d;while(c&&c.tagName!="TR")c=c.parentNode;if(e)$(c).addClass(i);else $(c).removeClass(i)}}a._skipCellFocus=a.get_isDataSheet();a.set_selectedValue(a._selectedKeyList.join(";"));var k=$get(a.get_id()+"$SelectionInfo");if(k)k.innerHTML=a._selectedKeyList.length==0?"":String.format(Web.DataViewResources.Pager.SelectionInfo,a._selectedKeyList.length);if(b>=0)a.executeRowCommand(b,"Select");else a.delayedRefresh()},delayedRefresh:function(c,b){var a=this;if(!b)b=1e3;if(c){delete a._delayedRefreshTimer;!(a._isBusy||Web.DataView._navigated||Sys.Application._disposing)&&a.refresh(true)}else{a._delayedRefreshTimer&&clearTimeout(a._delayedRefreshTimer);var d=a;a._delayedRefreshTimer=setTimeout(function(){d.delayedRefresh(true)},b)}},get_view:function(b){var a=this;if(!b)b=a.get_viewId();if(!a._view||a._view.Id!=b)for(var c=0;c<a._views.length;c++)if(a._views[c].Id==b){a._view=a._views[c];break}return a._view},get_viewType:function(b){var a=this.get_view(b);if(this._viewTypes){var c=this._viewTypes[a?a.Id:b];if(c!=null)return c}return a?a.Type:null},get_isGrid:function(b){var a=this.get_viewType(b);return a=="Grid"||a=="DataSheet"},get_isForm:function(b){var a=this.get_viewType(b);return a=="Form"},get_isDataSheet:function(d){var a=this,b=a.get_viewType(d);if(__tf!=4)return false;if(a._viewTypes){var c=a._viewTypes[a.get_viewId()];if(c!=null)b=c}return b=="DataSheet"},get_isChart:function(){return this.get_viewType()=="Chart"},get_lastViewId:function(){return this._lastViewId},set_lastViewId:function(a){this._lastViewId=a},get_lastCommandName:function(){return this._lastCommandName},set_lastCommandName:function(a){this._lastCommandName=a;this._lastCommandArgument=null;$closeHovers()},get_lastCommandArgument:function(){return this._lastCommandArgument},set_lastCommandArgument:function(a){this._lastCommandArgument=a},get_isEditing:function(){var c=this,a=c._lastCommandName,b=c._editing;return(a=="New"||a=="Edit"||a=="BatchEdit"||a=="Duplicate")&&b==null||b==true},get_isInserting:function(){return this._lastCommandName=="New"||this._lastCommandName=="Duplicate"},get_lookupField:function(){return this.get_mode()==Web.DataViewMode.View?this._lookupField:this._fields[0]},set_lookupField:function(a){this._lookupField=a},get_lookupContext:function(){var a=this.get_lookupField();return a?{FieldName:a.Name,Controller:a._dataView.get_controller(),View:a._dataView.get_viewId()}:null},get_mode:function(){return this._mode},set_mode:function(a){this._mode=a},get_lookupValue:function(){return this._lookupValue},set_lookupValue:function(a){this._lookupValue=a},get_lookupText:function(){return this._lookupText},set_lookupText:function(a){this._lookupText=a},get_lookupPostBackExpression:function(){return this._lookupPostBackExpression},set_lookupPostBackExpression:function(a){this._lookupPostBackExpression=a},get_domFilterSource:function(){return this._domFilterSource},set_domFilterSource:function(a){this._domFilterSource=a},get_showDetailsInListMode:function(){return this._showDetailsInListMode!=false},set_showDetailsInListMode:function(a){this._showDetailsInListMode=a},get_autoHide:function(){return!String.isNullOrEmpty(this.get_visibleWhen())?Web.AutoHideMode.Self:this._autoHide==null?Web.AutoHideMode.Nothing:this._autoHide},set_autoHide:function(a){this._autoHide=a},get_transaction:function(){return this._transaction},set_transaction:function(a){this._transaction=a},initialize:function(){var a=this;Web.DataView.callBaseMethod(a,"initialize");a._bodyKeydownHandler=Function.createDelegate(a,a._bodyKeydown);a._filterSourceSelectedHandler=Function.createDelegate(a,a._filterSourceSelected);a._quickFindHandlers={focus:a._quickFind_focus,blur:a._quickFind_blur,keydown:a._quickFind_keydown};a._checkMaxLengthHandler=function(c){var a=this,b=parseInt(a.getAttribute("maxlength"));if(a.value.length>b){a.value=a.value.substr(0,b);c.preventDefault();c.stopPropagation()}}},dispose:function(){var b=null,a=this;if(!Sys.Application._disposing){$(a._element).find("iframe").remove();a._detachBehaviors()}var c=a.extension();c&&c.dispose&&c.dispose();a._wsRequest=b;a._stopInputListener();a._disposeModalPopup();a._disposeFieldFilter();a._disposeSearchBarExtenders();a._disposeImport();a._disposeFields();a._lookupField=b;a._parentDataView=b;a._bodyKeydownHandler=b;a._filterSourceSelectedHandler=b;a._restoreEmbeddedViews();delete a._container;Web.DataView.callBaseMethod(a,"dispose")},get_master:function(){var a=this.get_filterSource();return a?Web.DataView.find(a):null},get_isTagged:function(a){return this._tag&&Array.contains(this._tag.split(Web.DataView._simpleListRegex),a)},updated:function(){var g="Supported",c=null,e=true,d=false,a=this;Web.DataView.callBaseMethod(a,"updated");if(!a._controller)return;a.get_servicePath().startsWith("http")&&a.set_baseUrl(a.get_siteUrl());var f=a.get_selectedValue();if(f.length>0){a.set_autoHighlightFirstRow(d);a.set_autoSelectFirstRow(d);if(a.multiSelect())a._selectedKeyList=f.split(";");else{a._selectedKey=f.split(",");a._pendingSelectedEvent=e}}if(a._container==c){a.get_element().innerHTML="";a._container=document.createElement("div");a.get_element().appendChild(a._container);$(a._container).addClass("DataViewContainer");var l=a._element.id,j=l.split(/_/);Sys.UI.DomElement.addCssClass(a._container,j?j[j.length-1]:l);!a.get_showActionBar()&&$(a._container).addClass("ActionBarHidden");!a.get_showDescription()&&$(a._container).addClass("DescriptionHidden")}if(a.get_filterSource()&&a.get_filterSource()!="Context"){var b=a.get_master();if(b){a._hasParent=e;b.add_selected(a._filterSourceSelectedHandler);if(a.get_transaction()==g)if(!String.isNullOrEmpty(b.get_transaction())){a.set_transaction(b.get_transaction()!=g?b.get_transaction():c);a._forceVisible=a.get_transaction()&&b.get_isInserting()}if(b._pendingSelectedEvent&&!$appfactory.mobile){a._source=b;var o=a;a._afterUpdateTimerId=setInterval(function(){o._afterUpdate()},250)}else if(!a._forceVisible)a._hidden=e}else{b=$get(a.get_filterSource());b&&$addHandler(b,"change",a._filterSourceSelectedHandler);a.set_domFilterSource(b)}a._externalFilter.length==0&&a._createExternalFilter();if(a._filter.length==0)!a._source&&a.applyExternalFilter()}else{a._hidden=!a._evaluateVisibility();a._hidden&&a._updateLayoutContainerVisibility(d)}a.get_transaction()==g&&a.set_transaction(c);!$appfactory.mobile&&a.get_modalAnchor()&&!a.get_isModal()&&a._initializeModalPopup();b!=c&&a.get_autoHide()!=Web.AutoHideMode.Nothing&&a._updateLayoutContainerVisibility(d);if(a.get_startCommandName()=="UseTransaction"){a._usesTransaction=e;a.set_startCommandName(c)}if(a.get_startCommandName()=="DetectTransaction")if(!a.get_transaction()){if(b&&Web.DataView.isInstanceOfType(b)){b.remove_selected(a._filterSourceSelectedHandler);clearInterval(a._afterUpdateTimerId)}return}else a.set_startCommandName(c);var h=Web.DataView.get_commandLine(),i=h.match(/_commandName=(.+?)&_commandArgument=(.*?)(&|$)/);if(i&&(String.isNullOrEmpty(a.get_startCommandName())||__designer())&&!a.get_filterSource()&&!a.get_isModal()&&!a.get_lookupField()){var k=h.match(/_controller=(\w+)/),n=h.match(/_view=(\w+)/);if((!k||k[1]==a.get_controller())&&(!n||n[1]==a.get_view())){a._trySecondCommand=!String.isNullOrEmpty(k);a.set_startCommandName(i[1]);a.set_startCommandArgument(i[2]);if(!String.isNullOrEmpty(a._viewId))a._replaceTriggerViewId=a._viewId;a._skipTriggeredView=e}}var m=$appfactory.mobile;if(a.get_startCommandName()){a.set_searchOnStart(d);a.set_lastCommandName(a.get_startCommandName());a.set_lastCommandArgument(a.get_startCommandArgument());a.get_startCommandName().match(/New|Edit|Select/)&&a.set_viewId(a.get_startCommandArgument());a.set_startCommandName(c);a.set_startCommandArgument(c);a._rows=[];!m&&a._loadPage()}else a.loadPage();m&&a.mobileUpdated()},_afterUpdate:function(){var a=this;if(a._delayedLoading&&a._source._pendingSelectedEvent||a._source._isBusy)return;clearInterval(a._afterUpdateTimerId);var b=a._source;a._source=null;a._filterSourceSelected(b,Sys.EventArgs.Empty,true)},dataAttr:function(e,d,a){var b=$(e),c="data-"+d;if(!a){a=b.attr(c);if(!a)a=b.attr("factory:"+d);return a}else b.attr(c,a)},_updateLayoutContainerVisibility:function(d){var g="none",m="activator",h="data-visibility-controller",b=this;if($appfactory.mobile){b._hidden=!d;return}if(b._forceVisible)d=true;var a=b._element.parentNode;String.isNullOrEmpty(a.getAttribute(h))&&a.setAttribute(h,b.get_id());var e=!String.isNullOrEmpty(b.dataAttr(a,m))?b.dataAttr(a,m).match(/^\s*(\w+)\s*\|\s*(.+?)\s*(\|\s*(.+)\s*)?$/):null;if(b.get_autoHide()==Web.AutoHideMode.Self){b._element.style.display=d?"":g;if(!d)d=$(b._element).siblings().is(":visible");var f=a.parentNode.childNodes[0];while(f.tagName!="DIV")f=f.nextSibling;if(e&&e[1]=="Tab"&&Sys.UI.DomElement.containsCssClass(f,"TabBar")){if(a.getAttribute(h)==b.get_id()){for(var j=-1,c=0;c<a.parentNode.childNodes.length;c++){var l=a.parentNode.childNodes[c];if(l.className&&Sys.UI.DomElement.containsCssClass(l,"TabBody"))j++;if(a==l)break}if(j!=-1){var i=f.getElementsByTagName("td"),n=i[j];n.style.display=d?"":g;if(!d&&Sys.UI.DomElement.containsCssClass(n,"Selected")){var q=f.getElementsByTagName("a");for(c=0;c<i.length;c++)if($common.getVisible(i[c])){$find(a.parentNode.id+"$ActivatorMenu").select(c,q[c]);break}}}}}else b.dataAttr(a,"hidden",!d)}else{e&&e[1]=="SideBarTask"&&b.dataAttr(a,"hidden",true);while(a){if(!String.isNullOrEmpty(b.dataAttr(a,"flow"))){a.style.display=d?"":g;break}a=a.parentNode}}var o=$get("PageContentSideBar");if(o&&e){var p=o.getElementsByTagName("a");for(c=0;c<p.length;c++){var k=p[c];if(Sys.UI.DomElement.containsCssClass(k.parentNode,"Task")&&k.innerHTML==e[2]){k.parentNode.style.display=d?"":g;break}}}Web.DataView._loaded&&_body_performResize()},loadPage:function(){var a=this;if($appfactory.mobile)return;var b=a.get_isDisplayed();a._showWait(!b);if(a.get_mode()!=Web.DataViewMode.View||(a.get_lookupField()||!(a._delayedLoading=!b)))!a._source&&a._loadPage();else if(!Array.contains($appfactory._delayedLoadingViews,a)){Array.add($appfactory._delayedLoadingViews,a);$appfactory._startDelayedLoading()}},get_isDisplayed:function(){var b=false;if(this._hidden)return b;var c=this.get_element(),a;if(!c)return b;a=c&&c.parentNode;while(a!=null){if(a.getAttribute&&a.tagName!="TABLE"&&this.dataAttr(a,"activator")&&!a._activated)return b;if(a.style&&a.style.display=="none")return b;a=a.parentNode}return true},goToPage:function(b,c){var a=this;if(a._isBusy)return;if(c)a._pageOffset=0;a.set_pageIndex(b);a._loadPage()},sort:function(b){var a=this;if(a._isBusy)return;a._clearCache();if(a.get_sortExpression()==b)b="";a.set_sortExpression(b);if(a.get_selectedKey().length>0){a._saveViewVitals();a._sync()}else{a.set_pageIndex(0);a._loadPage()}},applyFilterByIndex:function(d,a){var b=this;if(a==-1)b.removeFromFilterByIndex(d);else{var c=b._allFields[d],e=b.findFieldUnderAlias(c);b.applyFilter(c,a>=0?"=":null,a>=0?e._listOfValues[a]:null)}},findFieldUnderAlias:function(b){if(b.Hidden)for(var a=0;a<this._allFields.length;a++)if(this._allFields[a].AliasIndex==b.Index)return this._allFields[a];return b},removeFromFilterByIndex:function(a){field=this._allFields[a];this.removeFromFilter(field);this.sync()},removeFromFilter:function(b){for(var a=0;a<this._filter.length;a++)if(this._filter[a].match(/^(\w+):/)[1]==b.Name){Array.removeAt(this._filter,a);break}},clearFilter:function(){var b=null,a=this;for(var d=0;d<a._allFields.length;d++){var c=a._allFields[d],f=a.findFieldUnderAlias(c);a.filterOf(c)!=b&&!a.filterIsExternal(c.Name)&&a.removeFromFilter(c)}var e=a.get_quickFindElement();if(e!=b){e.value="";a.quickFind()}else{a.set_quickFindText(b);a._executeQuickFind(b)}},beginFilter:function(){this._filtering=true},endFilter:function(){this._filtering=false;this.refreshData()},applyFilter:function(b,c,d){var a=this;a._clearCache();a.removeFromFilter(b);if(c==":")d&&Array.add(a._filter,b.Name+":"+d);else c&&Array.add(a._filter,b.Name+":"+c+a.convertFieldValueToString(b,d));var e=a._filter.length==1&&a._filter[0].match(/(\w+):/)[1]==b.Name;b=a.findFieldUnderAlias(b);for(i=0;i<a._allFields.length;i++)if(!e||a._allFields[i].Name!=b.Name)a._allFields[i]._listOfValues=null;a._filtering!=true&&a._sync()},applyExternalFilter:function(e){var a=this;if(!e||!a._filter)a._filter=[];a._selectedRowIndex=null;for(var d=0;d<a._externalFilter.length;d++){var c=a._externalFilter[d];if(e)for(var b=0;b<a._filter.length;b++)if(a._filter[b].startsWith(c.Name+":=")){Array.removeAt(a._filter,b);break}Array.add(a._filter,c.Name+":="+c.Value)}},applyFieldFilter:function(f,d,b,h){var a=this;if(f==null)f=a._filterFieldIndex;if(!d)d=a._filterFieldFunc;var c=a._allFields[f];a.removeFromFilter(c);var e=String.format("{0}:",c.Name,c.Type);if(b&&b[0]==Web.DataViewResources.HeaderFilter.EmptyValue)b[0]=String.jsNull;if(!b)e+=d+"$\0";else if(d=="$between")e+="$between$"+a.convertFieldValueToString(c,b[0])+"$and$"+a.convertFieldValueToString(c,b[1])+"\0";else for(var g=0;g<b.length;g++)e+=d+(d.startsWith("$")?"$":"")+a.convertFieldValueToString(c,b[g])+"\0";e.indexOf("\0")>0&&Array.add(a._filter,e);!h&&a.refreshData();a._forgetSelectedRow(true)},get_fieldFilter:function(e,d){for(var b=0;b<this._filter.length;b++){var c=this._filter[b].match(/(\w+):(\*|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*)/);if(c[1]==e.Name){if(d){var a=c[2];return a.startsWith("$")?a.substring(0,a.length-1):a}else return c[4];break}}return null},_createFieldInputExtender:function(c,a,f,g){var b=null,e=this,d=b;if(a.Type.startsWith("DateTime")){d=$create(AjaxControlToolkit.CalendarBehavior,{id:String.format("{0}_{1}Calendar{2}_{3}",e.get_id(),c,a.Index,g),button:f.nextSibling},b,b,f);d.set_format(a.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1])}else if(a.AllowQBE&&a.Type=="String"&&a.AllowAutoComplete!=false){d=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("{0}:{1},{2}",c,e.get_id(),a.Name),delimiterCharacters:";",id:String.format("{0}_{1}AutoComplete{2}_{3}",e.get_id(),c,a.Index,g),minimumPrefixLength:a.AutoCompletePrefixLength==0?1:a.AutoCompletePrefixLength,serviceMethod:"GetListOfValues",servicePath:e.get_servicePath(),useContextKey:true,enableCaching:c!="SearchBar",typeCssClass:c},b,b,f);d._updateClearButton()}return d},showFieldFilter:function(h,j,n){var a=this;if(!a._filterExtenders)a._filterExtenders=[];var d=a._allFields[h],b=a.get_fieldFilter(d);if(b){var k=b.match(/^([\s\S]*?)(\0|$)/);if(k)b=k[1]}b=b&&!String.isJavaScriptNull(b)?b.split(Web.DataView._listRegex):[""];a._filterFieldIndex=h;a._filterFieldFunc=j;var c=a._filterElement=document.createElement("div");c.id=a.get_id()+"$FieldFilter";c.className="FieldFilter";var e=new Sys.StringBuilder,i=d.Type.startsWith("DateTime")?'<a class="Calendar" href="javascript:" onclick="return false">&nbsp;</a>':"";e.appendFormat('<div class="Field"><div class="Label"><span class="Name">{0}</span> <span class="Function">{1}</span></div><div class="Value"><input type="text" value="{2}"/>{3}</div></div>',d.HeaderText,n.toLowerCase(),Web.DataView.htmlAttributeEncode(d.format(a.convertStringToFieldValue(d,b[0]))),i);j=="$between"&&e.appendFormat('<div class="Field"><div class="Label"><span class="Function">{0}</span></div><div class="Value"><input type="text" value="{1}"/>{2}</div></div>',Web.DataViewResources.Data.Filters.Labels.And,Web.DataView.htmlAttributeEncode(b[1]?d.format(a.convertStringToFieldValue(d,b[1])):""),i);e.appendFormat('<div class="Buttons"><button onclick="$find(\'{0}\').closeFieldFilter(true);return false">{1}</button><button onclick="$find(\'{0}\').closeFieldFilter(false);return false">{2}</button></div>',a.get_id(),Web.DataViewResources.ModalPopup.OkButton,Web.DataViewResources.ModalPopup.CancelButton);c.innerHTML=e.toString();a._appendModalPanel(c);a._filterPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:a.get_id()+"$FilterPopup",PopupControlID:c.id,DropShadow:true,BackgroundCssClass:"ModalBackground"},null,null,a._container.getElementsByTagName("a")[0]);for(var g=c.getElementsByTagName("input"),f=0;f<g.length;f++){var m=g[f],l=a._createFieldInputExtender("Filter",d,m,f);l&&Array.add(a._filterExtenders,l)}a._saveTabIndexes();a._filterPopup.show();Sys.UI.DomElement.setFocus(g[0]);$(c).find("input:text").keydown(function(a){if(a.which==13){a.preventDefault();$(c).find("button:first").click()}})},closeFieldFilter:function(f){var a=this,d=a._filterElement.getElementsByTagName("input"),e=[];if(f)for(var h=a._allFields[a._filterFieldIndex],c=0;c<d.length;c++){var b=d[c];if(String.isBlank(b.value)){alert(Web.DataViewResources.Validator.RequiredField);Sys.UI.DomElement.setFocus(b);return}else{a._formatSearchField(b,a._filterFieldIndex);var i={NewValue:b.value.trim()},g=a._validateFieldValueFormat(h,i);if(g){alert(g);Sys.UI.DomElement.setFocus(b);return}else Array.add(e,h.Type.startsWith("DateTime")?b.value.trim():i.NewValue)}}a._disposeFieldFilter();a._restoreTabIndexes();f&&a.applyFieldFilter(null,null,e)},_disposeSearchBarExtenders:function(){var a=this;if(a._searchBarExtenders){for(var b=0;b<a._searchBarExtenders.length;b++)a._searchBarExtenders[b].dispose();Array.clear(a._searchBarExtenders)}},_disposeFieldFilter:function(){var a=this;if(a._filterExtenders){for(var b=0;b<a._filterExtenders.length;b++)a._filterExtenders[b].dispose();Array.clear(a._filterExtenders)}if(a._filterElement){a._filterPopup.hide();a._filterPopup.dispose();a._filterPopup=null;a._filterElement.parentNode.removeChild(a._filterElement);delete a._filterElement}},_showSearchBarFilter:function(c,b){var a=this;a._searchBarVisibleIndex=b;if(c==-1){var d=a._get("$SearchBarValue$",b);d.value="";a._searchBarFuncChanged(b);a._searchBarVisibleIndex=null}else a.showCustomFilter(c)},_appendModalPanel:function(a){this.get_element().appendChild(a)},showCustomFilter:function(e){var a=this,d=a._allFields[e],c=a._customFilterPanel=document.createElement("div");a._appendModalPanel(c);c.className="CustomFilterDialog";c.id=a.get_id()+"_CustomFilterPanel";var b=new Sys.StringBuilder;b.appendFormat('<div><span class="Highlight">{0}</span> {1}:</div>',Web.DataView.htmlEncode(d.Label),Web.DataViewResources.Data.Filters.Labels.Includes);b.append('<table cellpadding="0" cellspacing="0">');b.appendFormat('<tr><td colspan="2"><div id="{0}$CustomFilterItemList${1}" class="CustomFilterItems">{2}</div></td></tr>',a.get_id(),e,Web.DataViewResources.Common.WaitHtml);b.appendFormat('<tr><td></td><td align="right"><button id="{0}Ok">{1}</button> <button id="{0}Cancel">{2}</button></td></tr>',a.get_id(),Web.DataViewResources.ModalPopup.OkButton,Web.DataViewResources.ModalPopup.CancelButton);b.append("</table>");c.innerHTML=b.toString();b.clear();a._customFilterField=d;a._customFilterModalPopupBehavior=$create(AjaxControlToolkit.ModalPopupBehavior,{OkControlID:a.get_id()+"Ok",CancelControlID:a.get_id()+"Cancel",OnOkScript:String.format('$find("{0}").applyCustomFilter()',a.get_id()),OnCancelScript:String.format('$find("{0}").closeCustomFilter()',a.get_id()),PopupControlID:c.id,DropShadow:true,BackgroundCssClass:"ModalBackground"},null,null,a._container.getElementsByTagName("a")[0]);a._customFilterModalPopupBehavior.show();$addHandler(document.body,"keydown",a._bodyKeydownHandler);var f=a.findFieldUnderAlias(d);a._loadFilterListOfValues(d.Name)},_loadFilterListOfValues:function(b){var a=this;a._busy(true);var c=a.get_lookupContext();a._invoke("GetListOfValues",a._createArgsForListOfValues(b),Function.createDelegate(a,a._onGetFilterListOfValuesComplete),{fieldName:b})},_renderFilterOption:function(f,b,a,e,d){var c=this._findItemByValue(b,a);if(c)a=c[1];f.appendFormat('<tr><td class="Input"><input type="checkbox" id="{0}$CustomFilterItem{1}${2}"{4}/></td><td class="Label"><label for="{0}$CustomFilterItem{1}${2}">{3}</label></td></tr>',this.get_id(),b.Index,e,a,d?' checked="checked"':"")},_onGetFilterListOfValuesComplete:function(e,t){var h=null,d=this;d._busy(false);var c=d.findField(t.fieldName);d.findFieldUnderAlias(c)._listOfValues=e;if(e[e.length-1]==h){Array.insert(e,0,e[e.length-1]);Array.removeAt(e,e.length-1)}var n=d._get("$CustomFilterItemList$",c.Index);if(!n)return;for(var p=d._searchBarVisibleIndex!=h?d._createSearchBarFilter(true):d._filter,l=h,a=0;a<p.length;a++){var g=p[a].match(Web.DataView._fieldFilterRegex);if(g[1]==c.Name){l=g[2];break}}var f=h,o="$in$";if(l){g=l.match(Web.DataView._filterRegex);if(g){if(g[1].match(/\$(in|notin|between)\$/)){o=g[1];f=g[3].split(Web.DataView._listRegex)}else f=[g[3]];for(a=0;a<f.length;a++){var b=f[a];if(String.isJavaScriptNull(b))f[a]=Web.DataViewResources.HeaderFilter.EmptyValue;else{b=d.convertStringToFieldValue(c,b);f[a]=c.format(b)}}}}var i=new Sys.StringBuilder;i.appendFormat('<table class="FilterItems" cellpadding="0" cellspacing="0"><tr><td><input type="CheckBox" onclick="$find(\'{0}\')._selectAllFilterItems({1})" id="{0}$CustomFilterItemList$SelectAll"/></td><td><label for="{0}$CustomFilterItemList$SelectAll">{2}</label></td></tr>',d.get_id(),c.Index,Web.DataViewResources.Data.Filters.Labels.SelectAll);var k=[],j=[],q=[],m=[];for(a=0;a<e.length;a++){b=e[a];var r=b;if(b==h)b=Web.DataViewResources.HeaderFilter.EmptyValue;else{b=Web.DataView.htmlEncode(c.format(b));if(b=="")b=Web.DataViewResources.HeaderFilter.BlankValue}var s=f&&(o=="$in$"&&Array.contains(f,b)||o=="$notin$"&&!Array.contains(f,b));if(s){Array.add(j,b);Array.add(k,r)}else{Array.add(m,b);Array.add(q,r)}}for(a=0;a<j.length;a++)d._renderFilterOption(i,c,j[a],a,true);for(a=0;a<m.length;a++)d._renderFilterOption(i,c,m[a],a+j.length,false);i.append("</table>");n.innerHTML=i.toString();Sys.UI.DomElement.setFocus(n.getElementsByTagName("input")[0]);if(k.length>0){c._listOfValues=[];Array.addRange(c._listOfValues,k);Array.addRange(c._listOfValues,q)}},_selectAllFilterItems:function(c){for(var d=this._get("$CustomFilterItemList$",c),a=d.getElementsByTagName("input"),b=1;b<a.length;b++)a[b].checked=a[0].checked},applyCustomFilter:function(){var d=null,a=this,h=a._customFilterField,g=a._searchBarVisibleIndex!=d?a._get("$SearchBarValue$",a._searchBarVisibleIndex):d,j=g?a._get("$SearchBarFunction$",a._searchBarVisibleIndex):d;a.removeFromFilter(h);for(var b=d,l=a._get("$CustomFilterItemList$",h.Index),e=l.getElementsByTagName("input"),i=a.findFieldUnderAlias(h),f=0,c=1;c<e.length;c++)if(e[c].checked){if(!b)b="";else b+="$or$";b+=a.convertFieldValueToString(h,i._listOfValues[c-1]);f++}if(b&&(f<=10||f!=e.length-1))if(f<=10||f<=(e.length-1)/2)if(g)j.value="$in,true";else Array.add(a._filter,String.format("{0}:$in${1}\0",a._customFilterField.Name,b));else{b=d;for(c=1;c<e.length;c++)if(!e[c].checked){if(!b)b="";else b+="$or$";b+=a.convertFieldValueToString(h,i._listOfValues[c-1])}if(g)j.value="$notin,true";else Array.add(a._filter,String.format("{0}:$notin${1}\0",a._customFilterField.Name,b))}else b=d;for(c=0;c<a._allFields.length;c++){var k=a._allFields[c];if(k!=i)k._listOfValues=d}if(g){g.value=b?b:"";a._searchBarFuncChanged(a._searchBarVisibleIndex)}else{a._forceSync();a.refreshData()}a.closeCustomFilter()},closeCustomFilter:function(){var b=null,a=this;if(a._customFilterModalPopupBehavior){a._customFilterModalPopupBehavior.dispose();a._customFilterModalPopupBehavior=b;a._customFilterField=b}if(a._customFilterPanel){a._customFilterPanel.parentNode.removeChild(a._customFilterPanel);delete a._customFilterPanel}$removeHandler(document.body,"keydown",a._bodyKeydownHandler);a._customFilterField=b;a._searchBarVisibleIndex=b},convertFieldValueToString:function(b,a){if(typeof a=="string"&&(a.match(Web.DataView._listRegex)||a.startsWith("%js%")))return a;if(b.Type!="String"&&a!=null&&typeof a=="string")a=this.convertStringToFieldValue2(b,a);if(Date.isInstanceOfType(a))a=new Date(a-a.getTimezoneOffset()*60*1e3);return String.format("%js%{0}",Sys.Serialization.JavaScriptSerializer.serialize(a))},convertFieldValueToString2:function(c,a){var b=null;return c.Type.startsWith("DateTime")&&!String.isNullOrEmpty(c.DataFormatString)?a==b?b:String.localeFormat(c.DataFormatString,a):c.Type=="Boolean"?a==b?b:a.toString():a.toString()},convertStringToFieldValue:function(b,a){if(a!=null&&a.startsWith("%js%")){a=Sys.Serialization.JavaScriptSerializer.deserialize(a.substring(4));if(Date.isInstanceOfType(a))a=new Date(a.getTime()+a.getTimezoneOffset()*60*1e3);return a}else return this.convertStringToFieldValue2(b,a)},convertStringToFieldValue2:function(b,a){if(a==null)return a;switch(b.Type){case"DateTime":var c=b.DataFormatString&&b.DataFormatString.length?Date.parseLocale(a,b.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1]):Date.parse(a);if(!isNaN(c)&&c!=null)return c;break;case"SByte":case"Byte":case"Int16":case"Int32":case"UInt32":case"Int64":case"Single":case"Double":case"Decimal":case"Currency":var d=Number.parseLocale(a);if(!isNaN(d))return d}return a},goToView:function(c){var b=null,f="Form",a=this;if(!String.isNullOrEmpty(a._replaceTriggerViewId)&&a._replaceTriggerViewId==c){if(a._skipTriggeredView)a._skipTriggeredView=false;location.replace(location.href);return}var m=a._ditto&&a._ditto.slice(0);a._clearCache(true);a._ditto=m;var k=a.get_filter(),i=a.get_view().Group;if(c=="form")for(var e=0;e<a.get_views().length;e++)if(a.get_views()[e].Type==f){c=a.get_views()[e].Id;break}a._detachBehaviors();if(!a.get_isForm()){a._lastViewId=a.get_viewId();a._selectedRowIndex=0}var l=a.get_view().Id,d=l!=c;if(d){a._focusedFieldName=b;!a.get_isGrid()&&a.writeContext("vitals",b)}a.set_viewId(c);var j=a.get_view();if(j.Type!=f){a._lastViewId=c;a._restorePosition()}a.set_pageIndex(-1);var h=j.Type==f?a.get_selectedKeyFilter():!String.isNullOrEmpty(i)&&a.get_view().Group==i||!d?k:[];if(a._requestedFilter){h=a._requestedFilter;a._requestedFilter=b}var g=d?b:a.get_sortExpression();if(a._requestedSortExpression){g=a._requestedSortExpression;a._requestedSortExpression=b}a.set_filter(h);a.set_sortExpression(g);a._loadPage();a._raiseSelectedDelayed=true;if(d){a._scrollIntoView=true;a._focusedCell=b}},filterOf:function(b){for(var c=(!String.isNullOrEmpty(b.AliasName)?b.AliasName:b.Name)+":",a=0;a<this._filter.length;a++){var d=this._filter[a];if(d.startsWith(c)&&!d.match(":~"))return this._filter[a].substr(c.length)}return null},findField:function(c){for(var a=0;a<this._allFields.length;a++){var b=this._allFields[a];if(b.Name==c)return b}return null},findCategory:function(c){for(var a=0;a<this._categories.length;a++){var b=this._categories[a];if(b.Id==c)return b}return null},_isInInstantDetailsMode:function(){return location.href.match(Web.DataView.DetailsRegex)},_closeInstantDetails:function(){if(this._isInInstantDetailsMode())if(Web.DataViewResources.Lookup.ShowDetailsInPopup){close();return true}return false},_confirm:function(f,o){var a=this,p=/(_(\w+))\s*=\s*(.+?)(\s*\r|;|\n|$)/gi,b=f.action.Confirmation,g=true,i=p.exec(b);if(i&&!(__tf!=4)){var l=null,q="",k="New",n="";while(i){var d=i[2],h=i[3];if(d=="controller")l=h;if(d=="view")q=h;if(d=="commandName")k=k;if(d=="commandArgument")n=h;if(d=="width")f.MaxWidth=h;if(d=="title")f.WindowTitle=h;i=p.exec(b)}var e=a.get_isModal()?null:Web.DataView.find(l,"Controller");if(e&&!e.get_isModal()){var c=e._collectFieldValues();g=e._validateFieldValues(c,true);if(g){a._convertValuesToParameters(c);a._paramValues=c}}else{c=a._collectFieldValues();for(var r=f.Values=[],m=0;m<c.length;m++){var j=c[m];Array.add(r,{Name:"Context_"+j.Name,Value:j.Modified?j.NewValue:j.OldValue})}e=Web.DataView.showModal(a,l,q,k,n,a.get_baseUrl(),a.get_servicePath(),[],{confirmContext:f,showSearchBar:a.get_showSearchBar()});g=false}}else{b=a._parseText(b,a.get_currentRow());if(o)o(b);else if(!confirm(b))g=false}return g},executeAction:function(g,d,f,i,l,a){var c=null,b=this;if(b._isBusy)return;Web.DataView.hideMessage();if(!a){var j=b.get_lookupField()!=c,e=j&&b._lookupActionProcessing()?c:g=="ActionBar"?b.get_actionGroups(g)[i].Actions:b.get_actions(g);if(d<0&&e){for(var h=0;h<e.length;h++)if(b._isActionAvailable(e[h],f)){d=h;break}if(d<0)return}a=e?e[d]:c}if(a&&!String.isNullOrEmpty(a.Confirmation)){b.get_isGrid()&&!b.get_isDataSheet()&&b.get_lastCommandName()!="BatchEdit"&&!j&&b.executeRowCommand(f,"Select");if(!l&&!b._confirm({action:a,scope:g,actionIndex:d,rowIndex:f,groupIndex:i}))return}var n=a?a.CommandName:"Select",m=a?a.CommandArgument:c,k=a?a.CausesValidation:true,o=a?a.Path:c;b.executeRowCommand(f,n,m,k,o)},executeRowCommand:function(b,c,e,f,h){var a=this,d=a.extension();if(b!=null&&b>=0){a._selectedRowIndex=b;a._raiseSelectedDelayed=!(c=="Select"&&String.isNullOrEmpty(e));if(d)a._selectedRow=a._rows[b];a._selectKeyByRowIndex(b)}var g={commandName:c,commandArgument:e?e:"",path:h,causesValidation:f?true:false};if(!$appfactory.mobile&&a.get_isDataSheet()&&c.match(/Select|New|Edit|Duplicate/)&&a._rows.length>0)if(d!=null&&!Web.DataView.Extensions.active(d))Web.DataView.Extensions.active(d,true);else!a._get_focusedCell()&&a._startInputListenerOnCell(0,0);if(!a.executeCommand(g))return;if(c=="ClientScript"){if(!a._raiseSelectedDelayed){var i=a;setTimeout(function(){i.refresh(true)},10)}}else c=="Select"&&e==null&&!a.get_isGrid()&&a._render()},rowCommand:function(i,b,c,e,g){var a=this;a._raiseSelectedDelayed=!(b=="Select"&&String.isNullOrEmpty(c));a._selectKeyByRow(i);var f={commandName:b,commandArgument:c?c:"",path:g,causesValidation:e?true:false};if(a.get_isDataSheet()&&b.match(/Select|New|Edit|Duplicate/)){var d=a.extension();d!=null&&!Web.DataView.Extensions.active(d)&&Web.DataView.Extensions.active(d,true)}if(!a.executeCommand(f))return;if(b=="ClientScript"){if(!a._raiseSelectedDelayed){var h=a;setTimeout(function(){h.refresh(true)},10)}}else b=="Select"&&c==null&&!a.get_isGrid()&&a._render()},_get_dataRequestForm:function(){var b="_dataRequest_form",a=$get(b);if(!a){a=document.createElement("form");a.id=b;a.method="post";a.innerHTML='<input type="hidden" name="q" id="q"/><input type="hidden" name="aa" id="aa"/><input type="hidden" name="c" id="c"/><input type="hidden" name="a" id="a"/>';document.body.appendChild(a)}return a},_applySelectionFilter:function(b){var a=this;if(a.multiSelect()&&a._selectedKeyList.length>0&&a._keyFields.length==1){b.Filter=Array.clone(b.Filter);Array.add(b.Filter,String.format("{0}:$in${1}",a._keyFields[0].Name,a._selectedKeyList.join("$or$")))}},get_appRootPath:function(){var a=this.get_servicePath();if(typeof __cothost!="undefined"){if(__cothost=="DotNetNuke"&&a.match(/DesktopModules\//i))return a.replace(/Service\.asmx$/i,"");if(__cothost=="SharePoint"&&a.match(/_layouts\//i))return a.replace(/Service\.asmx$/i,"")}return"~/"},executeReport:function(i){var a=this;a._cancelConfirmation();var b=a._createParams(true);b.Controller=a.get_controller();b.View=a.get_viewId();var c=a._get_dataRequestForm();c.target="";c.action=a.resolveClientUrl(a.get_appRootPath()+"Report.ashx");$get("c",c).value=i.commandName;var e=i.commandArgument;if(!String.isNullOrEmpty(e)){if(e.startsWith("_"))c.target=e;var h=e.split(Web.DataView._simpleListRegex);e=h[0];if(h.length==3){b.Controller=h[1];b.View=h[2]}}$get("a",c).value=e;if(b.Filter.length>0&&a.get_viewType()!="Form"){var g=new Sys.StringBuilder;a._renderFilterDetails(g,b.Filter);var f=a.get_master();if(f)for(var l=f.get_selectedRow(),k=0;k<f._allFields.length;k++){var d=f._allFields[k];if(d.ShowInSummary&&!d.OnDemand){d=f._allFields[d.AliasIndex];!g.isEmpty()&&g.append(" ");g.appendFormat("{0} {1} {2}.",d.HeaderText,Web.DataViewResources.Data.Filters.Labels.Equals,d.format(l[d.Index]))}}b.FilterDetails=g.toString()}if(a._viewMessages)b.FilterDetails=String.format("{0} {1}",a._viewMessages[a.get_viewId()],b.FilterDetails);if(b.FilterDetails)b.FilterDetails=b.FilterDetails.replace(/(<b class=\"String\">([\s\S]*?)<\/b>)/g,'"$2"').replace(/(&amp;)/g,"&").replace(/(<.+?>)|&nbsp;/g,"");a._applySelectionFilter(b);$get("q",c).value=Sys.Serialization.JavaScriptSerializer.serialize(b);var j=a._createArguments(i);a._validateFieldValues(j.Values,true);j.ExternalFilter=b.ExternalFilter;$get("aa",c).value=Web.DataView.htmlEncode(Sys.Serialization.JavaScriptSerializer.serialize(j));a._showDownloadProgress();c.submit()},_showDownloadProgress:function(){if($appfactory.isSaaS())return;this._busy(true);var a=this,b="APPFACTORYDOWNLOADTOKEN";document.cookie=String.format("{0}={1}; path=/",b,encodeURIComponent(this.get_id()));var c=setInterval(function(){if(!String.isNullOrEmpty(document.cookie))for(var g=document.cookie.split(";"),d=0;d<g.length;d++){var h=g[d].trim();if(h.startsWith(b)){var f=h.substring(b.length+1).split(",");if(f.length==2&&f[0]==a.get_id()){document.cookie=String.format("{0}=; expires={1}; path=/",b,(new Date(0)).toUTCString());a._busy(false);clearInterval(c);var e=a._pendingExecuteComplete;if(a._pendingExecuteComplete){a._pendingExecuteComplete=null;a._onExecuteComplete(e.result,e.context)}}}}},500)},executeExport:function(a){var b=this,c=b._get_dataRequestForm();c.target=a.commandName=="ExportRss"?"_blank":"";c.action=b.resolveClientUrl(b.get_appRootPath()+"Export.ashx");var d=b._createParams(true);b._applySelectionFilter(d);a.Controller=b.get_controller();a.View=b.get_viewId();a.Filter=d.Filter;a.SortExpression=d.SortExpression;$get("c",c).value=a.commandName;$get("a",c).value=a.commandArgument;$get("q",c).value=Sys.Serialization.JavaScriptSerializer.serialize(a);c.submit()},_clearDynamicItems:function(){for(var a=0;a<this._allFields.length;a++){var b=this._allFields[a];if(b.DynamicItems)b.DynamicItems=null}},_copyLookupValues:function(i,b,d,f){if(String.isNullOrEmpty(b.Copy))return;var c=f?f:[],g=/(\w+)\s*=\s*(\w+)/g,a=g.exec(b.Copy);while(a){if(b._dataView.findField(a[1]))if(a[2]=="null")Array.add(c,{name:a[1],value:null});else if(i){var h=this.findField(a[2]);h&&Array.add(c,{name:a[1],value:i[h.Index]})}else if(d)for(var e=0;e<d.length;e++)if(d[e].Name==a[2]){Array.add(c,{name:a[1],value:d[e].NewValue});break}a=g.exec(b.Copy)}if(f)return;b._dataView.refresh(true,c);b._dataView._focus()},_copyExternalLookupValues:function(){var a=this;if(a.get_filterSource()&&a.get_filterSource()!="Context"){var b=a.get_master();if(b){for(var f=[],e=a.get_externalFilter(),d=0;d<e.length;d++){var c=a.findField(e[d].Name);c&&!String.isNullOrEmpty(c.Copy)&&b._copyLookupValues(b.get_currentRow(),c,null,f)}a._ditto=f}}},_processSelectedLookupValues:function(){var b=this,d=[],f=[],g=b.get_lookupField(),i=b.findField(g.ItemsDataValueField),h=b.findField(g.ItemsDataTextField),e=b.get_selectedRow();if(!i)for(var a=0;a<b._allFields.length;a++)b._allFields[a].IsPrimaryKey&&Array.add(d,e[b._allFields[a].Index]);else Array.add(d,e[i.Index]);if(!h){for(a=0;a<b.get_fields().length;a++){c=b.get_fields()[a];if(!c.Hidden&&c.Type=="String"){Array.add(f,c.format(e[c.AliasIndex]));break}}if(f.length==0)for(a=0;a<d.length;a++){var c=b.get_fields()[a];if(!c.Hidden){Array.add(f,c.format(e[c.AliasIndex]));break}}}else Array.add(f,h.format(e[h.Index]));b._copyLookupValues(e,g);g._dataView.changeLookupValue(g.Index,d.length==1?d[0]:d,f.join(";"))},_showModal:function(b){var c=null,a=this;a.set_lastCommandName(c);a.set_lastCommandArgument(c);a._render();if(b.commandName=="Duplicate")b.commandName="New";var d=Web.DataView.showModal(a,a.get_controller(),b.commandArgument,b.commandName,b.commandArgument,a.get_baseUrl(),a.get_servicePath(),a.get_hasParent()?a._externalFilter:c,{filter:a.get_selectedKeyFilter(),ditto:a.get_ditto(),lastViewId:a.get_lastViewId(),transaction:a.get_transaction(),filterSource:a.get_filterSource(),filterFields:a.get_filterFields(),showSearchBar:a.get_showSearchBar(),tag:a.get_tag(),showActionButtons:a.get_showActionButtons()});a.set_ditto(c);a._savePosition();if(!d.get_isInserting())d._position=a._position;a._restorePosition()},_savePosition:function(){var a=this;if(!a.get_isForm()&&a._selectedRowIndex!=null)a._position={index:a._pageSize*a._pageIndex+a._selectedRowIndex,count:a._totalRowCount,filter:a.get_filter(),sortExpression:a.get_sortExpression(),key:Array.clone(a._selectedKey),keyFilter:a._selectedKeyFilter,active:false}},_restorePosition:function(){var a=this;if(a._position){a._selectedKey=a._position.key;a._selectedKeyFilter=a._position.keyFilter;a._position=null}},_advance:function(b){var a=this;if(a._isBusy||!a._position||(b==-1&a._position.index==0||b==1&&a._position.index==a._position.count-1))return;a._position.index+=b;a._position.changing=true;a._position.changed=true;a._loadPage();a._position.changing=false},cancel:function(){var a=this;if(!a._closeInstantDetails())if(a.endModalState("Cancel"))return;else if(a.get_backOnCancel()||!String.isNullOrEmpty(a._replaceTriggerViewId)){a.goBack(false);setTimeout(function(){location.replace(location.href)},500)}else{a.set_lastCommandName("Cancel");a._pendingSelectedEvent=true;if(a.get_isForm()||a.get_isInserting()){a._forceSync();a.goToView(a._lastViewId)}else if(a._totalRowCount<0)a.goToPage(-1);else{a._clearDynamicItems();a._render();_body_performResize()}}},_convertValuesToParameters:function(c){var b=0;while(b<c.length){var a=c[b];a.ReadOnly=true;if(a.Name.match("PrimaryKey"))Array.removeAt(c,b);else{a.Name="Parameters_"+a.Name;b++}}},_actionConfirmed:function(d){var c=this,e=c._createArguments(d),g=c._validateFieldValues(e.Values,d.causesValidation==null||d.causesValidation);if(g){var b=c.get_confirmContext(),a=c.get_parentDataView();if(b&&a){var f=a._paramValues=e.Values;c._convertValuesToParameters(f);a._confirmDataViewId=c.get_id();a._lookupActionProcessing(false);a.executeAction(b.scope,b.actionIndex,b.rowIndex,b.groupIndex,true,b.action);a._lookupActionProcessing(true)}}},executeCommand:function(b){var k="Grid",n="GridType",j="DataSheet",e=null,h="Duplicate",f="New",a=this;if(a._isBusy)return;var d=new Web.BusinessRules(a),y=$appfactory.mobile;d.before(b);if(d.canceled()){d.dispose();a._valid=b.commandName=="Calculate";return a._valid}switch(b.commandName){case"Select":case"":a.set_lastCommandName(b.commandName);a.set_lastCommandArgument(b.commandArgument);if(a.get_lookupField()&&b.commandArgument=="")a._processSelectedLookupValues();else{if(!String.isBlank(b.commandArgument)){a._savePosition();if(a.get_showModalForms()&&a.get_isForm(b.commandArgument))a._showModal(b);else a.goToView(b.commandArgument)}else a._render();__designer()&&__designer_notifySelected(a)}break;case"Edit":case"BatchEdit":case f:case h:if(!y){a._allowModalAutoSize();a._fixHeightOfRow(false);if(b.commandName=="Edit")a._savePosition();else a._restorePosition()}if(b.commandName==h){var u=a.get_selectedRow();if(u){var r=[];for(i=0;i<a._allFields.length;i++){var s=a._allFields[i];Array.add(r,{name:s.Name,value:u[s.Index]})}a._ditto=r}}var m=a._get_focusedCell(),c=a.extension();if(b.commandName==f||b.commandName==h){if(String.isNullOrEmpty(b.commandArgument))b.commandArgument=a.get_viewId();if(c&&c.clearSelection)c.clearSelection(true);else a._forgetSelectedRow(false,m);b.commandName==f&&a._copyExternalLookupValues()}a.set_lastCommandName(b.commandName);a.set_lastCommandArgument(b.commandArgument);a._clearDynamicItems();if(!String.isBlank(b.commandArgument))if(a.get_showModalForms()&&a.get_isForm(b.commandArgument)&&!a.get_isModal())a._showModal(b);else a.goToView(b.commandArgument);else if(c&&c.stateChanged)c.stateChanged();else{if(a.get_isModal())a._container.style.height="";a.get_isDataSheet()&&!a._pendingChars&&a._startInputListenerOnCell(a._selectedRowIndex,m==e?0:m.colIndex);a._render()}__designer()&&__designer_notifySelected(a);break;case"Navigate":a.navigate(b.commandArgument);break;case"Cancel":a.cancel();break;case"Confirm":a._actionConfirmed(b);break;case"Back":history.go(!String.isNullOrEmpty(b.commandArgument)?parseInt(b.commandArgument):-1);break;case"Report":case"ReportAsPdf":case"ReportAsImage":case"ReportAsExcel":case"ReportAsWord":a.executeReport(b);break;case"ExportCsv":case"ExportRowset":case"ExportRss":a.executeExport(b);break;case"_ViewDetails":a._viewDetails(b.commandArgument);break;case"ClientScript":Web.HoverMonitor._instance.close();eval(b.commandArgument);break;case"SelectModal":case"EditModal":a.set_lastCommandName(e);a.set_lastCommandArgument(e);a._render();var x=b.commandName.match(/^(\w+)Modal$/),g=b.commandArgument.split(","),v=g.length==1?a.get_controller():g[0],p=g.length==1?b.commandArgument:g[1],q=[];for(i=0;i<a.get_selectedKey().length;i++)Array.add(q,{Name:a._keyFields[i].Name,Value:a.get_selectedKey()[i]});var w=Web.DataView.showModal(a,v,p,x[1],p,a.get_baseUrl(),a.get_servicePath(),q);w._parentDataViewId=a.get_id();break;case"Import":a._showImport(b.commandArgument);break;case j:a.writeContext(n,j);a._forceFocusDataSheet=true;a.changeViewType(j);a.refreshAndResize();break;case k:a.writeContext(n,k);a.changeViewType(k);a.refreshAndResize();break;case"Status":a._changeStatus(b);break;case"Search":a._executeSearch(b.path);break;case"None":return true;default:var l=e,t=b.commandArgument.match(/^view:(.+)$/);if(b.commandName=="Insert"&&t){l=t[1];Array.clear(a._selectedKey);a.updateSummary();a.set_lastCommandName(f);a.set_lastCommandArgument(l)}var o=a._createArguments(b,l);a._valid=a._validateFieldValues(o.Values,b.causesValidation==e||b.causesValidation);a._valid&&a._execute(o)}d.after(b);d.dispose();return!d.canceled()},_forgetSelectedRow:function(c,b){var a=this;if(!b)b=a._get_focusedCell();if(a.get_isDataSheet())if(b)b.colIndex=0;a._lastSelectedRowIndex=!a._ignoreSelectedKey&&a._selectedKey.length>0&&a._rowIsSelected(a._selectedRowIndex)?a._selectedRowIndex:-1;a._ignoreSelectedKey=false;Array.clear(a._selectedKey);a.updateSummary();c&&a.raiseSelected()},_changeStatus:function(c){var a=this;if(c.causesValidation){var e=a._collectFieldValues();if(c.values)e=Array.clone(c.values);if(!a._validateFieldValues(e,true))return}var d=a.findField("Status");if(!d)return;if(a.get_isEditing()){var b=a._get("_Item",d.Index);if(!b){b=document.createElement("input");b.type="hidden";b.id=String.format("{0}_Item{1}",a._id,d.Index);a._container.appendChild(b)}b.value=c.commandArgument}else{var f=a.get_selectedRow();f[d.Index]=c.commandArgument}a._updateVisibility()},_notifyDesigner:function(b){if(__designer()&&b){var a=this._lastArgs;external.ExplorerNodeChanged(this.get_controller(),this.get_viewId(),a.CommandName,a.CommandArgument,Sys.Serialization.JavaScriptSerializer.serialize(a.Values))}},goBack:function(b){Web.DataView._navigated=true;this._notifyDesigner(b);var a=location;if(a.href.match(/_explorerNode=/))a.replace(a.href);else history.go(-1)},_viewDetails:function(k){var j="editForm1",i="{0}&{1}={2}",a=this,b=a.findField(k);if(b){var g=b.Name;if(b.ItemsDataController==a.get_controller())for(var c=0;c<a._allFields.length;c++)if(a._allFields[c].IsPrimaryKey){g=a._allFields[c].Name;break}var f=a.get_contextFilter(b);if(__designer()){var e=String.format(i,b.ItemsDataController,!String.isNullOrEmpty(b.ItemsDataValueField)?b.ItemsDataValueField:g,a.get_selectedRow()[b.Index]);for(c=0;c<f.length;c++){var d=f[c];e=String.format(i,e,d.Name,d.Value)}e=a.resolveClientUrl(String.format("~/Details.{0}?l={1}",__designer()?"htm":"aspx",encodeURIComponent(e)));location.href=e;Web.DataView._navigated=false}else{d=[{Name:!String.isNullOrEmpty(b.ItemsDataValueField)?b.ItemsDataValueField:g,Value:a.fieldValue(b.Name)}];Array.addRange(d,f);var h=$appfactory.showModal(a,b.ItemsDataController,j,"Select",j,a.get_baseUrl(),a.get_servicePath(),d,{useCase:"ObjectRef"});h.set_showSearchBar(a.get_showSearchBar());h._parentDataViewId=a.get_id();h._closeViewDetails=true}}},changeViewType:function(b){var a=this;a.cancelDataSheet();if(!a._viewTypes)a._viewTypes=[];a._viewTypes[a.get_viewId()]=b;a._clearCache()},_parseLocation:function(a,h,g){var c=this;if(!h)h=c.get_selectedRow();if(!a)return null;a=c.resolveClientUrl(a);var f=/([\s\S]*?)\{(\w+)?\}/g,d="",e=-1,b=f.exec(a);while(b){d+=b[1];if(g&&c._lastArgs)for(var j=0;j<g.length;j++){var k=g[j];if(k.Name==b[2]){d+=c._lastArgs.CommandName.match(/Insert/i)?k.NewValue:k.OldValue;break}}else{var l=b[2].match(/^\d+$/)?c.get_fields()[parseInt(b[2])]:c.findField(b[2]);if(l){var i=h[l.Index];if(i!=null)d+=b.index==0?i:encodeURIComponent(i)}}e=f.lastIndex;b=f.exec(a)}if(e!=-1)a=d+(e<a.length?a.substr(e):"");if(a.startsWith("?"))a=location.pathname+a;return a},_parseText:function(a,h){if(!h)h=this.get_selectedRow();if(!a)return null;var f=/([\s\S]*?)\{(\w+)?\}/g,e="",c=-1,b=f.exec(a);while(b){e+=b[1];var g=b[2].match(/^\d+$/)?this.get_fields()[parseInt(b[2])]:this.findField(b[2]);if(g){var d=h[g.Index];if(d!=null){d=g.format(d);e+=d}}c=f.lastIndex;b=f.exec(a)}if(c!=-1)a=e+(c<a.length?a.substr(c):"");return a},_showImport:function(c){var a=this;if(!c)c=a.get_viewId();a._importView=c;a._importElement=document.createElement("div");a._importElement.id=a.get_id()+"$Import";a._importElement.className="Import";var b=new Sys.StringBuilder,d=String.format("<a href=\"javascript:\" onclick=\"$find('{0}')._downloadImportTemplate('{1}');return false;\">{2}</a>",a.get_id(),c,Web.DataViewResources.Data.Import.DownloadTemplate);b.appendFormat('<div id="{0}$ImportStatus" class="Status"><span>{1}</span> {2}</div>',a.get_id(),Web.DataViewResources.Data.Import.UploadInstruction,d);b.appendFormat('<div id="{0}$ImportMap" class="Map" style="display:none"></div>',a.get_id());b.appendFormat('<iframe src="{1}?parentId={0}&controller={2}&view={3}" frameborder="0" scrolling="no" id="{0}$ImportFrame" class="Import"></iframe>',a.get_id(),a.resolveClientUrl(a.get_appRootPath()+"Import.ashx"),a.get_controller(),c);b.appendFormat('<div class="Email">{1}:<br/><input type="text" id="{0}$ImportEmail"/></div>',a.get_id(),Web.DataViewResources.Data.Import.Email);b.appendFormat('<div class="Buttons"><button id="{0}$StartImport" onclick="$find(\'{0}\')._startImportProcessing();return false" style="display:none">{1}</button><button id="{0}$CancelImport" onclick="$find(\'{0}\')._closeImport();return false">{2}</button></div>',a.get_id(),Web.DataViewResources.Data.Import.StartButton,Web.DataViewResources.ModalPopup.CancelButton);a._importElement.innerHTML=b.toLocaleString();a._appendModalPanel(a._importElement);a._importPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:a.get_id()+"$ImportPopup",PopupControlID:a._importElement.id,DropShadow:true,BackgroundCssClass:"ModalBackground"},null,null,a._container.getElementsByTagName("a")[0]);a._saveTabIndexes();a._importPopup.show()},_closeImport:function(){this._disposeImport();this._restoreTabIndexes()},_disposeImport:function(){var a=this;if(a._importElement){a._importPopup.hide();a._importPopup.dispose();a._importPopup=null;a._importElement.parentNode.removeChild(a._importElement);delete a._importElement}},_downloadImportTemplate:function(a){this.executeExport({commandName:"ExportTemplate",commandArgument:String.format("{0},{1}",this.get_controller(),a)})},_initImportUpload:function(a){var b=a.createElement("div");b.innerHTML=String.format('<form method="post" enctype="multipart/form-data"><input type="file" id="ImportFile" name="ImportFile" style="font-size:8.5pt;font-family:tahoma;padding:2px 0px 4px 0px;" onchange="parent.window.$find(\'{0}\')._startImportUpload(this.value);this.parentNode.submit()"/></form>',this.get_id());a.body.appendChild(b);Sys.UI.DomElement.setFocus(a.getElementById("ImportFile"))},_get_importStatus:function(){return $get(this.get_id()+"$ImportStatus")},_get_importFrame:function(){return $get(this.get_id()+"$ImportFrame")},_startImportUpload:function(c){var a=this,b=c.split(/\\/);a._importFileName=b[b.length-1];Sys.UI.DomElement.setVisible(a._get_importFrame(),false);$(a._get_importStatus()).addClass("Wait");a._get_importStatus().innerHTML=Web.DataViewResources.Data.Import.Uploading},_finishImportUpload:function(c){var l="FileName",a=this;Sys.UI.DomElement.removeCssClass(a._get_importStatus(),"Wait");Sys.UI.DomElement.addCssClass(a._get_importStatus(),"Ready");var n=c.getElementById("Errors");if(n)a._get_importStatus().innerHTML=n.value;else{var q=c.getElementById(l),o=c.getElementById("NumberOfRecords"),d=c.getElementById("AvailableImportFields").value.trim().split(/\r?\n/),g=c.getElementById("FieldMap").value.trim().split(/\r?\n/);a._get_importStatus().innerHTML=String.format(Web.DataViewResources.Data.Import.MappingInstruction,o.value,a._importFileName);a._importFileName=c.getElementById(l).value;var k=$get(a.get_id()+"$StartImport");Sys.UI.DomElement.setVisible(k,true);Sys.UI.DomElement.setFocus(k);var b=new Sys.StringBuilder;b.append("<table>");for(var e=0;e<g.length;e++){var m=g[e].match(/^(.+?)=(.+?)?$/);b.appendFormat('<tr><td>{2}</td><td><select id="{0}$ImportField{1}"><option value="">{3}</option>',a.get_id(),e,Web.DataView.htmlEncode(m[1]),Web.DataViewResources.Data.Import.AutoDetect);for(var i=0;i<d.length;i++){var h=d[i].split("=");if(h[0]==m[2]){b.appendFormat('<option value="{0}"',h[0]);b.append(' selected="selected"');b.appendFormat(">{0}</option>",Web.DataView.htmlEncode(h[1]))}}b.append("</select></td></tr>")}b.append("</table>");var f=$get(a.get_id()+"$ImportMap");Sys.UI.DomElement.setVisible(f,true);f.innerHTML=b.toString();var p=$(f).find("select").change(function(){j()}),j=function(){var c=Array.clone(g),b=[],a=0;p.each(function(){$(this).css("width","auto");this.value!=""&&Array.add(b,this.value)}).each(function(){var e=this;$(e).find("option").filter(function(){return e.value!=this.value&&this.value!=""}).remove();for(var c=0;c<d.length;c++){var a=d[c].split("=");!Array.contains(b,a[0])&&$(this).append($("<option>",{value:a[0]}).text(a[1]))}}).each(function(){var b=$(this).outerWidth();if(b>a)a=b}).css("width",a)};j()}a._importPopup.show();a._get_importFrame().parentNode.removeChild(a._get_importFrame())},_startImportProcessing:function(){var a=this,c=$get(a.get_id()+"$ImportEmail"),e=c.value.replace(/;/g,",");if(String.isBlank(e)&&!confirm(Web.DataViewResources.Data.Import.EmailNotSpecified)){Sys.UI.DomElement.setFocus(c);return}var b=new Sys.StringBuilder;b.appendFormat("{0};{1};{2};{3};",a._importFileName,a.get_controller(),a._importView,e);var f=0;while(true){var d=$get(a.get_id()+"$ImportField"+f);if(!d)break;b.append(d.value);b.append(";");f++}a.executeCommand({commandName:"ProcessImportFile",commandArgument:b.toString()});a._closeImport();alert(Web.DataViewResources.Data.Import.Processing);a.refresh()},navigate:function(b,e){var a=this;a.set_selectedValue(a.get_selectedKey());var d=null,c=Web.HoverMonitor._instance;c&&c.close();b=a._parseLocation(b,null,e);for(i=0;i<a.get_views().length;i++)if(a.get_views()[i].Id==b){d=a.get_views()[i];break}if(d)a.goToView(b);else a._navigate(b)},_navigate:function(c,b){Web.DataView._navigated=true;var a=c.match(Web.DataView.LocationRegex);if(typeof __dauh!="undefined")if(a)this.encodePermalink(a[2],a[1],b);else this.encodePermalink(c);else if(a){Web.DataView._navigated=false;open(a[2],a[1],b?b:"")}else window.location.href=c},get_contextFilter:function(f,j){var d=[];if(!String.isNullOrEmpty(f.ContextFields)){var e=j?j:this._collectFieldValues(true),i=/(\w+)(\s*=\s*(.+?)){0,1}\s*(,|$)/g,b=i.exec(f.ContextFields);while(b){var g=!String.isNullOrEmpty(b[3])?b[3]:b[1],c=g.match(/^\'(.+)\'$/);if(!c)c=g.match(/^(\d+)$/);if(c){for(var a=0;a<d.length;a++)if(d[a].Name==b[1]){d[a].Value+="\0="+c[1];c=null;break}c&&Array.add(d,{Name:b[1],Value:c[1]})}else{var k=this.findField(g);if(k)for(a=0;a<e.length;a++)if(e[a].Name==k.Name){var h=e[a],l=h.Modified?h.NewValue:h.OldValue;Array.add(d,{Name:b[1],Value:l});break}}b=i.exec(f.ContextFields)}}return d},showLookup:function(h){var f=true,c=null,b=this;if(!b.get_enabled())return;var a=b._allFields[h];if(!a._lookupModalBehavior){var i=$get(b.get_id()+"_Item"+a.Index+"_ShowLookupLink");if(i){var d=a._lookupModalPanel=document.createElement("div");b._appendModalPanel(d);d.className="ModalPanel";d.id=b.get_id()+"_ItemLookupPanel"+a.Index;d.innerHTML=String.format('<table style="width:100%;height:100%"><tr><td valign="middle" align="center"><table cellpadding="0" cellspacing="0"><tr><td class="ModalTop"><div style="height:1px;font-size:1px"></div></td><td><div style="height:1px;font-size:1px"></div></td></tr><tr><td align="left" valign="top" id="{0}_ItemLookupPlaceholder{1}"  class="ModalPlaceholder"></td><td class="RightSideShadow"></td></tr><tr><td colspan="2"><div class="BottomShadow"></div></td></tr></table></td></tr></table>',b.get_id(),a.Index);a._lookupModalBehavior=$create(AjaxControlToolkit.ModalPopupBehavior,{id:b.get_id()+"_ItemLookup"+a.Index,PopupControlID:d.id,BackgroundCssClass:"ModalBackground"},c,c,i)}}else a._lookupDataControllerBehavior._render();var e=b.get_contextFilter(a),g=f;if(!a._lookupDataControllerBehavior){g=false;a._lookupDataControllerBehavior=$create(Web.DataView,{id:b.get_id()+"_LookupView"+h,baseUrl:b.get_baseUrl(),pageSize:a.ItemsPageSize?a.ItemsPageSize:Web.DataViewResources.Pager.PageSizes[0],showFirstLetters:a.ItemsLetters,servicePath:b.get_servicePath(),controller:a.ItemsDataController,viewId:a.ItemsDataView,showActionBar:Web.DataViewResources.Lookup.ShowActionBar,lookupField:a,externalFilter:e,filterSource:e.length>0?"Context":c,showSearchBar:b.get_showSearchBar(),searchOnStart:b.get_showSearchBar()&&a.SearchOnStart,description:a.ItemsDescription},c,c,$get(b.get_id()+"_ItemLookupPlaceholder"+a.Index))}else if(e.length>0){a._lookupDataControllerBehavior.set_externalFilter(e);a._lookupDataControllerBehavior.goToPage(-1);g=f}b._saveTabIndexes();a._lookupModalBehavior.show();g&&a._lookupDataControllerBehavior._focusQuickFind(f);$addHandler(document.body,"keydown",a._lookupDataControllerBehavior._bodyKeydownHandler);a._lookupDataControllerBehavior._adjustLookupSize();b._lookupIsActive=f},changeLookupValue:function(d,b,e){var c=this._allFields[d],a=this;setTimeout(function(){a._restoreTabIndexes();var f=a.get_id()+"_Item"+d,h=a.get_id()+"_Item"+c.AliasIndex;Sys.UI.DomElement.setVisible($get(f+"_ClearLookupLink"),true);var g=$get(f+"_ShowLookupLink");g.innerHTML=a.htmlEncode(c,e);Sys.UI.DomElement.setFocus(g);if(b)b=c.format(b);$get(f).value=b;if(f!=h)$get(h).value=e;$(g).closest("table").css("width","");a._updateLookupInfo(b,e);a._valueChanged(d);a._adjustModalHeight()},0);a._closeLookup(c)},clearLookupValue:function(e){var g="_ShowLookupLink",a=this,c=a._allFields[e],b=a.get_id()+"_Item"+e,i=a.get_id()+"_Item"+c.AliasIndex;Sys.UI.DomElement.setVisible($get(b+"_ClearLookupLink"),false);$get(b+g).innerHTML=Web.DataViewResources.Lookup.SelectLink;$get(b).value="";$get(i).value="";if(!String.isNullOrEmpty(c.Copy)){var f=[],h=/(\w+)=(\w+)/g,d=h.exec(c.Copy);while(d){d[2]=="null"&&Array.add(f,{name:d[1],value:null});d=h.exec(c.Copy)}f.length>0&&a.refresh(true,f)}a._updateLookupInfo("",Web.DataViewResources.Lookup.SelectLink);$get(b+g).focus();a._valueChanged(e);a._adjustModalHeight()},_updateLookupInfo:function(d,e){var a=this,b=$get(a.get_id()+"_Text0");if(b){b.value=e;b.name=b.id;var c=$get(a.get_id()+"_Item0");c.value=d;c.name=c.id;if(a.get_lookupPostBackExpression()){var f=Sys.WebForms.PageRequestManager.getInstance();if(f)eval("Sys.WebForms.PageRequestManager.getInstance()._doPostBack"+a.get_lookupPostBackExpression().match(/\w+(.+)/)[1]);else eval(a.get_lookupPostBackExpression())}}},createNewLookupValue:function(d){var a=this,b=a._newLookupValueField=a._allFields[d],c=a._createNewView=Web.DataView.showModal(a,b.ItemsDataController,b.ItemsNewDataView,"New",b.ItemsNewDataView,a.get_baseUrl(),a.get_servicePath(),a.get_contextFilter(b));c._parentDataViewId=a.get_id();c.add_executed(Function.createDelegate(a,a._saveNewLookupValueCompleted));c.set_showSearchBar(a.get_showSearchBar());a._lookupIsActive=true},_saveNewLookupValueCompleted:function(a,b){var c=this;if(b.result.Errors.length>0)return;b.handled=true;Web.DataView.hideMessage();var j=null,d=c._newLookupValueField,f=d.ItemsDataValueField;if(String.isNullOrEmpty(f))f=a._keyFields[0].Name;if(b.result.Values.length==0)b.result.Values=a._lastArgs.Values;for(var e=0;e<b.result.Values.length;e++)if(b.result.Values[e].Name==f){j=b.result.Values[e].NewValue;break}var h=null,g=d.ItemsDataTextField;if(String.isNullOrEmpty(g))g=a._fields[0].Name;for(i=0;i<a._lastArgs.Values.length;i++)if(a._lastArgs.Values[i].Name==g){h=a._lastArgs.Values[i].NewValue;break}c._createNewView.endModalState("Cancel");c._copyLookupValues(null,d,a._lastArgs.Values);c.changeLookupValue(d.Index,j,h);c._lookupIsActive=false},hideLookup:function(b){var c=b?this._allFields[b]:this.get_lookupField(),a=this.get_lookupField()._dataView;a._closeLookup(c);a._restoreTabIndexes();$get(a.get_id()+"_Item"+c.Index+"_ShowLookupLink").focus()},closeLookupAndCreateNew:function(){this.hideLookup();var a=this.get_lookupField();a._dataView.createNewLookupValue(a.Index)},htmlEncode:function(c,a){var b=this._allFields[c.AliasIndex];return b.HtmlEncode?b.Type=="String"?Web.DataView.htmlEncode(a):a:a},filterIsExternal:function(d){var a=this;if(a._externalFilter.length==0)return false;for(var b=0;b<a._filter.length;b++){var f=a._filter[b].match(/(\w+):/)[1],e=false;if(!d||d==f)for(var c=0;c<a._externalFilter.length;c++)if(a._externalFilter[c].Name==f){e=true;break}if(!e)return false}return true},updateSummary:function(){var e=false,j="PageSummaryBox",g=null,a=this;if(!a.get_showInSummary())return;var b=g;if(!a._summaryId){var h=$getSideBar();if(!h)a._summaryId="";else{a._summaryId="PageSummary_"+a.get_id();b=$get(j);if(!b){b=document.createElement("div");b.id=j;b.className="TaskBox Summary";b.innerHTML=String.format('<div class="Inner"><div class="Summary">{0}</div></div>',Web.DataViewResources.Menu.Summary);h.insertBefore(b,h.childNodes[h._hasActivators?1:0]);b._numberOfVisibleSummaries=0}var c=$get(a._summaryId);if(!c){c=document.createElement("div");c.id=a._summaryId;b.childNodes[0].appendChild(c)}}}if(a._summaryId.length>0){if(!b)b=$get(j);if(!a._rows||a._rows.length==0){Sys.UI.DomElement.setVisible(b,e);return}var r=a.get_selectedRow();c=$get(a._summaryId);var d=new Sys.StringBuilder,p=a._lastCommandName,q=a.get_view().Type;a.get_view().Type="Grid";a._lastCommandName=g;var f=true;if(a._selectedKey.length>0)for(var n=true,m=0,l=0;l<a._allFields.length;l++){var k=a._allFields[l];if(k.ShowInSummary){f=e;d.append('<div class="Field">');if(n)n=e;else d.append('<div class="Divider"></div>');d.appendFormat('<div class="Label">{0}</div>',String.trimLongWords(a._allFields[k.AliasIndex].Label));d.append('<div class="Value">');a._renderItem(d,k,r,e,e,e,e,true);d.append("</div></div>");m++;if(a.get_summaryFieldCount()>0&&m>=a.get_summaryFieldCount())break}}Sys.UI.DomElement.setVisible(c,!f);if(f&&a._summaryIsVisible)b._numberOfVisibleSummaries--;else if(!f&&!a._summaryIsVisible||!f&&a._summaryIsVisible==g)b._numberOfVisibleSummaries++;a._summaryIsVisible=!f;Sys.UI.DomElement.setVisible(b,b._numberOfVisibleSummaries>0);var o=d.toString();c.innerHTML=o;var i=a._lastArgs!=a._lastClearArgs&&a._lastArgs.CommandName=="Delete";if(!$appfactory.mobile&&(!f||i)&&a.get_filterSource()==g&&typeof Web.Membership!="undefined"){if(i)a._lastClearArgs=a._lastArgs;Web.Membership._instance.addPermalink(String.format("{0}&_controller={1}&_commandName=Select&_commandArgument=editForm1",a.get_keyRef(),a.get_controller()),i?g:String.format('<div class="TaskBox" style="width:{2}px"><div class="Inner"><div class="Summary">{0}</div>{1}</div></div>',document.title,o,c.offsetWidth==0?135:c.offsetWidth))}d.clear();a._lastCommandName=p;a.get_view().Type=q}},get_hasDetails:function(){return this._hasDetails==true},get_hasParent:function(){return this._hasParent==true},get_usesTransaction:function(){return this._usesTransaction==true},get_inTransaction:function(){return this.get_transaction()!=null},add_selected:function(a){this._hasDetails=true;this.get_events().addHandler("selected",a)},remove_selected:function(a){this.get_events().removeHandler("selected",a)},raiseSelected:function(){var a=this;if(Web.DataView._navigated)return;var b=a.get_events().getHandler("selected");b&&b(a,Sys.EventArgs.Empty);!a.multiSelect()&&a.set_selectedValue(a.get_selectedKey())},add_executed:function(a){this.get_events().addHandler("executed",a)},remove_executed:function(a){this.get_events().removeHandler("executed",a)},raiseExecuted:function(b){var a=this.get_events().getHandler("executed");a&&a(this,b)},_closeLookup:function(a){$closeHovers();if(a&&a._lookupModalBehavior){a._lookupModalBehavior.hide();$removeHandler(document.body,"keydown",a._lookupDataControllerBehavior._bodyKeydownHandler)}this._lookupIsActive=false;if(event){var b=new Sys.UI.DomEvent(event);b.stopPropagation();b.preventDefault()}},_collectFieldValues:function(t){var f=null,l="_Item",c=this;t=true;var j=[],o=c.get_selectedRow(),i=c.get_isInserting(),r=c.extension();if(r&&r.collect)j=r.collect();else{if(!o&&!i)return j;for(var d=0;d<c._allFields.length;d++){var a=c._allFields[d],u=a.ItemsStyle=="RadioButtonList",b=c._get(l,d);if(a.ReadOnly&&!t)b=f;else if(u){var g=0,h=$get(c.get_id()+l+d+"_"+g);while(h){if(h.checked){b=h;break}else b=f;g++;h=$get(c.get_id()+l+d+"_"+g)}}else if(a.ItemsStyle=="CheckBoxList"&&b){g=0;h=$get(c.get_id()+l+d+"_"+g);if(h){b.value="";while(h){if(h.checked){if(b.value.length>0)b.value+=",";b.value+=h.value}g++;h=$get(c.get_id()+l+d+"_"+g)}}}if(a.ClientEditor&&b){if(a.ClientEditor=="Web$DataView$RichText"){var v=Web.DataView.EditorFactories[a.ClientEditor.replace(".","$")];v.persist&&v.persist(b)}}else if(a.Editor&&b){var y=$get(b.id+"$Frame");if(y){editor=Web.DataView.Editors[a.EditorId];if(editor)b.value=editor.GetValue()}}var e=b?b.value:f;if(e)if(a.Type.startsWith("Date")){var k=Date.tryParseFuzzyDate(e,a.DataFormatString);if(k!=f&&b.type=="text")e=b.value=a.DateFmtStr?String.format(a.DateFmtStr,k):a.format(k)}else if(!String.isBlank(a.DataFormatString)&&a.isNumber()){var m=Number.tryParse(e);if(m!=f){if(a.DataFormatString.match(/\{0:p\}/i)&&m>1)m=m/100;e=b.value=a.format(m)}}if(a.TimeFmtStr){var q=c._get("_Item$Time",d);if(q){k=Date.tryParseFuzzyTime(q.value);if(k!=f){q.value=String.localeFormat(a.TimeFmtStr,k);e+=" "+q.value}}}if(!a.OnDemand&&(b||a.IsPrimaryKey||(!a.ReadOnly||t))){var w=true,s=false;if(c._lastCommandName=="BatchEdit"){var x=$get(String.format("{0}$BatchSelect{1}",c.get_id(),a.Index));s=a.TextMode==4||a.Hidden||a.ReadOnly;w=a.IsPrimaryKey||s||x&&x.checked}w&&Array.add(j,{Name:a.Name,OldValue:i?f:o[a.Index],NewValue:b&&e!=f?a.Type=="Boolean"&&e.length>0?e=="true":e.length==0?f:e:!i&&(a.TextMode==4||a.Hidden||a.ReadOnly)?o[a.Index]:f,Modified:b!=f&&!(!i&&a.Type=="String"&&String.isNullOrEmpty(e)&&String.isNullOrEmpty(o[a.Index]))||u&&i&&!a.AllowNulls,ReadOnly:a.ReadOnly&&!(a.IsPrimaryKey&&i)||s})}}}for(d=0;d<c._externalFilter.length;d++){var p=c._externalFilter[d];for(g=0;g<j.length;g++){var n=j[g];if(n.Name.toLowerCase()==p.Name.toLowerCase()&&n.NewValue==f){n.NewValue=typeof p.Value=="string"?c.convertStringToFieldValue(c.findField(n.Name),p.Value):p.Value;n.Modified=true;break}}}return j},_enumerateExpressions:function(f,e,d){var c=[];if(this._expressions)for(var b=0;b<this._expressions.length;b++){var a=this._expressions[b];a.Scope==e&&(f==Web.DynamicExpressionType.Any||a.Type==Web.DynamicExpressionType.RegularExpression)&&a.Target==d&&Array.add(c,a)}return c},_prepareJavaScriptExpression:function(a){if(!a._variables){var c=[],g=/\[(\w+)\]/g,e=g.exec(a.Test);while(e){for(var b=e[1],f=false,d=0;d<c.length;d++)if(c[d].name==b){f=true;break}if(!f){var h=this.findField(b);h&&Array.add(c,{name:b,regex:new RegExp("\\["+b+"\\]","g"),replace:String.format("this._javaScriptRowValue({0})",h.Index)})}e=g.exec(a.Test)}a._variables=c;a.Test=a.Test.replace(/\[(\w+)\.(\w+)\]/gi,"this.fieldValue('$2','$1')")}},_javaScriptRowValue:function(a){return this._javaScriptRow[a]},_evaluateJavaScriptExpressions:function(h,k,g){var c=null;for(var d=g?"":c,e=0;e<h.length;e++){var a=h[e];if(a.Type==Web.DynamicExpressionType.ClientScript){this._prepareJavaScriptExpression(a);var b=a._script;if(!b){b=a.Test;for(var f=0;f<a._variables.length;f++){var j=a._variables[f];b=b.replace(j.regex,j.replace)}a._script=b}if(b){this._javaScriptRow=k;try{var i=eval(b);if(g){if(i)if(d==c)d=a.Result;else d+=" "+a.Result}else return a.Result==c?i:a.Result}catch(l){}finally{this._javaScriptRow=c}}}}return d},_validateFieldValueFormat:function(e,a){var c=null,d=Web.DataViewResources.Validator;switch(e.Type){case"SByte":case"Byte":case"Int16":case"Int32":case"UInt32":case"Int64":case"Single":case"Double":case"Decimal":case"Currency":var b=a.NewValue;if(typeof b!="number")b=Number.tryParse(b);if(isNaN(b)||b==null)c=d.NumberIsExpected;else a.NewValue=b;break;case"Boolean":try{a.NewValue=String.isInstanceOfType(a.NewValue)?Boolean.parse(a.NewValue):a.NewValue}catch(f){c=d.BooleanIsExpected}break;case"DateTime":if(typeof a.NewValue=="string"){b=!String.isNullOrEmpty(e.DataFormatString)?Date.parseLocale(a.NewValue,e.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1]):Date.parse(a.NewValue);if(!b)c=d.DateIsExpected;else a.NewValue=b;if(!c&&a.NewValue!=null)a.NewValue=new Date(a.NewValue-a.NewValue.getTimezoneOffset()*60*1e3)}else if(isNaN(a.NewValue.getTime()))c=d.DateIsExpected}return c},validate:function(b){for(var a=0;a<b.length;a++)if(b[a].Error)return false;return true},_validateFieldValues:function(s,j,r){var k=false,d=null,p="DateTime",e=this;for(var f=true,m=new Sys.StringBuilder,n=0;n<s.length;n++){var a=s[n],b=e.findField(a.Name);if(!b||r&&b.ColIndex!=r.colIndex)continue;if(b.Type==p&&a.OldValue!=d&&a.OldValue.getTimezoneOffset)a.OldValue=new Date(a.OldValue-a.OldValue.getTimezoneOffset()*60*1e3);var c=d;if(b.ReadOnly&&b.IsPrimaryKey){if(a.NewValue==d&&a.OldValue!=d)a.NewValue=a.OldValue}else if(a.Modified){if(!b.AllowNulls&&(!b.HasDefaultValue||Web.DataViewResources.Validator.EnforceRequiredFieldsWithDefaultValue))if(String.isBlank(a.NewValue)&&!b.Hidden&&!b.isReadOnly())c=Web.DataViewResources.Validator.RequiredField;if(!c&&String.isBlank(a.NewValue))a.NewValue=d;if(!c&&a.NewValue!=d&&!b.IsMirror&&(!b.Hidden||a.Modified)){var w=e._validateFieldValueFormat(b,a);if(!b.isReadOnly())c=w}if(!c)for(var q=e._enumerateExpressions(Web.DynamicExpressionType.RegularExpression,Web.DynamicExpressionScope.Field,a.Name),o=0;o<q.length;o++){var i=q[o],v=a.NewValue?a.NewValue:"";try{var t=new RegExp(i.Test),u=t.exec(v);if(i.Result.match(/\$(\d|\'\`)/)){if(u)a.NewValue=v.replace(t,i.Result)}else if(!u)c=c?(c+=i.Result):i.Result}catch(x){}}a.Modified=b.Type.startsWith(p)?(a.NewValue==d?d:a.NewValue.toString())!=(a.OldValue==d?d:a.OldValue.toString()):a.NewValue!=a.OldValue}a.Error=c;if($appfactory.mobile){if(c&&j){e._focus(b.Name,c);f=k}}else{var g=$get(e.get_id()+"_Item"+b.Index+"_Error");if(g&&j){Sys.UI.DomElement.setVisible(g,k);g.innerHTML=c;c!=d&&f&&e._showFieldError(b,c);var h=g.parentNode;while(h&&h.tagName!="BODY"){if(!$common.getVisible(h)){g=d;break}h=h.parentNode}}if(c&&j){if(f){var l=e._lastFocusedCell;if(l){e._focusCell(-1,-1,k);e._focusCell(l.rowIndex,l.colIndex,true);e._lastFocusedCell=d}e._focus(b.Name)}f=k;!g&&m.append(Web.DataView.formatMessage("Attention",b.Label+": "+c))}}}if(!j)f=true;!f&&Web.DataView.showMessage(m.toString());m.clear();return f},_fieldIsInExternalFilter:function(a){return this._findExternalFilterItem(a)!=null},_findExternalFilterItem:function(c){for(var a=0;a<this._externalFilter.length;a++){var b=this._externalFilter[a];if(c.Name.toLowerCase()==b.Name.toLowerCase())return b}return null},_internalFocus:function(){var a=$get(this._focusId);if(a)try{a.value="";a.value=this._focusText;Sys.UI.DomElement.setCaretPosition(a,this._focusText.length)}catch(b){}},_showFieldError:function(h,e){var c="px",d=this,a=d._get("_Item",h.Index+"_Error");if(a){Sys.UI.DomElement.setVisible(a,e!=null);if(e){d._skipErrorReset=true;a.style.marginLeft="0px";a.style.marginTop="0px";a.innerHTML=String.format('{0} <a href="javascript:" onclick="Sys.UI.DomElement.setVisible(this.parentNode, false);$find(\'{2}\')._focus(\'{3}\');return false" class="Close" title="{1}"><span>&nbsp;</span></a>',e,Web.DataViewResources.ModalPopup.Close,d.get_id(),h.Name);if(d.get_isForm()){var g=$common.getPaddingBox(a.previousSibling?a.previousSibling:a);a.style.marginLeft=g.left+c;a.style.marginTop=1+c}else{var k=$appfactory.scrolling(),l=$common.getClientBounds(),i=$common.getBounds(a),f=i.x+i.width-(k.x+l.width);if(f<0)f=0;var m=$common.getBounds(a.parentNode);g=$common.getPaddingBox(a.parentNode);var b=a.nextSibling;while(b&&b.nodeType!=1)b=b.nextSibling;var j=$common.getBounds(b?b:a);a.style.marginLeft=-(j.x-m.x+1+f)+c;a.style.marginTop=j.height+g.bottom+c}}}},_focus:function(d,g){var j=true,m=false,l=null,a=this;if($appfactory.mobile){$appfactory.mobile.focus(d,g);return}if(g)for(var b=0;b<a.get_fields().length;b++)a._showFieldError(a.get_fields()[b]);var e=a._get_focusedCell();if(e&&a.get_isEditing()&&a._id==Web.DataView._activeDataSheetId){if(!String.isNullOrEmpty(d)){var c=l,p=m;for(b=0;b<a._fields.length;b++){c=a._fields[b];if(c.Name==d){a._focusCell(e.rowIndex,e.colIndex,m);p=e.colIndex!=b;e={rowIndex:a._selectedRowIndex,colIndex:b};if(!a._continueAfterScript)a._saveAndNew=m;break}}if(!String.isNullOrEmpty(g)&&c){if(p){a._focusCell(e.rowIndex,e.colIndex,j);a.refresh(j)}a._showFieldError(c,g)}}var k=a._focusCell(e.rowIndex,e.colIndex,j);if(k){var f=k.getElementsByTagName("input"),q=m;for(b=0;b<f.length;b++)if(f[b].type!="hidden"){q=j;break}if(!q)f=k.getElementsByTagName("textarea");if(f.length==0)f=k.getElementsByTagName("select");if(f.length==0)f=k.getElementsByTagName("a");for(b=0;b<f.length;b++){var h=f[b];if(h.tagName!="INPUT"||h.type!="hidden"){if((h.tagName=="INPUT"||h.tagName=="TEXTAREA")&&a._pendingChars!=l){a._focusText=a._pendingChars;a._focusId=h.id;var t=a;setTimeout(function(){t._internalFocus()},50)}else Sys.UI.DomElement.setFocus(h);break}}}a._pendingChars=l;return}if(String.isNullOrEmpty(d)&&!String.isNullOrEmpty(a._focusedFieldName)){c=a.findField(a._focusedFieldName);if(c)d=c.Name}a._focusedFieldName=d;for(b=0;b<a.get_fields().length;b++){c=a.get_fields()[b];var o=c.ItemsStyle=="AutoComplete"&&(c.Name==d||c.AliasName==d||String.isNullOrEmpty(d));if(!c.ReadOnly&&(d==l||c.Name==d||o)){var n=a.get_id()+"_Item"+(o?c.AliasIndex:c.Index);switch(c.ItemsStyle){case"RadioButtonList":case"CheckBoxList":n+="_0";break;case"Lookup":n+="_ShowLookupLink"}var r=$get(n),s=$get(String.format("{0}_ItemContainer{1}",a.get_id(),c.Index)),u=a._categories[c.CategoryIndex],i=Array.indexOf(a._tabs,u.Tab);d&&i>=0&&a.set_categoryTabIndex(i);a._toggleCategoryVisibility(c.CategoryIndex,j);if(r&&(!s||Sys.UI.DomElement.getVisible(s)))if(d||(i==a.get_categoryTabIndex()||a._tabs.length==0)){i>=0&&a.set_categoryTabIndex(i);try{g&&a._showFieldError(c,g);Sys.UI.DomElement.setFocus(r)}catch(v){}break}}}},_serverFocus:function(b,c){var a=this;a._focus(b,c);if(a.get_isDataSheet()){a.refresh(true);a._focus(b,c)}},_saveTabIndexes:function(){var a=this;a._lastSavedTabIndexes=a._savedTabIndexes;a._savedTabIndexes=[];for(var c=0;c<Web.DataView._tagsWithIndexes.length;c++)for(var e=document.getElementsByTagName(Web.DataView._tagsWithIndexes[c]),d=0;d<e.length;d++){var b=e[d];b&&Array.add(a._savedTabIndexes,{element:b,tabIndex:b.tabIndex})}},_restoreTabIndexes:function(){var a=this;if(a._savedTabIndexes){for(var b=0;b<a._savedTabIndexes.length;b++){a._savedTabIndexes[b].element.tabIndex=a._savedTabIndexes[b].tabIndex;delete a._savedTabIndexes[b].element}Array.clear(a._savedTabIndexes)}a._savedTabIndexes=a._lastSavedTabIndexes;a._lastSavedTabIndexes=null},_selectKeyByRowIndex:function(a){this._selectKeyByRow(this._rows[a])},_selectKeyByRow:function(e){var a=this;a._selectedRow=e;var c=a._selectedKey;a._selectedKey=[];a._selectedKeyFilter=[];for(var b=0;b<a._keyFields.length;b++){var d=a._keyFields[b];Array.add(a._selectedKey,e[d.Index]);Array.add(a._selectedKeyFilter,d.Name+":="+a.convertFieldValueToString(d,e[d.Index]));if(c&&(c.length<b||c[b]!=a._selectedKey[b]))c=null}a.updateSummary();!c&&!a._raiseSelectedDelayed&&a.raiseSelected()},_showWait:function(e){var a=this;if($appfactory.mobile)return;var d=Web.DataViewResources.Common.WaitHtml;if(a.get_fields()==null||e){a._container.innerHTML=a.get_isModal()||a.get_lookupField()?d:'<div class="dataview-busy-whitespace"></div>';$(a._container).find(".Wait").addClass("dataview")}else{var b=$get(a.get_id()+"_Wait");if(b){a._oldWaitHTML=b.innerHTML;b.innerHTML=d}}var c=a.extension();c&&c.wait()},_hideWait:function(){if(this._oldWaitHTML!=null){var a=$get(this.get_id()+"_Wait");if(a)a.innerHTML=this._oldWaitHTML}},_get_colSpan:function(){var a=this;return a.get_isForm()?2:a.get_fields().length+(a.multiSelect()?1:0)+(a.get_showIcons()?1:0)+(a.get_isDataSheet()?1:0)+(a._actionColumn?1:0)},_renderCreateNewBegin:function(b,a){!String.isNullOrEmpty(a.ItemsNewDataView)&&b.append('<table cellpadding="0" cellspacing="0"><tr><td>')},_renderCreateNewEnd:function(b,a){if(!String.isNullOrEmpty(a.ItemsNewDataView)){b.append("</td><td>");this.get_enabled()&&b.appendFormat('<a href="#" class="CreateNew" onclick="$find(\'{0}\').createNewLookupValue({1});return false" id="{0}_Item{1}_CreateNewLookupLink" title="{2}"{3}>&nbsp;</a>',this.get_id(),a.Index,String.format(Web.DataViewResources.Lookup.NewToolTip,a.Label),String.format(' tabindex="{0}"',$nextTabIndex()));b.append("</td></tr></table>")}},_raisePopulateDynamicLookups:function(){var a=this;a._hasDynamicLookups&&a.get_isEditing()&&a._skipPopulateDynamicLookups!=true&&a.executeCommand({commandName:"PopulateDynamicLookups",commandArgument:"",causesValidation:false});a._skipPopulateDynamicLookups=false},_raiseCalculate:function(b,a){this.executeCommand({commandName:"Calculate",commandArgument:b.Name,causesValidation:false,trigger:a.Name})},get_currentRow:function(){var a=this;return a.get_isInserting()?a._newRow?a._newRow:[]:a.get_selectedRow()},fieldValue:function(f,c){var a=null,b=!c||c.length==0?this:c.match(/^master$/i)?this.get_master():$find(c);if(!b)return a;if(!b._allFields)return a;var e=b.findField(f);if(!e)return a;var d=b._clonedRow;if(d==a)d=b._cloneChangedRow();return d?d[e.Index]:a},_useLEVs:function(g){var b=this;if(g&&b._allowLEVs){var d=b._get_LEVs();if(d.length>0)for(i=0;i<d[0].length;i++){var a=d[0][i];f=b.findField(a.Name);if(f&&f.AllowLEV){if(b._lastCommandName=="New"&&a.Modified&&a.NewValue!=null){for(var e=true,c=0;c<b._externalFilter.length;c++)if(b._externalFilter[c].Name.toLowerCase()==a.Name.toLowerCase()){e=false;break}if(e)g[f.Index]=a.NewValue}f._LEV=a.Modified?a.NewValue:null}}}},_configure:function(b){var a=this;if(!a._requiresConfiguration)return;if(!b)b=a.get_currentRow();if(!b)return;for(var e=0;e<a._allFields.length;e++){var c=a._allFields[e];if(!String.isNullOrEmpty(c.Configuration)){var g=/\s*(\w+)=(\w+)\s*?($|\n)/g,d=g.exec(c.Configuration);while(d){var f=a.findField(d[2]);if(f){var h=b[f.Index];if(h)c[d[1]]=h}d=g.exec(c.Configuration)}}}},_focusQuickFind:function(b){var a=this;if(!a._quickFindFocused||b==true){a._lostFocus=true;try{Sys.UI.DomElement.setFocus(a.get_quickFindElement())}catch(c){}a._quickFindFocused=true}},_restoreEmbeddedViews:function(){var a=this;if(!a._embeddedViews)return;for(var c=0;c<a._embeddedViews.length;c++){var b=a._embeddedViews[c];b.parent.appendChild(b.view._element);delete b.parent;b.view=null}Array.clear(a._embeddedViews)},_incorporateEmbeddedViews:function(){if(!this._embeddedViews)return;for(var b=0;b<this._embeddedViews.length;b++){var a=this._embeddedViews[b],d=$get("v_"+a.view.get_cookie().replace(/-/g,"")),c=a.view._element;a.parent=c.parentNode;d.appendChild(c)}},_render:function(e){var c=true,b=false,a=this;if($appfactory.mobile)e&&a._refreshExtension();else{a._restoreEmbeddedViews();a._detachBehaviors();a._disposeSearchBarExtenders();a._useLEVs();a._configure();a._internalRender();a._viewMessages&&a.showViewMessage(a._viewMessages[a.get_viewId()]);a._raisePopulateDynamicLookups();!a.get_modalAnchor()&&a.get_lookupField()&&a._focusQuickFind();if(a._raiseSelectedDelayed){a._raiseSelectedDelayed=b;a.raiseSelected();a._forceChanged=b}if(a._scrollIntoView){a._scrollIntoView=b;var g=$common.getBounds(a._element),f=$appfactory.scrolling();g.y<f.y&&a._element.scrollIntoView(c)}a._incorporateEmbeddedViews();a.get_isModal()&&a._adjustModalPopupSize();if(a.get_searchOnStart()&&a.get_isGrid()){a._focusSearchBar();a.set_searchOnStart(b)}if(a.get_isDataSheet()){var d=a._get_focusedCell();if(a.get_isInserting()&&!d)a._startInputListenerOnCell(0,0);else if(d&&a._id==Web.DataView._activeDataSheetId){a._skipCellFocus=c;a._focusCell(-1,-1,c)}}if(a.get_isGrid()&&a._synced){a._synced=b;if(a._selectedRowIndex==null){a._forgetSelectedRow(c);a.refresh(c)}}a._syncKeyFilter()}},_syncKeyFilter:function(){var a=this,c=a.get_selectedKey();if(c.length>0&&a._selectedKeyFilter.length==0)for(var b=0;b<a._keyFields.length;b++){var d=a._keyFields[b];Array.add(a._selectedKeyFilter,d.Name+":="+a.convertFieldValueToString(d,c[b]))}},_mergeRowUpdates:function(b){var a=this;if(a._lastCommandName=="BatchEdit"){var g=a._batchEdit=[],f=a._allFields;$(a._element).find(".BatchSelect input:checkbox:checked").each(function(){var a=this.id.match(/BatchSelect(\d+)$/);if(a){var b=f[parseInt(a[1])];Array.add(g,b.Name)}})}a._originalRow=null;a._useLEVs(b);if(a.get_isEditing()&&a._ditto){a._originalRow=Array.clone(b);for(var d=0;d<a._ditto.length;d++){var e=a._ditto[d],c=a.findField(e.name);if(c&&!(c.ReadOnly&&c.IsPrimaryKey))b[c.Index]=e.value}delete a._ditto}a._configure(b);a._mergedRow=b},_removeRowUpdates:function(){var a=this,c=a._mergedRow;if(!c)return;if(a._originalRow)for(var b=0;b<a._originalRow.length;b++)c[b]=a._originalRow[b];a._mergedRow=null},_internalRender:function(){var f=null,a=this;a._multipleSelection=f;a._dynamicActionButtons=false;var k=a.get_viewType(),b=new Sys.StringBuilder;if(a.get_mode()==Web.DataViewMode.Lookup){var c=a._fields[0],d=a.get_lookupText();if(d==f)d=Web.DataViewResources.Lookup.SelectLink;var m=c.format(d);a._renderCreateNewBegin(b,c);b.appendFormat('<table cellpadding="0" cellspacing="0" class="DataViewLookup"><tr><td><a href="javascript:" onclick="$find(\'{0}\').showLookup({1});return false" class="Select" id="{0}_Item{1}_ShowLookupLink" title="{3}" tabindex="{7}"{8}>{2}</a><a href="#" class="Clear" onclick="$find(\'{0}\').clearLookupValue({1});return false" id="{0}_Item{1}_ClearLookupLink" title="{5}" tabindex="{7}">&nbsp;</a></td></tr></table><input type="hidden" id="{0}_Item{1}" value="{4}"/><input type="hidden" id="{0}_Text{1}" value="{6}"/>',a.get_id(),c.Index,a.htmlEncode(c,m),String.format(Web.DataViewResources.Lookup.SelectToolTip,c.Label),a.get_lookupValue(),String.format(Web.DataViewResources.Lookup.ClearToolTip,c.Label),Web.DataView.htmlAttributeEncode(m),$nextTabIndex(),a.get_enabled()?"":' disabled="true" class="Disabled"');a._renderCreateNewEnd(b,c);a.get_element().appendChild(a._container);a._container.innerHTML=b.toString();if(a.get_lookupValue()==""||!a.get_enabled())$get(a.get_id()+"_Item0_ClearLookupLink").style.display="none"}else{var l=k=="Form";b.appendFormat('<table class="DataView {1}_{2}{3}{4} {5}Type" cellpadding="0" cellspacing="0"{0}>',a.get_isModal()?String.format(' style="width:{0}px"',a._container.offsetWidth-20):"",a.get_controller(),a.get_viewId(),a._numberOfColumns>0?" MultiColumn":"",a._tabs.length>0?" Tabbed":"",k);if(l)a._renderFormView(b);else a._renderGridView(b);b.append("</table>");if(a._mergedRow)for(var h=a._get_focusedCell(),g=a.get_isInserting(),j=a.get_isDataSheet(),e=0;e<a._allFields.length;e++){var i=a._allFields[e],n=h&&e!=a._fields[h.colIndex].Index;if(i.Hidden&&(!i.IsPrimaryKey||g)||n||!h&&g&&j){d=a._mergedRow[e];(d!=f||j&&!g)&&b.appendFormat('<input id="{0}_Item{1}" type="hidden" value="{2}"/>',a.get_id(),e,Web.DataView.htmlAttributeEncode(d!=f?i.format(d):""))}}a._container.innerHTML=b.toString();if(a._multipleSelection!=f&&a._multipleSelection==true)$get(a.get_id()+"_ToggleButton").checked=true;a._attachBehaviors();a._updateVisibility();if(a.get_isEditing()){a._lastCommandName=="BatchEdit"&&$(a._element).find("div.BatchSelect input:checkbox:checked").each(function(){Web.DataView._updateBatchSelectStatus(this,l)});a._focus()}}b.clear();a._updateChart();a._updateSearchBar();a._removeRowUpdates();a._fixWidthOfColumns();a._fixHeightOfRow(true);a._refreshExtension()},_refreshExtension:function(){var a=this.extension(),b=this._lastExtension;if(a!=b){b&&b.hide();a&&a.show();this._lastExtension=a}a&&a.refresh()},_get_headerRowElement:function(){var b=this._container.childNodes[0].childNodes[0].childNodes,a=0;while(a<b.length){if(Sys.UI.DomElement.containsCssClass(b[a],"HeaderRow"))return b[a];a++}return null},_fixWidthOfColumns:function(){var f="Fixed",b=this;if((b.get_isDataSheet()||b.get_isGrid())&&!b.extension()){var c=b._get_headerRowElement();if(c){if(!b._viewColumnSettings)b._viewColumnSettings=[];var d=b._viewColumnSettings[b.get_viewId()];if(!d){d=[];$(c).addClass(f);for(var a=0;a<c.childNodes.length;a++){var g=c.childNodes[a],h=$common.getBounds(g);if(h.width==0){Sys.UI.DomElement.removeCssClass(c,f);return}var k=$common.getPaddingBox(g),j=$common.getBorderBox(g),e={w:h.width-k.horizontal-j.horizontal,h:h.height-k.vertical-j.vertical};Array.add(d,e)}var l=$common.getBounds(c);for(a=0;a<d.length;a++)d[a].h=l.height;b._viewColumnSettings[b.get_viewId()]=d;Sys.UI.DomElement.removeCssClass(c,f)}for(a=0;a<c.childNodes.length;a++){e=d[a];if(e){var i=c.childNodes[a];i.style.height=e.h+"px";i.style.width=e.w+"px"}}}}},_fixHeightOfRow:function(g){var a=this;if((a.get_isDataSheet()||a.get_isGrid())&&(!g||a.get_isEditing())){var c=a._get_headerRowElement();if(!c)return;var h=a._get_focusedCell(),f=a.get_isGrid()?a._selectedRowIndex:h.rowIndex;if(f>=0){for(var e=c.parentNode,b=0;b<e.childNodes.length;b++)if(e.childNodes[b]==c)break;var d=e.childNodes[b+f+1];if(d)if(g){if(a._selectedRowHeight)d.style.height=a._selectedRowHeight+"px"}else{var i=$common.getBounds(d);a._selectedRowHeight=i.height}}}},_updateChart:function(){var b=this;if(b.get_isChart()){var c=b._get("$Chart"),e=c.offsetWidth;if(e<100)e=c.parentNode.offsetWidth;var a=b._createParams();delete a.Transaction;delete a.LookupContextFieldName;delete a.LookupContextController;delete a.LookupContextView;delete a.LookupContext;delete a.LastCommandName;delete a.LastCommandArgument;delete a.Inserting;delete a.DoesNotRequireData;var f=Sys.Serialization.JavaScriptSerializer.serialize(a),g=$common.getBounds(c),d=b;if(d._chartHeight)c.style.height=d._chartHeight+"px";$(c).one("load",function(){try{d._chartHeight=$(this).height()}catch(a){}}).attr("src",String.format("{0}ChartHost.aspx?c={1}_{2}&w={3}&r={4}",b.get_baseUrl(),b.get_controller(),b.get_viewId(),e,encodeURIComponent(f)))}},_toggleCategoryVisibility:function(d,a){var e="Maximize",c=$get(String.format("{0}$Category${1}",this.get_id(),d));if(c){var f=this.get_categories()[d];if(!a)a=!Sys.UI.DomElement.getVisible(c);Sys.UI.DomElement.setVisible(c,a);var b=$get(String.format("{0}$CategoryButton${1}",this.get_id(),d));f.Collapsed=!a;if(a){Sys.UI.DomElement.removeCssClass(b,e);b.childNodes[0].title=Web.DataViewResources.Form.Minimize}else{$(b).addClass(e);b.childNodes[0].title=Web.DataViewResources.Form.Maximize}_body_performResize()}},_processTemplatedText:function(j,a){var d=false;if(!a)a="";var h=/\{(\w+)\}/g,c=h.exec(a);if(!c)return a;var b=new Sys.StringBuilder,e=0;while(c){b.append(a.substring(e,c.index));var f=c[1];e=c.index+f.length+2;var i=this.findField(f);if(i){b.append('<span class="FieldPlaceholder">');this._renderItem(b,i,j,d,d,d,d,d,true);b.append("</span>")}else b.appendFormat("[{0}]",f);c=h.exec(a)}var g=a.length-1;e<g&&b.append(a.substring(e,g));return b.toString().replace(/ (id|for)=\".+?\"/g,"")},_get_selectedTab:function(){return this._tabs.length>0?this._tabs[this.get_categoryTabIndex()]:null},_renderFormView:function(b){var y="</td></tr></table>",x="display:none",r="none",q="block",w="</td></tr>",k=false,g=true,v="</tr></table></td></tr>",a=this,E=a.get_isEditing();a._renderStatusBar(b);a._renderViewDescription(b);Web.DataViewResources.Form.ShowActionBar&&a._renderActionBar(b);var d=a.get_currentRow();a._mergeRowUpdates(d);a._updateVisibility(d);if(a.get_isInserting()&&a._expressions)for(i=0;i<a._expressions.length;i++){var h=a._expressions[i];if(h.Scope==Web.DynamicExpressionScope.DefaultValues&&h.Type==Web.DynamicExpressionType.ClientScript){f=a.findField(h.Target);if(f)if(String.isNullOrEmpty(h.Test))d[f.Index]=h.Result;else{var B=eval(h.Test);if(B)d[f.Index]=String.isNullOrEmpty(h.Result)?B:h.Result}}}var D=0;for(i=0;i<a._allFields.length;i++)if(!a._allFields[i].Hidden)D++;var u=d!=null;u&&a._renderActionButtons(b,"Top","Form");var o=a._get_selectedTab();if(a._tabs.length>0){b.appendFormat('<tr class="TabsRow"><td colspan="{0}" class="TabsBar{1}">',a._get_colSpan(),!u?" WithMargin":"");b.append('<table cellpadding="0" cellspacing="0" class="Tabs"><tr>');for(i=0;i<a._tabs.length;i++)b.appendFormat('<td id="{2}_Tab{3}" class="Tab{1}" onmouseover="$hoverTab(this,true)" onmouseout="$hoverTab(this,false)"><span class="Outer"><span class="Inner"><span class="Tab"><a href="javascript:" onclick="$find(&quot;{2}&quot;).set_categoryTabIndex({3});return false;" onfocus="$hoverTab(this,true)" onblur="$hoverTab(this,false)" tabindex="{4}">{0}</a></span></span></span></td>',Web.DataView.htmlEncode(a._tabs[i]),i==a.get_categoryTabIndex()?" Selected":"",a.get_id(),i,$nextTabIndex());b.append(v)}if(!d)a._renderNoRecordsWhenNeeded(b);else{var C=a._get_template();if(C){b.appendFormat('<tr class="CategoryRow"><td valign="top" class="Fields" colspan="{0}">',a._get_colSpan());a._renderTemplate(C,b,d,g,k);b.append(w)}else{var n=a.get_categories(),l=a.get_fields(),s=a._numberOfColumns;if(s>0){b.appendFormat('<tr class="Categories"><td class="Categories" colspan="{0}"><table class="Categories"><tr class="CategoryRow">',a._get_colSpan());for(var p=0;p<s;p++){p>0&&b.append('<td class="CategorySeparator">&nbsp;</td>');b.appendFormat('<td class="CategoryColumn" valign="top" style="width:{0}%">',100/s);for(i=0;i<n.length;i++){var c=n[i];if(c.ColumnIndex==p||a._ignoreColumnIndex){if(a.get_isModal())c.Collapsed=k;b.appendFormat('<div id="{0}_Category{1}" class="Category {3}" style="display:{2}">',a.get_id(),i,!o||o==c.Tab?q:r,c.Id);var m=a._processTemplatedText(d,c.Description),t=a._formatViewText(Web.DataViewResources.Views.DefaultCategoryDescriptions[m],g,m);b.appendFormat('<table class="Category {8}" cellpadding="0" cellspacing="0"><tr><td class="HeaderText"><span class="Text">{0}</span><a href="javascript:" class="MinMax{6}" onclick="$find(\'{2}\')._toggleCategoryVisibility({3});return false;" id="{2}$CategoryButton${3}" style="{5}"><span title="{4}"></span></a><div style="clear:both;height:1px;margin-top:-1px;"></div></td></tr><tr><td class="Description" id="{2}$CategoryDescription${3}" style="display:{7}">{1}</td></tr></table>',c.HeaderText,t,a.get_id(),i,c.Collapsed?Web.DataViewResources.Form.Maximize:Web.DataViewResources.Form.Minimize,n.length>1&&!a.get_isModal()?"":x,c.Collapsed?" Maximize":"",String.isNullOrEmpty(t)?r:q,c.Id);var z=g;for(j=0;j<l.length;j++){var e=l[j];if(!e.Hidden&&e.CategoryIndex==c.Index){z=k;break}}if(!z){b.appendFormat('<table class="Fields" id="{0}$Category${1}" style="{2}"><tr class="FieldsRow"><td class="Fields" valign="top" width="100%">',a.get_id(),i,c.Collapsed?x:"");if(!String.isNullOrEmpty(c.Template))a._renderTemplate(c.Template,b,d,g,k);else for(j=0;j<l.length;j++){e=l[j];if(!e.Hidden&&e.CategoryIndex==c.Index){var A=e.Name.match(/^(_[A-Za-z_]+)\d/);b.appendFormat('<table cellpadding="0" cellspacing="0" class="FieldWrapper {0}"><tr class="FieldWrapper"><td class="Header" valign="top">',A?A[1]:e.Name);a._renderItem(b,e,d,g,k,k,g);b.appendFormat('</td><td class="Item{0}" valign="top">',E&&!e.isReadOnly()?"":" ReadOnly");a._renderItem(b,e,d,g);b.append(y)}}b.append(y)}b.append("</div>")}}b.append("</td>")}b.append(v)}else for(i=0;i<n.length;i++){c=n[i];m=a._processTemplatedText(d,c.Description);b.appendFormat('<tr class="CategoryRow {5}" id="{2}_Category{3}" style="display:{4}"><td valign="top" class="Category {5}"><table class="Category {5}" cellpadding="0" cellspacing="0"><tr><td class="HeaderText">{0}</td></tr><tr><td class="Description" id="{2}$CategoryDescription${3}">{1}</td></tr></table></td><td valign="top" class="Fields {5}">',c.HeaderText,a._formatViewText(Web.DataViewResources.Views.DefaultCategoryDescriptions[m],g,m),a.get_id(),i,!o||o==c.Tab?q:r,c.Id);if(!String.isNullOrEmpty(c.Template))a._renderTemplate(c.Template,b,d,g,k);else for(j=0;j<l.length;j++){e=l[j];!e.Hidden&&e.CategoryIndex==c.Index&&a._renderItem(b,e,d,g)}b.append(w)}}}d&&a._renderActionButtons(b,"Bottom","Form")},_updateTabbedCategoryVisibility:function(){var d="Selected",a=this;if(a._tabs&&a._tabs.length>0){for(var e=a._tabs[a.get_categoryTabIndex()],b=0;b<a._tabs.length;b++){var c=a._get("_Tab",b);if(c)if(b==a.get_categoryTabIndex())$(c).addClass(d);else $(c).removeClass(d)}for(b=0;b<a._categories.length;b++){var f=a._categories[b];c=a._get("_Category",b);c&&Sys.UI.DomElement.setVisible(c,f.Tab==e)}a._updateVisibility()}a._adjustModalHeight()},_renderItem:function(b,a,m,y,fb,gb,I,eb,D){var ab=' title="{0}"',Z=' size="{0}"',Y=' style="display:block;width:90%;"',X=' placeholder="{0}"',G='<input type="hidden" id="{0}_Item{1}" value="{2}"/>',W="</table>",V='<td class="Button">&nbsp;</td><td class="Option"></td>',U='<table cellpadding="0" cellspacing="0" class="RadioButtonList" title="{0}">',x=true,T='<div class="Header">&nbsp;</div>',g="",F=" checked",E="true",f=null,d=this,j=Web.DataViewResources.Data,i=d.get_isForm()||fb,c=m[a.Index];if(c!=f)c=c.toString();var n=f,v=a.ItemsStyle=="CheckBoxList",q=d.get_isEditing(),z=a.Index!=a.AliasIndex;if(q&&a.ItemsStyle=="CheckBox"&&a.Items.length==2){var N=a.Items[0][0],C=a.Items[1][0];if(N==E){N="false";C=E}if(c==f)c=a.Items[0][0];n=String.format('<input type="checkbox" id="{0}_Item{1}"{2} tabindex="{3}" value="{4}" onclick="this.value=this.checked?\'{6}\':\'{5}\';$find(&quot;{0}&quot;)._valueChanged({1});" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{7}"/>',d.get_id(),a.Index,C&&(c==E||c==C)?F:g,$nextTabIndex(),c,N,C,a.ToolTip)}var B=a.isReadOnly();if(i){var hb=String.format('<div class="Error" id="{0}_Item{1}_Error" style="display:none"></div>',d.get_id(),a.Index);!I&&b.appendFormat('<div class="Item {2}" id="{0}_ItemContainer{1}">',d.get_id(),a.Index,a.Name);var J=d._allFields[a.AliasIndex].HeaderText;if(n&&I&&!(q&&B)){b.append(T);return}if(J.length>0)if(D&&n&&d._numberOfColumns>0)b.append(T);else b.appendFormat('<div class="Header {5}">{3}<label for="{0}_Item{1}">{2}{4}</label></div>',d.get_id(),a.Index,J,d._numberOfColumns>0||D?g:n,q&&!a.AllowNulls&&!n&&!B&&Web.DataViewResources.Form.RequiredFieldMarker?Web.DataViewResources.Form.RequiredFieldMarker:g,a.Name);if(I)return;(n==f||d._numberOfColumns>0)&&b.append('<div class="Value">')}var S=!q&&!String.isNullOrEmpty(a.ItemsDataController)&&!v&&!gb&&c&&d._disableObjectRef!=x&&!a.tagged("lookup-details-hidden");S&&!i&&b.append('<table width="100%" cellpadding="0" cellspacing="0" class="ObjectRef"><tr><td>');if(q&&y&&!B){var Q=a;a._LEV!=f&&b.append('<table cellpadding="0" cellspacing="0"><tr><td>');!i&&n&&b.append(n);var R=!String.isNullOrEmpty(a.ItemsStyle),L=a.ItemsStyle=="Lookup",P=!String.isNullOrEmpty(a.ContextFields),u=a.ItemsStyle=="AutoComplete",h=a.DynamicItems?a.DynamicItems:a.Items;if(R&&!L&&!u&&(h.length==0&&!v)&&P){h=[];(a.AllowNulls||P)&&Array.add(h,[g,j.NullValueInForms]);c!=f&&Array.add(h,[c,m[a.AliasIndex]])}else if(a.DynamicItems&&!v){for(var K=false,o=0;o<h.length;o++)if(h[o][0]==c){K=x;break}if(!K)c=f;(a.AllowNulls||!K)&&!String.isNullOrEmpty(h[0][0])&&Array.insert(h,0,[g,j.NullValueInForms])}if(n!=f){if(d._numberOfColumns>0||D){b.append(n);b.appendFormat('<label for="{0}_Item{1}" title="{3}">{2}</label>',d.get_id(),a.Index,J,a.ToolTip)}}else if(h.length>0||v||R&&!L&&!u)if(a.ItemsStyle=="RadioButtonList"){b.appendFormat(U,a.ToolTip);for(var p=a.Columns==0?1:a.Columns,A=Math.floor(h.length/p)+(h.length%p>0?1:0),t=0;t<A;t++){b.append("<tr>");for(var s=0;s<p;s++){var r=s*A+t;if(r<h.length){var k=h[r],l=k[0]==f?g:k[0].toString();if(c==f)c=g;b.appendFormat('<td class="Button"><input type="radio" id="{0}_Item{1}_{2}" name="{0}_Item{1}" value="{3}"{4} tabindex="{6}" onclick="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/></td><td class="Option"><label for="{0}_Item{1}_{2}">{5}<label></td>',d.get_id(),a.Index,r,l,l==c?F:g,d.htmlEncode(a,k[1]),$nextTabIndex())}else b.append(V)}b.append("</tr>")}b.append(W)}else if(v){var kb=c?c.split(","):[],O=!String.isNullOrEmpty(a.ContextFields)&&!a.DynamicItems;b.appendFormat('<input type="hidden" id="{0}_Item{1}" name="{0}_Item{1}" value="{2}"/>',d.get_id(),a.Index,O?c:g);if(O)b.append(Web.DataViewResources.HeaderFilter.Loading);else{b.appendFormat(U,a.ToolTip);p=a.Columns==0?1:a.Columns;A=Math.floor(h.length/p)+(h.length%p>0?1:0);for(t=0;t<A;t++){b.append("<tr>");for(s=0;s<p;s++){r=s*A+t;if(r<h.length){k=h[r];l=k[0]==f?g:k[0].toString();if(c==f)c=g;b.appendFormat('<td class="Button"><input type="checkbox" id="{0}_Item{1}_{2}" name="{0}_Item{1}" value="{3}"{4} tabindex="{6}"  onclick="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/></td><td class="Option"><label for="{0}_Item{1}_{2}">{5}<label></td>',d.get_id(),a.Index,r,l,Array.indexOf(kb,l)!=-1?F:g,d.htmlEncode(a,k[1]),$nextTabIndex())}else b.append(V)}b.append("</tr>")}b.append(W)}}else{b.appendFormat('<select id="{0}_Item{1}" size="{2}" tabindex="{3}" onchange="$find(&quot;{0}&quot;)._valueChanged({1});" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{4}">',d.get_id(),a.Index,a.ItemsStyle=="ListBox"?a.Rows==0?5:a.Rows:"1",$nextTabIndex(),a.ToolTip);if(c==f)c=g;c=c.toString();for(o=0;o<h.length;o++){k=h[o];l=k[0];var ib=l==f&&!a.AllowNulls?Web.DataViewResources.Lookup.SelectLink:k[1];if(l==f)l=g;l=l.toString();b.appendFormat('<option value="{0}"{1}>{2}</option>',l,l==c?" selected":g,d.htmlEncode(a,ib))}b.append("</select>")}else if(!String.isNullOrEmpty(a.ItemsDataController)&&L){c=m[a.AliasIndex];if(c==f)c=Web.DataViewResources.Lookup.SelectLink;var e=d._allFields[a.AliasIndex].format(c);d._renderCreateNewBegin(b,a);b.appendFormat('<table cellpadding="0" cellspacing="0" class="Lookup"><tr><td><a href="#" onclick="$find(\'{0}\').showLookup({1});return false" id="{0}_Item{1}_ShowLookupLink" title="{3}" tabindex="{5}">{2}</a><a href="#" class="Clear" onclick="$find(\'{0}\').clearLookupValue({1});return false" id="{0}_Item{1}_ClearLookupLink" title="{7}" tabindex="{6}" style="display:{8}">&nbsp;</a></td></tr></table><input type="hidden" id="{0}_Item{1}" value="{4}"/><input type="hidden" id="{0}_Item{9}" value="{2}"/>',d.get_id(),a.Index,d.htmlEncode(a,e),!String.isNullOrEmpty(a.ToolTip)?a.ToolTip:String.format(Web.DataViewResources.Lookup.SelectToolTip,a.Label),m[a.Index],$nextTabIndex(),$nextTabIndex(),String.format(Web.DataViewResources.Lookup.ClearToolTip,a.Label),m[a.Index]!=f?"display":"none",a.AliasIndex);d._renderCreateNewEnd(b,a)}else if(a.OnDemand)d._renderOnDemandItem(b,a,m,y,i);else if(a.Editor){var jb=a.Editor;b.appendFormat(G,d.get_id(),a.Index,Web.DataView.htmlAttributeEncode(c));b.appendFormat('<iframe src="{0}?id={1}_Item{2}&control={3}" frameborder="0" scrolling="no" id="{1}_Item{2}$Frame" class="FieldEditor {3}" tabindex="{4}"></iframe>',d.resolveClientUrl(d.get_appRootPath()+"ControlHost.aspx"),d.get_id(),a.Index,jb,$nextTabIndex())}else if(a.Rows>1){b.appendFormat('<textarea id="{0}_Item{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{3}" style="',d.get_id(),a.Index,$nextTabIndex(),a.ToolTip);a.TextMode==3&&!String.isNullOrEmpty(c)&&b.append("display:none;");if(!i)b.append('display:block;width:100%;"');else b.appendFormat('" cols="{0}"',a.Columns>0?a.Columns:50);b.appendFormat(' rows="{0}"',a.Rows);$appfactory.supportsPlaceholder&&!String.isNullOrEmpty(a.Watermark)&&b.appendFormat(X,Web.DataView.htmlAttributeEncode(a.Watermark));b.append(">");b.append(a.HtmlEncode?d.htmlEncode(a,c):c);b.append("</textarea>");a.TextMode==3&&!String.isNullOrEmpty(c)&&b.appendFormat("<div>{2}<div><a href=\"javascript:\" onclick=\"var o=$get('{0}_Item{1}');o.style.display='block';o.focus();this.parentNode.parentNode.style.display='none';return false;\">{3}</a> | <a href=\"javascript:\" onclick=\"if(!confirm('{5}'))return;$get('{0}_Item{1}').value='';this.parentNode.parentNode.parentNode.parentNode.style.display='none';return false;\">{4}</a></div></div>",d.get_id(),a.Index,d.htmlEncode(a,c).replace(/((\r\n*)|\n)/g,"<br/>"),j.NoteEditLabel,j.NoteDeleteLabel,j.NoteDeleteConfirm)}else{p=a.Columns>0?a.Columns:50;var db=a.ToolTip;if(u&&(!z||q)){c=m[a.Index];b.appendFormat(G,d.get_id(),a.Index,Web.DataView.htmlAttributeEncode(c));a=d._allFields[a.AliasIndex]}a.TimeFmtStr&&b.append('<table cellpadding="0" cellspacing="0" class="DateTime"><tr><td class="Date">');b.appendFormat('<input type="{3}" id="{0}_Item{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"',d.get_id(),a.Index,$nextTabIndex(),a.TextMode!=1?"text":"password");if(!i)b.append(Y);else b.appendFormat(Z,p);a.Len>0&&b.appendFormat(' maxlength="{0}"',a.Len);u&&b.appendFormat(ab,db);c=m[a.Index];if(c==f)e=u?j.NullValueInForms:g;else if(z)e=c.toString();else{if(a.DateFmtStr){if(typeof c=="string")c=Date.parseLocale(c,a.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1]);a.DataFormatString=a.DateFmtStr}e=a.format(c);if(a.DateFmtStr)a.DataFormatString=a.DataFmtStr}b.appendFormat(' value="{0}" {1}',Web.DataView.htmlAttributeEncode(e),i?' class="TextInput"':String.format('class="TextInput {0}Type"',a.Type));b.appendFormat(ab,a.ToolTip);$appfactory.supportsPlaceholder&&!String.isNullOrEmpty(a.Watermark)&&b.appendFormat(X,Web.DataView.htmlAttributeEncode(a.Watermark));b.append("/>");a.Type.startsWith("DateTime")&&i&&Web.DataViewResources.Form.ShowCalendarButton&&!a.TimeFmtStr&&b.appendFormat('<a id="{0}_Item{1}_Button" href="#" onclick="return false" class="Calendar">&nbsp;</a>',d.get_id(),a.Index);if(a.TimeFmtStr){b.appendFormat('</td><td class="Time"><input type="text" id="{0}_Item$Time{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"',d.get_id(),a.Index,$nextTabIndex());if(!i)b.append(Y);else b.appendFormat(Z,p);if(c==f)e=u?j.NullValueInForms:g;else if(z)e=c.toString();else{a.DataFormatString=a.TimeFmtStr;e=a.format(c);a.DataFormatString=a.DataFmtStr}b.appendFormat(' value="{0}" {1}/></td></table>',Web.DataView.htmlAttributeEncode(e),i?g:'class="TimeType"')}}if(a._LEV!=f){var M=d._allFields[a.AliasIndex]._LEV;if(M==f)M=g;b.appendFormat('</td><td class="UseLEV"><a href="javascript:" onclick="$find(\'{0}\')._applyLEV({1});return false" tabindex="{2}" title="{3}">&nbsp;</a></td></tr></table>',d.get_id(),a.Index,$nextTabIndex(),Web.DataView.htmlAttributeEncode(String.format(j.UseLEV,d._allFields[a.AliasIndex].format(M))))}d._lastCommandName=="BatchEdit"&&b.appendFormat('<div class="BatchSelect"><table cellpadding="0" cellspacing="0"><tr><td><input type="checkbox" id="{0}$BatchSelect{1}" onclick="Web.DataView._updateBatchSelectStatus(this,{3})"{4}/></td><td><label for="{0}$BatchSelect{1}">{2}</a></td></tr></table></div>',d.get_id(),Q.Index,j.BatchUpdate,i==x,d._batchEdit&&Array.contains(d._batchEdit,Q.Name)?' checked="checked"':g)}else if(a.OnDemand)d._renderOnDemandItem(b,a,m,y,i);else{c=d.htmlEncode(a,m[a.AliasIndex]);if(q)if(B&&y){var cb=m[a.Index];b.appendFormat(G,d.get_id(),a.Index,cb!=f?Web.DataView.htmlAttributeEncode(d._allFields[a.AliasIndex].format(cb)):g)}var H=a.DynamicItems?a.DynamicItems:a.Items;if(H.length==0){if(a.Type=="String"&&c!=f&&c.length>j.MaxReadOnlyStringLen&&!(a.TextMode==3||a.TextMode==2))c=c.substring(0,j.MaxReadOnlyStringLen)+"...";if(c&&a.TextMode==3)c=c.replace(/((\r\n*)|\n)/g,"<br/>");e=String.isBlank(c)?i?j.NullValueInForms:j.NullValue:d._allFields[a.AliasIndex].format(c)}else if(v){h=c?c.split(","):[];var bb=x;for(o=0;o<H.length;o++){k=H[o];l=k[0]==f?g:k[0].toString();if(Array.contains(h,l)){if(bb)bb=false;else b.append(", ");b.append(Web.DataView.htmlEncode(k[1]))}}e=h.length==0?j.NullValueInForms:g}else if(z&&!y)e=c;else{k=d._findItemByValue(a,!z?c:m[a.Index]);e=k[1];if(!i&&e==j.NullValueInForms)e=j.NullValue}if(!String.isNullOrEmpty(a.HyperlinkFormatString)&&c!=f){var w=d._parseLocation(a.HyperlinkFormatString,m);if(w&&w.match(/^mailto\:/))e=String.format('<a href="{0}" title="{2}">{1}</a>',w,e,a.ToolTip);else if(w.match(/^javascript\:/))e=String.format('<a href="javascript:" onclick="{0};return false;" title="{2}">{1}</a>',w.substring(11),e,a.ToolTip);else e=String.format('<a href="javascript:" onclick="$find(\'{2}\')._navigate(\'{0}\');" title="{3}">{1}</a>',w,e,d.get_id(),a.ToolTip)}if(a.TextMode==1)e="**********";if(eb==x)e=String.trimLongWords(e);if(__designer()&&e)e=e.replace(/\^\w+\^/g,g);b.append(e)}if(S){!i&&b.append('</td><td align="right">');b.appendFormat('<span class="ObjectRef" title="{0}" onclick="$find(&quot;{1}&quot;).executeCommand({{commandName: &quot;_ViewDetails&quot;, commandArgument: &quot;{2}&quot;}})">&nbsp;</span>',String.format(Web.DataViewResources.Lookup.DetailsToolTip,Web.DataView.htmlAttributeEncode(d._allFields[a.AliasIndex].HeaderText)),d.get_id(),a.Name);!i&&b.append("</td></tr></table>")}if(i){(n==f||d._numberOfColumns>0)&&b.append("</div>");b.append(hb);!String.isNullOrEmpty(a.FooterText)&&b.appendFormat('<div class="Footer">{0}</div>',a.FooterText);b.append("</div>")}},_renderOnDemandItem:function(c,b,l,e,j){var h=null,g=this,a=Web.DataViewResources.Data,d=l[b.Index],k=d!=h?d.toString().match(/^null\|(.+)$/):h,f=k!=h||d==h;if(k)d=k[1];if(f&&!e&&b.OnDemandStyle==1)c.append(j?a.NullValueInForms:a.NullValue);else{var i=g.resolveClientUrl(g.get_appRootPath()+a.BlobHandler);e&&!f&&c.appendFormat('<a href="{0}?{1}=o|{2}" title="{3}" onclick="$find(&quot;{4}&quot;)._showDownloadProgress();open(this.href, &quot;_blank&quot;,&quot;height={5},width={6},resizable=yes&quot;);return false">',i,b.OnDemandHandler,d,a.BlobDownloadHint,g.get_id(),$(window).height()/2,$(window).width()/2);if(b.OnDemandStyle==1)if(f)c.append(j?a.NullValueInForms:a.NullValue);else c.append(e?a.BlobDownloadLink:a.BlobDownloadLinkReadOnly);else if(!f)c.appendFormat('<img src="{0}?{1}=t|{2}" class="Thumbnail"/>',i,b.OnDemandHandler,d);else c.append(j?a.NullValueInForms:a.NullValue);e&&!f&&c.append("</a>");!b.ReadOnly&&(g.get_isEditing()&&e)&&c.appendFormat('<iframe src="{0}?{1}=u|{2}&owner={3}&index={4}" frameborder="0" scrolling="no" id="{3}_Frame{4}" tabindex="{6}"></iframe><div style="display:none" id="{3}_ProgressBar{4}" class="UploadProgressBar">{5}</div>',i,b.OnDemandHandler,d,g.get_id(),b.Index,"Uploading...",$nextTabIndex())}},_showUploadProgress:function(k,e){var c=this,f=$get(String.format("{0}_Frame{1}",c.get_id(),k)),a=$get(String.format("{0}_ProgressBar{1}",c.get_id(),k));if(f!=null&&a!=null){var g=$(e).find("input:file"),d=g.val().split(/(\\|\/)/);d=d.length>0?d[d.length-1]:null;var l=c.get_isInserting(),h=$(a).show().text(d).focus(),i=$common.getPaddingBox(a),j=$common.getBorderBox(a);a.style.width=f.offsetWidth-i.horizontal-j.horizontal+"px";a.style.height=f.offsetHeight-i.vertical-j.vertical+"px";var m=$(f).hide();if(!l){c._showDownloadProgress();e.submit()}else{var b=c._pendingUploads;if(!b)b=c._pendingUploads=[];b.push({form:e,progress:a});h.find("a").button("destroy");h.addClass("dataview-insert").append($(String.format("<a>{0}</a>",Web.DataViewResources.Data.Filters.Labels.Clear)).button({icons:{primary:"ui-icon-close"},text:false}).click(function(){h.hide();m.show();for(var a=0;a<b.length;a++)if(b[a].form==e){Array.removeAt(b,a);break}g.replaceWith(g.clone(true))}))}}},_internalRenderActionButtons:function(g,h,f,c){var a=this;if(!c)c=a._actionButtonsInScope(f);a._clonedRow=a._cloneChangedRow();for(var d=0;d<c.length;d++){action=c[d];if(a._isActionAvailable(action)){var b=!String.isNullOrEmpty(action.CssClass)?action.CssClass:"";if(action.HeaderText&&action.HeaderText.length>10){if(b.length>0)b+=" ";b+="AutoWidth"}var e=action.CommandName=="None";g.appendFormat('<button onclick="{6}$find(\'{0}\').executeAction(\'{5}\', {1},-1);return false" tabindex="{3}" class="{8}{4}"{7}>{2}</button>',a.get_id(),d,action.HeaderText,$nextTabIndex(),b,f,e?"return false;":"",e?' disabled="disabled"':"",action.CssClassEx)}if(action._whenClientScript!=null)a._dynamicActionButtons=true}a._clonedRow=null},_actionButtonsInScope:function(c){var a=this.get_actions(c);if(a.length==0)return;if(c=="Row"){for(var d=false,b=0;b<a.length;b++)if(this._isActionAvailable(a[b])){d=true;break}if(!d)return null}return a},_renderActionButtons:function(c,h,e){var i=" Hidden",l=" Disabled",b="",a=this;if(a.get_showActionButtons().indexOf(h)==-1)return;var m=a._actionButtonsInScope(e);if(!m)return;var n=a._get_colSpan(),k=b;if(e=="Row"&&a._actionColumn){n--;k='<td class="ActionColumn">&nbsp;</td>'}c.appendFormat('<tr class="ActionButtonsRow {0}ButtonsRow {2}Scope">{3}<td colspan="{1}" class="ActionButtons {2}ActionButtons">',h,n,e,k);c.append('<table style="width:100%" cellpadding="0" cellspacing="0" class="ActionButtons"><tr>');var j=String.format(' id="{0}$ActionButtons${1}"',a.get_id(),h);if(e=="Form"){var d=a._position,q=d&&d.count>1&&!a.get_isInserting(),o=d&&d.index>0,p=d&&d.index<d.count-1,g=a._get_specialAction("Print"),f=a.get_isModal()?a._get_specialAction("Annotate"):null;c.appendFormat('<td class="Left"><table class="FormNav"><tr><td class="Previous{5}{7}"><a href="javascript:" onclick="$find(\'{2}\')._advance(-1);return false;" title="{3}"><span></span></a></td><td class="Next{6}{7}"><a href="javascript:" onclick="$find(\'{2}\')._advance(1);return false;" title="{4}"><span></span></a></td><td class="Print{9}"><a href="javascript:" onclick="{10};return false;" title="{8}"><span></span></a></td><td class="Annotate{12}"><a href="javascript:" onclick="{13};return false;" title="{11}"><span></span></a></td><td class="Instruction" id="{0}_Wait" align="left">{1}</td></tr></table></td><td class="Right" align="right"{14}>&nbsp;',h=="Bottom"?a.get_id():b,a.get_isEditing()&&Web.DataViewResources.Form.RequiredFieldMarker?Web.DataViewResources.Form.RequiredFiledMarkerFootnote:b,a.get_id(),Web.DataViewResources.Pager.Previous,Web.DataViewResources.Pager.Next,o?b:l,p?b:l,q?b:i,g?g.text:b,g?b:i,g?g.script:null,f?f.text:b,f?b:i,f?f.script:null,j)}else c.appendFormat("<td{0}>",j);a._internalRenderActionButtons(c,h,e,m);a._lastActionButtonsScope=e;c.append("</td></tr></table>");c.append("</td></tr>")},_isActionMatched:function(a){var b=null;if(!a._csInitialized){if(!String.isNullOrEmpty(a.WhenClientScript))a._whenClientScript=this._prepareJavaScriptExpressionEx(a.WhenClientScript);a._csInitialized=true}var c=(a.WhenViewRegex==b||a.WhenViewRegex.exec(this.get_viewId())!=b==a.WhenViewRegexResult)&&(a.WhenTagRegex==b||a.WhenTagRegex.exec(this.get_tag())!=b==a.WhenTagRegexResult)&&(a.WhenHRefRegex==b||a.WhenHRefRegex.exec(location.pathname)!=b==a.WhenHRefRegexResult)&&(a._whenClientScript==b||eval(a._whenClientScript)==true);return c},_isActionAvailable:function(b,d){var h="Duplicate",g="DataSheet",a=this,c=b.WhenLastCommandName?b.WhenLastCommandName:"";if(c=="Any")c=a.get_lastCommandName();var f=b.WhenLastCommandArgument?b.WhenLastCommandArgument:"",j=c.length==0||c==a.get_lastCommandName()&&(f.length==0||f==a.get_lastCommandArgument());if(j){var e=a.get_isEditing();if(b.CommandName==g)return!e&&a.get_isGrid()&&a.get_viewType()!=g&&a._isActionMatched(b);else if(b.CommandName=="Grid")return!e&&a.get_isGrid()&&a.get_viewType()!="Grid"&&a._isActionMatched(b);else if(e){var i=a._rowIsSelected(d==null?a._selectedRowIndex:d);return i?(c=="New"||c=="Edit"||c=="BatchEdit"||c==h)&&a._isActionMatched(b):!i&&d==null&&(c=="New"||c==h)?a._isActionMatched(b):c.length==0&&d!=null&&a._isActionMatched(b)}}return j&&(!b.WhenKeySelected||b.WhenKeySelected&&a._selectedKey&&a._selectedKey.length>0)&&a._isActionMatched(b)&&(b.CommandName!="New"||a._hasKey())},_hasKey:function(){return this._keyFields&&this._keyFields.length>0},_rowIsSelected:function(b){var a=this;if(!a._hasKey())return a.get_isModal()&&a.get_isForm();var c=a._rows[b];return a.rowIsSelected(c)},rowIsSelected:function(e){var c=this._keyFields,f=this._selectedKey;if(e&&c.length==f.length&&c.length){if(e==this._mergedRow)return true;for(var d=0;d<c.length;d++){var g=c[d],a=f[d],b=e[g.Index];if(g.Type.startsWith("DateTime")){if(!(a||b))return false;a=a.toString();b=b.toString()}if(a!=b&&!(b==null&&String.isNullOrEmpty(a)))return false}return true}else return false},_get_template:function(a){return this.get_isDataSheet()?null:$get(this.get_controller()+"_"+this.get_viewId()+(a?"_"+a:""))},_renderTemplate:function(g,c,j,l,k){var b=this,d=typeof g=="string"?g:g.innerHTML,i=/([\s\S]*?)\{([\w\d]+)(\:([\S\s]+?)){0,1}\}/g,e=0,a=i.exec(d);while(a){e=a.index+a[0].length;c.append(a[1]);var h=b.findField(a[2]);if(h)if(a[4]&&a[4].length>0)c.appendFormat("{0:"+a[4]+"}",j[h.Index]);else b._renderItem(c,h,j,l,k,null,null,null,true);else{var f=Web.DataView.find(a[2]);if(f){if(!b._embeddedViews)b._embeddedViews=[];Array.add(b._embeddedViews,{view:f});c.appendFormat('<div id="v_{0}" class="EmbeddedViewPlaceholder"></div>',f.get_cookie().replace(/-/g,""))}}a=i.exec(d)}e<d.length&&c.append(d.substring(e))},_renderNewRow:function(b){var a=this;if(a.get_isInserting()){var e=a.get_isDataSheet(),m=a._actionColumn&&!e,f=a._get_focusedCell();if(!f)f={colIndex:0};var i=e?null:a._gridTemplates.New;b.appendFormat('<tr class="Row Selected{0}{1}">',i?" InlineFormRow":"",e?" Inserting":"");var h=a.multiSelect();h&&b.append('<td class="Cell Toggle First">&nbsp;</td>');var k=a.get_showIcons();k&&b.appendFormat('<td class="Cell Icons{0}"><span>&nbsp;</span></td>',!h?" First":"");a.get_isDataSheet()&&b.appendFormat('<td class="Cell Gap"><div class="Icon"></div></td>',!h&&!k?" First":"");m&&b.append('<td class="Cell ActionColumn">&nbsp;</td>');var g=a._newRow?a._newRow:[];a._mergeRowUpdates(g);a._updateVisibility(g);if(i){b.appendFormat('<td class="Cell" colspan="{0}">',a.get_fields().length);a._renderTemplate(i,b,g,true,true);b.append("</td>")}else for(var d=0;d<a._fields.length;d++){var c=a._fields[d],l=a._allFields[c.AliasIndex],j="";if(e){a._editing=f&&f.colIndex==c.ColIndex;if(!a._editing)j=String.format(" onclick=\"$find('{0}')._dataSheetCellFocus(event,-1,{1})\"",a.get_id(),d)}b.appendFormat('<td class="Cell {0} {1}Type{2}{3}"{4}>',l.Name,l.Type,d==0?" FirstColumn":"",d==a._fields.length-1?" LastColumn":"",j);!c.ReadOnly&&b.appendFormat('<div class="Error" id="{0}_Item{1}_Error" style="display:none"></div>',a.get_id(),c.Index);a._renderItem(b,c,g,!c.OnDemand,null);a._editing=null;b.append("</td>")}b.append("</tr>");!e&&a._renderActionButtons(b,"Bottom","Row")}},_iconClicked:function(c){var b="Attachment",a=this;if(!a.get_isDataSheet()&&a.get_lookupField()==null)if(a._icons&&a._icons[c]==b){a._lastClickedIcon=b;a.set_autoSelectFirstRow(true);a._autoSelect(c)}},_renderRows:function(b,S,o){var Q=" Editing",P="Alternating",O=" Selected",N=" LastColumn",M=" FirstColumn",C="String",e="",x=" First",u=false,r=true,g=null,a=this,m=a.get_lookupField()!=g,n=a.get_isDataSheet(),B=!m&&a._actionColumn&&!n,U=B?a.get_actionGroups("ActionColumn",r):g,X=a._enumerateExpressions(Web.DynamicExpressionType.Any,Web.DynamicExpressionScope.ViewRowStyle,a.get_viewId());b.append('<tr class="HeaderRow">');var y=a.get_showIcons();if(o){b.appendFormat('<th class="Toggle First"><input type="checkbox" onclick="$find(&quot;{0}&quot;).toggleSelectedRow()" id="{0}_ToggleButton"/></th>',a.get_id());a._multipleSelection=u}y&&b.appendFormat('<th class="Icons{0}">&nbsp;</th>',!o?x:e);n&&b.appendFormat('<th class="Gap{0}">&nbsp;</th>',!o&&!y?x:e);B&&b.appendFormat('<th class="FieldHeaderSelector ActionColumn"><span>{0}</span></th>',a._actionColumn);for(var L=a.get_sortExpression(),w=L?L.match(/^\s*(\w+)((\s+(asc|desc))|(\s*(,|$)))/i):g,c=0;c<a._fields.length;c++){var d=a._fields[c],p=d.Name;d=a._allFields[d.AliasIndex];if(d.Name==p)p=e;b.appendFormat('<th class="FieldHeaderSelector {4} {0} {1}Type{2}{3}"',d.Name,d.Items.length>0?C:d.Type,c==0?M:e,c==a._fields.length-1?N:e,p);(d.AllowSorting||d.AllowQBE)&&b.appendFormat(' onmouseover="$showHover(this,\'{0}$FieldHeaderSelector${1}\',\'FieldHeaderSelector\')" onmouseout="$hideHover(this)" onclick="$toggleHover()"',a.get_id(),c);b.append(">");if(d.AllowSorting){b.appendFormat('<a href="#" onclick="$find(\'{0}\').sort(\'{1}\');$preventToggleHover();return false" title="{3}" onfocus="$showHover(this,\'{0}$FieldHeaderSelector${4}\',\'FieldHeaderSelector\',1)" onblur="$hideHover(this)" tabindex="{5}">{2}</a>',a.get_id(),d.Name,d.HeaderText,String.format(Web.DataViewResources.HeaderFilter.SortBy,d.HeaderText),c,$nextTabIndex());w&&w[1]==d.Name&&b.append(String.format('<span class="{0}">&nbsp;</span>',w[4]?w[4].toLowerCase()=="asc"?"SortUp":"SortDown":"SortUp"));a.filterOf(d)!=g&&b.append('<span class="Filter">&nbsp;</span>')}else b.appendFormat("<span>{0}</span>",d.HeaderText);b.append("</th>")}b.append("</tr>");var h=a._get_focusedCell(),i=a.get_isEditing(),R=a.get_isInserting(),D=a._lastSelectedRowIndex;if(!a._gridTemplates){var k={Default:a._get_template(),Edit:a._get_template("edit"),New:a._get_template("new")};if(k.Default)k.Default=k.Default.innerHTML;k.Edit=k.Edit?k.Edit.innerHTML:k.Default;k.New=k.New?k.New.innerHTML:k.Default;a._gridTemplates=k}var E=n?g:a._gridTemplates.Edit,T=n?g:a._gridTemplates.Default,l=g;a._registerRowSelectorItems();var V="onmouseover=\"$(this).addClass('Highlight');\" onmouseout=\"$(this).removeClass('Highlight')\"",W=a.get_showRowNumber(),K=u;for(c=0;c<a.get_rows().length;c++){var s=a.get_rows()[c],G=" "+a._evaluateJavaScriptExpressions(X,s,r),f=a._rowIsSelected(c);if(f)K=r;if(f)a._selectedRowIndex=c;var v=g,F=e;if(o){var A=Array.indexOf(a._selectedKeyList,a._createRowKey(c))!=-1;if(A)a._multipleSelection=r;v=String.format('<td class="Cell Toggle First"><input type="checkbox" id="{0}_CheckBox{1}" onclick="$find(&quot;{0}&quot;).toggleSelectedRow({1})"{2} class="MultiSelect{3}"/></td>',a.get_id(),c,A?' checked="checked"':g,A?O:e);if(A)F=" MultiSelectedRow"}var z=y?String.format('<td class="Cell Icons {0}{1}"><span onclick="$find(\'{3}\')._iconClicked({4});">{2}</span></td>',a._icons?a._icons[c]:e,!o?x:e,W?a.get_pageSize()*a.get_pageIndex()+c+1+(a._pageOffset?a._pageOffset:0):"&nbsp;",a.get_id(),c):e;if(n)z+=String.format('<td class="Cell Gap{2}" onclick="$find(\'{0}\')._dataSheetCellFocus(event,{1},-1)"><div class="Icon"></div></td>',a.get_id(),c,!o&&!y?x:e);if(B)z+=a._renderActionColumnCell(s,c,f,U);if(i&&f){a._mergeRowUpdates(s);a._updateVisibility(s)}if(f&&(i&&E||T)){b.appendFormat('<tr id="{0}_Row{1}" class="{2}Row{3} Selected{7}">{5}{6}<td class="Cell" colspan="{4}">',a.get_id(),c,c%2==0?e:P," InlineFormRow",a.get_fields().length,v,z,i?Q:e);a._renderTemplate(i&&E?E:T,b,s,r,r);b.append("</td>")}else{b.appendFormat('<tr id="{0}_Row{1}" class="{2}Row{3}{4}{7}" {6}>',a.get_id(),c,c%2==0?e:P,f?O+G:G,F,S?e:" ReadOnlyRow",n&&!m?e:V,f&&i?Q:e);v&&b.append(v);b.append(z);for(j=0;j<a._fields.length;j++){d=a._fields[j];var t=a._allFields[d.AliasIndex];p=d.Name==t.Name?e:d.Name;if(h)a._editing=i&&h.rowIndex==c&&h.colIndex==d.ColIndex;var q=j==0&&S;if(q){l=Web.HoverMonitor.Families[String.format("{0}$RowSelector${1}",a.get_id(),c)];if(!l||l.items.length==0)q=u}var H=j==0?M:e,J=String.format(" onclick=\"$find('{0}')._{3}CellFocus(event,{1},{2})\"",a.get_id(),c,j,n&&!m?"dataSheet":"gridView"),I=j==a._fields.length-1?N:e;if(q&&!m||f&&i||d.OnDemand&&f)b.appendFormat('<td class="Cell {5} {0} {1}Type{2}{4}"{3}>',t.Name,d.Items.length>0?C:t.Type,H,f&&i&&(!n||h&&h.colIndex==d.ColIndex)?e:J,I,p);else b.appendFormat('<td class="Cell {7} {2} {3}Type{4}{6}" style="cursor:default;"{5}>',a.get_id(),c,t.Name,t.Type=="Byte[]"?"Binary":d.Items.length>0?C:t.Type,H,J,I,p);f&&i&&!d.ReadOnly&&b.appendFormat('<div class="Error" id="{0}_Item{1}_Error" style="display:none"></div>',a.get_id(),d.Index);if(q){!m&&l&&l.items.length>1&&b.appendFormat('<div id="{0}_RowSelector{1}" class="RowSelector" onmouseover="$showHover(this, \'{0}$RowSelector${1}\', \'RowSelector\')" onmouseout="$hideHover(this)" onclick="$toggleHover()">',a.get_id(),c);if(!(f&&i)){var Y=m||!l||l.items.length==1?e:String.format(" onfocus=\"$showHover(this, '{0}$RowSelector${1}', 'RowSelector', 1)\" onblur=\"$hideHover(this)\" ",a.get_id(),c);if(!m)b.appendFormat('<a href="#" onclick="$hoverOver(this, 2);$find(\'{0}\').executeAction(\'Grid\',-1,{1});$preventToggleHover();return false" tabindex="{2}"{3}>',a.get_id(),c,$nextTabIndex(),Y);else b.appendFormat('<a href="javascript:" onclick="return false" tabindex="{0}">',$nextTabIndex())}}a._renderItem(b,d,s,f,g,q);if(q&&!i){!(f&&i)&&b.append("</a>");!m&&l&&l.items.length>1&&b.append("</div>")}b.append("</td>");if(h)a._editing=g}}b.append("</tr>");f&&h==g&&a._renderActionButtons(b,"Bottom","Row");if(R&&D==c){D=-2;a._renderNewRow(b)}if(a._syncFocusedCell&&h&&f)h.rowIndex=c}R&&D!=-2&&a._renderNewRow(b);if(a._saveAndNew){a._saveAndNew=u;if(a._syncFocusedCell)a.newDataSheetRow();else{h=a._get_focusedCell();if(h){h.colIndex=0;a._moveFocusToNextRow(h,a.get_pageSize())}}}a._syncFocusedCell=u;if(!K)a._selectedRowIndex=g},_renderActionColumnCell:function(n,l,g,h){var a=this;a._clonedRow=n;if(!g){var k=a.get_lastCommandName(),j=a.get_lastCommandArgument();a.set_lastCommandName("Select");a.set_lastCommandArgument(null)}var b=new Sys.StringBuilder;b.append('<td class="Cell ActionColumn">');for(var f=true,d=0;d<h.length;d++)for(var i=h[d],e=0;e<i.Actions.length;e++){var c=i.Actions[e];if(a._isActionAvailable(c)){if(f)f=false;else b.append('<span class="Divider">&nbsp;</span>');b.appendFormat('<a href="javascript:" onclick="var dv=$find(\'{0}\');dv.executeAction(\'ActionColumn\',{2},{4},{3});return false;" class="{6}"><span class="Outer"><span class="Inner"><span class="Self" title="{5}">{1}</span></span></span></a>',a.get_id(),Web.DataView.htmlEncode(c.HeaderText),e,d,l,Web.DataView.htmlEncode(c.Description),c.CssClass)}}f&&b.append("&nbsp;");b.append("</td>");var m=b.toString();b.clear();a._clonedRow=null;if(!g){a.set_lastCommandName(k);a.set_lastCommandArgument(j)}return m},extension:function(){var c=null,b=this,a=c,f=Web.DataView.Extensions;if(f){var e=b.get_viewType(),d=b._extensions;if(d==c)d=b._extensions={};a=d[e];if(a==c){var g=f?f[e]:c;a=b._extensions[e]=g?new g(b):0;a&&a.initialize()}}return a},_renderGridView:function(b){var a=this;a._renderViewDescription(b);a._renderActionBar(b);a._renderSearchBar(b);var i=a.get_showPager(),c=a.extension();a._renderPager(b,"Top");if(a.get_isChart()){a._renderInfoBar(b);a._sortingDisabled=false;for(var g=false,d=0;d<a._fields.length;d++){var h=a._fields[d];if(h.Aggregate!=0)a._sortingDisabled=true;else if(!g){g=true;a.set_sortExpression(null);a.set_sortExpression(h.Name)}}!c&&b.appendFormat('<tr class="ChartRow"><td colspan="{1}" class="ChartCell"><img id="{0}$Chart" class="Chart" onload="if(this.readyState==\'complete\'){{this.style.height=\'\';_body_performResize()}}"/></td></tr>',a.get_id(),a._get_colSpan())}else{var f=a._hasKey(),e=a.multiSelect()&&f;if(!a.get_searchOnStart()){a._renderInfoBar(b);!c&&a._renderRows(b,f,e)}if(!c){a._renderAggregates(b,e);a._renderNoRecordsWhenNeeded(b)}}!c&&a._renderPager(b,"Bottom")},_renderAggregates:function(a,j){var e='<td class="Aggregate">&nbsp;</td>',b=this,g=b.get_aggregates();if(b._totalRowCount==0||g==null)return;a.append('<tr class="AggregateRow">');j&&a.append(e);b.get_showIcons()&&a.append(e);b.get_isDataSheet()&&a.append(e);b._actionColumn&&a.append(e);for(var h=0;h<b.get_fields().length;h++){var c=b.get_fields()[h];if(c.Aggregate==0)a.append('<td class="None">&nbsp;</td>');else{var d=g[c.Index];if(d==null)d=Web.DataViewResources.Data.NullValue;else d=c.format(d);var f=b._allFields[c.AliasIndex];if(f.IsMirror)d=g[c.AliasIndex];var i=Web.DataViewResources.Grid.Aggregates[Web.DataViewAggregates[c.Aggregate]];a.appendFormat('<td class="Aggregate {0} {1}Type" title="',f.Name,f.Type);a.appendFormat(i.ToolTip,f.HeaderText);a.append('">');a.appendFormat(i.FmtStr,d);a.append("</td>")}}a.append("</tr>")},_renderSearchBar:function(b){var a=this;if(!a.get_showSearchBar())return;if(__tf!=4)return;a._searchBarInitialized=false;b.appendFormat('<tr class="SearchBarRow" id="{0}$SearchBar" style="{2}"><td colspan="{1}" class="SearchBarCell" id="{0}$SearchBarContent">Search bar goes here.<br/><br/><br/><br/></td></tr>',a.get_id(),a._get_colSpan(),a.get_searchBarIsVisible()?"":"display:none")},_renderNoRecordsWhenNeeded:function(c){var a=this;if(a._totalRowCount==0){var b=a.get_isDataSheet()&&a._keyFields.length>0&&a.executeActionInScope(["Row","ActionBar"],"New",null,null,true)?String.format(' <a href="javascript:" class="NewRowLink" onclick="$find(\'{0}\').newDataSheetRow();return false;" title="{2}">{1}</a>',a.get_id(),Web.DataViewResources.Grid.NewRowLink,Web.DataViewResources.Lookup.GenericNewToolTip):"";c.appendFormat('<tr class="Row NoRecords"><td colspan="{0}" class="Cell">{1}{2}</td></tr>',a._get_colSpan(),Web.DataViewResources.Data.NoRecords,b)}},_attachBehaviors:function(){var a=this;if($appfactory.mobile)return;a._detachBehaviors();a._attachFieldBehaviors();var b=a.get_quickFindElement();b&&$addHandlers(b,a._quickFindHandlers,a)},_get:function(a,b){return b==null?$get(this.get_id()+a):$get(this.get_id()+a+b)},_attachTimeOptions:function(c,g){var d=$create(Web.AutoComplete,{completionInterval:500,contextKey:"",delimiterCharacters:"",id:this.get_id()+"_AutoComplete$Time"+c.Index,minimumPrefixLength:c.AutoCompletePrefixLength,typeCssClass:"AutoComplete"},null,null,g);Sys.UI.DomElement.addCssClass(d._completionListElement,"Time");var h=Sys.CultureInfo.CurrentCulture.dateTimeFormat,a=null,e=c.DataFormatString&&c.DataFormatString.replace(/\W/g,"_")||"Default";if(c.Type=="TimeSpan"){if(!$appfactory._timeSpanOptions)$appfactory._timeSpanOptions={};a=$appfactory._timeSpanOptions[e];if(!a){a=[];var b=new Date,f=c.DataFormatString||"{0:HH:mm}";b.setHours(0,0,0,0);while(a.length<24*4){Array.add(a,String.localeFormat(f,b));b.setMinutes(b.getMinutes()+15)}$appfactory._timeSpanOptions[e]=a}}else{a=Web.DataView._timeOptions;if(!a){a=[];b=new Date;b.setHours(b.getHours(),0,0,0);while(a.length<24*2){Array.add(a,String.localeFormat("{0:"+h.ShortTimePattern+"}",b));b.setMinutes(b.getMinutes()+30)}Web.DataView._timeOptions=a}}(d._cache=[])["%"]=a;return d},_executeClientEditorFactories:function(i,b,d){var h=b==null?i.Editor:i.ClientEditor;if(!String.isNullOrEmpty(h))for(var f=h.split(Web.DataView._simpleListRegex),e=0;e<f.length;e++){var j=f[e],c=j.replace(/\W/g,"$"),a=Web.DataView.EditorFactories[c];if(a==null){try{a=eval(String.format('typeof {0}!="undefined"?new {0}():""',c))}catch(l){a=""}Web.DataView.EditorFactories[c]=a}if(b==null)return a!="";if(a!=""){if(!d&&Web.DataView._customInputElements.indexOf(b.id)<0)return;var g=this.get_viewType(),k=d?a.attach(b,g):a.detach(b,g);if(k){if(d)Array.add(Web.DataView._customInputElements,b.id);else Array.remove(Web.DataView._customInputElements,b.id);return true}}}return false},_attachFieldBehaviors:function(){var j="AutoComplete",i="_AutoComplete",f=null,b=this;if(b.get_isEditing())for(var h=0;h<b.get_fields().length;h++){var a=b.get_fields()[h],c=b._get("_Item",a.Index),e=f;if(c&&!a.ReadOnly&&!b._executeClientEditorFactories(a,c,true)){if(c.tagName=="TEXTAREA"&&a.Len>0){c.setAttribute("maxlength",a.Len);$addHandler(c,"keyup",b._checkMaxLengthHandler);$addHandler(c,"blur",b._checkMaxLengthHandler)}if(!String.isNullOrEmpty(a.Mask)){var d=Sys.CultureInfo.CurrentCulture,g=d.dateTimeFormat.ShortDatePattern.toUpperCase().split(d.dateTimeFormat.DateSeparator),m=$create(AjaxControlToolkit.MaskedEditBehavior,{CultureAMPMPlaceholder:d.dateTimeFormat.AMDesignator+";"+d.dateTimeFormat.PMDesignator,CultureCurrencySymbolPlaceholder:d.numberFormat.CurrencySymbol,CultureDateFormat:g[0].substring(0,1)+g[1].substring(0,1)+g[2].substring(0,1),CultureDatePlaceholder:d.dateTimeFormat.DateSeparator,CultureDecimalPlaceholder:d.numberFormat.NumberDecimalSeparator,CultureName:d.name,CultureThousandsPlaceholder:d.numberFormat.NumberGroupSeparator,CultureTimePlaceholder:d.dateTimeFormat.TimeSeparator,DisplayMoney:a.DataFormatString=="{0:c}",Mask:a.Mask,MaskType:a.MaskType,ClearMaskOnLostFocus:a.MaskType>0,id:b.get_id()+"_MaskedEdit"+a.Index},f,f,c);a.MaskType==2&&m.set_InputDirection(1);Array.add(a.Behaviors,m)}if(a.Type.startsWith("Date")){e=$create(AjaxControlToolkit.CalendarBehavior,{id:b._get("_Calendar",a.Index)},f,f,c);e.set_format((a.DateFmtStr?a.DateFmtStr:a.DataFormatString).match(/\{0:([\s\S]*?)\}/)[1]);var l=$get(c.id+"_Button");l&&e.set_button(l);if(a.TimeFmtStr){c=b._get("_Item$Time",a.Index);if(c){Array.add(a.Behaviors,e);e=b._attachTimeOptions(a,c)}}}else if(a.Type=="TimeSpan")e=b._attachTimeOptions(a,c);else if(c.type=="text"&&a.AutoCompletePrefixLength>0)e=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("{0},{1},{2}",b.get_controller(),b.get_viewId(),a.Name),delimiterCharacters:",;",id:b.get_id()+i+a.Index,minimumPrefixLength:a.AutoCompletePrefixLength,serviceMethod:"GetCompletionList",servicePath:b.get_servicePath(),useContextKey:true,typeCssClass:j},f,f,c);else if(a.ItemsStyle==j){var k=b._allFields[a.AliasIndex];c=b._get("_Item",k.Index);if(c&&c.type=="text")e=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("Field:{0},{1}",b.get_id(),k.Name),delimiterCharacters:"",id:b.get_id()+i+a.Index,minimumPrefixLength:a.AutoCompletePrefixLength==0?1:a.AutoCompletePrefixLength,serviceMethod:"GetPage",servicePath:b.get_servicePath(),useContextKey:true,fieldName:a.Name,enableCaching:false,typeCssClass:"Lookup"},f,f,c)}e&&Array.add(a.Behaviors,e)}}},_detachBehaviors:function(){var d=null,b=this;if($appfactory.mobile)return;var f=b.get_quickFindElement();f&&$clearHandlers(f);if(b.get_fields()!=d)for(i=0;i<b.get_fields().length;i++){var a=b.get_fields()[i],c=b._get("_Item",a.Index);if(c&&b._executeClientEditorFactories(a,c,false))continue;if(a.Len>0&&a.Rows>1)if(c&&c.tagName=="TEXTAREA"&&c._events){$removeHandler(c,"keyup",b._checkMaxLengthHandler);$removeHandler(c,"blur",b._checkMaxLengthHandler)}if(a._lookupModalBehavior!=d){a._lookupModalBehavior.dispose();a._lookupModalPanel.parentNode.removeChild(a._lookupModalPanel);delete a._lookupModalPanel;a._lookupModalBehavior=d}if(a._lookupDataControllerBehavior!=d){a._lookupDataControllerBehavior.dispose();a._lookupDataControllerBehavior=d}for(var e=0;e<a.Behaviors.length;e++)a.Behaviors[e].dispose();Array.clear(a.Behaviors);if(a.Editor)Web.DataView.Editors[a.EditorId]=d}},_registerDataTypeFilterItems:function(f,h,i,e,c){for(var b=null,g=0;g<i.length;g++){var a=i[g];if(!a){if(!c.SearchOptions){b=new Web.Item(f);h.addChild(b)}}else if(!a.Hidden&&(!c.SearchOptions||Array.indexOf(c.SearchOptions,a.Function)>=0)){b=new Web.Item(f,a.Prompt?a.Text+"...":a.Text);h.addChild(b);if(a.List)this._registerDataTypeFilterItems(f,b,a.List,e,c);else if(a.Prompt)b.set_script('$find("{0}").showFieldFilter({1},"{2}","{3}")',this.get_id(),c.Index,a.Function,a.Text);else b.set_script('$find("{0}").applyFieldFilter({1},"{2}")',this.get_id(),c.Index,a.Function);if(e&&a.Function==e){var d=b;while(d){d.set_selected(true);d=d.get_parent()}}}}},_registerFieldHeaderItems:function(o,n,z,y){var i=true,m=null,c=this,A=o==m?0:o,B=o==m?c.get_fields().length-1:o,l=c.get_sortExpression();if(l)l=l.match(/^(\w+)\s+(asc|desc)/);for(var p=A;p<=B;p++){var d=m,e=[],g=n?n:String.format("{0}$FieldHeaderSelector${1}",c.get_id(),p),h=c.get_fields()[p],b=c._allFields[h.AliasIndex];if(y&&b.Aggregate!=0)continue;if(b.AllowSorting||b.AllowQBE){var s=Web.DataViewResources.HeaderFilter.GenericSortAscending,r=Web.DataViewResources.HeaderFilter.GenericSortDescending;switch(b.FilterType){case"Text":s=Web.DataViewResources.HeaderFilter.StringSortAscending;r=Web.DataViewResources.HeaderFilter.StringSortDescending;break;case"Date":s=Web.DataViewResources.HeaderFilter.DateSortAscending;r=Web.DataViewResources.HeaderFilter.DateSortDescending}var t=b.AllowSorting&&!c._sortingDisabled;if(t){var w=l&&l[1]==b.Name,a=new Web.Item(g,s);if(w&&l[2]=="asc")a.set_selected(i);else a.set_cssClass("SortAscending");a.set_script('$find("{0}").sort("{1} asc")',c.get_id(),b.Name);Array.add(e,a);a=new Web.Item(g,r);if(w&&l[2]=="desc")a.set_selected(i);else a.set_cssClass("SortDescending");a.set_script('$find("{0}").sort("{1} desc")',c.get_id(),b.Name);Array.add(e,a)}if(b.AllowQBE){d=c.filterOf(b);t&&Array.add(e,new Web.Item);a=new Web.Item(g,String.format(Web.DataViewResources.HeaderFilter.ClearFilter,b.HeaderText));a.set_cssClass("FilterOff");!d&&a.set_disabled(i);a.set_script('$find("{0}").applyFilterByIndex({1},-1)',c.get_id(),h.AliasIndex);Array.add(e,a);var q=m;if(!__designer()){var v=Web.DataViewResources.Data.Filters[b.FilterType];if(b.Items.length==0){a=new Web.Item(g,v.Text);Array.add(e,a);q=c.get_fieldFilter(b,i);c._registerDataTypeFilterItems(g,a,v.List,q,b)}if(b.FilterType!="Boolean"&&(!b.SearchOptions||Array.indexOf(b.SearchOptions,"$in")>=0)&&b.AllowMultipleValues!=false){a=new Web.Item(g,Web.DataViewResources.HeaderFilter.CustomFilterOption);if(d&&d.match(/\$(in|out)\$/))a.set_selected(i);else a.set_cssClass("CustomFilter");a.set_script('$find("{0}").showCustomFilter({1})',c.get_id(),h.AliasIndex);Array.add(e,a)}}if(h.AllowSamples!=false)if(h._listOfValues){if(d&&d.startsWith("=")){d=d.substring(1);if(d.endsWith("\0"))d=d.substring(0,d.length-1)}for(var j=0;j<h._listOfValues.length;j++){j==0&&Array.add(e,new Web.Item);var k=h._listOfValues[j],u=false,f=k;if(k==m)f=Web.DataViewResources.HeaderFilter.EmptyValue;else if(b.Items.length>0){a=c._findItemByValue(b,k);f=a[1]}else if(b.Type=="String"&&k.length==0)f=Web.DataViewResources.HeaderFilter.BlankValue;else if(!String.isNullOrEmpty(b.DataFormatString))f=b.Type.startsWith("DateTime")?String.localeFormat("{0:d}",k):b.format(k);k=c.convertFieldValueToString(b,k);u=q=="="&&d&&k==d;if(f.length>Web.DataViewResources.HeaderFilter.MaxSampleTextLen)f=f.substring(0,Web.DataViewResources.HeaderFilter.MaxSampleTextLen)+"...";if(typeof f!="string")f=f.toString();a=new Web.Item(g,f);u&&a.set_selected(i);a.set_script("$find('{0}').applyFilterByIndex({1},{2});",c.get_id(),h.AliasIndex,j);a.set_group(1);Array.add(e,a)}}else if(!b.SearchOptions||Array.indexOf(b.SearchOptions,"=")>=0){a=new Web.Item(g,Web.DataViewResources.HeaderFilter.Loading);a.set_dynamic(i);a.set_script('$find("{0}")._loadListOfValues("{1}","{2}","{3}")',c.get_id(),g,h.Name,b.Name);Array.add(e,a)}}}if(n){a=new Web.Item(n,b.HeaderText);Array.add(z,a);for(j=0;j<e.length;j++){var x=e[j];a.addChild(x)}x.get_selected()&&a.set_selected(i);d&&a.set_selected(i)}else $registerItems(g,e,Web.HoverStyle.Click,Web.PopupPosition.Right,Web.ItemDescriptionStyle.ToolTip)}},_get_specialAction:function(b){if(!this._specialActions)return null;var c=this._specialActions[b+"Text"],a=this._specialActions[b+"Script"];return String.isNullOrEmpty(a)?null:{text:c,script:a}},_registerSpecialAction:function(b,d,c,e){var a=this;if(!a._specialActions.PrintText&&b.CommandName.match(/^Report/)){if(e==null&&!a._isActionAvailable(b))return;a._specialActions.PrintText=b.HeaderText;a._specialActions.PrintScript=String.format("$find('{0}').executeAction('ActionBar',{1},-1,{2})",a.get_id(),c,d)}else if(b.CssClass=="AttachIcon"){if(e==null&&!a._isActionAvailable(b))return;a._specialActions.AnnotateText=b.HeaderText;a._specialActions.AnnotateScript=String.format("$find('{0}').executeAction('ActionBar',{1},0,{2})",a.get_id(),c,d)}},_registerActionBarItems:function(){var f=null,a=this,i=a.get_actionGroups("ActionBar"),k=a.get_isChart();if(k&&!a.get_showViewSelector()){var e=String.format("{0}${1}$ActionGroup$Chart",a.get_id(),a.get_viewId()),h=[];a._registerFieldHeaderItems(f,e,h,true);$registerItems(e,h,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Left,Web.ItemDescriptionStyle.None)}a._specialActions={PrintText:f,PrintScript:f,AnnotateText:f,AnnotateScript:f};for(var d=0;d<i.length;d++){var g=i[d];e=String.format("{0}${1}$ActionGroup${2}",a.get_id(),a.get_viewId(),d);if(!g.Flat){h=[];for(var b=0;b<g.Actions.length;b++){var c=g.Actions[b];if(a._isActionAvailable(c)){var j=new Web.Item(e,c.HeaderText,c.Description);j.set_cssClass(c.CssClassEx+(String.isNullOrEmpty(c.CssClass)?c.CommandName+"LargeIcon":c.CssClass));Array.add(h,j);j.set_script(String.format("$find('{0}').executeAction('ActionBar',{1},null,{2})",a.get_id(),b,d));a._registerSpecialAction(c,d,b,true)}}$registerItems(e,h,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Left,Web.ItemDescriptionStyle.Inline)}else{$unregisterItems(e);for(b=0;b<g.Actions.length;b++)a._registerSpecialAction(g.Actions[b],d,b)}}Array.clear(i)},_registerViewSelectorItems:function(){for(var c=[],a=this,e=a.get_id()+"$ViewSelector",f=0;f<a.get_views().length;f++){var b=a.get_views()[f];if(b.Type!="Form"&&b.ShowInSelector||b.Id==a.get_viewId()){var d=new Web.Item(e,b.Label);b.Id==this.get_viewId()&&d.set_selected(true);d.set_script(function(b){a.executeCommand({commandName:"Select",commandArgument:b.Id})});d.context(b);Array.add(c,d)}}if(a.get_isChart()){Array.add(c,new Web.Item);a._registerFieldHeaderItems(null,e,c,true)}$registerItems(e,c,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Right,Web.ItemDescriptionStyle.None)},_registerRowSelectorItems:function(){var h="{0}$RowSelector${1}",b=this,d=b.get_actions("Grid");if(d&&d.length>0)for(var a=0;a<b._rows.length;a++){for(var f=[],i=String.format(h,b.get_id(),a),e=0;e<d.length;e++){var c=d[e];if(b._isActionAvailable(c,a)){var g=new Web.Item(i,c.HeaderText,c.Description);g.set_cssClass(c.CssClassEx+(String.isNullOrEmpty(c.CssClass)?c.CommandName+"Icon":c.CssClass)+(f.length==0?" Default":""));Array.add(f,g);g.set_script(String.format('$find("{0}").executeAction("Grid", {1},{2})',b.get_id(),e,a))}}$registerItems(i,f,Web.HoverStyle.Click,Web.PopupPosition.Right,Web.ItemDescriptionStyle.ToolTip)}else for(a=0;a<b._rows.length;a++)$unregisterItems(String.format(h,b.get_id(),a))},_get_searchBarSettings:function(){var b=this;if(!b._searchBarSettings)b._searchBarSettings=[];var j=b._searchBarSettings[b.get_viewId()];if(!j){var q=[],h=[],m=b.get_filter();if(m.length>0&&!b.filterIsExternal())for(var c=0;c<m.length;c++){var o=m[c].match(Web.DataView._fieldFilterRegex),a=b.findField(o[1]);if(!a||b._fieldIsInExternalFilter(a))continue;var v=b._allFields[a.AliasIndex],f=o[2].match(Web.DataView._filterRegex);if(!o[2].startsWith("~")){a._renderedOnSearchBar=true;var w=b._findItemByValue(a,f[3]),e=f[3];if(e=="null")e="";var s=e.match(/^([\s\S]+?)\0?$/);if(s)e=s[1];var t=a.Items.length==0?f[1]:"$in",d=b._findFilterDefByFunction(Web.DataViewResources.Data.Filters[a.FilterType].List,a.FilterType=="Boolean"&&f[3].length>1?f[3]=="%js%true"?"$true":"$false":t);if(d){var k=e.match(/^(.+?)\$and\$(.+?)$/);Array.add(h,{Index:a.Index,Function:String.format("{0},{1}",d.Function,d.Prompt?"true":"false"),Value:k?k[1]:e,Value2:k?k[2]:""})}}}var i=false;for(c=0;c<b._allFields.length;c++){a=b._allFields[c];i=a.Search==Web.FieldSearchMode.Required||a.Search==Web.FieldSearchMode.Suggested;if(i)break}for(c=0;c<b._allFields.length;c++){var g=b._allFields[c];a=b._allFields[g.AliasIndex];if(a.AllowQBE&&a.Search!=Web.FieldSearchMode.Forbidden&&(!g.Hidden||a.Search!=Web.FieldSearchMode.Default)){var n=!i&&h.length<Web.DataViewResources.Grid.VisibleSearchBarFields||i&&(g.Search==Web.FieldSearchMode.Required||g.Search==Web.FieldSearchMode.Suggested);if(!a._renderedOnSearchBar){var l=a.Items.length==0||a.FilterType=="Boolean"?null:"$in";if(a.SearchOptions)l=a.SearchOptions[0];for(var r=Web.DataViewResources.Data.Filters[a.FilterType].List,p=0;p<r.length;p++){d=r[p];if(l==null||d.Function==l)break}var u={Index:a.Index,Function:String.format("{0},{1}",d.Function,d.Prompt?"true":"false")};(n||(b.findFieldUnderAlias(a)==a||a.VisibleOnSearchBar==null))&&Array.add(n?h:q,u);a.VisibleOnSearchBar=n}a._renderedOnSearchBar=false}}j={visibleFields:h,availableFields:q};b._searchBarSettings[b.get_viewId()]=j}return j},_lookupActionProcessing:function(a){if(a!=null)this._standardActionProcessing=!a;return this._standardActionProcessing!=true},search:function(){var a=this;a._lookupActionProcessing(false);var b=a._hasSearchAction&&a.executeActionInScope(["ActionBar","Form"],"Search",null,-1);a._lookupActionProcessing(true);return b},_toggleSearchBar:function(){var a=this;if(a._hasSearchShortcut&&a.search())return;a.set_searchBarIsVisible(!a.get_searchBarIsVisible());a._updateSearchBar();if(a.get_searchBarIsVisible()){a.get_lookupField()&&a._adjustLookupSize();a._focusSearchBar()}_body_performResize()},_renderSearchBarFieldNameOptions:function(e,d,b){if(d.Search==Web.FieldSearchMode.Required)return;for(var a=0;a<b.availableFields.length;a++){var c=b.availableFields[a],f=this._allFields[c.Index];e.appendFormat('<option value="{0}">{1}</option>',a,Web.DataView.htmlEncode(f.HeaderText))}},_renderSearchBarFunctionOptions:function(i,b,f,g,d){for(var c=0;c<f.length;c++){var a=f[c];if(a)if(a.List)this._renderSearchBarFunctionOptions(i,b,a.List,g);else if(d==null||a.Function==d){var j=String.format("{0},{1}",Web.DataView.htmlAttributeEncode(a.Function),a.Prompt?"true":"false"),k=j==g.Function?' selected="selected"':"",h=String.format('<option value="{0}"{1}>{2}{3}</option>',j,k,a.Prompt?"":Web.DataViewResources.Data.Filters.Labels.Equals+" ",!a.Function.match(Web.DataView._keepCapitalization)?a.Text.toLowerCase():a.Text);if(b.SearchOptions){var e=Array.indexOf(b.SearchOptions,a.Function);if(e>=0)b.SearchOptionSet[e]=h}else i.append(h)}}},_renderSearchBarField:function(c,r,e){var q="$between",p="</select></td>",b=this,i=r.visibleFields[e],a=b._allFields[i.Index],u=a.Items.length==0||a.FilterType=="Boolean"?null:"$in",k=i.Function.match(/^(.+?),(true|false)$/);c.appendFormat('<tr id="{0}$SearchBarField${1}"><td class="Control"><select id="{0}$SearchBarName${1}" tabindex="{3}" onchange="$find(\'{0}\')._searchBarNameChanged({1})"><option value="{1}" selected="selected">{2}</option>',b.get_id(),e,Web.DataView.htmlEncode(a.HeaderText),$nextTabIndex());b._renderSearchBarFieldNameOptions(c,a,r);c.append(p);c.appendFormat('<td class="Control"><select id="{0}$SearchBarFunction${1}" class="Function" tabindex="{2}" onchange="$find(\'{0}\')._searchBarFuncChanged({1})">',b.get_id(),e,$nextTabIndex());if(a.SearchOptions)a.SearchOptionSet=[];b._renderSearchBarFunctionOptions(c,a,Web.DataViewResources.Data.Filters[a.FilterType].List,i,u);if(a.SearchOptions)for(var f=0;f<a.SearchOptionSet.length;f++)c.append(a.SearchOptionSet[f]);c.append(p);var o=a.Type.startsWith("DateTime")?'<a class="Calendar" href="javascript:" onclick="return false">&nbsp;</a>':"",m=k[1]=="$in"||k[1]=="$notin",d=i.Value;if(m){var h=new Sys.StringBuilder,j=!String.isNullOrEmpty(d);h.appendFormat('<table class="FilterValues{3}" cellpadding="0" cellspacing="0" onmouseover="Web.DataView.highlightFilterValues(this,true,\'Active\')" onmouseout="Web.DataView.highlightFilterValues(this,false,\'Active\')"><tr><td class="Values" valign="top"><div><a class="Link" onclick="$find(\'{0}\')._showSearchBarFilter({1},{2});return false;" tabindex="{4}" href="javascript:" onfocus="Web.DataView.highlightFilterValues(this,true,\'Focused\')" onblur="Web.DataView.highlightFilterValues(this,false,\'Focused\')" title="{5}">',b.get_id(),a.Index,e,j?"":" Empty",$nextTabIndex(),Web.DataViewResources.Data.Filters.Labels.FilterToolTip);if(j){var s=d.split(/\$or\$/);for(f=0;f<s.length;f++){f>0&&h.append('<span class="Highlight">, </span>');var g=s[f];if(String.isJavaScriptNull(g))g=Web.DataViewResources.HeaderFilter.EmptyValue;else{g=b.convertStringToFieldValue(a,g);var t=b._findItemByValue(a,g);g=t?t[1]:a.format(g)}h.append(g)}}else h.append(Web.DataViewResources.Lookup.SelectLink);h.appendFormat('</a></div></td><td class="Button{5}" valign="top"><a href="javascript:" onclick="$find(\'{0}\')._showSearchBarFilter({1},{2});return false" title="{3}" tabindex="{4}" onfocus="Web.DataView.highlightFilterValues(this,true,\'Focused\')" onblur="Web.DataView.highlightFilterValues(this,false,\'Focused\')" >&nbsp;</a></td></tr></table>',b.get_id(),j?-1:a.Index,e,j?Web.DataViewResources.Data.Filters.Labels.Clear:Web.DataViewResources.Data.Filters.Labels.FilterToolTip,$nextTabIndex(),j?" Clear":"");o=h.toString()}else if(!String.isNullOrEmpty(d))d=d.split(/\$or\$/)[0];if(k[2]=="true"){if(typeof d=="string"&&!m)d=a.format(b.convertStringToFieldValue(a,d));c.appendFormat('<td class="Control"><input id="{0}$SearchBarValue${1}" type="{6}" class="{2} {7}" value="{3}" tabindex="{4}"/>{5}</td>',b.get_id(),e,a.FilterType,Web.DataView.htmlAttributeEncode(d=="null"?Web.DataViewResources.HeaderFilter.EmptyValue:d),$nextTabIndex(),o,m?"hidden":"text",a.AllowAutoComplete!=false?" AutoComplete":"")}else c.append("<td>&nbsp;</td>");var n=$nextTabIndex();if(k[1]==q)n=$nextTabIndex();c.appendFormat('<td class="FieldAction"><a href="javascript:" tabindex="{1}" title="{2}" class="Remove" onclick="$find(\'{0}\')._searchBarNameChanged({3}, true)"><span></span</a></td>',b.get_id(),n,Web.DataViewResources.Grid.RemoveCondition,e);c.append("</tr>");if(a.FilterType!="Text"&&k[1]==q){var l=i.Value2;if(typeof l=="string")l=a.format(b.convertStringToFieldValue(a,l));c.appendFormat('<tr><td colspan="2" class="Control AndLabel">{4}</td><td><input id="{0}$SearchBarValue2${1}" type="text" class="{2}" value="{3}" tabindex="{5}"/>{6}</td><td>&nbsp;</td></tr>',b.get_id(),e,a.FilterType,Web.DataView.htmlAttributeEncode(l),Web.DataViewResources.Data.Filters.Labels.And,n-1,o)}},_focusSearchBar:function(a){var f="Function",d=this,e=a!=null;if(!e)a=0;var c=d._get_searchBarControl(f,a);if(!c){a=0;c=d._get_searchBarControl(f,0)}var b=d._get_searchBarControl("Value",a);if(b)if(b.type=="hidden"){var g=b.parentNode.getElementsByTagName("a")[0];g.focus();e&&d._searchBarVisibleIndex==null&&String.isNullOrEmpty(b.value)&&g.click()}else Sys.UI.DomElement.setFocus(b);else c&&c.focus()},_searchBarNameChanged:function(b,g){var c=this;c._saveSearchBarSettings();var a=c._get_searchBarSettings(),e=a.visibleFields[b];if(!g){var f=c._get_searchBarControl("Name",b),d=parseInt(f.value);a.visibleFields[b]=a.availableFields[d];Array.removeAt(a.availableFields,d)}else Array.removeAt(a.visibleFields,b);Array.insert(a.availableFields,0,e);c._renderSearchBarControls(true);c._focusSearchBar(b)},_searchBarFuncChanged:function(b){var a=this;a._saveSearchBarSettings();var e=a._get_searchBarSettings(),c=e.visibleFields[b],d=a._get_searchBarControl("Function",b);c.Function=d.value;a._renderSearchBarControls(true);a._focusSearchBar(b)},_searchBarAddField:function(){var b=this;b._saveSearchBarSettings();var a=b._get_searchBarSettings();Array.add(a.visibleFields,a.availableFields[0]);Array.removeAt(a.availableFields,0);b._renderSearchBarControls(true);b._focusSearchBar(a.visibleFields.length-1)},_createSearchBarFilter:function(n){var q="DateTime",k=false,a=this;for(var s=Array.clone(a._filter),m=a._get_searchBarSettings(),h=[],g=true,b=0;b<m.visibleFields.length;b++){var l=m.visibleFields[b],c=a._allFields[l.Index];a.removeFromFilter(c);var d=l.Function.match(/^(.+?),(true|false)$/),o=[];if(d[2]=="true"){var f=a._get_searchBarControl("Value",b),e=a._get_searchBarControl("Value2",b);if(String.isBlank(f.value)&&(!e||String.isBlank(e.value))&&c.Search!=Web.FieldSearchMode.Required)continue;if(d[1]=="$in"||d[1]=="$notin"){Array.add(h,{Index:c.Index,Function:d[1],Values:[f.value]});continue}if(String.isBlank(f.value)){if(n)continue;else{alert(Web.DataViewResources.Validator.RequiredField);Sys.UI.DomElement.setFocus(f);g=k}break}var j={NewValue:f.value.trim()},i=a._validateFieldValueFormat(c,j);if(i)if(n)continue;else{alert(i);Sys.UI.DomElement.setFocus(f);g=k;break}else Array.add(o,c.Type.startsWith(q)?f.value.trim():j.NewValue);if(d[1]=="$between"){if(String.isBlank(e.value)){if(n)continue;else{alert(Web.DataViewResources.Validator.RequiredField);Sys.UI.DomElement.setFocus(e);g=k}break}j={NewValue:e.value.trim()};i=a._validateFieldValueFormat(c,j);if(i)if(n)continue;else{alert(i);Sys.UI.DomElement.setFocus(e);g=k;break}else Array.add(o,c.Type.startsWith(q)?e.value.trim():j.NewValue)}Array.add(h,{Index:c.Index,Function:d[1],Values:o})}else Array.add(h,{Index:c.Index,Function:d[1],Values:null})}if(!g)return null;for(b=0;b<m.availableFields.length;b++){l=m.availableFields[b];c=a._allFields[l.Index];a.removeFromFilter(c)}for(b=0;b<h.length;b++){var p=h[b];a.applyFieldFilter(p.Index,p.Function,p.Values,true)}var r=a._filter;a._filter=s;return r},_executeSearch:function(h){var b=this,d=b.get_action(h);if(d&&(!d.Confirmation||!d.Confirmation.match(/_controller\s*=/)))for(var f=Sys.Application.getComponents(),e=0;e<f.length;e++){var a=f[e];if(Web.DataView.isInstanceOfType(a)&&a._hasSearchAction){var c=a.get_action(a._hasSearchAction);if(c&&c.Confirmation){var g=c.Confirmation.match(/_controller\s*=\s*(\w+)/);g&&g[1]==b._controller&&a.search()}}}else{b._clearSelectedKey();b._cancelConfirmation();b.refreshAndResize()}},_performSearch:function(){var a=this;if(a._isBusy)return;a._saveSearchBarSettings();var b=a._createSearchBarFilter(false);if(b){a.set_filter(b);a.refreshData();a._setFocusOnSearchBar=true}a._forgetSelectedRow(true)},_resetSearchBar:function(){var a=this;if(a._isBusy)return;a.clearFilter();a._searchBarSettings[a.get_viewId()]=null;a._renderSearchBarControls(true);a._focusSearchBar()},_get_searchBarControl:function(b,a){return $get(String.format("{0}$SearchBar{1}${2}",this.get_id(),b,a))},_saveSearchBarSettings:function(){var a=this;for(var e=a._get_searchBarSettings(),b=0;b<e.visibleFields.length;b++){var c=e.visibleFields[b],g=a._get_searchBarControl("Function",b),d=a._get_searchBarControl("Value",b),f=a._get_searchBarControl("Value2",b);c.Function=g.value;if(d){d.value==Web.DataViewResources.HeaderFilter.EmptyValue?"null":d.value;c.Value=a._formatSearchField(d,c.Index)}if(f)c.Value2=a._formatSearchField(f,c.Index)}},_formatSearchField:function(b,e){var a=this._allFields[e];if(a.Type.startsWith("Date")){var c=Date.tryParseFuzzyDate(b.value,a.DataFormatString);if(c!=null)b.value=a.format(c)}else if(a.Type!="String"){var d=Number.tryParse(b.value,a.DataFormatString);if(d!=null)b.value=a.format(d)}return b.value},_renderSearchBarControls:function(q){var j="SearchBar",a=this;if(a._searchBarInitialized&&!q)return;var o=$get(a.get_id()+"$SearchBarContent");a._searchBarInitialized=true;var c=new Sys.StringBuilder;c.append('<table class="SearchBarFrame">');for(var e=a._get_searchBarSettings(),b=0;b<e.visibleFields.length;b++)a._renderSearchBarField(c,e,b);e.availableFields.length>0&&c.appendFormat('<tr><td colspan="3" class="AddConditionText"><a href="javascript:" onclick="$find(\'{0}\')._searchBarAddField();return false;">{3}</a></td><td class="FieldAction"><a href="javascript:" class="Add" tabindex="{1}" title="{2}" onclick="$find(\'{0}\')._searchBarAddField();return false;"><span></span></a></td>',a.get_id(),$nextTabIndex(),Web.DataViewResources.Grid.AddCondition,Web.DataViewResources.Grid.AddConditionText);c.appendFormat('<tr><td><div id="{0}$SearchBarNameStub" class="Stub"></div></td><td><div id="{0}$SearchBarFuncStub" class="Stub"></div></td><td></td></tr>',a.get_id());c.append("</table>");var p=Web.DataViewResources.Grid;c.appendFormat('<div class="SearchButtons"><button onclick="$find(\'{0}\')._performSearch();return false" tabindex="{3}" class="Search">{1}</button><br/><button onclick="$find(\'{0}\')._resetSearchBar();return false" tabindex="{4}" class="Reset">{2}</button></div>',a.get_id(),p.PerformAdvancedSearch,Web.DataViewResources.Data.Filters.Labels.Clear,$nextTabIndex(),$nextTabIndex());o.innerHTML=c.toString();c.clear();var f=$get(a.get_id()+"$SearchBarNameStub");f.style.width=f.offsetWidth+"px";f=$get(a.get_id()+"$SearchBarFuncStub");f.style.width=f.offsetWidth+"px";var l=o.getElementsByTagName("select");for(b=0;b<l.length;b++)l[b].style.width="100%";if(!a._searchBarExtenders)a._searchBarExtenders=[];for(b=0;b<e.visibleFields.length;b++){var k=e.visibleFields[b],n=a._allFields[k.Index],h=a._get_searchBarControl("Value",b);if(h)if(k.Function.match(/\$(in|notin),/)==null){var g=a._createFieldInputExtender(j,n,h,b);g&&Array.add(a._searchBarExtenders,g)}else{var d=h;while(d&&d.tagName!="TR")d=d.parentNode;for(var i=0;i<d.childNodes.length;i++)d.childNodes[i].vAlign="top"}var m=a._get_searchBarControl("Value2",b);if(m){g=a._createFieldInputExtender(j,n,m,b+"$2");g&&Array.add(a._searchBarExtenders,g)}}},_updateSearchBar:function(){var g="WithSearchBar",f="Activated",a=this,d=a._get("$SearchBar");if(!d)return;var b=a.get_searchBarIsVisible(),c=a._get("$SearchBarActivator");if(c)if(b)Sys.UI.DomElement.addCssClass(c,f);else Sys.UI.DomElement.removeCssClass(c,f);Sys.UI.DomElement.setVisible(d,b);b&&a._renderSearchBarControls(d);if(c){Sys.UI.DomElement.setVisible(a._get("$QuickFind"),!b);var h=a._get("$SearchToggle");if(a._hasSearchAction&&a._hasSearchShortcut)h.title=Web.DataViewResources.Grid.PerformAdvancedSearch;else h.title=a.get_searchBarIsVisible()?Web.DataViewResources.Grid.HideAdvancedSearch:Web.DataViewResources.Grid.ShowAdvancedSearch}var e=a._get("$InfoRow");if(e)if(b)Sys.UI.DomElement.addCssClass(e,g);else Sys.UI.DomElement.removeCssClass(e,g);if(a._setFocusOnSearchBar){a._setFocusOnSearchBar=false;a._focusSearchBar()}},_renderSearchBarActivator:function(b){var a=this;if(!a.get_showSearchBar()||!a.get_showQuickFind()&&a.get_searchOnStart())return;b.appendFormat('<td class="SearchBarActivator{1}" id="{0}$SearchBarActivator"><a href="javascript:" onclick="$find(\'{0}\')._toggleSearchBar();return false;" id="{0}$SearchToggle"><span></span></a></td>',a.get_id(),a._hasSearchAction&&a._hasSearchShortcut?" Search":"");!a.get_showQuickFind()&&b.append('<td class="Divider"><div></div></td>')},_internalRenderActionBar:function(c){var j='<td class="Divider"><div></div></td>',a=this,h=a.get_actionGroups("ActionBar");c.append('<table cellpadding="0" cellspacing="0" class="Groups"><tr>');var l=a.get_isGrid();l&&a._renderSearchBarActivator(c);if(l&&a.get_showQuickFind()){var m=a.get_quickFindText();c.appendFormat('<td class="QuickFind" title="{2}" id="{0}$QuickFind"><div class="QuickFind"><table cellpadding="0" cellspacing="0"><tr><td><input type="text" id="{0}_QuickFind" value="{1}" class="{3}" tabindex="{4}"/></td><td class="Button"><a href="#" onclick="$find(\'{0}\').quickFind();return false;"><span>&nbsp;</span></a></td></tr></table></div></td>',a.get_id(),Web.DataView.htmlAttributeEncode(m),Web.DataViewResources.Grid.QuickFindToolTip,m==Web.DataViewResources.Grid.QuickFindText?"Empty":"NonEmpty",$nextTabIndex());c.append(j);a.get_lookupField()&&!String.isNullOrEmpty(a.get_lookupField().ItemsNewDataView)&&c.appendFormat('<td class="QuickCreateNew"><a href="javascript:" onclick="$find(\'{0}\').closeLookupAndCreateNew();return false;" class="CreateNew" title="{1}" tabindex="{2}><span class="Placeholder"></span></a></td>',a.get_id(),Web.DataViewResources.Lookup.GenericNewToolTip,$nextTabIndex())}else(h.length==0||a.get_lookupField())&&c.append('<td class="Divider"><div style="visibility:hidden"></div></td>');if(!a.get_lookupField()){a._registerActionBarItems();var i=a.get_isChart()&&!a.get_showViewSelector();i&&c.appendFormat('<td class="Group Main" onmouseover="$showHover(this,&quot;{0}${1}$ActionGroup$Chart&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><a href="javascript:" onfocus="$showHover(this,&quot;{0}${1}$ActionGroup$Chart&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" tabindex="{3}" onclick="$hoverOver(this, 2);return false;">{2}</a></span></td>',a.get_id(),a.get_viewId(),Web.DataView.htmlEncode(a.get_view().Label),$nextTabIndex());for(var f=0;f<h.length;f++){(f>0||i)&&c.append(j);var e=h[f];if(e.Flat){for(var g=-1,k=-1,d=0;d<e.Actions.length;d++){var b=e.Actions[d];b._isAvailable=a._isActionAvailable(b)&&!String.isNullOrEmpty(b.HeaderText);b._isFirst=false;b._isLast=false;if(b._isAvailable){if(g==-1)g=d;k=d}}if(g>=0){e.Actions[g]._isFirst=true;e.Actions[k]._isLast=true}for(d=0;d<e.Actions.length;d++){b=e.Actions[d];b._isAvailable&&c.appendFormat('<td class="{7}Group FlatGroup{6}{8}{9}" onmouseover="$showHover(this,&quot;{0}${2}$ActionGroup${1}&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="if(this._skip)this._skip=null;else $find(\'{0}\').executeAction(\'ActionBar\',{1},null,{2})" title="{10}"><span class="Outer">{5}<a href="javascript:" tabindex="{4}" onclick="this.parentNode.parentNode._skip=true;$find(\'{0}\').executeAction(\'ActionBar\',{1},null,{2});return false;" onfocus="$showHover(this,&quot;{0}${2}$ActionGroup${1}&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)">{3}</a></span></td>',a.get_id(),d,f,Web.DataView.htmlEncode(b.HeaderText),$nextTabIndex(),!String.isNullOrEmpty(b.CssClass)?String.format('<span class="FlatGroupIcon {0}">&nbsp;</span>',b.CssClass):"",!String.isNullOrEmpty(b.CssClass)?" FlatGroupWithIcon":"",b.CssClassEx,b._isFirst?" First":"",b._isLast?" Last":"",b.Description)}}else c.appendFormat('<td class="{5}Group" onmouseover="$showHover(this,&quot;{0}${1}$ActionGroup${2}&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><a href="javascript:" onfocus="$showHover(this,&quot;{0}${1}$ActionGroup${2}&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" tabindex="{4}" onclick="$hoverOver(this, 2);return false;">{3}</a></span></td>',a.get_id(),a.get_viewId(),f,e.HeaderText,$nextTabIndex(),e.CssClassEx)}}c.append("</tr></table>")},_renderActionBar:function(b){var c="</td></tr></table>",a=this;if(!a.get_showActionBar()){a._registerActionBarItems();return}b.appendFormat('<tr class="ActionRow"><td colspan="{0}"  class="ActionBar">',a._get_colSpan());b.appendFormat('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td style="width:100%" id="{0}$ActionBar">',a.get_id());a._internalRenderActionBar(b);a._registerViewSelectorItems();b.append('</td><td class="ViewSelectorControl">');if(a.get_showViewSelector()){b.appendFormat('<table cellpadding="0" cellspacing="0"><tr><td class="ViewSelectorLabel">{0}:</td><td>',Web.DataViewResources.ActionBar.View);b.appendFormat('<span class="ViewSelector" onmouseover="$showHover(this,&quot;{0}$ViewSelector&quot;,&quot;ViewSelector&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><span class="Inner"><a href="javascript:" class="Link" tabindex="{2}" onfocus="$showHover(this,&quot;{0}$ViewSelector&quot;,&quot;ViewSelector&quot;,3)" onblur="$hideHover(this)">{1}</a></span></span></span>',a.get_id(),Web.DataView.htmlEncode(a.get_view().Label),$nextTabIndex());b.append(c)}b.append(c);b.append("</td></tr>")},get_statusBar:function(){return this._statusBar},_renderStatusBar:function(a){a.appendFormat('<tr class="StatusBarRow" style="display:none"><td colspan="{1}" class="StatusBar" id="{0}$StatusBar"></td></tr>',this.get_id(),this._get_colSpan())},statusBar:function(){var p="ToCurrent",i=this,l=i.get_statusBar(),e;if(!String.isNullOrEmpty(l)){var d=/((\w+)\.)?((\w+)\.)?(\w+):\s*(.+?)\s*\n\s*(((.+?)\s*>\s*)+)/g,b=d.exec(l);while(b){var o=i.fieldValue(b[5]);if(o==null)o="null";if((b[6]==o||b[6]=="*")&&(String.isNullOrEmpty(b[2])||b[2]==i.get_controller())&&(String.isNullOrEmpty(b[3])||b[4]==i.get_viewId())){d=/(\[)?\s*(.+?)\s*(\])?\s*>\s*/g;var c=[],f=d.exec(b[7]);while(f){Array.add(c,{Text:f[2],Current:f[1]=="["&&f[3]=="]"});f=d.exec(b[7])}if(c.length>0&&!(__tf!=4)){e=new Sys.StringBuilder('<ul class="StatusBar">');for(var n=false,m=true,a=0;a<c.length;a++)if(c[a].Current){n=true;m=false;break}for(a=0;a<c.length;a++){var h=c[a],j=h.Current?"Current":n?"Past":m?"Future":"",k=a<c.length-1?c[a+1]:null,g="";if(k)if(k.Current)g=j+p;else if(h.Current)if(k.Current)g=j+p;else g=j+"ToFuture";if(h.Current){n=false;m=true}e.appendFormat('<li class="Segment {1}{2}{3} {4}"><span class="Outer"><span class="Inner"><span class="Self">{0}</span></span></span></li>',Web.DataView.htmlEncode(h.Text),j,a==0?" First":"",a==c.length-1?" Last":"",g)}e.append("</ul>")}break}b=d.exec(l)}}return e?e.toString():null},_updateStatusBar:function(){var c=this.get_statusBar(),b,a;if(!String.isNullOrEmpty(c)){a=$(this._get("$StatusBar"));if(a.length){b=this.statusBar();if(b)a.html(b).parent().show();else a.parent().hide()}}},filterByFirstLetter:function(d){var a=this,b=a._firstLetters[0],c=a._firstLetters[d];a.applyFieldFilter(a.findField(b).Index,"$beginswith",[c])},_renderViewDescription:function(b){var g=null,a=this,m=a._firstLetters&&a._firstLetters.length>2,i=a.get_showDescription();if(!i&&!m)return;var f=i?a.get_description():"",h=g;if(m){var e=new Sys.StringBuilder;e.append('<div class="Letters">');for(var k=a.findField(a._firstLetters[0]),l=g,c=0;c<a._filter.length;c++){var d=a._filter[c].match(Web.DataView._fieldFilterRegex);if(d&&d[1]==k.Name){d=d[2].match(/^\$beginswith\$(.+?)\0$/);if(d)l=a.convertStringToFieldValue(k,d[1]);break}}var n=String.format("{0} {1} ",Web.DataView.htmlAttributeEncode(k.Label),Web.DataViewResources.Data.Filters.Text.List[2].Text.toLowerCase());for(c=1;c<a._firstLetters.length;c++){var j=a._firstLetters[c];e.appendFormat('<a href="javascript:" onclick="$find(\'{0}\').filterByFirstLetter({1});return false;" class="Letter{5}" title="{3}{4}">{2}</a> ',a.get_id(),c,j,n,Web.DataView.htmlAttributeEncode(j),l==j?" Selected":"")}e.append("</div>");h=e.toString();e.clear()}if(i&&String.isNullOrEmpty(f))f=a.get_view().HeaderText;if(!String.isNullOrEmpty(f)||a.get_lookupField()||h){b.appendFormat('<tr class="HeaderTextRow"><td colspan="{0}" class="HeaderText">',a._get_colSpan());a.get_lookupField()!=g&&b.append('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td style="padding:0px">');b.appendFormat('<div id="{0}$HeaderText">',a.get_id());b.append(a._formatViewText(Web.DataViewResources.Views.DefaultDescriptions[f],true,f));b.append("</div>");h&&b.append(h);a.get_lookupField()!=g&&b.appendFormat('</td><td align="right" style="padding:0px"><a href="javascript:" class="Close" onclick="$find(\'{0}\').hideLookup();return false" tabindex="{2}" title="{1}">&nbsp;</a></td></tr></table>',a.get_id(),Web.DataViewResources.ModalPopup.Close,$nextTabIndex());b.append("</td></tr>")}},_renderInfoBar:function(c){var a=this,d=a.get_filter();if(d.length>0&&!a.filterIsExternal()){var b=new Sys.StringBuilder;a.get_viewType()!="Form"&&a._renderFilterDetails(b,d);if(a.get_viewType()!="Form"&&!b.isEmpty()){c.appendFormat('<tr class="InfoRow {2}" id="{0}$InfoRow"><td colspan="{1}">',a.get_id(),a._get_colSpan(),a.get_viewType());c.append(b.toString());c.append("</td></tr>")}b.clear()}},_findFilterDefByFunction:function(d,a){if(a.endsWith("$"))a=a.substring(0,a.length-1);for(var c=0;c<d.length;c++){var b=d[c];if(b)if(b.List){var e=this._findFilterDefByFunction(b.List,a);if(e)return e}else if(b.Function==a)return b}return null},_renderFilterDetails:function(b,n){var o="<b>{0}</b>",e=this;for(var m=false,l=0;l<n.length;l++){var j=n[l].match(Web.DataView._fieldFilterRegex),a=e.findField(j[1]);if(!a||e._fieldIsInExternalFilter(a))continue;if(!m){b.appendFormat('<a href="javascript:" onclick="$find(\'{0}\').clearFilter();return false" class="Close" tabindex="{3}" title="{2}">&nbsp;</a><span class="Details"><span class="Information">&nbsp;</span>{1} ',e.get_id(),Web.DataViewResources.InfoBar.FilterApplied,Web.DataViewResources.ModalPopup.Close,$nextTabIndex());m=true}var q=e._allFields[a.AliasIndex],d=Web.DataView._filterIteratorRegex.exec(j[2]),k=true;while(d&&!(a.Index==a.AliasIndex&&a.IsPrimaryKey&&a.Hidden)){if(!k)b.append(", ");else b.appendFormat('<span class="FilterElement" onclick="$find(\'{0}\').removeFromFilterByIndex({1})" title="{2}">',e.get_id(),a.Index,Web.DataView.htmlAttributeEncode(String.format(Web.DataViewResources.HeaderFilter.ClearFilter,a.Label)));if(d[1].startsWith("~"))b.appendFormat(String.format('{0} <b class="String">{1}</b>',Web.DataViewResources.InfoBar.QuickFind,e.convertStringToFieldValue(a,d[3])));else{b.appendFormat('<span class="Highlight">{0}</span>',q.HeaderText);var h=e._findFilterDefByFunction(Web.DataViewResources.Data.Filters[a.FilterType].List,a.FilterType=="Boolean"&&d[3].length>1?d[3]=="%js%true"?"$true":"$false":d[1]);if(!h){switch(d[1]){case"=":b.append(String.isJavaScriptNull(d[2])?Web.DataViewResources.InfoBar.Empty:Web.DataViewResources.InfoBar.EqualTo);break;case"<":b.append(Web.DataViewResources.InfoBar.LessThan);break;case"<=":b.append(Web.DataViewResources.InfoBar.LessThanOrEqual);break;case">":b.append(Web.DataViewResources.InfoBar.GreaterThan);break;case">=":b.append(Web.DataViewResources.InfoBar.GreaterThanOrEqual);break;case"*":b.append(d[2].startsWith("%")?Web.DataViewResources.InfoBar.Like:Web.DataViewResources.InfoBar.StartsWith)}var f=e._findItemByValue(a,e.convertStringToFieldValue(a,d[3])),c=f==null?d[3]:f[1];if(String.isJavaScriptNull(d[3])||String.isBlank(c))c=Web.DataViewResources.InfoBar.Empty;else c=e.convertStringToFieldValue(a,c);b.appendFormat(o,String.htmlEncode(c))}else if(h.Prompt){b.appendFormat(" {0} ",h.Text.toLowerCase());c=d[3];var g=c.split(Web.DataView._listRegex);if(String.isJavaScriptNull(g[0]))g[0]=Web.DataViewResources.InfoBar.Empty;if(!String.isJavaScriptNull(d[2])){var p=g[0].match(/^([\s\S]+?)\0?$/);if(p)g[0]=p[1];c=e.convertStringToFieldValue(a,g[0]);f=e._findItemByValue(a,c);b.appendFormat(o,String.htmlEncode(f?f[1]:a.format(c)));for(var i=1;i<g.length;i++){b.appendFormat("{0} ",d[1]=="$between$"?" "+Web.DataViewResources.Data.Filters.Labels.And:", ");c=e.convertStringToFieldValue(a,g[i]);if(c==null)c=Web.DataViewResources.HeaderFilter.EmptyValue;else{f=e._findItemByValue(a,c);c=f?f[1]:a.format(c)}b.appendFormat('<b class="{1}">{0}</b>',String.htmlEncode(c));if(i>5){b.append(", ..");break}}}}else b.appendFormat(" {0} <b>{1}</b>",Web.DataViewResources.Data.Filters.Labels.Equals,h.Function.match(Web.DataView._keepCapitalization)?h.Text:h.Text.toLowerCase())}d=Web.DataView._filterIteratorRegex.exec(j[2]);k=false}!k&&b.append(".");b.append("</span> ")}b.append("</span>")},_findItemByValue:function(c,b){var a=null,e=c.DynamicItems?c.DynamicItems:c.Items;if(e.length==0)return a;b=b==a?"":b.toString();for(var f=0;f<e.length;f++){var d=e[f],g=d[0]==a?"":d[0].toString();if(g==b)return d}return[a,this.get_isForm()?Web.DataViewResources.Data.NullValueInForms:Web.DataViewResources.Data.NullValue]},_renderPager:function(b,p){var n='<span class="Disabled">{0}</span>',g='<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}</a>',a=this;if(a.get_showPager().indexOf(p)==-1)return;var q=a.get_isChart();b.appendFormat('<tr class="FooterRow {2}PagerRow"><td colspan="{0}" class="Footer"><table cellpadding="0" cellspacing="0" style="width:100%"><tr><td align="left" class="Pager PageButtons{1}">',a._get_colSpan(),q?" Print":"",p);var d=a.get_pageCount(),e=a.get_pageSize();if(q){d=1;e=a._totalRowCount;var j=a._get_specialAction("Print");j&&b.appendFormat('<a href="javascript:" onclick="{1};return false;" title="{0}" class="Print"><span></span></a></td><td>',j.text,j.script)}if(d>1){var c=a._firstPageButtonIndex,m=a.get_pagerButtonCount(),o=m;if(a.get_pageIndex()>0)b.appendFormat(g,a.get_pageIndex()-1,a.get_id(),Web.DataViewResources.Pager.Previous,$nextTabIndex());else b.appendFormat(n,Web.DataViewResources.Pager.Previous);b.appendFormat(" | {0}: ",Web.DataViewResources.Pager.Page);c>0&&b.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage(0,true);return false" class="PaddedLink" tabindex="{2}">1</a><a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">...</a>',c-1,a.get_id(),$nextTabIndex(),$nextTabIndex());while(o>0&&c<d){if(c==a.get_pageIndex())b.appendFormat('<span class="Selected">{0}</span>',c+1);else b.appendFormat(g,c,a.get_id(),c+1,$nextTabIndex());c++;o--}c<=d-1&&b.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{2}">...</a><a href="#" onclick="$find(\'{1}\').goToPage({3}-1,true);return false" class="PaddedLink" tabindex="{4}">{3}</a>',a._firstPageButtonIndex+m,a.get_id(),$nextTabIndex(),d,$nextTabIndex());b.append(" | ");if(a.get_pageIndex()<d-1)b.appendFormat(g,a.get_pageIndex()+1,a.get_id(),Web.DataViewResources.Pager.Next,$nextTabIndex());else b.appendFormat(n,Web.DataViewResources.Pager.Next)}b.append('</td><td align="right" class="Pager PageSize">&nbsp;');var h=a.get_showPageSize(),k=a._pageSizes;if(h&&a._totalRowCount>e){b.append(Web.DataViewResources.Pager.ItemsPerPage);for(i=0;i<k.length;i++){i>0&&b.append(", ");if(e==k[i])b.appendFormat("<b>{0}</b>",e);else b.appendFormat('<a href="#" onclick="$find(\'{0}\').set_pageSize({1},true);return false" tabindex="{2}">{1}</a>',a.get_id(),k[i],$nextTabIndex())}b.append(" | ")}if(a._totalRowCount>0){var f=(a.get_pageIndex()+1)*e;if(f>a._totalRowCount)f=a._totalRowCount;h&&b.appendFormat(Web.DataViewResources.Pager.ShowingItems,a.get_pageIndex()*e+1,f,a._totalRowCount);var l=a.multiSelect();if(l){b.appendFormat('<span id="{0}$SelectionInfo">',a.get_id());a._selectedKeyList.length>0&&b.appendFormat(Web.DataViewResources.Pager.SelectionInfo,a._selectedKeyList.length);b.append("</span>")}(h||l)&&b.append(" | ")}b.appendFormat('</td><td align="center" class="Pager Refresh" id="{0}_Wait">',a.get_id());!a.get_searchOnStart()&&b.appendFormat('<a href="#" onclick="$find(\'{0}\').{3}();return false" tabindex="{2}" title="{1}"><span>&nbsp;</span></a>',a.get_id(),Web.DataViewResources.Pager.Refresh,$nextTabIndex(),a._hasSearchAction?"search":"sync");b.append("</td></tr></table>");b.append("</td></tr>")},refreshAndResize:function(){this.cancelDataSheetEdit();this.goToPage(-1);delete this._viewColumnSettings},refreshData:function(){this._clearCache();this.set_pageIndex(-2);this._loadPage()},_dittoCollectedValues:function(e,f){if(this.get_isEditing()){for(var g=f?new RegExp(String.format("^{0}(Length|ContentType|FileName|FullFileName)?$",f)):null,h=this._collectFieldValues(true),c=[],b=0;b<h.length;b++){var a=h[b];(!g||!a.Name.match(g))&&Array.add(c,{name:a.Name,value:a.Modified?a.NewValue:a.OldValue})}if(e)for(b=0;b<e.length;b++){a=e[b];for(var d=0;d<c.length;d++){var i=a.Name?a.Name:a.name;if(c[d].name==i){Array.removeAt(c,d);break}}Array.add(c,a.Name?{name:a.Name,value:a.NewValue}:a)}this._ditto=c}},refresh:function(d,c,b){var a=this;a._dittoCollectedValues(c,b);a._lastSelectedCategoryTabIndex=a.get_categoryTabIndex();if(d)a._render();else a.goToView(a.get_viewId())},_cname:function(b){var a=this.get_viewId();if(a==null)a="grid1";return String.format("{0}${1}${2}",this._id,a,b)},readContext:function(a){return Web.PageState.read(this._cname(a))},writeContext:function(b,a){Web.PageState.write(this._cname(b),a)},_saveViewVitals:function(){var a=this;a.writeContext("vitals",{PageIndex:a.get_pageIndex(),PageSize:a.get_pageSize(),Filter:a.get_filter(),SortExpression:a.get_sortExpression(),Tag:a.get_tag()})},_restoreViewVitals:function(a){var c=this;if(a.PageIndex>=0)return;var b=c.readContext("vitals");if(b==null)return;a.RequiresRowCount=true;a.RequiresMetaData=true;if(a.PageIndex==-1&&b.Filter&&a.Filter){a.Tag=b.Tag;a.PageIndex=b.PageIndex;a.PageSize=b.PageSize;if(a.FilterIsExternal){for(var h=a.Filter,e=0;e<b.Filter.length;e++){for(var d=b.Filter[e],k=d.substring(0,d.indexOf(":")),j=false,f=0;f<a.Filter.length;f++){var g=a.Filter[f],l=g.substring(0,g.indexOf(":"));if(l==k){j=true;break}}!j&&Array.add(h,d)}a.Filter=Array.clone(h)}else if(a.Filter==null||a.Filter.length==0)a.Filter=Array.clone(b.Filter);a.SortExpression=b.SortExpression;if(!c.get_isDataSheet()||!c._get_focusedCell()){var i=c.readContext("GridType");i!=null&&c.changeViewType(i)}}},_useSearchParams:function(d){var b=this,a=b._paramValues;if(a){b._searchParamValues=a;b._paramValues=null}else a=b._searchParamValues;if(a){for(var e=Array.clone(d.ExternalFilter),c=0;c<a.length;c++){var f=a[c];Array.add(e,{Name:f.Name,Value:f.NewValue})}d.ExternalFilter=e}},_forceSync:function(){var a=this;if(a._skipSync)a._skipSync=false;else a._syncKey=a.get_selectedKey()},sync:function(b){var a=this;a._clearCache();if(b!=null){if(!Array.isInstanceOfType(b))b=[b];for(var d=[],c=0;c<a._keyFields.length;c++){var e=a._keyFields[c];d[a._keyFields[c].Index]=b[c]}a._raiseSelectedDelayed=true;a._pendingSelectedEvent=true;a._selectKeyByRow(d)}a._forceSync();a.refreshAndResize();a._synced=true},_sync:function(){var a=this,b=a._viewColumnSettings;a._viewColumnSettings=[];a.sync();a._viewColumnSettings=b},_createParams:function(i){var d=null,a=this,c=a.get_lookupContext(),e=a.get_viewType();if(String.isNullOrEmpty(e))e=a.readContext("GridType");var g=a.extension(),b={PageIndex:a.get_pageIndex(),PageSize:a.get_pageSize(),PageOffset:a.get_pageOffset(),SortExpression:a.get_sortExpression(),Filter:a.get_filter(),ContextKey:a.get_id(),Cookie:a.get_cookie(),FilterIsExternal:a._externalFilter.length>0,LookupContextFieldName:c?c.FieldName:d,LookupContextController:c?c.Controller:d,LookupContextView:c?c.View:d,LookupContext:c,Inserting:a.get_isInserting(),LastCommandName:a.get_lastCommandName(),LastCommandArgument:a.get_lastCommandArgument(),ExternalFilter:a.get_externalFilter(),Transaction:a.get_transaction(),DoesNotRequireData:a.get_searchOnStart(),LastView:a.get_lastViewId(),Tag:a.get_tag(),RequiresFirstLetters:a.get_showFirstLetters(),ViewType:e,SupportsCaching:Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>7,SystemFilter:g?g.systemFilter():d,RequiresRowCount:a._requiresRowCount==true},f=a.get_confirmContext();if(f){var h=Array.clone(b.ExternalFilter);Array.addRange(h,f.Values);b.ExternalFilter=h}a._useSearchParams(b);if(a._position){if(a._position.changing){b.PageIndex=a._position.index;b.PageSize=1;b.Filter=a._position.filter;b.SortExpression=a._position.sortExpression;b.RequiresMetaData=true}if(i)b.Filter=a._selectedKeyFilter}b.SyncKey=a._syncKey;if(a._syncKey)a._syncKey=d;return b},_createArguments:function(d,e,c){var a=this;if(!c)c=a._collectFieldValues();if(!e)e=a.get_viewId();if(d.values)c=Array.clone(d.values);if(a._paramValues){c=Array.clone(c);Array.addRange(c,a._paramValues);delete a._paramVlaues}var b={CommandName:d.commandName,CommandArgument:d.commandArgument,Path:d.path,LastCommandName:a.get_lastCommandName(),Values:c,ContextKey:a.get_id(),Cookie:a.get_cookie(),Controller:a.get_controller(),View:e,LastView:a.get_lastViewId(),Tag:a.get_tag(),Trigger:d.trigger};b.Filter=a.get_filter();b.SortExpression=a.get_sortExpression();b.SelectedValues=a.get_selectedValues();b.ExternalFilter=Array.clone(a.get_externalFilter());b.Transaction=a.get_transaction();if(d.commandName=="PopulateDynamicLookups")for(var f=0;f<a._allFields.length;f++){var g=a.get_contextFilter(a._allFields[f],c);g.length>0&&Array.addRange(b.ExternalFilter,g)}if(!String.isNullOrEmpty(b.Transaction)&&!a.get_isModal()&&!a.get_filterSource()&&b.CommandName.match(/Insert|Update|Delete/))b.Transaction+=":complete";b.SaveLEVs=a._allowLEVs==true;return b},_loadPage:function(){var a=this;a._isBusy&&a._cancelWSRequest();a._delayedLoading=false;if(a._source)return;if(a.get_mode()!=Web.DataViewMode.View){a._allFields=[{Index:0,Label:"",DataFormatString:"",AliasIndex:0,ItemsDataController:a.get_controller(),ItemsNewDataView:a.get_newViewId(),ItemsDataView:a.get_viewId(),_dataView:a,Behaviors:[],format:_field_format,isReadOnly:_field_isReadOnly,isNumber:_field_isNumber}];a._fields=a._allFields;a._render()}else{a._busy(true);a._detachBehaviors();a._showWait();var d=a._createParams();a._restoreViewVitals(d);var b={controller:a.get_controller(),view:a.get_viewId(),request:d},c=new Web.BusinessRules(a);c.before({commandName:"Select",commandArgument:b.view});c.dispose();a._invoke("GetPage",b,Function.createDelegate(a,a._onGetPageComplete))}},_cancelWSRequest:function(){var a=this._wsRequest;if(a){this._wsRequest=null;a.get_executor&&!a.completed()&&a.get_executor().abort()}},_invoke:function(d,a,f,c){var b=this,e=this.get_servicePath();function g(h,i,j){if(h.get_statusCode()==0)$appfactory.confirm(Web.DataViewResources.Data.ConnectionLost,function(){b._wsRequest=Sys.Net.WebServiceProxy.invoke(e,d,false,a,f,g,c)},function(){b._onMethodFailed(h,i,j)});else b._onMethodFailed(h,i,j)}b._autoRefresh(true);if(e.startsWith("http")){switch(d){case"GetPage":case"GetListOfValues":a.request.Controller=a.controller;a.request.View=a.view;a=a.request;break;case"Execute":a=a.args}$.ajax({url:this.get_baseUrl()+"appservices/_invoke",type:"GET",cache:false,data:{method:d,args:Sys.Serialization.JavaScriptSerializer.serialize(a)},dataType:"jsonp",success:function(a){f(a,c)},error:function(a){b._onMethodFailed(a.message,a.response,c)}})}else b._wsRequest=Sys.Net.WebServiceProxy.invoke(e,d,false,a,f,g,c)},_disposeFields:function(){if(this._allFields)for(var b=0;b<this._allFields.length;b++){var a=this._allFields[b];a._dataView=null;a._listOfValues&&Array.clear(a._listOfValues)}},_formatViewText:function(b,d,e){var a=this,c=a._views.length>0?a._views[0].Label:a._view?a._view.Label:"";return!String.isNullOrEmpty(b)?String.format(b,d==true?c.toLowerCase():c):e},_autoRefresh:function(c){var a=this;if(a._refreshInterval>0){if(a._riTimeout){clearTimeout(a._riTimeout);a._riTimeout=null}if(!c){var b=a;a._riTimeout=setTimeout(function(){!b.get_isForm()&&b.sync()},a._refreshInterval*1e3)}}},_clearCache:function(d){var a=this._cachedPages;if(a){for(var b=0;b<a.length;b++){var e=a[b];Array.clear(e.rows);delete e.rows}Array.clear(a);delete this._cachedPages}var c=this.extension();c&&c.reset(d==null||d==true)},_supportsCaching:function(a){return a=="DataSheet"||a=="Grid"&&$appfactory.mobile},_cacheResult:function(c){var f=null,j=this,m=c.PageSize,i=c.PageSize<c.Rows.length,o=j.get_viewType();if(!i&&!o)o=j.readContext("GridType");if(!i)i=j._supportsCaching(o);if(!i&&!o&&c.Views)for(var a=0;a<c.Views.length;a++){var r=c.Views[a];if(r.Id==c.View){i=j._supportsCaching(r.Type);break}}if(i&&c.SupportsCaching){var h=c.Rows;c.Rows=[];var b=j._cachedPages;if(!b)b=j._cachedPages=[];var n=c.PageIndex,k=0,l=m-1;if(n>0)if(h.length<=m*2){k=m;l=h.length-1}else{k+=m;l+=m}var g={index:n,rows:[]};for(a=k;a<=l;a++){var q=h[a];if(q){Array.add(c.Rows,Array.clone(q));Array.add(g.rows,q)}}var e=f;if(k>0){e={index:n-1,rows:[]};for(a=0;a<k;a++)Array.add(e.rows,h[a])}var d=f;if(l<h.length-1){d={index:n+1,rows:[]};for(a=l+1;a<h.length;a++)Array.add(d.rows,h[a])}a=0;while(a<b.length){var p=b[a];if(g!=f&&p.index==g.index){b[a]=g;g=f}else if(e!=f&&p.index==e.index){b[a]=e;e=f}else if(d!=f&&p.index==d.index){b[a]=d;d=f}else a++}if(g||e||d){if(b.length>100){Array.removeAt(b,0);Array.removeAt(b,0);Array.removeAt(b,0)}g&&Array.add(b,g);e&&Array.add(b,e);d&&Array.add(b,d)}}},_onGetPageComplete:function(c){var y="false",T="createForm1",S="/Membership.aspx",R="UserUserName",Q="aspnet_Membership",x="Lookup",u="{0:",P="$autocompleteanywhere",O="$disablemultiplevalues",N="$disablesamples",M="$disableautocomplete",w="Boolean",L="DateTime",j=null,g=true,h=false,b=this;b._busy(h);if(Sys.Services&&Sys.Services.AuthenticationService&&Sys.Services.AuthenticationService.get_isLoggedIn&&Sys.Services.AuthenticationService.get_isLoggedIn()&&!c.IsAuthenticated){location.replace($appfactory.unanchor(location.href));return}if(b._containerIsHidden){Sys.UI.DomElement.setVisible(b._container,g);b._containerIsHidden=h}b.set_tag(c.Tag);if(c.FirstLetters!="")b._firstLetters=c.FirstLetters?c.FirstLetters.split(/,/):j;var s=b._position&&b._position.changed;b._cacheResult(c);if(b._pageIndex<0||s){if(b._pageIndex==-1||s){b._disposeFields();b._expressions=c.Expressions;b._detachBehaviors();b._allFields=c.Fields;b._fields=[];var t=[];if(b._keyFields&&b._selectedKey.length>0){for(var d=0;d<b._keyFields.length;d++)t[d]={name:b._keyFields[d].Name,value:b._selectedKey[d]};b._selectedKey=[]}b._keyFields=[];var K=h;for(d=0;d<c.Fields.length;d++){var a=c.Fields[d];a.Index=d;if(a.Name=="Status")K=g}if(!K)c.Fields[c.Fields.length]={Name:"Status",ReadOnly:g,Type:"String",AllowNulls:g,Hidden:g,Index:c.Fields.length,_system:g};var v=Web.DataView._commandLine.match(/\W_display=(.+?)(&|$)/);for(d=0;d<c.Fields.length;d++){a=c.Fields[d];var cb=!String.isNullOrEmpty(a.AliasName)?b.findField(a.AliasName):j;a.AliasIndex=cb?cb.Index:d;if((!a.Hidden||v)&&b._fieldIsInExternalFilter(a)&&b.get_hideExternalFilterFields()){var jb=a.Hidden;a.Hidden=g;if(v&&Array.indexOfCaseInsensitive(v[1].split(","),a.Name)!=-1){if(!jb)a.Hidden=h;if(b.get_isInserting()){var gb=new RegExp(String.format("\\W{0}=(.*?)(&|$)",a.Name)),X=Web.DataView._commandLine.match(gb);if(X){if(!c.NewRow)c.NewRow=[];c.NewRow[d]=decodeURIComponent(X[1])}}}}if(!String.isNullOrEmpty(a.ToolTip))a.ToolTip=Web.DataView.htmlAttributeEncode(a.ToolTip);if(!a.Watermark&&!a.AllowNulls)a.Watermark=Web.DataViewResources.Validator.Required;a.Behaviors=[]}if(c.NewRow&&b._ditto)for(d=0;d<c.Fields.length;d++){a=c.Fields[d];if(c.NewRow[d]!=j)for(var f=0;f<b._ditto.length;f++)if(b._ditto[f].name==a.Name){Array.removeAt(b._ditto,f);break}}b._hasDynamicLookups=h;b._requiresConfiguration=h;var ib=0;for(d=0;d<c.Fields.length;d++){a=c.Fields[d];a._dataView=b;!a.Hidden&&Array.add(b._fields,a);if(a.IsPrimaryKey){Array.add(b._keyFields,a);for(f=0;f<t.length;f++)if(t[f].name==a.Name){Array.add(b._selectedKey,t[f].value);break}}if(String.isNullOrEmpty(a.HeaderText))a.HeaderText=a.Label;if(String.isNullOrEmpty(a.HeaderText))a.HeaderText=a.Name;a.FilterType="Number";switch(a.Type){case"Time":case"String":a.FilterType="Text";break;case L:case"DateTimeOffset":a.FilterType="Date";break;case w:a.FilterType=w}if(!String.isBlank(a.SearchOptions)&&!(__tf!=4)){var i=a.SearchOptions.replace(/\s+/g,",").split(/,/);a.AllowAutoComplete=!Array.contains(i,M);!a.AllowAutoComplete&&Array.remove(i,M);a.AllowSamples=!Array.contains(i,N);!a.AllowSamples&&Array.remove(i,N);a.AllowMultipleValues=!Array.contains(i,O);!a.AllowMultipleValues&&Array.remove(i,O);a.AutoCompleteAnywhere=Array.contains(i,P);if(a.AutoCompleteAnywhere){Array.remove(i,P);c.Fields[a.AliasIndex].AutoCompleteAnywhere=g}f=0;var G=h;while(f<i.length){var E=i[f]=i[f].trim();if(E=="*")G=g;if(E.length>0&&E!="*")f++;else Array.removeAt(i,f)}if(G&&i.length>0){var hb=Web.DataViewResources.Data.Filters[a.FilterType];b._enumerateMissingSearchOptions(i,hb.List)}Array.contains(i,"$in")&&!Array.contains(i,"$notin")&&Array.add(i,"$notin");a.SearchOptions=i.length==0?j:i}else a.SearchOptions=j;a.format=_field_format;a.isReadOnly=_field_isReadOnly;a.isNumber=_field_isNumber;a.text=_field_text;a.trim=_field_trim;a.htmlEncode=_field_htmlEncode;a.tagged=function(){var b=this.Tag,c,d,e="";if(b)for(var a=0;a<arguments.length;a++){d=arguments[a];c=b.indexOf(d);if(c>=0){a=c+d.length;while(a<b.length){var f=b[a].match(/\d/);if(f)e+=b[a++];else break}Web.DataView.tagSuffix=e;return g}}return h};if(a.DataFormatString&&a.DataFormatString.indexOf("{")==-1)a.DataFormatString=u+a.DataFormatString+"}";if(a.DataFormatString)a.DataFormatString=b.resolveClientUrl(a.DataFormatString);if(a.Type.startsWith(L))if(!a.DataFormatString)a.DataFormatString="{0:d}";else{l=a.DataFormatString.match(/{0:(g)}/i);if(l){var D=Sys.CultureInfo.CurrentCulture.dateTimeFormat;a.DateFmtStr=u+D.ShortDatePattern+"}";a.TimeFmtStr=u+(l[1]=="g"?D.ShortTimePattern:D.LongTimePattern)+"}"}var bb=Web.DataView.dateFormatStrings[a.DataFormatString];if(bb)a.DataFormatString=u+bb+"}";if(a.DateFmtStr)a.DataFmtStr=a.DataFormatString}if(a.Type==w&&a.Items.length==0){a.Items=Array.clone(a.AllowNulls?Web.DataViewResources.Data.BooleanOptionalDefaultItems:Web.DataViewResources.Data.BooleanDefaultItems);if(!a.ItemsStyle)a.ItemsStyle=Web.DataViewResources.Data.BooleanDefaultStyle}a.Items&&a.Items.length>0&&(a.AllowNulls||a.ItemsStyle=="DropDownList")&&!String.isNullOrEmpty(a.Items[0][0])&&a.ItemsStyle!="CheckBoxList"&&Array.insert(a.Items,0,[j,Web.DataViewResources.Data.NullValueInForms]);if(!String.isNullOrEmpty(a.ItemsStyle))if(!String.isNullOrEmpty(a.ContextFields)&&a.ItemsStyle!=x&&a.ItemsStyle!="AutoComplete"&&!String.isNullOrEmpty(a.ItemsDataController)){b._hasDynamicLookups=g;a.ItemsAreDynamic=g}else if(a.ItemsStyle=="UserNameLookup"){a.ItemsStyle=x;a.ItemsDataController=Q;a.ItemsDataTextField="UserName";a.ItemsDataValueField=R;if(Web.Menu.findNode(S))a.ItemsNewDataView=T}else if(a.ItemsStyle=="UserIdLookup"){a.ItemsStyle=x;a.ItemsDataController=Q;a.ItemsDataTextField=R;a.ItemsDataValueField="UserId";if(Web.Menu.findNode(S))a.ItemsNewDataView=T}if(!String.isNullOrEmpty(a.Configuration))b._requiresConfiguration=g;if(a.AllowLEV)b._allowLEVs=g;if(a.TextMode==2&&String.isNullOrEmpty(a.Editor)&&!$appfactory.mobile){if(Sys.Extended.UI.HtmlEditorExtenderBehavior||typeof CKEDITOR!="undefined")a.ClientEditor="Web$DataView$RichText";else a.Editor="RichEditor";a.HtmlEncode=h}if(a.Editor)if(b._executeClientEditorFactories(a)){a.ClientEditor=a.Editor;a.Editor=j}else a.EditorId=String.format("{0}_Item{1}",b.get_id(),a.Index);a.ColIndex=!a.Hidden?ib++:-1;var p=Web.DataView.Geo;if(a.tagged("modified-","created-")&&a.tagged("modified-latitude","modified-longitude","modified-coords","created-latitude","created-longitude","created-coords")){if(!p||p.latitude<0){p=Web.DataView.Geo={latitude:-1,longitude:-1};var V=navigator.geolocation;V&&V.watchPosition(function(a){p.latitude=a.coords.latitude;p.longitude=a.coords.longitude},function(a){p.error=a})}a.TextMode=4}}c.LEVs&&b._recordLEVs(c.LEVs);b._views=c.Views;b._view=j;if(!b._lastViewId&&!b.get_isForm())b._lastViewId=c.View;b._actionGroups=c.ActionGroups?c.ActionGroups:[];b._statusBar=c.StatusBar;var B=/^(true|false)\:(.+)$/,Y=0;b._actionColumn=j;for(d=0;d<b._actionGroups.length;d++){var n=b._actionGroups[d],C=Web.DataViewResources.Actions.Scopes[n.Scope];if(C._Self){var ab=C._Self[n.HeaderText];if(ab)n.HeaderText=ab.HeaderText}if(n.Scope=="ActionColumn")b._actionColumn=!String.isNullOrEmpty(n.HeaderText)?n.HeaderText:Web.DataViewResources.Grid.ActionColumnHeaderText;if(!n.Id)n.Id="auto"+Y++;n.CssClassEx=String.format("Actions-g-{0} ",n.Id);for(f=0;f<n.Actions.length;f++){var e=n.Actions[f];if(!e.Id)e.Id="auto"+Y++;e.Path=String.format("{0}/{1}",n.Id,e.Id);var z=e.Confirmation;if(e.CommandName=="Search"){b._hasSearchAction=e.Path;b._hasSearchShortcut=z&&z.match(/_shortcut\s*=\s*true/)}e.CssClassEx=String.format("Actions-g-{0}-a-{1} ",n.Id,e.Id);if(String.isNullOrEmpty(e.HeaderText)){var m=C[e.CommandName];if(m){if(m.CommandArgument){var q=m.CommandArgument[e.CommandArgument];if(q)m=q}if(m.WhenLastCommandName){q=m.WhenLastCommandName[e.WhenLastCommandName];if(q)m=q}e.HeaderText=m.HeaderText;if(!String.isNullOrEmpty(m.HeaderText)&&m.HeaderText.indexOf("{")>=0)e.HeaderText=m.VarMaxLen!=j&&c.Views[0].Label.length>m.VarMaxLen?m.HeaderText2:b._formatViewText(m.HeaderText);if(String.isNullOrEmpty(e.Description))e.Description=b._formatViewText(m.Description);if(String.isNullOrEmpty(z))e.Confirmation=m.Confirmation}else e.HeaderText=e.CommandName}if(String.isNullOrEmpty(e.WhenView))e.WhenViewRegex=j;else{var l=B.exec(e.WhenView);e.WhenViewRegex=new RegExp(l?l[2]:e.WhenView);e.WhenViewRegexResult=l?l[1]!=y:g}if(String.isNullOrEmpty(e.WhenTag))e.WhenTagRegex=j;else{l=B.exec(e.WhenTag);e.WhenTagRegex=new RegExp(l?l[2]:e.WhenTag);e.WhenTagRegexResult=l?l[1]!=y:g}if(String.isNullOrEmpty(e.WhenHRef))e.WhenHRefRegex=j;else{l=B.exec(e.WhenHRef);e.WhenHRefRegex=new RegExp(l?l[2]:e.WhenHRef);e.WhenHRefRegexResult=l?l[1]!=y:g}}}var r=1,W=h,o=b._categories=c.Categories;b._tabs=[];for(d=0;d<o.length;d++){var k=o[d];k.Index=d;!String.isNullOrEmpty(k.Tab)&&!Array.contains(b._tabs,k.Tab)&&Array.add(b._tabs,k.Tab);if(k.NewColumn){if(d>0)r++;W=g}k.ColumnIndex=r-1;if(k.Id){var eb=$get(String.format("{0}_{1}_{2}",c.Controller,c.View,k.Id));if(eb)k.Template=eb.innerHTML}if(k.Floating&&String.isNullOrEmpty(k.Template)){var db=new Sys.StringBuilder('<div class="FloatingCategoryHeader"></div>');for(f=0;f<b._allFields.length;f++){var F=b._allFields[f];!F.Hidden&&d==F.CategoryIndex&&db.appendFormat('<div class="FieldPlaceholder">{{{0}}}</div>',F.Name)}k.Template=db.toString()}}if(b._tabs.length>0){for(d=0;d<o.length;d++){k=o[d];if(String.isNullOrEmpty(k.Tab))if(!String.isNullOrEmpty(o[0].Tab))k.Tab=o[0].Tab;else{k.Tab=Web.DataViewResources.Form.GeneralTabText;b._tabs[0]!=Web.DataViewResources.Form.GeneralTabText&&Array.insert(b._tabs,0,Web.DataViewResources.Form.GeneralTabText)}k.ColumnIndex=0}if(b._lastSelectedCategoryTabIndex!=j){var I=b._focusedFieldName;b.set_categoryTabIndex(!(b._lastSelectedCategoryTabIndex>=0)||I&&I.startsWith("_Annotation_")?b._tabs.length-1:0);delete b._lastSelectedCategoryTabIndex}else b.set_categoryTabIndex(0);var U=b.get_parentDataView(b);U._lastClickedIcon=="Attachment"&&b.set_categoryTabIndex(b._tabs.length-1);U._lastClickedIcon=j;r=1}else b.set_categoryTabIndex(-1);b._numberOfColumns=W&&!b._get_template()?r:0}b._filter=c.Filter;b._sortExpression=c.SortExpression;b._updatePageCount(c,s);var J=b.get_pagerButtonCount(g);b._firstPageButtonIndex=Math.floor(c.PageIndex/J)*J}else if(b._requiresRowCount){b._requiresRowCount=h;b._updatePageCount(c,h)}for(d=0;d<c.Fields.length;d++){a=c.Fields[d];var A=c.Fields[a.AliasIndex];if(a.AllowAutoComplete==h)A.AllowAutoComplete=h;if(a.AllowSamples==h)A.AllowSamples=h;if(a.AllowMultipleValues==h)A.AllowMultipleValues=h}b._icons=c.Icons;if(!b.get_isInserting()){var H=h;if(b._rows){if(b._rows.length==0||c.Rows.length==0)delete b._viewColumnSettings;for(d=0;d<b._rows.length;d++)Array.clear(b._rows[d]);Array.clear(b._rows);H=b.get_isGrid()}b._rows=c.Rows;if(H){b._selectedRowIndex=j;for(d=0;d<b._rows.length;d++)if(b._rowIsSelected(d)){b._selectedRowIndex=d;break}}}b._newRow=c.NewRow?c.NewRow:[];if(c.Aggregates)b._aggregates=c.Aggregates;if(b.get_isForm()&&b._selectedRowIndex==j&&b._totalRowCount>0){b._selectedRowIndex=0;b._selectKeyByRowIndex(0)}if(s){b._position.changed=g;b._selectKeyByRowIndex(0)}b._render(g);if(!$appfactory.mobile){b.get_lookupField()&&b._adjustLookupSize();if(b._isInInstantDetailsMode()){var kb=$common.getClientBounds(),fb=$common.getContentSize(document.body);resizeBy(0,fb.height-kb.height)}b._saveViewVitals();if(b._pendingSelectedEvent){b._pendingSelectedEvent=h;b.updateSummary()}b._registerFieldHeaderItems();_body_performResize()}b._executeSecondCommand();b._autoRefresh();b._autoSelect();if(!String.isNullOrEmpty(c.ClientScript))eval(c.ClientScript);var Z=new Web.BusinessRules(b);Z.after({commandName:c.NewRow?"New":"Select",commandArgument:c.View});Z.dispose()},_updatePageCount:function(a,c){var b=this;b._totalRowCount=a.TotalRowCount;if(b._position&&b._position.count==-1)b._position.count=a.TotalRowCount;b._pageIndex=a.PageIndex;if(!c){b._pageSize=a.PageSize;b._pageCount=Math.floor(a.TotalRowCount/a.PageSize);if(a.TotalRowCount%a.PageSize!=0)b._pageCount++}},_autoSelect:function(g){var c=false,b=null,a=this,d=b,e=b,f,k=c;if(a.get_autoHighlightFirstRow()){a.set_autoHighlightFirstRow(c);d="Select";f="highlight"}if(a.get_autoSelectFirstRow()){a.set_autoSelectFirstRow(c);f="select";var h=a.get_actionGroups("Grid");if(h.length>0)for(var j=0;j<h[0].Actions.length;j++){var i=h[0].Actions[j];if(i.CommandName){d=i.CommandName;e=i.CommandArgument;k=!String.isNullOrEmpty(e)&!a.get_showModalForms()&&g==b;break}}}if(d&&a.get_viewType()!="Form"&&a._rows.length>0){k&&a._hideContainer();var l=a.extension();if(l)l._autoSelect={row:a._rows[g||0],action:f};else a.executeRowCommand(g||0,d,e)}if(!a._tryFocusDataSheet||a._forceFocusDataSheet){a._tryFocusDataSheet=true;a.get_isDataSheet()&&!a.get_lookupField()&(!a.get_filterSource()||a._forceFocusDataSheet)&&a._rows.length>0&&!$appfactory.mobile&&a.executeRowCommand(a.get_selectedKey().length>0?b:0,"Select");a._forceFocusDataSheet=c}},_hideContainer:function(){this._containerIsHidden=true;this._container.style.display="none"},_enumerateMissingSearchOptions:function(b,c){for(var d=0;d<c.length;d++){var a=c[d];if(a&&!a.Hidden)if(a.List)this._enumerateExpressions(b,c);else!Array.contains(b,a.Function)&&Array.add(b,a.Function)}},_executeSecondCommand:function(c){var a=this;if(c){var b=Web.DataView._commandLine.match(/_commandName2=(\w+)(.*?_commandArgument2=(.*?)(&|$))?/);b&&a.executeActionInScope([a.get_viewType(),"ActionBar"],b[1],b[3])}else if(a._trySecondCommand){a._trySecondCommand=false;if(a.get_viewType()!="Form"||a._totalRowCount>0){var d=a;setTimeout(function(){d._executeSecondCommand(true)},50)}}},_skipNextInputListenerClickEvent:function(){if(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>=9)this._skipClickEvent=true},_gridViewCellFocus:function(e,d){var b=this;try{var c=new Sys.UI.DomEvent(e),a=c.target;if((a.tagName=="A"||a.parentNode.tagName=="A")&&!b.get_lookupField()||Sys.UI.DomElement.containsCssClass(a,"RowSelector"))return false;if(a.tagName=="SPAN"&&a.className=="ObjectRef")return false;if(b.get_lookupField()){c.stopPropagation();c.preventDefault()}b._skipNextInputListenerClickEvent()}catch(g){}b.executeRowCommand(d,"Select");return true},_dataSheetCellFocus:function(g,c,d){var a=this,b=a._get_focusedCell(),e=a.get_isInserting();if(e&&c!=-1)c=-1;if(d==-1)d=b!=null?b.colIndex:0;if(a.get_isEditing()&&b){a._focusCell(-1,-1,false);a._focusCell(c,d);var f=c==b.rowIndex||e&&c==-1;if(!f&&!a._updateFocusedRow(b)||!a._updateFocusedCell(b)){a._focusCell(c,d,false);a._focusCell(b.rowIndex,b.colIndex)}else f&&(c!=a._selectedRowIndex&&!e)&&a.cancelDataSheetEdit();a._skipNextInputListenerClickEvent();return}if(!g)a._skipNextInputListenerClickEvent();else if(!a._gridViewCellFocus(g,c,d))return;if(b!=null&&b.rowIndex==c&&b.colIndex==d&&!a.get_isEditing()&&!a.get_lookupField()){document.selection&&document.selection.clear();a._skipEditOnClick!=true&&a._allowEdit()&&a.editDataSheetRow(b.rowIndex)}else a._startInputListenerOnCell(c,d);a._skipEditOnClick=false},_startInputListenerOnCell:function(d,c){var a=this;a._startInputListener();a._focusCell(-1,-1,false);a._focusCell(d,c);if(!a.get_lookupField()){if(Web.DataView._activeDataSheetId!=a.get_id()){var b=$find(Web.DataView._activeDataSheetId);b&&b.cancelDataSheet();Web.DataView._activeDataSheetId=a.get_id()}a._lostFocus=false}},_startInputListener:function(){var a=this;a._stopInputListener();if(!a._inputListenerKeyDownHandler){a._inputListenerKeyDownHandler=Function.createDelegate(a,a._inputListenerKeyDown);a._inputListenerKeyPressHandler=Function.createDelegate(a,a._inputListenerKeyPress);a._inputListenerClickHandler=Function.createDelegate(a,a._inputListenerClick);a._inputListenerDblClickHandler=Function.createDelegate(a,a._inputListenerDblClick);a._focusedCell=null}$addHandler(document,"keydown",a._inputListenerKeyDownHandler);$addHandler(document,"keypress",a._inputListenerKeyPressHandler);$addHandler(document,"click",a._inputListenerClickHandler);$addHandler(document,"dblclick",a._inputListenerDblClickHandler);a._trackingInput=true},_stopInputListener:function(){var a=this;if(!a._trackingInput)return;$removeHandler(document,"keydown",a._inputListenerKeyDownHandler);$removeHandler(document,"keypress",a._inputListenerKeyPressHandler);$removeHandler(document,"click",a._inputListenerClickHandler);$removeHandler(document,"dblclick",a._inputListenerDblClickHandler);a._lostFocus=true;a._trackingInput=false},_allowEdit:function(){return this._findActionsByCommandName("Edit").length>0},_allowNew:function(){return this._findActionsByCommandName("New").length>0},get_interactiveActionGroups:function(){var b=this,a=b.get_actionGroups("Grid");Array.addRange(a,b.get_actionGroups("ActionBar"));Array.addRange(a,b.get_actionGroups("Form"));Array.addRange(a,b.get_actionGroups("ActionColumn"));return a},_findActionsByCommandName:function(f){for(var d=[],c=this.get_interactiveActionGroups(),a=0;a<c.length;a++){actions=c[a].Actions;for(var b=0;b<actions.length;b++){var e=actions[b];e.CommandName==f&&Array.add(d,e)}}return d},_inputListenerKeyPress:function(c){var a=this;if(c.rawEvent&&c.rawEvent.charCode==0)return;if(a._lostFocus)return;if(a.get_isEditing()){if(a._pendingChars)a._pendingChars+=String.fromCharCode(c.charCode);return}if(a._isBusy)return;var b=a._get_focusedCell();if(b==null)return;var d=a._fields[b.colIndex];if(d.ReadOnly)return;if(!a._allowEdit())return;a.executeRowCommand(b.rowIndex,"Select");if(!d.isReadOnly()){a._pendingChars=String.fromCharCode(c.charCode);a.editDataSheetRow(b.rowIndex)}},cancelDataSheet:function(){var a=this;if(a.get_isDataSheet()){a._focusCell(-1,-1,false);a._stopInputListener();a.set_ditto(null);Web.DataView._activeDataSheetId=null;a.cancelDataSheetEdit();a._lostFocus=false;a._focusedCell=null}},_inputListenerKeyDown:function(b){var d=true,h=false,g=null,a=this;if(a._lookupIsActive)return;if(a._lostFocus)return;if(Web.HoverMonitor._instance.get_isOpen())return;if(a._isBusy){if(a._pendingChars)return;b.preventDefault();b.stopPropagation();return}if(a._isBusy)return;var e=a._get_focusedCell();if(e==g)return;var c={rowIndex:e.rowIndex,colIndex:e.colIndex},f=h,k=h,i=a.get_pageSize();if(a._rows.length<i)i=a._rows.length;switch(b.keyCode){case 83:case Sys.UI.Key.enter:if(b.keyCode==83&&!b.ctrlKey)return;if(a.get_isEditing()){var l=b.target&&b.target.tagName;if((l=="TEXTAREA"||l=="A")&&!b.ctrlKey)return;f=d;a._updateFocusedRow(e);b.preventDefault();b.stopPropagation();return}if(b.ctrlKey&&!a.get_isEditing()||a.get_lookupField()){f=d;a.executeRowCommand(e.rowIndex,"Select")}else if(b.shiftKey){if(c.rowIndex>0)c.rowIndex--}else if(a._moveFocusToNextRow(c,i))f=d;break;case Sys.UI.Key.down:if(a.get_isEditing()||b.ctrlKey)return;if(a._moveFocusToNextRow(c,i))f=d;break;case Sys.UI.Key.up:if(a.get_isEditing()||b.ctrlKey)return;if(c.rowIndex>0)c.rowIndex--;else{if(a._pageOffset==0&&a.get_pageIndex()==0){a._pageOffset=g;f=d}else if(a._pageOffset==g){if(a.get_pageIndex()>0)a._pageOffset=-1}else a._pageOffset--;f=d;if(a._pageOffset==-i){a._pageOffset=g;a.get_pageIndex()>0&&a.goToPage(a.get_pageIndex()-1)}else a.goToPage(a.get_pageIndex())}break;case Sys.UI.Key.tab:case Sys.UI.Key.right:case Sys.UI.Key.left:var j=d;if((b.keyCode==Sys.UI.Key.right||b.keyCode==Sys.UI.Key.left)&&a.get_isEditing())return;if(!b.shiftKey&&b.target.parentNode.className=="Date")return;if(b.shiftKey&&b.target.id&&b.target.id.match(/\$Time\d+/))return;var m=a._pageOffset;if(b.shiftKey||b.keyCode==Sys.UI.Key.left){if(c.colIndex>0){c.colIndex--;if(b.keyCode==Sys.UI.Key.tab)while(c.colIndex>0&&a._fields[c.colIndex].isReadOnly())c.colIndex--}else if(a.get_isEditing())f=d}else if(c.colIndex<a._fields.length-1){c.colIndex++;if(b.keyCode==Sys.UI.Key.tab)while(c.colIndex<a._fields.length-1&&a._fields[c.colIndex].isReadOnly())c.colIndex++}else{if(a.get_isEditing()){if(!a._updateFocusedRow(e,b.keyCode==Sys.UI.Key.tab)){b.preventDefault();b.stopPropagation();return}else j=h;f=d}if(j&&a._moveFocusToNextRow(c,i))f=d;if(c.rowIndex!=e.rowIndex||a._pageOffset!=m){c.colIndex=0;f=h}}if(j&&a.get_isEditing())k=d;break;case Sys.UI.Key.home:if(a.get_isEditing())return;if(b.ctrlKey)if(a.get_pageIndex()>0){f=d;a._pageOffset=0;a.goToPage(0);e.rowIndex=0;e.colIndex=0}else{c.rowIndex=0;c.colIndex=0}else c.colIndex=0;break;case Sys.UI.Key.end:if(a.get_isEditing())return;if(b.ctrlKey){f=d;e.colIndex=a._fields.length-1;e.rowIndex=a._totalRowCount%a.get_pageSize()-1;if(e.rowIndex<0)e.rowIndex=a.get_pageSize();a._pageOffset=g;a.goToPage(a.get_pageCount()-1)}else c.colIndex=a._fields.length-1;break;case Sys.UI.Key.pageUp:if(a.get_isEditing())return;f=d;if(a.get_pageIndex()>0)a.goToPage(a.get_pageIndex()-1);else if(a._pageOffset!=g){a._pageOffset=g;a.goToPage(a.get_pageIndex())}break;case Sys.UI.Key.pageDown:if(a.get_isEditing())return;f=d;a.get_pageIndex()<a.get_pageCount()-1&&a.goToPage(a.get_pageIndex()+1);break;case Sys.UI.Key.esc:!a.cancelDataSheetEdit()&&a.cancelDataSheet();f=d;break;case Sys.UI.Key.del:if(a.get_isEditing()||b.shiftKey||b.altKey)return;f=d;if(b.ctrlKey)a.deleteDataSheetRow();else{a._pendingChars="";a.editDataSheetRow(e.rowIndex)}break;case 45:if(!a.get_isEditing()){f=d;a._allowNew()&&a.newDataSheetRow()}break;case 32:if(b.ctrlKey&&a.multiSelect()&&!a.get_isInserting()){f=d;a.toggleSelectedRow(e.rowIndex)}else return;break;case 113:if(a.get_isEditing())return;f=d;a._allowEdit()&&a.editDataSheetRow(e.rowIndex)}if((e.rowIndex!=c.rowIndex||e.colIndex!=c.colIndex)&&!f){a._focusCell(e.rowIndex,e.colIndex,h);a._focusCell(c.rowIndex,c.colIndex,d);f=d}if(f){b.preventDefault();b.stopPropagation()}if(k)if(!a._updateFocusedCell(e)){a._focusCell(c.rowIndex,c.colIndex,h);a._focusCell(e.rowIndex,e.colIndex,d)}},_updateFocusedCell:function(h){var b=this,d=b._collectFieldValues(),g=b._validateFieldValues(d,true,h),a=b._fields[h.colIndex];if(g){var f=true;if(a.Index<d.length&&d[a.Index].Modified)f=!b._performValueChanged(a.Index);f&&b.refresh(true)}else if(a.Behaviors)for(var e=0;e<a.Behaviors.length;e++){var c=a.Behaviors[e];if(AjaxControlToolkit.CalendarBehavior.isInstanceOfType(c)&&c.get_isOpen()){c.hide();c.show()}}return g},_updateFocusedRow:function(b,c){var a=this;Web.DataView.showMessage();a._syncFocusedCell=a.get_isInserting();a._lastFocusedCell=b;a._skipSync=true;a.executeRowCommand(b.rowIndex,a._syncFocusedCell?"Insert":"Update",null,true);if(a._valid)a._saveAndNew=c;return a._valid},_get_selectedDataRowIndex:function(b){var a=this;return a.get_pageIndex()*a.get_pageSize()+a.get_pageOffset()+(b!=null?b:a._selectedRowIndex)},executeActionInScope:function(j,l,i,a,m){var b=this;if(a==null)a=b._selectedRowIndex;for(var h=0;h<j.length;h++){var k=j[h],e=b.get_actionGroups(k);if(e)for(var d=0;d<e.length;d++){var f=e[d].Actions;if(f)for(var c=0;c<f.length;c++){var g=f[c];if(g.CommandName==l&&(String.isNullOrEmpty(i)||g.CommandArgument==i)&&b._isActionAvailable(g,a)){m!=true&&b.executeAction(k,c,a,d);return true}}}}return false},newDataSheetRow:function(){var a=this;setTimeout(function(){a.executeCommand({commandName:"New",commandArgument:a.get_viewId()})},100)},editDataSheetRow:function(a){this.get_isDataSheet()&&this.executeRowCommand(a,"Edit","",false)},deleteDataSheetRow:function(){var a=this._get_focusedCell();if(a){this.executeRowCommand(a.rowIndex,"Select");var b=this;setTimeout(function(){b.executeActionInScope(["Row","ActionBar"],"Delete",null,a.rowIndex)},100)}},_moveFocusToNextRow:function(b,d){var a=this,c=false,e=a._get_selectedDataRowIndex(b.rowIndex),f=a._pageOffset;if(b.rowIndex<d-1)b.rowIndex++;else if(a._get_selectedDataRowIndex(b.rowIndex)<a._totalRowCount-1){if(a._pageOffset==null)a._pageOffset=1;else a._pageOffset++;c=true;if(a._pageOffset==d){a._pageOffset=null;a.goToPage(a.get_pageIndex()+1)}else a.goToPage(a.get_pageIndex())}if(e==a._get_selectedDataRowIndex(b.rowIndex)&&!a.get_isEditing()&&a._allowNew()){a._ignoreSelectedKey=true;a.newDataSheetRow();c=true}return c},_scrollToRow:function(b){return;var a=this._get_focusedCell();if(a){a.rowIndex+=b>0?1:-1;this._moveFocusToNextRow(a,this.get_pageSize)}},cancelDataSheetEdit:function(){if(this.get_isEditing()){var a=this._get_focusedCell();a!=null&&this.executeRowCommand(a.rowIndex,"Cancel",null,false);return true}else return false},_inputListenerClick:function(h){var c=true,d=false,a=this;if(a._skipClickEvent){a._skipClickEvent=d;return}if(a._lookupIsActive)return;var b=h.target,f=d,e=d,g=c;while(b!=null){if(b==a._container){f=c;break}if(b.className!=null)if(b.className.match(/Cell|Group|InfoRow|FieldHeaderSelector|Toggle|FooterRow|ActionRow\s*/))e=c;else if(b.className.match(/QuickFind|SearchBarFrame\s*/))g=d;b=b.parentNode}if(!f)a.cancelDataSheet();else{if(g)a._lostFocus=!e;else a._lostFocus=c;a._skipEditOnClick=c;!e&&a.cancelDataSheetEdit()}},_inputListenerDblClick:function(){var a=this;if(a._lostFocus)return;var b=a._get_focusedCell();if(!b||a.get_isEditing()||!a._allowEdit())return;document.selection&&document.selection.clear();a.editDataSheetRow(b.rowIndex)},_get_focusedCell:function(){return this._focusedCell},_focusCell:function(h,d,r){var l="CrossHair",f=null,a=this;if(!a.get_isDataSheet()){a._focusedCell=f;return f}var u=a.get_isInserting();if(r==f)r=true;if(h==-1&&d==-1){if(!a._focusedCell)return f;h=a._focusedCell.rowIndex;d=a._focusedCell.colIndex}if(h>=a._rows.length)h=a._rows.length-1;if(d>=a._fields.length)d=a._fields.length-1;for(var s=a._container.childNodes[0].rows,k=-1,e=0;e<s.length;e++){var j=s[e];if(Sys.UI.DomElement.containsCssClass(j,"Row")||Sys.UI.DomElement.containsCssClass(j,"AlternatingRow"))k++;if(u){if(Sys.UI.DomElement.containsCssClass(j,"Inserting"))break}else if(k==h)break}if(k<0)return f;var o=-1;for(e=0;e<j.childNodes.length;e++){var b=j.childNodes[e+a.get_sysColCount()];if(b&&Sys.UI.DomElement.containsCssClass(b,"Cell"))o++;if(o==d)break}if(o<0)return f;var t=b.parentNode.childNodes[a.get_sysColCount()-1],q=a._get_headerRowElement(),g=q.childNodes[d+a.get_sysColCount()];if(r==true){var n=$common.getBounds(g);Sys.UI.DomElement.addCssClass(b,"Focused");Sys.UI.DomElement.addCssClass(t,l);Sys.UI.DomElement.addCssClass(g,l);if(!a._skipCellFocus){var i=$appfactory.scrolling(),p=$common.getClientBounds(),c=$common.getBounds(b);if(i.y>c.y)(k==0?g:b).scrollIntoView(true);else if(i.y+p.height<=c.y+c.height)b.scrollIntoView(false);else(i.x>c.x||i.x+p.width-1<=c.x||i.x+p.width-1<=c.x+c.width)&&b.scrollIntoView(false);if(Sys.Browser.agent==Sys.Browser.InternetExplorer){var v=$common.getBounds(q);q.style.height=v.height+"px"}}var m=$common.getBounds(g);(n.width!=m.width||n.x!=m.x||n.y!=m.y)&&Sys.UI.DomElement.addCssClass(g,"Narrow");a._skipCellFocus=false}else{Sys.UI.DomElement.removeCssClass(b,"Focused");Sys.UI.DomElement.removeCssClass(b,"Narrow");Sys.UI.DomElement.removeCssClass(t,l);Sys.UI.DomElement.removeCssClass(g,l)}a._focusedCell={rowIndex:h,colIndex:d};return b},_initializeModalPopup:function(){var a=this;Sys.UI.DomElement.addCssClass(a.get_element(),"ModalPlaceholder");var e=$common.getClientBounds(),c=e.width/5*4,d=Web.DataViewResources.ModalPopup.MaxWidth,b=a.get_confirmContext();if(b&&b.MaxWidth>0&&b.MaxWidth<c)d=b.MaxWidth;if(c>d)c=d;var f=e.height/5*4;if(a._container.style.overflowX!=null){a._container.style.overflowY="auto";a._container.style.overflowX="hidden"}else a._container.style.overflow="auto";a._container.style.height=f+"px";a._container.style.width=c+"px";a._saveTabIndexes();a._modalPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:a.get_id()+"ModalPopup"+Sys.Application.getComponents().length,PopupControlID:a.get_element().id,DropShadow:true,BackgroundCssClass:"ModalBackground"},null,null,a.get_modalAnchor());a._modalPopup.show()},_resizeContainerBounds:function(){var a=this;if(!a._modalPopup)a._container.style.height="";var b=$common.getBounds(a._container),d=$common.getClientBounds(),c=Math.ceil(d.height/5*4);if(b.height>c){a._container.style.height=c+"px";b.skipResizing=true}return b},_adjustModalPopupSize:function(){var g=true,b="px",a=this,h=a.get_confirmContext();Sys.UI.DomElement.removeCssClass(a._element,"EmptyModalDialog");for(var d=new Sys.StringBuilder,c=[],n=a._container.getElementsByTagName("table"),k=n.length-1;k>=0;k--){var l=n[k];if(l.className=="ActionButtons"){if(d.isEmpty()){d.append('<table class="DataView" cellSpacing=0 cellPadding=0><tr class="ActionButtonsRow BottomButtonsRow">');d.append(l.parentNode.parentNode.innerHTML);d.append("</tr></table>")}Array.add(c,l.parentNode.parentNode)}}while(c.length>0){c[0].parentNode.removeChild(c[0]);delete c[0];Array.removeAt(c,0)}var e=a._container.childNodes[0];e.style.width="";e.style.height="";var f=$common.getContentSize(e);f.height+=Sys.Browser.agent===Sys.Browser.InternetExplorer&&Sys.Browser.version<8?3:1;if(!a._buttons){a._buttons=document.createElement("div");a.get_element().appendChild(a._buttons);a._buttons.style.width=f.width+b;Sys.UI.DomElement.addCssClass(a._buttons,"FixedButtons");a._title=document.createElement("div");Sys.UI.DomElement.addCssClass(a._title,"FixedTitle");a.get_element().insertBefore(a._title,a._container);!__designer()&&$(a._element).draggable({handle:a._title,drag:function(h,b){var a=$(window),f=a.width(),e=a.height(),c=b.offset.left-a.scrollLeft(),d=b.offset.top-a.scrollTop(),g=b.helper.outerWidth();if(c+g<50||d<5||c>f-50||d>e-75)return false}})}else if(!a._modalAutoSized){a._container.style.width="auto";a._modalAutoSized=g}a._buttons.innerHTML=d.toString();d.clear();var m=a._resizeContainerBounds();if(m.height>f.height&&!m.skipResizing){var p=$common.getBorderBox(e);f.width+=p.horizontal;$common.setContentSize(a._container,f)}e.style.width=a._title.offsetWidth+b;a._buttons.style.width=a._title.offsetWidth+b;Sys.UI.DomElement.setVisible(a.get_element(),g);var o=$common.getBounds(a._container),j=$common.getPaddingBox(a._title),i=$common.getBorderBox(a._title);a._title.style.width=o.width-j.horizontal-i.horizontal+b;j=$common.getPaddingBox(a._buttons);i=$common.getBorderBox(a._buttons);a._buttons.style.width=o.width-j.horizontal-i.horizontal+b;a._title.innerHTML=String.format('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td><div class="Text">{1}</div></td><td align="right"><a href="javascript:" class="Close" onclick="$find(\'{0}\').endModalState(\'Cancel\');return false" tabindex="{3}" title="{2}">&nbsp;</a></td></tr></table>',a.get_id(),h&&h.WindowTitle?h.WindowTitle:Web.DataView.htmlEncode(a.get_view().Label),Web.DataViewResources.ModalPopup.Close,$nextTabIndex());a._modalPopup.show();if(a._modalAutoSized&&!a._modalWidthFixed){a._modalWidthFixed=g;a._container.style.width=a._container.offsetWidth+b}a._adjustModalHeight(g)},_adjustModalHeight:function(l){var b=this,a=b._container;if(b._modalPopup&&b.get_viewType()=="Form")if(l){var c=$common.getBounds(a);b._lastContainerHeight=c.height}else if(b._lastContainerHeight!=null){var h=a.style.height,j=a.scrollTop;a.style.height="";for(var d=null,f=a.getElementsByTagName("tr"),e=0;e<f.length;e++)if(f[e].className=="Categories"){d=f[e].childNodes[0];break}if(d)d.style.paddingBottom="";c=$common.getBounds(a);if(b._lastContainerHeight>c.height){var k=$common.getPaddingBox(d);if(d){var g=b._lastContainerHeight-c.height-k.bottom;if(Sys.Browser.agent==Sys.Browser.InternetExplorer)g++;d.style.paddingBottom=g+"px"}}else{var i=$common.getClientBounds();if(i.height*.8<=c.height){a.style.height=h;a.scrollTop=j}else b._lastContainerHeight=c.height}}},_allowModalAutoSize:function(){this._modalWidthFixed=false;this._modalAutoSized=false},_disposeModalPopup:function(){var a=this;if(!a._modalPopup)return;a._modalPopup.hide();a._modalPopup.dispose();!__designer()&&$(a._element).draggable("destroy");delete a._buttons;delete a._title;delete a._modalAnchor;var b=a.get_element();b.parentNode.removeChild(b);a._restoreTabIndexes()},endModalState:function(f){var b=this,a=b.get_parentDataView(),e=Web.HoverMonitor._instance;if(b.get_isModal()){var c=b.get_exitModalStateCommands();if(c)for(var d=0;d<c.length;d++)if(f==c[d]){if(a){a._lookupIsActive=false;a._skipClickEvent=true}if($appfactory.mobile)$appfactory.mobile.endModalState(a,b);else b.dispose();return true}}if(a&&!b.get_confirmContext())!$appfactory.mobile&&a.refresh();e&&e.close();return false},_adjustLookupSize:function(){var a=this;if(a.get_lookupField()&&a.get_pageSize()>3){var d=$appfactory.scrolling(),c=$common.getClientBounds(),b=$common.getBounds(a.get_element());b.height+b.y>c.height+d.y&&a.set_pageSize(Math.ceil(a.get_pageSize()*.66))}},_onMethodFailed:function(b){var a=this;a._busy(false);if(Web.DataView._navigated)return;if(a._wsRequest==null)return;Web.DataView.showMessage(String.format('<pre style="word-wrap:break-word;margin:0px">Component: {4}\r\nController: {5}; View: {6}; Timed out: {0}; Status Code: {7};\r\nException: {1}\r\nMessage: {2}\r\nStack:\r\n{3}</pre>',b.get_timedOut(),b.get_exceptionType(),b.get_message(),b.get_stackTrace(),a.get_id(),a.get_controller(),a.get_viewId(),b.get_statusCode()));a.get_element().style.border="1px red solid"},_createArgsForListOfValues:function(e){var c=null,a=this,b=a.get_lookupContext(),d=a._searchBarVisibleIndex==c?a.get_filter():a._createSearchBarFilter(true),f={FieldName:e,Controller:a.get_controller(),View:a.get_viewId(),Filter:d.length==1&&d[0].match(/(\w+):/)[1]==e?c:d,ExternalFilter:a.get_externalFilter(),LookupContextFieldName:b?b.FieldName:c,LookupContextController:b?b.Controller:c,LookupContextView:b?b.View:c,Tag:a.get_tag()};a._useSearchParams(f);return{controller:a.get_controller(),view:a.get_viewId(),request:f}},_loadListOfValues:function(d,c,b){var a=this;a._busy(true);a._invoke("GetListOfValues",a._createArgsForListOfValues(b),Function.createDelegate(a,a._onGetListOfValuesComplete),{family:d,fieldName:c})},_onGetListOfValuesComplete:function(a,c){var b=this;b._busy(false);var d=b.findField(c.fieldName);d._listOfValues=a;if(a[a.length-1]==null){Array.insert(a,0,a[a.length-1]);Array.removeAt(a,a.length-1)}if(b.get_isChart()){if(b.get_showViewSelector())b._registerViewSelectorItems();else b._registerActionBarItems();Web.HoverMonitor._instance._tempOpenDelay=100}else b._registerFieldHeaderItems(Array.indexOf(b.get_fields(),d));$refreshHoverMenu(c.family);Web.DataView._resized=true},get_parentDataView:function(b){var a=b;if(!String.isNullOrEmpty(this._parentDataViewId))a=$find(this._parentDataViewId);return a},get_selectedValues:function(){var b=this.get_parentDataView(this),a=b.get_selectedValue();return a.length==0?[]:!b.multiSelect()?[a]:a.split(";")},_execute:function(b){var a=this;a._busy(true);a._showWait();a._lastArgs=b;a._invoke("Execute",{controller:b.Controller,view:b.View,args:b},Function.createDelegate(a,a._onExecuteComplete))},_populateDynamicLookups:function(c){var a=this;for(var b=0;b<c.Values.length;b++){var e=c.Values[b],d=a.findField(e.Name);if(d)d.DynamicItems=e.NewValue}a._skipPopulateDynamicLookups=true;a.refresh(true);a._focus()},_updateCalculatedFields:function(a){this._displayActionErrors(a);for(var c=[],b=0;b<a.Values.length;b++){var d=a.Values[b];Array.add(c,{name:d.Name,value:d.NewValue})}this.refresh(true,c);this._focus()},_get_LEVs:function(){for(var b=0;b<Web.DataView.LEVs.length;b++){var a=Web.DataView.LEVs[b];if(a.controller==this.get_controller())return a.records}a={controller:this.get_controller(),records:[]};Array.add(Web.DataView.LEVs,a);return a.records},_recordLEVs:function(a){var b=this;if(!b._allowLEVs||!a&&!b._lastArgs.CommandName.match(/Insert|Update/))return;if(!(b._lastArgs||a))return;if(!a)a=b._lastArgs.Values;for(var c=b._get_LEVs(),e=true,d=0;d<a.length;d++)if(a[d].Modified){e=false;break}if(e)return;c.length>0&&Array.removeAt(c,c.length-1);Array.insert(c,0,a)},_applyLEV:function(g){var a=this;for(var e=a._allFields[g],h=a._allFields[e.AliasIndex],d=[],f=a._get_LEVs()[0],c=0;c<f.length;c++){var b=f[c];(b.Name==e.Name||b.Name==h.Name)&&Array.add(d,{name:b.Name,value:b.NewValue})}a.refresh(true,d)},_notifyMaster:function(){if(this.get_hasParent()){var a=$find(this.get_filterSource());a&&a._updateDynamicValues(this.get_controller())}},_clearSelectedKey:function(c){var b=this,a=b._lookupInfo?b:b.get_parentDataView(b);a._selectedKey=[];a._selectedKeyFilter=[];a._selectedRowIndex=null;a._position=null;if(c!=false)a._raiseSelectedDelayed=true;a._selectedRow=null},_refreshSelectedKey:function(c){var a=this;if(c.length==0&&a._lastArgs)c=a._lastArgs.Values;for(var e=[],i=[],j=false,g=0;g<a._keyFields.length;g++)for(var f=a._keyFields[g],d=0;d<c.length;d++)if(c[d].Name==f.Name){var h=c[d];if(h.NewValue==null){a._clearSelectedKey();return}Array.add(e,h.NewValue);Array.add(i,f.Name+":="+a.convertFieldValueToString(f,h.NewValue));break}var b=a.get_parentDataView();if(!b)b=a;if(e.length>0){b._selectedKey=e;b._selectedKeyFilter=i;b._raiseSelectedDelayed=true}},_cancelConfirmation:function(){if(this._confirmDataViewId){var a=$find(this._confirmDataViewId);if(a){this._confirmDataViewId=null;a.cancel()}}},_findKeyValue:function(b){for(var d=this._keyFields[0],a=0;a<b.length;a++){var c=b[a];if(d.Name==c.Name)return c.NewValue}return null},_onExecuteComplete:function(b,w){var g=true,f=null,h=false,a=this,x=$appfactory.mobile,c=a._lastArgs.CommandName;a._busy(h);a._hideWait();var j=b.Errors.length==0,k=a._pendingUploads;if(k&&k.length>0&&j&&c=="Insert"&&b.RowsAffected==1){var o=k[0];Array.removeAt(k,0);var q=a._findKeyValue(b.Values);if(q==f)q=a._findKeyValue(a._lastArgs.Values);o.form.action=o.form.action.replace(/=u\|&/,String.format("=u|{0}&",q));a._pendingExecuteComplete={result:b,context:w};a._showDownloadProgress();o.form.submit();return}var m=a._lastFocusedCell;if(c=="PopulateDynamicLookups"){a._populateDynamicLookups(b);return}else if(c=="Calculate"){a._updateCalculatedFields(b);if(!String.isNullOrEmpty(b.ClientScript))eval(b.ClientScript);return}var n=h,u=c=="Custom";j&&a._cancelConfirmation();var z={result:b,context:w,handled:h};a.raiseExecuted(z);if(z.handled)return;var t=!c.match(/Insert/);if(c.match(/Delete/i)&&b.RowsAffected>0)a._clearSelectedKey();else if(c.match(/Custom|SQL|Email/)){n=!u&&a.get_isEditing();if(b.Values.length>0){a.refresh(g,b.Values);if(u&&!b.ClientScript)b.ClientScript="void(0)";a._refreshSelectedKey(b.Values,j)}else if(!n&&c=="SQL"){a._raiseSelectedDelayed=g;a._forceChanged=g}}else if(t)for(var i=0;i<b.Values.length;i++){var A=b.Values[i],y=a.findField(A.Name);if(y)a.get_currentRow()[y.Index]=A.NewValue}else a._refreshSelectedKey(b.Values,j);if(j){a._forceSync();var s=a.get_parentDataView();s&&s._forceSync();a.set_tag(b.Tag);a._requestedFilter=b.Filter;a._requestedSortExpression=b.SortExpression;a._autoRefresh();if(a.multiSelect()){a._selectedKeyList=[];a.set_selectedValue("")}a._recordLEVs();a.updateSummary();a._continueAfterScript=g;if(b.ClientScript){a._continueAfterScript=h;b.ClientScript=a.resolveClientUrl(b.ClientScript);eval(b.ClientScript)}a._lastFocusedCell=f;var l=a._lastArgs.CommandArgument,p=new Web.BusinessRules(a);p.after({commandName:c,commandArgument:l});if(p.canceled())a._continueAfterScript=h;p.dispose();if(a._continueAfterScript){if(b.NavigateUrl){b.NavigateUrl=a.resolveClientUrl(b.NavigateUrl);a.navigate(b.NavigateUrl,t?a._lastArgs.Values:b.Values)}else if(!a._closeInstantDetails())if(!a.endModalState(c))if(a.get_backOnCancel()||!String.isNullOrEmpty(a._replaceTriggerViewId))a.goBack(g);else{a._notifyDesigner(g);var v=a.get_actions(a._get_lastActionScope(),g);for(i=0;i<v.length;i++){var e=v[i];if(e.WhenLastCommandName==c&&(e.WhenLastCommandArgument==""||e.WhenLastCommandArgument==l)&&a._isActionMatched(e)){var d=a,B=d._lastArgs.Values;function r(){d.set_lastCommandName(c);d.set_lastCommandArgument(l);d.executeCommand({commandName:e.CommandName,commandArgument:e.CommandArgument,path:e.Path,causesValidation:e.CausesValidation,values:c.match(/Insert|Custom/)?B:f});d._pendingSelectedEvent=e.CommandName.match(/^(Edit|Select)/)!=f;d._notifyMaster()}if(x&&d._parentDataViewId){d=$appfactory.find(a._parentDataViewId);x.endModalState(d,a,r)}else r();return}}if(!n){a._pendingSelectedEvent=c.match(/Update|Custom|SQL/);a.set_lastCommandName(f);if(a.get_isModal()&&(!a.get_isForm(a._lastViewId)||a._closeViewDetails))a.endModalState("Cancel");else a.goToView(a._lastViewId)}}a._notifyMaster()}}else{if(m){a._focusCell(-1,-1,h);a._focusCell(m.rowIndex,m.colIndex,g);a._lastFocusedCell=f;a._saveAndNew=h}if(b.ClientScript){b.ClientScript=a.resolveClientUrl(b.ClientScript);eval(b.ClientScript)}a._displayActionErrors(b)}},_get_lastActionScope:function(){var a=this,e=a._lastArgs?a._lastArgs.Path:null;if(e){var g=e.match(/^(\w+)\//);if(g)for(var d=a._actionGroups,c=0;c<d.length;c++){var f=d[c];if(f.Id==g[1])return f.Scope}}var b=a.get_viewType();if(b.match(/DataSheet|Tree/))b="Grid";return b},_displayActionErrors:function(a){if(a.Errors.length==0)return;var b=new Sys.StringBuilder;for(i=0;i<a.Errors.length;i++)b.append(Web.DataView.formatMessage("Attention",a.Errors[i]));Web.DataView.showMessage(b.toString());b.clear()},_busy:function(j){var p="dataview-loading",o=".dataview-loaded",f=null,i=this;if(j==f)return i._isBusy;i._isBusy=j;i._enableButtons(!j);if($appfactory.isSaaS())return;var d=i,a=$appfactory.mobile,l=d._busyInterval,c=!a&&(d.get_isModal()||d.get_lookupField()!=f||!i._controller)||a,r=a?a.toolbar():c?document.body:d._container,h=$(r),k=$(d._container);if(a&&!a.toolbar().is(":visible")){a.wait(j);return}if(j&&!l){!a&&!k.is(o)&&k.addClass(p);!c;var g=h.outerWidth()/5;if(g>200)g=200;var b=d._$busy=$(String.format('<div class="dataview-busy-indicator{0}"></div>',c?" modal":"")).css({position:a?"fixed":"absolute",width:g,"z-index":c?a?1e3:3e6:0}).appendTo(document.body),e=-g,q=c?0:b.height();b.hide();var m=0,u=false,n;i._busyInterval=setInterval(function(){var i="left top";if(m!=f)if(m++>(a?35:75)){m=f;n=true}else return;e+=Math.ceil(g/30);if(n){b.show();n=false}if(e>=0){var d=h.outerWidth();if(e>=d-g&&e<d)b.width(d-e);else if(e>=d)e=-g;var j=h.scrollTop();b.position({my:i,at:String.format("left+{0} top{1}{2}",e,c?"+":"-",c?$(window).scrollTop():q),of:h})}else{b.width(g+e);b.position({my:i,at:String.format("left top{0}{1}",c?"+":"-",c?$(window).scrollTop():q),of:h})}},1e3/60)}else if(l){!a&&!k.is(o)&&k.removeClass(p).addClass("dataview-loaded");clearInterval(l);d._busyInterval=f;b=d._$busy;if(b){var t=b.offset(),s=h.offset();d._$busy=f;b.width(h.outerWidth()-(t.left-s.left));setTimeout(function(){b.remove()},500)}}},_enableButtons:function(a){if($appfactory.mobile)return;var b=$("button",this._element).each(function(){$(this).toggleClass("disabled",!a)})},_bodyKeydown:function(b){var a=this,c=false;if(a._customFilterField){if(b.keyCode==Sys.UI.Key.enter){c=true;a.applyCustomFilter()}else if(b.keyCode==Sys.UI.Key.esc){c=true;a.closeCustomFilter()}}else if(a.get_lookupField())if(b.keyCode==Sys.UI.Key.esc){c=true;a.hideLookup()}if(c){b.preventDefault();b.stopPropagation()}},_prepareJavaScriptExpressionEx:function(a){return a.replace(/\[((\w+)\.)?(\w+)\]/g,"this.fieldValue('$3','$2')")},_evaluateVisibility:function(){var a=this.get_visibleWhen();if(String.isNullOrEmpty(a))return true;a=this._prepareJavaScriptExpressionEx(a);return eval(a)!=false},_filterSourceSelected:function(c,s,m){var g=true,e=false,a=this;a._hidden=!a._evaluateVisibility();var f=a.readContext("vitals");if(f){var b=0;while(b<f.Filter.length){var k=f.Filter[b],r=k.substring(0,k.indexOf(":")),p=e;if(a._keyFields)for(var h=0;h<a._keyFields.length;h++)if(a._keyFields[h].Name==r){p=g;break}if(p)Array.removeAt(f.Filter,b);else b++}a.writeContext("vitals",f)}var o=[];for(b=0;b<a._externalFilter.length;b++){Array.add(o,a._externalFilter[b].Value);a._externalFilter[b].Value=null}var n=e,l=e;if(Web.DataView.isInstanceOfType(c)){!String.isNullOrEmpty(a._transaction)&&a.set_transaction(c.get_transaction());a._populateExternalViewFilter(c);n=!c.get_showDetailsInListMode()&&c.get_isGrid();if(c._forceChanged)l=g}else if(a._externalFilter.length>0)a._externalFilter[0].Value=c.target.value;a.applyExternalFilter();var j=g,i=e;for(b=0;b<a._externalFilter.length;b++){var q=a._externalFilter[b].Value;if(q!=null)j=e;if(q!=o[b])i=g}a.get_autoHide()!=Web.AutoHideMode.Nothing&&a._updateLayoutContainerVisibility(!j&&!n&&!a._hidden);if(i||l){!m&&a.set_pageIndex(-1);var d=a._position;if(d){d.index=0;d.count=-1;d.key=[];d.keyFilter=[];d.filter=a.get_filter()}if(!m){a._selectedKey=[];a._selectedKeyFilter=[]}a._clearCache();a.loadPage()}a.raiseSelected();a.updateSummary()},_createExternalFilter:function(){var a=this;a._externalFilter=[];var d=/(\w+)(,|$)/g;if(a.get_filterFields())for(var c=a.get_filterFields().split(Web.DataView._simpleListRegex),b=0;b<c.length;b++)Array.add(a._externalFilter,{Name:c[b],Value:null})},_populateExternalViewFilter:function(a){if(!(a._selectedKey&&a._keyFields&&a._selectedKey.length==a._keyFields.length))return;for(var e=0;e<this._externalFilter.length;e++){for(var c=this._externalFilter[e],f=false,b=0;b<a._keyFields.length;b++){var d=a._keyFields[b];if(c.Name==d.Name){c.Value=a.convertFieldValueToString(d,a._selectedKey[b]);f=true;break}}if(!f&&this.get_controller()!=a.get_controller())for(b=0;b<a._allFields.length;b++){d=a._allFields[b];if(c.Name==d.Name){c.Value=a.convertFieldValueToString(d,a.get_selectedRow()[a._allFields[b].Index]);f=true;break}}if(!f&&a._selectedKey.length>=e)c.Value=a._selectedKey[e]}},_cloneChangedRow:function(){var a=this;if(a.get_isEditing()){for(var e=a._collectFieldValues(),d=a.get_currentRow(),f=d?Array.clone(d):null,h=__designer(),c=0;c<e.length;c++){var b=e[c],g=a.findField(b.Name);if(g)f[g.Index]=h?b.Modified?b.NewValue:b.OldValue:b.NewValue}return f}else return a.get_selectedRow()},_updateVisibility:function(h){var w="$ActionButtons$",l=null,f=true,g=false,a=this;if(!a._expressions)return;a._readOnlyChanged=g;var y=a.get_isForm(),m=[];if(!h)h=a._cloneChangedRow();if(!h)return;for(var n=g,x=g,e=0;e<a._expressions.length;e++){var j=m[0]=a._expressions[e];if(j.Type==Web.DynamicExpressionType.ClientScript)if(j.Scope==Web.DynamicExpressionScope.DataFieldVisibility){var b=a.findField(j.Target);if(b){var c=a._get(y?"_ItemContainer":"Item",b.Index);if(c){var i=a._evaluateJavaScriptExpressions(m,h,g);if(y){var q=Sys.UI.DomElement.getVisible(c);if(Sys.UI.DomElement.containsCssClass(c.parentNode,"FieldPlaceholder"))c=c.parentNode;else if(Sys.UI.DomElement.containsCssClass(c.parentNode.parentNode,"FieldWrapper"))c=c.parentNode.parentNode.parentNode.parentNode;Sys.UI.DomElement.setVisible(c,i==f);if(q!=i)n=f}}}}else if(j.Scope==Web.DynamicExpressionScope.CategoryVisibility){var d=a.findCategory(j.Target);if(d){c=a._get("_Category",d.Index);if(c){d.IsVisible=a._evaluateJavaScriptExpressions(m,h,g);i=d.IsVisible&&(String.isNullOrEmpty(d.Tab)||d.Tab==a._get_selectedTab());q=Sys.UI.DomElement.getVisible(c);Sys.UI.DomElement.setVisible(c,i==f);if(q!=i)n=f;var o=a._get("$CategoryDescription$",d.Index);if(o){var u=a._processTemplatedText(h,d.Description);o.innerHTML=u;o.style.display=String.isNullOrEmpty(u)?"none":"block"}if(!String.isNullOrEmpty(d.Tab))x=f}}}else if(j.Scope==Web.DynamicExpressionScope.ReadOnly){b=a.findField(j.Target);if(b){if(b.OriginalTextMode==l)b.OriginalTextMode=b.TextMode;var C=b.isReadOnly();i=a._evaluateJavaScriptExpressions(m,h,g);b.TextMode=i==f?4:b.OriginalTextMode;if(i!=C){n=f;a._readOnlyChanged=f}}}}if(x)for(e=0;e<a._tabs.length;e++){for(var D=a._tabs[e],t=g,p=g,s=0;s<a._categories.length;s++){d=a._categories[s];if(d.Tab==D&&d.IsVisible!=l){t=f;p=d.IsVisible;if(p)break}}t&&Sys.UI.DomElement.setVisible(a._get("_Tab",e),p)}if(a._dynamicActionButtons){a._clonedRow=h;var B=a._get(w,"Top");if(B){var k=new Sys.StringBuilder;a._internalRenderActionButtons(k,"Top",a._lastActionButtonsScope);a._newTopActionButtons=k.toString();k.clear()}var A=a._get(w,"Bottom");if(A){k=new Sys.StringBuilder;a._internalRenderActionButtons(k,"Bottom",a._lastActionButtonsScope);a._newBottomActionButtons=k.toString();k.clear()}var r=a;setTimeout(function(){r._refreshActionButtons()},500);a._clonedRow=l}a._updateStatusBar();if(n){a._adjustModalHeight();a._modalPopup&&a._modalPopup.show();_body_performResize()}if(a.get_isEditing()&&!a._lookupIsActive){var z=a._get_focusedCell();for(e=0;e<a._fields.length;e++){b=a._fields[e];if(!b.ReadOnly&&!b.Hidden&&b.AutoSelect&&b.ItemsStyle=="Lookup"&&(z==l||z.colIndex==b.ColIndex)){b.AutoSelect=g;v=h[b.Index];if(v==l){a._lookupIsActive=f;r=a;setTimeout(function(){r.showLookup(b.Index)},100);break}}}}},_refreshActionButtons:function(){var d="$ActionButtons$",a=this,c=a._get(d,"Top");if(c&&a._newTopActionButtons){c.innerHTML=a._newTopActionButtons;a._newTopActionButtons=null}var b=a._get(d,"Bottom");if(b&&a._newBottomActionButtons){b.innerHTML=a._newBottomActionButtons;a._newBottomActionButtons=null}},_updateDynamicValues:function(b){var e=true,a=this;for(var d=false,h=a._allFields,i=b&&b.Name?b.Name:b,g=0;g<h.length;g++){var c=h[g],k=!String.isNullOrEmpty(c.ContextFields);if(k){var j=/\s*(\w+)\s*(=\s*(\w+)\s*)?(,|$)/g,f=j.exec(c.ContextFields);while(f){if(c.ItemsAreDynamic&&(b==null||f[3]==i)){if(!a.get_isEditing()){a.refresh();return e}a._raisePopulateDynamicLookups();d=e}else if(c.Calculated&&f[1]==i){if(!a.get_isEditing()){a.refresh();return e}a._raiseCalculate(c,b);d=e}if(d)break;f=j.exec(c.ContextFields)}if(d)break}}return d},_valueFocused:function(a){var b=this._allFields[a];this._focusedFieldName=b.Name;Web.DataView._focusedDataViewId=this._id;Web.DataView._focusedItemIndex=a},_resetContextLookupValues:function(c){var a=[],d=[];this._enumerateContextFieldValues(c,a,d);var b=a.length>0;b&&this.refresh(true,a);return b},_enumerateContextFieldValues:function(k,e,f){for(var j=k.Name,d=this._allFields,b=0;b<d.length;b++){var a=d[b],c=a.ContextFields;if(!String.isNullOrEmpty(c)&&!f[b]&&!String.isNullOrEmpty(a.ItemsStyle)){var i=/\s*(\w+)\s*(=\s*(\w+)\s*)?(,|$)/g,g=i.exec(c);while(g){if(g[1]==j){f[b]=true;Array.add(e,{name:a.Name,value:null});var h=d[a.AliasIndex];h!=a&&Array.add(e,{name:h.Name,value:null});a.DynamicItems=null;this._enumerateContextFieldValues(a,e,f)}g=i.exec(c)}}}},_copyStaticLookupValues:function(a){if(!String.isNullOrEmpty(a.Copy)&&(a.ItemsStyle=="RadioButtonList"||a.ItemsStyle=="ListBox"||a.ItemsStyle=="DropDownList")){var j=this._collectFieldValues(),b=j[a.Index].NewValue;if(b!=null&&typeof b!="string")b=b.toString();for(var d=null,e=0;e<a.Items.length;e++){var i=a.Items[e],c=i[0];if(c!=null&&typeof c!="string")c=c.toString();if(c==b){d=i;break}}if(d){var h=[],g=/(\w+)=(\w+)/g,k=2,f=g.exec(a.Copy);while(f){Array.add(h,{name:f[1],value:d[k++]});f=g.exec(a.Copy)}this.refresh(true,h);return true}}return false},_replaceFieldValue:function(a){for(var d=this._enumerateExpressions(Web.DynamicExpressionType.RegularExpression,Web.DynamicExpressionScope.Field,a.Name),c=0;c<d.length;c++){var b=d[c];try{if(b.Result.match(/\$(\d|\'\`)/)){var h=this._collectFieldValues(),g=h[a.Index],f=g.NewValue?g.NewValue.toString():null,j=new RegExp(b.Test),e=f.replace(j,b.Result);if(e!=f){var i=[{name:a.Name,value:e}];this.refresh(true,i)}}}catch(k){}}},_valueChanged:function(b){var a=this,c=a._allFields[b];a._showFieldError(c,null);a._skipErrorReset=false;var d=a;setTimeout(function(){!Web.DataView._navigated&&d._performValueChanged(b,true)},200)},_performValueChanged:function(d,c){var a=this,b=a._allFields[d];if(!b)return;if(a._skipErrorReset){a._skipErrorReset=false;return}else a._showFieldError(b,null);a._replaceFieldValue(b);var g=a._resetContextLookupValues(b),e=a._copyStaticLookupValues(b);a._updateVisibility();var f=a._updateDynamicValues(b);if(c&&a._readOnlyChanged&&a.get_isEditing()){a.refresh(true);a._focus()}return e||f||g||a._readOnlyChanged},_quickFind_focus:function(){var a=this.get_quickFindElement();if(a.value==Web.DataViewResources.Grid.QuickFindText)a.value="";Sys.UI.DomElement.removeCssClass(a,"Empty");Sys.UI.DomElement.removeCssClass(a,"NonEmpty");a.select();this._lostFocus=true},_quickFind_blur:function(){var a=this.get_quickFindElement();if(String.isBlank(a.value)){a.value=Web.DataViewResources.Grid.QuickFindText;Sys.UI.DomElement.addCssClass(a,"Empty")}else Sys.UI.DomElement.addCssClass(a,"NonEmpty");this._lostFocus=false},_executeQuickFind:function(d){var a=this;a._forceSync();for(var b=0;b<a._allFields.length;b++)a._allFields[b]._listOfValues=null;for(b=0;b<a._allFields.length;b++){var c=a._allFields[b];if(!c.Hidden){c=a._allFields[c.AliasIndex];if(String.isNullOrEmpty(d)){a.removeFromFilter(c);a.refreshData()}else a.applyFilter(c,"~",d);break}}},quickFind:function(b){var a=this,d=(String.isNullOrEmpty(b)?a.get_quickFindElement().value:b).match(/^\s*(.*?)\s*$/),c=d[1]==Web.DataViewResources.Grid.QuickFindText?"":d[1];a.set_quickFindText(c);a._executeQuickFind(c);a._lostFocus=false},_quickFind_keydown:function(b){var a=this;if(b.keyCode==Sys.UI.Key.enter){b.preventDefault();b.stopPropagation();a.quickFind()}else if(b.keyCode==Sys.UI.Key.down){return;if(a.get_isDataSheet()&&a._totalRowCount>0){b.preventDefault();b.stopPropagation();if(!a._get_focusedCell())a._startInputListenerOnCell(0,0);else a._lostFocus=false;var c=a._focusCell(-1,-1,true);c.focus()}}},encodePermalink:function(d,c,b){var a=this;Sys.Net.WebServiceProxy.invoke(a.get_servicePath(),"EncodePermalink",false,{link:d,rooted:false},Function.createDelegate(a,a._encodePermalink_Success),Function.createDelegate(a,a._onMethodFailed),{target:c,features:b})},_encodePermalink_Success:function(b,a){if(a.target||a.features)open(b,a.target,a.features);else location.href=b},showViewMessage:function(c){var a=this,e=a._get("$HeaderText");if(e!=null&&c){var d=String.format('<div class="MsgBox">{1} <a href="javascript:" onclick="$find(\'{0}\').hideViewMessage();return false;" class="Close" title="{2}">&nbsp;</a></div>',a.get_id(),c,Web.DataViewResources.ModalPopup.Close),b=a.get_view();if(!b.OriginalHeaderText)b.OriginalHeaderText=b.HeaderText;b.HeaderText=d;e.innerHTML=d;if(!a._viewMessages)a._viewMessages={};a._viewMessages[b.Id]=c}},hideViewMessage:function(){var a=this,d=a._get("$HeaderText");if(d!=null){var c=a.get_view(),b=c.OriginalHeaderText;c.HeaderText=b;d.innerHTML=a._formatViewText(Web.DataViewResources.Views.DefaultDescriptions[b],true,b);a._viewMessages[c.Id]=null}}};Web.DataView.registerClass("Web.DataView",Sys.UI.Behavior);Web.AutoComplete=function(a){Web.AutoComplete.initializeBase(this,[a])};Web.AutoComplete.prototype={initialize:function(){var a=this;Web.AutoComplete.callBaseMethod(a,"initialize");a._textBoxMouseOverHandler=Function.createDelegate(a,a._onTextBoxMouseOver);a._textBoxMouseOutHandler=Function.createDelegate(a,a._onTextBoxMouseOut);a._completionListItemCssClass="Item";a._highlightedItemCssClass="HighlightedItem"},dispose:function(){var a=this;a._viewPage=null;if(a._element){$removeHandler(a._element,"mouseover",a._textBoxMouseOverHandler);$removeHandler(a._element,"mouseout",a._textBoxMouseOutHandler)}Web.AutoComplete.callBaseMethod(a,"dispose")},get_fieldName:function(){return this._fieldName},set_fieldName:function(a){this._fieldName=a},updated:function(){var a=this,b=document.createElement("div");b.className="AutoCompleteFrame "+a.get_typeCssClass();b.innerHTML=String.format('<table><tr><td class="Input"></td><td class="Clear" style="{2}"><span class="Clear" onclick="var e=this.parentNode.parentNode.getElementsByTagName(\'input\')[0];e.value=\'\';e.focus()" title="{1}">&nbsp;</span></td><td class="Button" onmouseover="if(!Sys.UI.DomElement.containsCssClass(this.parentNode, \'Active\'))$find(\'{0}\')._showDropDown(true)" onmouseout="$find(\'{0}\')._showDropDown(false)"><span class="Button" onclick="$find(\'{0}\')._showFullList();">&nbsp;</span></td></tr></table>',a.get_id(),Web.DataViewResources.Data.Filters.Labels.Clear,a.get_contextKey().match(/^(SearchBar|Filter)\:/)!=null?"":"display:none");a._element.setAttribute("autocomplete","off");a._element.parentNode.insertBefore(b,a._element);b.getElementsByTagName("td")[0].appendChild(a._element);if(Sys.Browser.agent==Sys.Browser.WebKit)b.style.marginLeft="2px";if(a._completionSetCount==10)a._completionSetCount=100;$addHandler(a._element,"mouseover",a._textBoxMouseOverHandler);$addHandler(a._element,"mouseout",a._textBoxMouseOutHandler);Web.AutoComplete.callBaseMethod(a,"updated");document.body.appendChild(a._completionListElement);a._completionListElement.className="CompletionList AutoComplete";a._completionListElement.style.display="none"},_showCachedFullList:function(){this._update("%",this._cache["%"],false)},_showFullList:function(){var a=this;if(a._webRequest)return;var c=a._popupBehavior.get_visible();a._hideCompletionList();a._element.focus();if(c)return;a._completionWord="%";if(a._cache&&a._cache["%"]){var d=a;setTimeout(function(){d._showCachedFullList()},50);return}var b={prefixText:a._completionWord,count:a._completionSetCount};if(a._useContextKey)b.contextKey=a._contextKey;a._ignoreCompletionWord=true;a._invoke(b,a._completionWord)},_showDropDown:function(c){var b="Active",a=this._element;while(a.tagName!="TR")a=a.parentNode;if(c)Sys.UI.DomElement.addCssClass(a,b);else if(this._textBoxHasFocus)Sys.UI.DomElement.addCssClass(a,b);else Sys.UI.DomElement.removeCssClass(a,b)},_onKeyDown:function(a){var c=this;if(a.keyCode==Sys.UI.Key.down&&a.altKey){a.preventDefault();a.stopPropagation();c._showFullList()}var d=c._popupBehavior._visible;Web.AutoComplete.callBaseMethod(c,"_onKeyDown",[a]);if(a.keyCode==Sys.UI.Key.enter||a.keyCode==Sys.UI.Key.esc){var b=c._get_fieldDataView(true);if(b)if(b.get_isDataSheet()&&d){a.preventDefault();a.stopPropagation()}else if(b.get_searchBarIsVisible()){a.preventDefault();a.stopPropagation();!d&&setTimeout(function(){b._performSearch()},100)}}},_update:function(h,f,g){var b=this;Web.AutoComplete.callBaseMethod(b,"_update",[h,f,g]);if(f){for(var a=-1,e=b._currentCompletionWord().toLowerCase(),c=0;c<f.length;c++){var d=f[c];if(d!=null){d=d.toLowerCase();if(a==-1&&d.startsWith(e))a=c;if(d==e){a=c;break}}}if(a>=0&&a<b._completionListElement.childNodes.length){b._selectIndex=a;e=b._completionListElement.childNodes[a];b._highlightItem(e);b._handleScroll(e,a+5)}}},_get_fieldDataView:function(c){var b=null,a=this._get_contextInfo();if(a&&(a.type=="Field"||c&&a.type=="SearchBar"))b=Web.DataView.find(a.controller);return b},_setText:function(n){var b=this;Web.AutoComplete.callBaseMethod(b,"_setText",[n]);b._updateClearButton();var h=b._get_fieldDataView();if(h){var e=h.findField(b.get_fieldName()),m=b.get_element().value,d=[];if(m!=Web.DataViewResources.Data.NullValueInForms){var k=b._enumerateViewPageItems(m);if(k!=-1){for(var c=b._viewPage,l=c.Rows[k],g=[],a=0;a<c.Fields.length;a++){var i=c.Fields[a];i.Name==e.ItemsDataValueField&&Array.add(g,i)}if(g.length==0)for(a=0;a<c.Fields.length;a++){i=c.Fields[a];if(i.IsPrimaryKey){Array.add(g,i);break}}for(a=0;a<g.length;a++){var o=l[g[0].Index];Array.add(d,o)}}}$get(h.get_id()+"_Item"+e.Index).value=d.toString();b._originalElementText=b.get_element().value;if(b._get_isInLookupMode()){if(!String.isNullOrEmpty(e.Copy)){d=[];var j=/(\w+)=(\w+)/g,f=j.exec(e.Copy);while(f){if(f[2]=="null")Array.add(d,{name:f[1],value:null});else for(a=0;a<c.Fields.length;a++)c.Fields[a].Name==f[2]&&Array.add(d,{name:f[1],value:l[a]});f=j.exec(e.Copy)}h.refresh(true,d)}h._valueChanged(e.Index)}}},_get_isInLookupMode:function(){var a=this._get_contextInfo();return a!=null&&a.type=="Field"},_updateClearButton:function(){var a="Filtered",b=this._element.parentNode.parentNode;if(!String.isBlank(this._element.value))Sys.UI.DomElement.addCssClass(b,a);else Sys.UI.DomElement.removeCssClass(b,a)},_onGotFocus:function(c){var a=this;Web.AutoComplete.callBaseMethod(a,"_onGotFocus",[c]);a._showDropDown(true);a._updateClearButton();if(a._get_isInLookupMode()){var b=a.get_element();a._originalElementText=b.value;if(a._originalElementText==Web.DataViewResources.Data.NullValueInForms){b.value="";b.select()}}},_onLostFocus:function(b){var a=this;Web.AutoComplete.callBaseMethod(a,"_onLostFocus",[b]);a._showDropDown(false);a._updateClearButton();if(a._get_isInLookupMode()&&a._originalElementText!=null)a.get_element().value=a._originalElementText},_onTextBoxMouseOver:function(){this._showDropDown(true)},_onTextBoxMouseOut:function(){this._showDropDown(false)},_currentCompletionWord:function(){var a=this;if(a._completionWord){var b=a._completionWord;a._completionWord=null;return b}return Web.AutoComplete.callBaseMethod(a,"_currentCompletionWord")},_onTimerTick:function(e,c){var a=this;a._timer.set_enabled(false);if(a._servicePath&&a._serviceMethod){var b=a._currentCompletionWord();if(b.trim().length<a._minimumPrefixLength){a._currentPrefix=null;a._update("",null,false);return}if(a._currentPrefix!==b||b==""&&a._minimumPrefixLength==0){a._currentPrefix=b;if(b!=""&&a._cache&&a._cache[b]){a._update(b,a._cache[b],false);return}c=new Sys.CancelEventArgs;a.raisePopulating(c);if(c.get_cancel())return;var d={prefixText:a._currentPrefix,count:a._completionSetCount};if(a._useContextKey)d.contextKey=a._contextKey;if(a._webRequest){a._webRequest.get_executor().abort();a._webRequest=null}a._invoke(d,b);$common.updateFormToRefreshATDeviceBuffer()}}},_get_contextInfo:function(){var a=this.get_contextKey().match(/^(\w+)\:(\w+),(\w+)$/);return a?{type:a[1],controller:a[2],fieldName:a[3]}:null},_invoke:function(t,r){var i=false,e=null,m=true,j=this,b=j,g=b._get_contextInfo();if(g){var a=Web.DataView.find(g.controller),f=[],o=g.fieldName,q="beginswith";if(g.type=="SearchBar")f=a._createSearchBarFilter(m);else if(g.type=="Filter")f=a.get_filter();else{var d=a.findField(j.get_fieldName());o=!String.isNullOrEmpty(d.ItemsDataTextField)?d.ItemsDataTextField:d.Name}if(!j._ignoreCompletionWord){for(var h=0;h<f.length;h++){var u=f[h].match(/^(\w+):/);if(u[1]==g.fieldName){Array.removeAt(f,h);break}}if(!d)d=a.findField(o);if(d&&d.AutoCompleteAnywhere)q="contains";Array.add(f,String.format("{0}:${1}${2}\0",o,q,j._currentCompletionWord()))}var p=e,k=e,n=e;if(g.type=="Field"){k=d.ItemsDataController;n=d.ItemsDataView;var c={FieldName:d.Name,Controller:a.get_controller(),View:a.get_viewId()},l=a.get_contextFilter(d);for(h=0;h<l.length;h++){var s=l[h];Array.add(f,String.format("{0}:={1}\0",s.Name,s.Value))}p={PageIndex:0,RequiresMetaData:m,RequiresRowCount:i,PageSize:300,SortExpression:d.ItemsDataTextField,Filter:f,ContextKey:a.get_id(),Cookie:a.get_cookie(),FilterIsExternal:l.length>0,Transaction:a.get_transaction(),LookupContextFieldName:c?c.FieldName:e,LookupContextController:c?c.Controller:e,LookupContextView:c?c.View:e,LookupContext:c,View:a.get_viewId(),Tag:a.get_tag(),ExternalFilter:l}}else{k=a.get_controller();n=a.get_viewId();p={FieldName:g.fieldName,Filter:f,LookupContextFieldName:c?c.FieldName:e,LookupContextController:c?c.Controller:e,LookupContextView:c?c.View:e,AllowFieldInFilter:j._ignoreCompletionWord!=m,Controller:k,View:n,Tag:a.get_tag(),ExternalFilter:a.get_externalFilter()}}a._busy(m);b._webRequest=a._invoke(b.get_serviceMethod(),{controller:k,view:n,request:p},function(d,c){if(g.type=="Field"){a._busy(i);b._onGetPageComplete(d,c)}else{a._busy(i);b._onGetListOfValuesComplete(d,c)}},r);b._ignoreCompletionWord=i}else b._webRequest=Sys.Net.WebServiceProxy.invoke(b.get_servicePath(),b.get_serviceMethod(),i,t,Function.createDelegate(b,b._onMethodComplete),Function.createDelegate(b,b._onMethodFailed),r)},_onGetListOfValuesComplete:function(a,b){if(a.length>0&&a[0]==null)a[0]=Web.DataViewResources.HeaderFilter.EmptyValue;this._webRequest=null;this._update(b,a,true)},_onGetPageComplete:function(d,c){var a=this;if(!a._element)return;a._viewPage=d;var b=a._enumerateViewPageItems();a._onGetListOfValuesComplete(b,c)},_enumerateViewPageItems:function(f){for(var c=this._viewPage,i=this._get_fieldDataView(),g=i.findField(this.get_fieldName()),d=[],a=0;a<c.Fields.length;a++){var b=c.Fields[a];b.Index=a;b.Name==g.ItemsDataTextField&&Array.add(d,b)}if(d.length==0)for(a=0;a<c.Fields.length;a++){b=c.Fields[a];if(!b.Hidden&&b.Type=="String"){Array.add(d,b);break}}if(d.length==0)for(a=0;a<c.Fields.length;a++){b=c.Fields[a];if(!b.Hidden){Array.add(b);break}}var e=[];g.AllowNulls&&Array.add(e,Web.DataViewResources.Data.NullValueInForms);for(a=0;a<c.Rows.length;a++){var h=c.Rows[a][d[0].Index];if(f!=null){if(h==f)return a}else Array.add(e,h)}return f!=null?-1:e},get_typeCssClass:function(){return this._typeCssClass},set_typeCssClass:function(a){this._typeCssClass=a}};Web.DataView.hideMessage=function(){Web.DataView.showMessage()};Web.DataView.formatMessage=function(b,a){return String.format('<table cellpadding="0" cellspacing="0" ><tr><td class="{0}" valign="top">&nbsp;</td><td class="Message">{1}</td></tr></table>',b,a)};Web.DataView.showMessage=function(b){var f="DataView_MessageBar",c=null;if(String.isBlank(b))b=c;var d=document.getElementsByTagName("body")[0],k=false;if(!Web.DataView.MessageBar){var a=document.createElement("div");a.id=f;d.appendChild(a);Sys.UI.DomElement.setVisible(a,false);Sys.UI.DomElement.addCssClass(a,"MessageBar");Web.DataView.MessageBar=$create(AjaxControlToolkit.AlwaysVisibleControlBehavior,{VerticalOffset:AjaxControlToolkit.VerticalSide.Top},c,c,a);var e=Sys.UI.DomElement.getBounds(d);if(e.y<0)e.y=0;Web.DataView.OriginalBodyTopOffset=e.y}a=$get(f);var i=Sys.UI.DomElement.getVisible(a);a.innerHTML=b?String.format('<div>{0}</div><div class="Stub"></div>',b):"";Sys.UI.DomElement.setVisible(a,b!=c);var j=Sys.UI.DomElement.getBounds(a),h=b?Web.DataView.OriginalBodyTopOffset+j.height:Web.DataView.OriginalBodyTopOffset;d.style.paddingTop=h+"px";var g=$get("Membership_Login");if(g)g.style.marginTop=h+"px";Sys.UI.DomElement.getVisible(a)!=i&&_body_performResize()};Web.DataView._tagsWithIndexes=["A","AREA","BUTTON","INPUT","OBJECT","SELECT","TEXTAREA","IFRAME"];Web.DataView._delayedLoadingViews=[];Web.DataView._performDelayedLoading=function(){var b=0;while(b<Web.DataView._delayedLoadingViews.length){var a=Web.DataView._delayedLoadingViews[b];if(a.get_isDisplayed()){Array.remove(Web.DataView._delayedLoadingViews,a);a._delayedLoading&&a._loadPage()}else b++}};Web.DataView.unanchor=function(a){var b=a.match(/^(.+?)#.*$/);return b?b[1]:a};Web.DataView.find=function(b,c){for(var f="_"+b,e=Sys.Application.getComponents(),d=0;d<e.length;d++){var a=e[d];if(c){if(Web.DataView.isInstanceOfType(a)&&(c=="Controller"&&a._controller==b||c=="Tag"&&a.get_isTagged(b)))return a}else if(a._id==b||Web.DataView.isInstanceOfType(a)&&a._id.endsWith(f))return a}return null};Web.DataView.confirm=function(c,b,a){if(window.confirm(c))b&&b();else a&&a()};Web.DataView.alert=function(b,a){window.alert(b);a&&a()};Web.DataView.showModal=function(c,k,q,s,r,m,j,t,a){var f=null,i=Web.DataView.isInstanceOfType(c),e=c,g=$appfactory.mobile;if(!$appfactory.mobile){if(i&&c._container)e=c._container.getElementsByTagName("a")[0];if(!e)for(var n=document.getElementsByTagName("a","input","button"),h=n.length-1;h>=0;h--)if(n[h].tabIndex>=0){e=n[h];break}if(e==f){alert("Cannot find an anchor for a modal popup.");return}Web.HoverMonitor._instance.close()}g&&g.modalDataView();if(!m)m=Web.DataView._baseUrl;if(!j)j=Web.DataView._servicePath;var d=this._placeholder=document.createElement("div"),p=Sys.Application.getComponents().length,o=k.toLowerCase();if($find(o))o+=p;d.id=String.format("{0}_{1}_Placeholder{2}",k,q,p);if(i)c._appendModalPanel(d);else document.body.appendChild(d);d.className="ModalPlaceholder FixedDialog EmptyModalDialog";var b={id:o,baseUrl:m,servicePath:j,controller:k,viewId:q,showActionBar:false,modalAnchor:e,startCommandName:s,startCommandArgument:r,exitModalStateCommands:["Cancel"],externalFilter:t};if(a){if(!a.useCase){a.useCase=$appfactory._defaultUseCase;$appfactory._defaultUseCase=f}b.filter=a.filter;b.ditto=a.ditto;b.lastViewId=a.lastViewId;b.transaction=a.transaction;b.filterSource=a.filterSource;b.filterFields=a.filterFields;b.confirmContext=a.confirmContext;b.showSearchBar=a.showSearchBar;b.useCase=a.useCase;b.tag=a.tag;b.showActionButtons=a.showActionButtons}var l=$create(Web.DataView,b,f,f,d);if(i){l._parentDataViewId=c.get_id();l._hasDetails=c._hasDetails}g&&setTimeout(function(){g.modalDataView(b.id)},0);return l};Web.DataView.alert=function(b,a){alert(b);a&&a()};Web.DataView.isSaaS=function(){var a=this;if(a._isSaaS==null){a._isSaaS=false;$("script").each(function(){if(this.src.match(/\/factory(.*?)\.js/))a._isSaaS=true})}return a._isSaaS};Web.DataView._resizeInterval=null;Web.DataView._resizing=false;Web.DataView._resized=false;Web.DataView._customInputElements=[];var $appfactory=Web.DataView;Web.DataView.borderBox=function(b){var a=$(b);return{horizontal:a.outerWidth()-a.innerWidth(),vertical:a.outerHeight()-a.innerHeight()}};Web.DataView.paddingBox=function(b){var a=$(b);return{horizontal:a.innerWidth()-a.width(),vertical:a.innerHeight()-a.height()}};Web.DataView.marginBox=function(b){var a=$(b);return{horizontal:a.outerWidth(true)-a.outerWidth(),vertical:a.outerHeight(true)-a.outerHeight()}};Web.DataView.bounds=function(c){var a=$(c),b=a.offset();return{x:b.left,y:b.top,width:a.outerWidth(),height:a.outerHeight()}};Web.DataView.scrolling=function(){var a=$(window);return{x:a.scrollLeft(),y:a.scrollTop()}};Web.DataView.clientBounds=function(){var a=$(window);return{width:a.width(),height:a.height()}};function _body_hideLayoutContainers(){if(!Web.DataView._layoutContainers)return;for(var a=0;a<Web.DataView._layoutContainers.length;a++){var b=Web.DataView._layoutContainers[a];b.width!="100%"&&Sys.UI.DomElement.setVisible($get(b.id),false)}}function _body_resizeLayoutContainers(){var c=Web.DataView._layoutContainers;if(!c||c.length==0)return;var f=$get("PageContent");if(!f)return;var h=$appfactory.bounds(f),n=$appfactory.paddingBox(f),o=$appfactory.borderBox(f),p=$appfactory.marginBox(f);h.width-=n.horizontal+o.horizontal+p.horizontal;var g=c[c.length-1].rowIndex;while(g>=c[0].rowIndex){for(var l=0,e=0;e<c.length;e++){var b=c[e];if(b.rowIndex==g&&!String.isNullOrEmpty(b.width)){var a=$get(b.id);if(a){var i=$appfactory.paddingBox(a),j=$appfactory.borderBox(a),k=$appfactory.marginBox(a),m=b.width.match(/(\d+)(%|px|)/),d=m[2]!="%"?parseFloat(m[1]):Math.floor(h.width*parseFloat(m[1])/100);l+=d;d-=i.horizontal+j.horizontal+k.horizontal;if(b.width!="100%"){a.style.width=d+"px";Sys.UI.DomElement.setVisible(a,true)}else $(a).removeClass("LayoutContainer").addClass("RowContainer")}}}if(l<h.width)for(e=0;e<c.length;e++){b=c[e];if(b.rowIndex==g&&String.isNullOrEmpty(b.width)){a=$get(b.id);if(a){i=$appfactory.paddingBox(a);j=$appfactory.borderBox(a);k=$appfactory.marginBox(a);d=Math.floor((h.width-l)/b.peersWithoutWidth);d-=i.horizontal+j.horizontal+k.horizontal;if(d<1)d=1;a.style.width=d+"px";Sys.UI.DomElement.setVisible(a,true)}}}g--}}function _body_keydown(c){if(c.keyCode==Sys.UI.Key.enter&&Web.DataView._focusedItemIndex!=null){var a=$find(Web.DataView._focusedDataViewId);if(a&&a._get_focusedCell())return;var b=$get(Web.DataView._focusedDataViewId+"_Item"+Web.DataView._focusedItemIndex);if(b&&b.tagName=="INPUT"&&b.type=="text"&&b==c.target){c.preventDefault();c.stopPropagation();a=$find(Web.DataView._focusedDataViewId);a&&a._valueChanged(Web.DataView._focusedItemIndex)}}}function _body_resize(){Web.DataView._resizeInterval&&clearInterval(Web.DataView._resizeInterval);if(!Web.DataView._resizing&&!Web.DataView._resized){Web.DataView._resizeInterval=setInterval(function(){_body_performResize()},10);_body_hideLayoutContainers();_body_resizeLayoutContainers()}else $closeHovers();Web.DataView._resized=false}function _body_scroll(){var a=$getSideBar();if(!a)return;var b=$appfactory.scrolling(),e=$common.getClientBounds(),c=$common.getBounds(a);if(a._originalTop==null)a._originalTop=c.y;var f=a._originalTop,d=0;if(Web.DataView.MessageBar){var g=$common.getBounds(Web.DataView.MessageBar._element);f+=d=g.height}if(b.y>a._originalTop&&c.height+4<=e.height&&b.x==0){a.style.width=c.width+"px";if(Sys.Browser.agent==Sys.Browser.InternetExplorer&&Sys.Browser.version<=6){a.style.top=4+b.y+d+"px";a.style.position="absolute"}else{a.style.top=4+d+"px";a.style.position="fixed"}}else{a.style.top="";a.style.width="";a.style.position=""}}function _body_createPageContext(c){var a=$get("PageContent");if(!a)return;var f=$common.getBounds(a),e=$common.getPaddingBox(a),d=$common.getBorderBox(a),b={height:f.height-e.vertical-d.vertical,scrolling:$appfactory.scrolling()};if(c!=false)Web.DataView._pageContext=b;return b}function _body_performResize(){var b="px",d=null;Web.DataView._resizeInterval&&clearInterval(Web.DataView._resizeInterval);Web.DataView._resizeInterval=d;$closeHovers();var a=$get("PageContent");if(!a||$appfactory.mobile)return;var i=$common.getClientBounds(),u=$common.getClientBounds();if(Web.DataView.MessageBar){var c=Web.DataView.MessageBar._element;if($common.getVisible(c)){var h=$common.getPaddingBox(c);c.style.width=u.width-h.horizontal+b;var f=c.childNodes[0];f.style.height="";var v=$common.getBounds(f),j=Math.ceil(i.height*.15);if(v.height>j){f.style.height=j+b;f.style.overflow="auto"}h=Sys.UI.DomElement.getBounds(c);var n=Web.DataView.OriginalBodyTopOffset+h.height;document.body.style.paddingTop=n+b;var l=$get("Membership_Login");if(l)l.style.marginTop=n+b}}Web.DataView._resizing=true;var e=Web.DataView._pageContext;if(e==d)e=_body_createPageContext(false);else Web.DataView._pageContext=d;var m=$appfactory.scrolling();if(m.y==0)a.style.height="10px";_body_resizeLayoutContainers();if(typeof __cothost=="undefined"){var q=$appfactory.bounds(a),o=$appfactory.paddingBox(a),p=$appfactory.borderBox(a),t=Web.Menu.MainMenuElemId?$get(Web.Menu.MainMenuElemId):d,k=t?$common.getBorderBox(t):d,s=$get("PageFooterContent"),r=$get("PageFooterBar"),g=m.y+i.height-q.y-(r?r.offsetHeight:0)-(s?s.offsetHeight:0)-p.vertical-o.vertical-(k?k.vertical:0);if(q.height<g)if(Sys.Browser.agent==Sys.Browser.Opera)g+=p.vertical+o.vertical;if(e.scrolling.y==0||Web.DataView._numberOfContainers<2)a.style.height=document.body.offsetHeight>i.height?"":g+b;else{a.style.height=e.height+b;scrollTo(0,e.scrolling.y)}}_body_scroll();Web.DataView._resizing=false;Web.DataView._resized=true}Web.DataView._activate=function(b,l,e){var j="Selected",i="CloseSiteAction",h="SideBarTask",p=new RegExp("^\\s*"+e+"\\s*\\|"),a=$get(l);if(e==h){var d=a;while(d&&String.isNullOrEmpty(this.prototype.dataAttr(d,"flow")))d=d.parentNode;for(var g=d.getElementsByTagName("div"),c=0;c<g.length;c++){var k=this.prototype.dataAttr(g[c],"activator");!String.isNullOrEmpty(k)&&p.exec(k)&&$(g[c]).hide()}}Sys.UI.DomElement.setVisible(a,e==h?true:!Sys.UI.DomElement.getVisible(a));a._activated=true;if(e=="SiteAction"&&a.childNodes[0].className!=i){var f=document.createElement("div");f.className=i;f.innerHTML=String.format("<a href=\"javascript:\" onclick=\"Web.DataView._activate(null,'{0}','SiteAction')\">{1}</a>",l,Web.DataViewResources.ModalPopup.Close);a.insertBefore(f,a.childNodes[0])}if(Sys.UI.DomElement.getVisible(a)){var n=$common.getBounds(a),q=$common.getClientBounds(),m=$appfactory.scrolling();(n.y<m.y||n.y>m.y+q.height)&&a.scrollIntoView(false)}if(b){while(b&&!Sys.UI.DomElement.containsCssClass(b,"Task"))b=b.parentNode;for(c=0;c<b.parentNode.childNodes.length;c++){var o=b.parentNode.childNodes[c];o.className&&Sys.UI.DomElement.removeCssClass(o,j)}Sys.UI.DomElement.addCssClass(b,j)}_body_performResize()};Web.DataView._partialUpdateBeginRequest=function(i,g){for(var f=g.get_request(),d=Sys.Application.getComponents(),b=[],c=0;c<d.length;c++){var a=d[c];if(a._controller&&a._viewId&&Web.DataView.isInstanceOfType(a)){var e=a.get_tag();if(!String.isNullOrEmpty(e)){Array.add(b,e);Array.add(b,a.get_selectedKey())}}}var h=Sys.Serialization.JavaScriptSerializer.serialize(b);f.set_body(f.get_body()+"&"+encodeURIComponent("__WEB_DATAVIEWSTATE")+"="+encodeURIComponent(h))};Web.DataView._load=function(){var v="description",u="hidden",o=null,n=false,m="div",i=true;if(Web.DataView._loaded)return;Sys.WebForms&&Sys.WebForms.PageRequestManager._instance&&Sys.WebForms.PageRequestManager._instance.add_beginRequest(Web.DataView._partialUpdateBeginRequest);Web.DataView._loaded=i;updateACT();Web.DataView.supportsPlaceholder="placeholder"in document.createElement("input");var J=$get("PageContent");if(J){$("body").find('div[data-app-role="page"]').remove();for(var l=document.body.getElementsByTagName(m),b=0;b<l.length;b++)if(l[b].className.match(/Loading/)){Sys.UI.DomElement.removeCssClass(l[b],"Loading");break}l=J.getElementsByTagName(m);var e=[],x=0,D=n,t=n,h=o,w=[];Web.DataView._numberOfContainers=0;var f=Web.DataView.prototype.dataAttr;for(b=0;b<l.length;b++){var d=l[b],y=f(d,"width"),I=f(d,"flow");if(!String.isNullOrEmpty(y)||!String.isNullOrEmpty(I)){if(I!="NewColumn"){d.style.clear="left";x++}if(String.isNullOrEmpty(d.id))d.id="_lc"+e.length;Sys.UI.DomElement.addCssClass(d,"LayoutContainer");Web.DataView._numberOfContainers++;if(y!="100%")d.style.overflow=u;Array.add(e,{id:d.id,width:y,rowIndex:x,peersWithoutWidth:0});for(var F=d.getElementsByTagName(m),g=[],c=0;c<F.length;c++){var j=F[c],E=f(j,"activator");if(!String.isNullOrEmpty(E)){j.id=String.isNullOrEmpty(j.id)?d.id+"$a"+c:j.id;var a={elem:j,activator:E.split("|"),id:j.id};a.activator[0]=a.activator[0].trim();if(a.activator.length==1)a.activator[1]=c.toString();Array.add(g,a)}}c=1;while(c<g.length){a=g[c];for(var B=0;B<c;B++){var A=g[B];if(A.activator[0]==a.activator[0]&A.activator[1]==a.activator[1]){while(a.elem.childNodes.length>0)A.elem.appendChild(a.elem.childNodes[0]);delete a.elem;Array.removeAt(g,c);a=o;break}}if(a)c++}if(g.length>0){D=i;var k=[],s=i;for(c=0;c<g.length;c++){a=g[c];if(a.activator[0]=="Tab"){if(k.length==0){var p=document.createElement(m);p.className="TabBar";d.insertBefore(p,a.elem)}var K={title:a.activator[1],elementId:a.id,selected:k.length==0,description:f(a.elem,v),hidden:f(a.elem,u)};Array.add(k,K);Sys.UI.DomElement.setVisible(a.elem,K.selected);a.elem._activated=i;Sys.UI.DomElement.addCssClass(a.elem,"TabBody TabContainer")}else if(a.activator[0]=="SideBarTask"){if(!h){h=new Sys.StringBuilder;h.appendFormat('<div class="TaskBox TaskList"><div class="Inner"><div class="Header">{0}</div>',Web.DataViewResources.Menu.Tasks)}a.elem._activated=s;if(s)s=n;Sys.UI.DomElement.setVisible(a.elem,a.elem._activated);h.appendFormat("<div class=\"Task{1}\"{4}><a href=\"javascript:\" onclick=\"Web.DataView._activate(this,'{2}','SideBarTask');return false;\" title='{3}'>{0}</a></div>",a.activator[1],!t?" Selected":"",a.id,Web.DataView.htmlAttributeEncode(f(a.elem,v)),f(a.elem,u)=="true"?' style="display:none"':"");t=i}else if(a.activator[0]=="SiteAction"&&Web.Menu.get_siteActionsFamily()){var z=new Web.Item(Web.Menu.get_siteActionsFamily(),a.activator[1],f(a.elem,v));z.set_cssClass(f(a.elem,"cssClass"));z.set_script('Web.DataView._activate(null,"{0}","SiteAction")',a.id);Array.add(w,z);Sys.UI.DomElement.setVisible(a.elem,n)}else Sys.UI.DomElement.setVisible(a.elem,n);a.elem=o}if(k.length>0){$create(Web.Menu,{id:d.id+"$ActivatorMenu",nodes:k},o,o,p);k.length<2&&b==0&&Sys.UI.DomElement.addCssClass(p,"EmptyTabBar")}}}}D&&Web.DataView._performDelayedLoading();if(t&&h){var q=$getSideBar();if(q){h.append("</div></div>");var H=document.createElement(m);H.innerHTML=h.toString();h.clear();q.insertBefore(H,q.childNodes[0]);q._hasActivators=i}}w.length>0&&Web.Menu.set_siteActions(w);var r=x;while(e.length>0&&r>=e[0].rowIndex){var C=0,G=0;for(b=0;b<e.length;b++){lc=e[b];if(lc.rowIndex==r){G++;if(String.isNullOrEmpty(lc.width))C++}}for(b=0;b<e.length;b++){lc=e[b];if(lc.rowIndex==r){lc.peersWithoutWidth=C;if(G==1&&String.isNullOrEmpty(lc.width))lc.width="100%"}}r--}Web.DataView._layoutContainers=e;_body_performResize();$addHandler(window,"resize",_body_resize);$addHandler(window,"scroll",_body_scroll)}Web.DataView._startDelayedLoading();$addHandler(document.body,"keydown",_body_keydown)};Web.DataView._unload=function(){if(this._state){Array.clear(this._state);delete this._state}if(Web.DataView._delayedLoadingTimer){clearInterval(Web.DataView._delayedLoadingTimer);Array.clear(Web.DataView._delayedLoadingViews);delete Web.DataView._delayedLoadingViews}if($get("PageContent")){$removeHandler(window,"resize",_body_resize);$removeHandler(window,"scroll",_body_scroll)}$removeHandler(document.body,"keydown",_body_keydown)};Web.DataView._startDelayedLoading=function(){if(Web.DataView._delayedLoadingViews.length>0&&!Web.DataView._delayedLoadingTimer)Web.DataView._delayedLoadingTimer=setInterval(function(){Web.DataView._performDelayedLoading()},1e3)};Web.DataView._updateBatchSelectStatus=function(c,e){var b="BatchEditFrame",d=e?"Item":"Cell",a=c.parentNode;while(a!=null&&!Sys.UI.DomElement.containsCssClass(a,d))a=a.parentNode;if(a)if(c.checked)Sys.UI.DomElement.addCssClass(a,b);else Sys.UI.DomElement.removeCssClass(a,b)};Web.DataView.highlightFilterValues=function(a,c,b){while(a&&a.tagName!="TABLE")a=a.parentNode;if(a)if(c&&!a.className.match(b))Sys.UI.DomElement.addCssClass(a,b);else!c&&a.className.match(b)&&Sys.UI.DomElement.removeCssClass(a,b)};Web.DataView.get_commandLine=function(){var b="undefined",a=Web.DataView._commandLine;if(!a){if(typeof __dacl!=b)a=__dacl;if(!a){a=typeof Web.Membership!=b?Web.Membership._instance.get_commandLine():null;a=!a?location.href:location.pathname+"?"+a}Web.DataView._commandLine=$appfactory.unanchor(a)}return a};Web.DataView._run=function(c,f,e){var b=$('#PageContent, div[data-role="page"]');if(!e){var d="placeholder"in document.createElement("input"),a=$('<div id="appfactory-login"><div class="user-name"><label for="username">User Name:</label><input type="text" id="username" placeholder="User Name"/></div><div class="password"><label for="password">Password:</label><input type="password" id="password" placeholder="Password"/></div><div class="login"><button>Login</button><div></div>').insertBefore(b);a.find("button").click(function(e){e.preventDefault();var b=a.find("#username"),d=a.find("#password");$.ajax({url:c+"/appservices/_authenticate",type:"GET",cache:false,data:{args:Sys.Serialization.JavaScriptSerializer.serialize([b.val(),d.val()])},dataType:"jsonp",success:function(a){if(a)location.replace(location.href);else b.focus()},error:function(){alert("error")}})});d&&a.find("label").remove();b.hide();return}$("div[data-controller]").each(function(){var a="bool",d=$(this),b=d.attr("data-controller");if(b){var e=d.attr("id");if(!e)e=b;var g={id:e,controller:b,baseUrl:c,servicePath:f,showSearchBar:true},h=[{name:"view"},{name:"pageSize",type:"int"},{name:"servicePath"},{name:"filterSource"},{name:"filterFields"},{name:"autoHide",aliases:["nothing","self","container"],values:[0,1,2]},{name:"showSearchBar",type:a},{name:"showModalForms",type:a}];$(h).each(function(){var c=this,b=d.attr("data-"+c.name.replace(/([A-Z])/g,"-$1"));if(b){if(c.aliases)b=c.values[Array.indexOf(c.aliases,b.toString().toLowerCase())];if(c.type==a)b=b=="true";if(c.type=="int")b=parseInt(b);g[c.name]=b}});$create(Web.DataView,g,null,null,this)}})};Web.DataView.DetailsRegex=/\/Details\.aspx\?/i;Web.DataView.LocationRegex=/^(_.+?):(.+)$/;Web.DataView.LEVs=[];Web.DataView.Editors=[];Web.DataView.EditorFactories={};(function(){var a=Sys.CultureInfo.CurrentCulture.dateTimeFormat;Web.DataView.dateFormatStrings={"{0:g}":a.ShortDatePattern+" "+a.ShortTimePattern,"{0:G}":a.ShortDatePattern+" "+a.LongTimePattern,"{0:f}":a.LongDatePattern+" "+a.ShortTimePattern,"{0:u}":a.SortableDateTimePattern,"{0:U}":a.UniversalSortableDateTimePattern}})();if(!$.mobile){Sys.Application.add_load(Web.DataView._load);Sys.Application.add_unload(Web.DataView._unload)}function $createDataView(e,c,a){var d={id:c+"Extender",controller:c,baseUrl:"./",servicePath:"Services/DataControllerService.asmx"};if(a)for(var b=0;b<a.length;b++)d[a[b].name]=a[b].value;$create(Web.DataView,d,null,null,$get(e))}function updateACT(){if(Sys.Extended&&typeof AjaxControlToolkit=="undefined")AjaxControlToolkit=Sys.Extended.UI;Web.AutoComplete.registerClass("Web.AutoComplete",AjaxControlToolkit.AutoCompleteBehavior);Sys.Browser.WebKit={};if(navigator.userAgent.indexOf("WebKit/")>-1){Sys.Browser.agent=Sys.Browser.WebKit;Sys.Browser.version=parseFloat(navigator.userAgent.match(/WebKit\/(\d+(\.\d+)?)/)[1]);Sys.Browser.name="WebKit"}if(!(Sys.Browser.agent==Sys.Browser.InternetExplorer||Sys.Browser.agent==Sys.Browser.Firefox||Sys.Browser.agent==Sys.Browser.Opera)&&!Sys.Extended){$common.old_getBounds=$common.getBounds;$common.getBounds=function(c){var b=$common.old_getBounds(c),a=$appfactory.scrolling();if(a.y||a.x){b.x+=a.x;b.y+=a.y}return b}}if(AjaxControlToolkit.CalendarBehavior&&!AjaxControlToolkit.CalendarBehavior.prototype.old_show){AjaxControlToolkit.CalendarBehavior.prototype.old_show=AjaxControlToolkit.CalendarBehavior.prototype.show;AjaxControlToolkit.CalendarBehavior.prototype.show=function(){var a=".Error:visible";this.old_show();var e=$(this._container).zIndex(100100),b=$(this._element),d=b.parent().find(a).length||b.closest("div.Item").find(a).length;function c(){e.position({my:"left "+(d?"bottom":"top"),at:"left "+(d?"top":"bottom"),of:b})}c();setTimeout(c,10)};AjaxControlToolkit.CalendarBehavior.prototype.old_raiseDateSelectionChanged=AjaxControlToolkit.CalendarBehavior.prototype.raiseDateSelectionChanged;AjaxControlToolkit.CalendarBehavior.prototype.raiseDateSelectionChanged=function(){this.old_raiseDateSelectionChanged();this._element.focus()}}if(AjaxControlToolkit.TabContainer&&!AjaxControlToolkit.TabContainer.prototype.old_set_activeTabIndex){AjaxControlToolkit.TabContainer.prototype.old_set_activeTabIndex=AjaxControlToolkit.TabContainer.prototype.set_activeTabIndex;AjaxControlToolkit.TabContainer.prototype.set_activeTabIndex=function(b){var a=this,c=a.get_activeTabIndex();if(!a._headerAssigned){a._headerAssigned=true;Sys.UI.DomElement.addCssClass(a._element.getElementsByTagName("div")[0],"tab-header")}a.old_set_activeTabIndex(b);b!=c&&_body_performResize()}}if(AjaxControlToolkit.AutoCompleteBehavior&&!AjaxControlToolkit.AutoCompleteBehavior.prototype.old_dispose){AjaxControlToolkit.AutoCompleteBehavior.prototype.old_dispose=AjaxControlToolkit.AutoCompleteBehavior.prototype.dispose;AjaxControlToolkit.AutoCompleteBehavior.prototype.dispose=function(){var a=this;a.old_dispose();if(a._completionListElement){a._completionListElement.parentNode.removeChild(a._completionListElement);delete a._completionListElement}};AjaxControlToolkit.AutoCompleteBehavior.prototype.old__handleFlyoutFocus=AjaxControlToolkit.AutoCompleteBehavior.prototype._handleFlyoutFocus;AjaxControlToolkit.AutoCompleteBehavior.prototype._handleFlyoutFocus=function(){if(!this._completionListElement)return;this.old__handleFlyoutFocus()};AjaxControlToolkit.AutoCompleteBehavior.prototype.old_showPopup=AjaxControlToolkit.AutoCompleteBehavior.prototype.showPopup;AjaxControlToolkit.AutoCompleteBehavior.prototype.showPopup=function(){var c="px",a=this;a.old_showPopup();if(Sys.UI.DomElement.getVisible(a._completionListElement)){var h=$appfactory.scrolling();a._completionListElement.style.height="";Sys.UI.DomElement.addCssClass(a._completionListElement,"CompletionList");a._completionListElement.style.width="";a._completionListElement.style.zIndex=200100;var e=$common.getClientBounds(),b=$common.getBounds(a._completionListElement);if(b.width>e.width/3)b.width=e.width/3;var f=a._element;if(Sys.UI.DomElement.containsCssClass(f.parentNode,"Input"))while(!Sys.UI.DomElement.containsCssClass(f.parentNode,"AutoCompleteFrame"))f=f.parentNode;var d=$common.getBounds(f),k=$common.getBorderBox(a._completionListElement),j=$common.getPaddingBox(a._completionListElement);if(b.width<=d.width)a._completionListElement.style.width=d.width-k.horizontal-j.horizontal+c;b=$common.getBounds(a._completionListElement);if(b.x!=d.x){b.x=d.x;a._completionListElement.style.left=b.x+c}if(b.y!=d.y){b.y=d.y+d.height-1;a._completionListElement.style.top=b.y+c}if(b.x+b.width>e.width)a._completionListElement.style.left=e.width-b.width+c;bound=$common.getBounds(a._completionListElement);var g=d.y-h.y,i=e.height-(d.y+d.height-h.y);if(bound.height<=i||i>=g){if(b.y+b.height-h.y>e.height){a._completionListElement.style.height=e.height-(b.y-h.y)-4+c;a._completionListElement.style.overflow="auto"}}else if(g<b.height){a._completionListElement.style.top=d.y-g+c;a._completionListElement.style.height=g+c;a._completionListElement.style.overflow="auto"}else a._completionListElement.style.top=d.y-b.height+3+c}};if(AjaxControlToolkit.ModalPopupBehavior&&!AjaxControlToolkit.ModalPopupBehavior.prototype.old__attachPopup){AjaxControlToolkit.ModalPopupBehavior.prototype.old__attachPopup=AjaxControlToolkit.ModalPopupBehavior.prototype._attachPopup;AjaxControlToolkit.ModalPopupBehavior.prototype._attachPopup=function(){var a=this;a.old__attachPopup();if(a._dropShadowBehavior){a._dropShadowBehavior.set_Width(4);(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>=9)&&a._dropShadowBehavior.set_Rounded(true)}}}}}function $hoverTab(a,b){while(a&&a.tagName!="TD")a=a.parentNode;if(a)if(b){Sys.UI.DomElement.addCssClass(a,"Active");a.focus()}else Sys.UI.DomElement.removeCssClass(a,"Active")}function $getSideBar(){var a=$get("PageContentSideBar");if(!a)return null;for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(c.className=="SideBarBody")return c}return null}function $dvget(d,i,f,j){for(var h=Sys.Application.getComponents(),k="_"+d,b=null,a=0;a<h.length;a++){var c=h[a];if(c._id==d||Web.DataView.isInstanceOfType(c)&&(c._id.endsWith(k)||c._controller==d&&(!i||c.get_viewId()==i))){b=c;break}}if(b)if(f){var e=b.findField(f);if(e){if(j){element=$get(b._id+"_ItemContainer"+e.Index);if(element)for(a=0;a<element.childNodes.length;a++){var g=element.childNodes[a];if(g.className=="Value")return g}}else return $get(b._id+"_Item"+e.Index);return element}else return null}else return b;return null}Sys.UI.DomElement.setFocus=function(a){var b=document.selection;b&&b.type!="Text"&&b.type!="None"&&b.clear();if(a){a.focus();a.select&&a.select();document.focus&&document.focus()}};Sys.UI.DomElement.getCaretPosition=function(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length);b=c.text.length}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return b};Sys.UI.DomElement.setCaretPosition=function(a,c){var d="character";if(a.setSelectionRange){a.focus();a.setSelectionRange(c,c)}else if(a.createTextRange){var b=a.createTextRange();b.collapse(true);b.moveEnd(d,c);b.moveStart(d,c);b.select()}};function _field_format(b){var a=this;try{if(b!=null&&a.Type=="TimeSpan"&&a.DataFormatString&&a.FormatOnClient&&typeof b=="string")b=Date.tryParseFuzzyTime(b,false);return b==null?"null":a.FormatOnClient&&!String.isNullOrEmpty(a.DataFormatString)?String.localeFormat(a.DataFormatString,b):b.toString()}catch(c){throw new Error(String.format("\nField: {0}\nData Format String: {1}\n{2}",a.Name,a.DataFormatString,c.message));}}function _field_isReadOnly(){return this.TextMode==4||this.ReadOnly}function _field_isNumber(){return Array.indexOf(["SByte","Byte","Int16","Int32","UInt32","Int64","Single","Double","Decimal","Currency"],this.Type)}function _field_htmlEncode(){return this.HtmlEncode&&this.TextMode!=3&&this.TextMode!=4}function _field_trim(a){var b=this,c=Web.DataViewResources.Data;if(b.Type=="String"&&a!=null&&a.length>c.MaxReadOnlyStringLen&&!(b.TextMode==3||b.TextMode==2))a=a.substring(0,c.MaxReadOnlyStringLen)+"...";if(a&&b.TextMode==3)a=a.replace(/(\r?\n)/g,"<br/>");return a}function _field_text(d,l){var a=this,b,i=Web.DataViewResources.Data,e=a.DynamicItems?a.DynamicItems:a.Items;if(e.length==0)b=String.isBlank(d)?i.NullValueInForms:a.format(d);else if(a.ItemsStyle=="CheckBoxList"){for(var j=d?d.split(","):[],f=new Sys.StringBuilder,h=true,g=0;g<e.length;g++){var c=e[g],k=c[0]==null?"":c[0].toString();if(Array.contains(j,k)){if(h)h=false;else f.append(", ");f.append(c[1])}}b=f.toString();b=j.length==0?i.NullValueInForms:b}else{c=a._dataView._findItemByValue(a,d);b=c[1]}if(a.TextMode==1)b="**********";if(l!=false)b=a.trim(b);return b}Array.indexOfCaseInsensitive=function(c,b){b=b.toLowerCase();for(var a=0;a<c.length;a++)if(c[a].toLowerCase()==b)return a;return-1};Number.tryParse=function(a){var d=null;if(typeof a!="string")return d;if(String.isNullOrEmpty(a))return d;var b=Number.parseLocale(a);if(isNaN(b)){var c=Sys.CultureInfo.CurrentCulture.numberFormat;if(!c._simplifyRegex)c._simplifyRegex=new RegExp(String.format("({0}|\\{1})",c.CurrencySymbol.replace(/(\W)/g,"\\$1"),c.CurrencyGroupSeparator),"gi");var e=a.match(/\(/)!=d;a=a.replace(c._simplifyRegex,"").replace(/\(|\)/g,"");a=a.replace(c.CurrencyDecimalSeparator,c.NumberDecimalSeparator);b=Number.parseLocale(a);if(isNaN(b)){b=Number.parseLocale(a.replace(c.PercentSymbol,""));if(!isNaN(b))b/=100}}if(!isNaN(b)){if(e)b*=-1;return b}return d};Date.tryParseFuzzyDate=function(e,n){var f=null;if(String.isNullOrEmpty(e))return f;var b=Sys.CultureInfo.CurrentCulture.dateTimeFormat,a=Date.parseLocale(e,b.ShortDatePattern);if(a==f)a=Date.parseLocale(e,b.LongDatePattern);if(a==f&&!String.isNullOrEmpty(n)){var o=n.match(/\{0:([\s\S]*?)\}/);if(o)a=Date.parseLocale(e,o[1])}if(a)return a;a=new Date;var c=e.match(/^\s*(\w+)\s*$/);if(c){var d=Array.indexOfCaseInsensitive(b.DayNames,c[1]);if(d==-1)d=Array.indexOfCaseInsensitive(b.AbbreviatedDayNames,c[1]);if(d==-1)d=Array.indexOfCaseInsensitive(b.ShortestDayNames,c[1]);if(d>=0){while(a.getDay()!=d)a.setDate(a.getDate()+1);return a}}c=e.match(/^\s*(\w+|\d+)[^\w\d]*(\w+|\d+)\s*$/);if(c){var k=c[1],h=c[2];if(k.match(/\d+/)){k=h;h=c[1]}c=h.match(/\d+/);h=c?c[0]:1;d=Array.indexOfCaseInsensitive(b.MonthNames,k);if(d==-1)d=Array.indexOfCaseInsensitive(b.AbbreviatedMonthNames,k);if(d>=0){a.setDate(1);while(a.getMonth()!=d)a.setMonth(a.getMonth()+1);a.setDate(h);return a}}c=e.match(/^\s*(\d\d?)(\D*(\d\d?))?(\D*(\d+))?\s*$/);if(!c)return f;try{if(!b.LogicalYearPosition){var m=b.ShortDatePattern.indexOf("m");if(m<0)m=b.ShortDatePattern.indexOf("M");var l=b.ShortDatePattern.indexOf("d");if(l<0)l=b.ShortDatePattern.indexOf("D");b.LogicalYearPosition=5;b.LogicalMonthPosition=m<l?1:3;b.LogicalDayPosition=m<l?3:1}var j=c[b.LogicalYearPosition];if(String.isNullOrEmpty(j))j=a.getFullYear();else j=Number.parseLocale(j);var g=c[b.LogicalMonthPosition];if(String.isNullOrEmpty(g))g=a.getMonth();else{g=Number.parseLocale(g);g--}var i=c[b.LogicalDayPosition];if(String.isNullOrEmpty(i))i=a.getDay();else i=Number.parseLocale(i);a=new Date(j,g,i)}catch(p){return f}return a};Date.tryParseFuzzyTime=function(e,j){if(String.isNullOrEmpty(e))return null;var c=null,d=Sys.CultureInfo.CurrentCulture.dateTimeFormat,a=e.match(/^\s*(\d\d?)(\D*(\d\d?))?(\s*(\w+))?\s*$/);if(!a)a=e.match(/^\s*(\d\d?)(\D*(\d\d?))?(\D*(\d\d?))?(\D*(\d+))?(\s*([\S\s]+))?\s*$/);if(a){c=new Date;var b=a[1],g=a[3],i=a.length==10?a[5]:"",h=a.length==10?a[7]:"",f=a[a.length-1];if(!String.isNullOrEmpty(b)){b=Number.parseLocale(b);if(!String.isNullOrEmpty(f)){if(f.toLowerCase()==d.PMDesignator.toLowerCase()){if(b!=12)b+=12}else if(b==12)b=0}else if(j!=false&&!String.isNullOrEmpty(d.PMDesignator)&&d.ShortTimePattern.indexOf("tt")>0&&(new Date).getHours()>=12)b+=12;c.setHours(b)}!String.isNullOrEmpty(g)&&c.setMinutes(Number.parseLocale(g));c.setSeconds(!String.isNullOrEmpty(i)?Number.parseLocale(i):0);c.setMilliseconds(!String.isNullOrEmpty(h)?Number.parseLocale(h):0)}return c};Sys.Serialization.JavaScriptSerializer.deserialize=function(e,d){if(Sys.Serialization.JavaScriptSerializer._timeZoneOffset==null){Sys.Serialization.JavaScriptSerializer._timeZoneOffset="$1new Date($2)";if(typeof __timeZoneUtcOffset!="undefined"){var a=((new Date).getTimezoneOffset()+__timeZoneUtcOffset)*60*1e3;if(a!=0)Sys.Serialization.JavaScriptSerializer._timeZoneOffset=String.format("$1new Date($2{0}{1})",a<0?"-":"+",a<0?a*-1:a)}}var f,b=Sys.Serialization.JavaScriptSerializer._esc;try{var c=e.replace(b.dateRegEx,Sys.Serialization.JavaScriptSerializer._timeZoneOffset);if(d&&b.jsonRegEx.test(c.replace(b.jsonStringRegEx,"")))throw null;return eval("("+c+")")}catch(f){throw Error.argument("data",Sys.Res.cannotDeserializeInvalidJson);}};Date.$addDays=function(a,b){return a?new Date(a.setDate(a.getDate()+b)):a};Date.$now=function(){return new Date};Date.$today=function(){var a=new Date;return new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0)};Date.$endOfDay=function(){var a=new Date;return new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59)};Date.$within=function(a,b){return a?a<Date.$addDays(Date.$today(),b)&&a>=Date.$today():false};Date.$pastDue=function(b,a){if(a==null)a=new Date;if(a.getHours()==0)a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59);if(b==null)b=new Date;return b>a};Web.DataView._blankRegex=/^\s*$/;Web.DataView._fieldFilterRegex=/(\w+):([\s\S]*)/;Web.DataView._filterRegex=/(\*|~|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*?)(\0|$)$/;Web.DataView._filterIteratorRegex=/(\*|~|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*?)(\0|$)/g;Web.DataView._keepCapitalization=/^\$(month|quarter|true|false)/;Web.DataView._listRegex=/\$and\$|\$or\$/;Web.DataView._simpleListRegex=/\s*,\s*/;Web.DataView._htmlTest=/<\w+.*?>/;function __designer(){return typeof __designerMode!="undefined"}function __evalEvent(c){var a=this.getAttribute("on"+c+"2");if(String.isNullOrEmpty(a))return true;var b=true;a=a.replace(/(^|;)return /g,";returnResult=");eval(a);return b}Web.BusinessRules=function(a){this._dataView=a;this.result=new Web.BusinessRules.Result(this)};Web.BusinessRules.prototype={canceled:function(){return this._canceled==true},dispose:function(){this.reset(null);this._dataView=null;this.result._rules=null},reset:function(a){this._actionArgs=null;this._args=a},_initialize:function(){var a=this;if(!a._actionArgs){var b=a._dataView;a._actionArgs=b._createArguments(a._args,null);if(b.get_isEditing()){b._validateFieldValues(a._actionArgs.Values,a._args.causesValidation==null||a._args.causesValidation);a._valid=b.validate(a._actionArgs.Values)}}},process:function(s){var i=null,a=this,f=a._dataView,e=a._args.commandName;if(e=="Calculate"&&f._lookupIsActive){a.preventDefault();return}var g=Web.DataView.Geo;if(g&&!(__tf!=4)&&e.match(/New|Edit/)){for(var p=a._dataView._fields,b=0;b<p.length;b++){var d=p[b];if(!d.readOnly)if(d.tagged("modified-latitude")||d.tagged("created-latitude")&&e=="New")a.updateFieldValue(d.Name,g.latitude==-1?i:g.latitude);else if(d.tagged("modified-longitude")||d.tagged("created-longitude")&&e=="New")a.updateFieldValue(d.Name,g.longitude==-1?i:g.longitude);else(d.tagged("modified-coords")||d.tagged("created-coords")&&e=="New")&&a.updateFieldValue(d.Name,g.latitude==-1?i:String.format("{0},{1}",g.latitude,g.longitude))}if(a._newValues){f._updateCalculatedFields({Errors:[],Values:a._newValues});a._newValues=i}}var j=f._expressions;if(!j||j.length==0)return;if(!a._rules){a._rules=[];var r=0;for(b=0;b<j.length;b++){var n=j[b];if(n.Type==Web.DynamicExpressionType.ClientScript&&n.Scope==Web.DynamicExpressionScope.Rule){var h=n.Result.match(/^<id>(.+?)<\/id><commandName>(.+?)<\/commandName><commandArgument>(.*?)<\/commandArgument><view>(.*?)<\/view><phase>(.*?)<\/phase><script>([\s\S]+?)<\/script>$/);if(h){var o=String.format("Web.BusinessRules.{0}_Rule_{1}",f._controller,h[1]?h[1]:r),m=eval(String.format('typeof {0} !="undefined"?{0}:null',o));if(!m)m=eval(a._parseRule(o,h[6]));Array.add(a._rules,{commandName:h[2],commandArgument:h[3],view:h[4],phase:h[5],script:m})}}}}for(b=0;b<a._rules.length;b++){var c=a._rules[b];if(c.phase!=s)continue;var k=false;if(!String.isNullOrEmpty(c.view)){var q=f.get_viewId();if(!(c.view==q||q.match(new RegExp(c.view))))k=true}if(!String.isNullOrEmpty(c.commandName)){e=a._args.commandName;if(!(c.commandName==e||e.match(new RegExp(c.commandName))))k=true}if(!String.isNullOrEmpty(c.commandArgument)){var l=a._args.commandArgument;if(!(c.commandArgument==l||l&&l.match(new RegExp(c.commandArgument))))k=true}if(!k){c.script.call(a);if(a.canceled())break}}if(a._newValues){f._updateCalculatedFields({Errors:[],Values:a._newValues});delete a._newValues;a._pendingFocus()}else if(a.canceled()&&f.get_isDataSheet()){f._updateCalculatedFields({Errors:[],Values:[]});a._pendingFocus()}},_pendingFocus:function(){var a=this;if(a._focusFieldName){a._dataView._focus(a._focusFieldName,a._focusMessage);a._focusFieldName=null}},before:function(b){var a=this;a.reset(b);a.process("Before");!a.canceled()&&a.process("Execute")},after:function(a){if(this._dataView._isBusy)return;this.reset(a);this.process("After")},_parseRule:function(d,b){var a=new Sys.StringBuilder;a.appendFormat("{0}=function(){{\n",d);var c=/([\s\S]*?)(\[(\w+)(\.(\w+))?\](\s*=([^=][\s\S]+?);)?)/g;this._parseScript(a,c,b);b=a.toString();a.clear();this._parseScript(a,c,b);a.append("\n}");return a.toString()},_parseScript:function(b,f,c){var e=-1,a=f.exec(c);while(a){b.append(a[1]);var d=a[3],g=a[5];if(a[1].match(/\w$/))b.append(a[2]);else if(d.match(/^master$/i))b.appendFormat("this.fieldValue('{0}','Master')",g);else{var h=this._dataView.findField(d);if(!String.isNullOrEmpty(a[7]))b.appendFormat("this.updateFieldValue('{0}',{1});",d,a[7]);else b.appendFormat("this.fieldValue('{0}','{1}')",d,g)}e=f.lastIndex;a=f.exec(c)}if(e!=-1)b.append(e<c.length?c.substr(e):"");else b.append(c)},preventDefault:function(){this._canceled=true;this._dataView._raiseSelectedDelayed=false;this._dataView._pendingSelectedEvent=false},validateInput:function(){this._initialize();return this._valid==true},dataView:function(){return this._dataView},arguments:function(){this._initialize();return this._actionArgs},selectFieldValueObject:function(d){this._initialize();for(var b=this._actionArgs.Values,a=0;a<b.length;a++){var c=b[a];if(d==c.Name)return c}return null},selectFieldValue:function(b){var a=this.selectFieldValueObject(b);return a?a.Modified?a.NewValue:a.OldValue:null},fieldValue:function(b,d){var c=this;if(d=="Master"){var e=c._dataView.get_master();return e?e.fieldValue(b):null}if(!d||d=="Value")return c.selectFieldValue(b);var a=c.selectFieldValueObject(b);!a&&c._unknownField(b);switch(d){case"NewValue":return a.NewValue;case"OldValue":return a.OldValue;case"Modified":return a.Modified;case"ReadOnly":return a.ReadOnly;case"Error":return a.Error;default:return a.OldValue}},updateFieldValue:function(e,f){var b=this,d=b.selectFieldValueObject(e);if(d){d.NewValue=f;d.Modified=true;var a=b._newValues;if(!a)a=b._newValues=[];for(var c=0;c<a.length;c++)if(a[c].Name==e){Array.removeAt(a,c);break}Array.add(a,d)}else b._unknownField(e)},property:function(a,b){a="Rules$"+a;if(arguments.length==1)return this._dataView.readContext(a);else this._dataView.writeContext(a,b)},_unknownField:function(a){throw new Error(String.format('Unknown field "{0}" is not defined in  /controllers/{1}/views/{2}.',a,this._dataView._controller,this._dataView._viewId));}};Web.BusinessRules.Result=function(a){this._rules=a};Web.BusinessRules.Result.prototype={focus:function(d){var a=null;if(arguments.length>1){var c=Array.clone(arguments);Array.removeAt(c,0);a=String._toFormattedString(true,c)}var b=this._rules,e=b._dataView;b._focusFieldName=d;b._focusMessage=a;e._focus(d,a)},showMessage:function(){Web.DataView.showMessage(String._toFormattedString(true,arguments))},showViewMessage:function(){this._rules._dataView.showViewMessage(String._toFormattedString(true,arguments))},showAlert:function(){alert(String._toFormattedString(true,arguments))},confirm:function(){return confirm(String._toFormattedString(true,arguments))},refresh:function(a){this._rules._dataView(a==true)},refreshChildren:function(){var a=this._rules._dataView;a._forceChanged=true;a._raiseSelectedDelayed=true;this.refresh(true)}};Web$DataView$RichText=function(){};Web$DataView$RichText.prototype={attach:function(d){var f="text-align",c="align",b="style",g=$(d);g.addClass("dataview-rich-text");var i=$("html").attr("lang");if(String.isNullOrEmpty(i))i=$("html").attr("xml:lang");if(typeof CKEDITOR!="undefined"){$("<div></div>").insertAfter(g).width(g.outerWidth()).height(1);CKEDITOR.replace(d.id,{language:i,on:{instanceReady:function(b){var a=CKEDITOR.instances[d.id].getCommand("maximize");if(a){a._old_exec=a.exec;a.exec=function(a){this._old_exec(a);$(b.editor.container.$).find(".cke_maximized").css("z-index",10001)}}}}})}else{var a=Web.DataViewResources.Editor,k=[{CommandName:"Undo",Tooltip:a.Undo},{CommandName:"Redo",Tooltip:a.Redo},{CommandName:"Bold",Tooltip:a.Bold,ElementWhiteList:{b:[b],strong:[b]}},{CommandName:"Italic",Tooltip:a.Italic,ElementWhiteList:{i:[b],em:[b]}},{CommandName:"Underline",Tooltip:a.Underline,ElementWhiteList:{u:[b]}},{CommandName:"StrikeThrough",Tooltip:a.Strikethrough,ElementWhiteList:{strike:[b]}},{CommandName:"Subscript",Tooltip:a.Subscript,ElementWhiteList:{sub:[b]}},{CommandName:"Superscript",Tooltip:a.Superscript,ElementWhiteList:{sup:[b]}},{CommandName:"JustifyLeft",Tooltip:a.JustifyLeft,ElementWhiteList:{p:[c],div:[b,c]},AttributeWhiteList:{style:[f]},align:["left"]},{CommandName:"JustifyCenter",Tooltip:a.JustifyCenter,ElementWhiteList:{p:[c],div:[b,c]},AttributeWhiteList:{style:[f]},align:["center"]},{CommandName:"JustifyRight",Tooltip:a.JustifyRight,ElementWhiteList:{p:[c],div:[b,c]},AttributeWhiteList:{style:[f]},align:["right"]},{CommandName:"JustifyFull",Tooltip:a.JustifyFull,ElementWhiteList:{p:[c],div:[b,c]},AttributeWhiteList:{style:[f]},align:["justify"]},{CommandName:"insertOrderedList",Tooltip:a.InsertOrderedList,ElementWhiteList:{ol:[],li:[]}},{CommandName:"insertUnorderedList",Tooltip:a.InsertUnorderedList,ElementWhiteList:{ul:[],li:[]}},{CommandName:"createLink",Tooltip:a.CreateLink,ElementWhiteList:{a:["href"]}},{CommandName:"UnLink",Tooltip:a.UnLink},{CommandName:"RemoveFormat",Tooltip:a.RemoveFormat},{CommandName:"SelectAll",Tooltip:a.SelectAll},{CommandName:"UnSelect",Tooltip:a.UnSelect},{CommandName:"Delete",Tooltip:a.Delete},{CommandName:"Cut",Tooltip:a.Cut},{CommandName:"Paste",Tooltip:a.Paste},{CommandName:"BackColor",Tooltip:a.BackColor,ElementWhiteList:{font:b,span:b},AttributeWhiteList:{style:"background-color"}},{CommandName:"ForeColor",Tooltip:a.ForeColor,ElementWhiteList:{font:"color"},AttributeWhiteList:{font:"color"}},{CommandName:"FontName",Tooltip:a.FontName,ElementWhiteList:{font:["face"]},AttributeWhitList:{face:[]}},{CommandName:"FontSize",Tooltip:a.FontSize,ElementWhiteList:{font:["size"]},AttributeWhitList:{size:[]}},{CommandName:"Indent",Tooltip:a.Indent,ElementWhiteList:{blockquote:[b,"dir"]},AttributeWhitList:{style:["margin","margin-right","padding","border"],dir:["ltr","rtl","auto"]}},{CommandName:"Outdent",Tooltip:a.Outdent},{CommandName:"InsertHorizontalRule",Tooltip:a.InsertHorizontalRule,ElementWhiteList:{hr:["size","width"]},AttributeWhiteList:{size:[],width:[]}},{CommandName:"HorizontalSeparator",Tooltip:""}];navigator.appVersion.match(/MSIE/)&&k.splice(0,2);var e=Sys.Extended.UI.HtmlEditorExtenderBehavior;if(!e._customized){e.prototype.old_executeCommand=e.prototype._executeCommand;e.prototype._executeCommand=function(a){$(this._editableDiv).focus();this.old_executeCommand(a)};e._customized=true}var h=$create(e,{ToolbarButtons:k,id:d.id+"$Editor"},null,null,d);h._noEncoding=true;h._editableDiv.tabIndex=d.tabIndex;var j=$(h._topButtonContainer);j.find("nobr span").hide();j.find("select").css({"font-family":"","font-size":""})}return true},detach:function(a){if(typeof CKEDITOR!="undefined")CKEDITOR.remove(a.id);else{var b=$find(a.id+"$Editor");b&&b.dispose()}return true},persist:function(a){if(typeof CKEDITOR!="undefined")a.value=CKEDITOR.instances[a.id].getData();else{var b=$find(a.id+"$Editor");if(b)a.value=b._editableDiv.innerHTML}}};typeof Sys!=="undefined"&&Sys.Application.notifyScriptLoaded()